var js=Object.defineProperty;var ks=(r,e,t)=>e in r?js(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var Re=(r,e,t)=>ks(r,typeof e!="symbol"?e+"":e,t);import{r as b,a as Ss,g as Ns,c as F,b as it}from"./vendor-C1JoJ-56.js";import{B as Es}from"./router-Cxn95ysK.js";import{f as J,i as Me,a as Ps,b as Ts}from"./utils-CsonoGMZ.js";import{C as As,A as Os,M as at,L as wt,R as $s,P as Nt,U as Cs,a as Et,E as Pt,b as ot,X as ze,D as Pe,c as Is,H as Rs,d as Jt,e as Ls,W as Ds,f as Vt,g as vt,T as xt,h as lt,i as Us,S as Bs,j as qs,k as Ms,l as Ws,m as Fs,n as zs,o as Hs}from"./icons-CEdyd5dy.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))s(n);new MutationObserver(n=>{for(const i of n)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&s(o)}).observe(document,{childList:!0,subtree:!0});function t(n){const i={};return n.integrity&&(i.integrity=n.integrity),n.referrerPolicy&&(i.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?i.credentials="include":n.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function s(n){if(n.ep)return;n.ep=!0;const i=t(n);fetch(n.href,i)}})();var Kt={exports:{}},He={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Js=b,Vs=Symbol.for("react.element"),Ks=Symbol.for("react.fragment"),Gs=Object.prototype.hasOwnProperty,Ys=Js.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,Qs={key:!0,ref:!0,__self:!0,__source:!0};function Gt(r,e,t){var s,n={},i=null,o=null;t!==void 0&&(i=""+t),e.key!==void 0&&(i=""+e.key),e.ref!==void 0&&(o=e.ref);for(s in e)Gs.call(e,s)&&!Qs.hasOwnProperty(s)&&(n[s]=e[s]);if(r&&r.defaultProps)for(s in e=r.defaultProps,e)n[s]===void 0&&(n[s]=e[s]);return{$$typeof:Vs,type:r,key:i,ref:o,props:n,_owner:Ys.current}}He.Fragment=Ks;He.jsx=Gt;He.jsxs=Gt;Kt.exports=He;var a=Kt.exports,ct={},Tt=Ss;ct.createRoot=Tt.createRoot,ct.hydrateRoot=Tt.hydrateRoot;class Xs{constructor(){Re(this,"dbName","LuckyPickDB");Re(this,"version",1);Re(this,"db",null)}async init(){return new Promise((e,t)=>{const s=indexedDB.open(this.dbName,this.version);s.onerror=()=>t(s.error),s.onsuccess=()=>{this.db=s.result,e()},s.onupgradeneeded=n=>{const i=n.target.result;i.objectStoreNames.contains("sessions")||i.createObjectStore("sessions",{keyPath:"id"}),i.objectStoreNames.contains("bets")||i.createObjectStore("bets",{keyPath:"id"}),i.objectStoreNames.contains("results")||i.createObjectStore("results",{keyPath:"id"}),i.objectStoreNames.contains("transactions")||i.createObjectStore("transactions",{keyPath:"id"}),i.objectStoreNames.contains("user")||i.createObjectStore("user",{keyPath:"id"}),i.objectStoreNames.contains("offlineActions")||i.createObjectStore("offlineActions",{keyPath:"id",autoIncrement:!0})}})}async saveData(e,t){return this.db||await this.init(),new Promise((s,n)=>{const l=this.db.transaction([e],"readwrite").objectStore(e).put(t);l.onerror=()=>n(l.error),l.onsuccess=()=>s()})}async getData(e,t){return this.db||await this.init(),new Promise((s,n)=>{const o=this.db.transaction([e],"readonly").objectStore(e),l=t?o.get(t):o.getAll();l.onerror=()=>n(l.error),l.onsuccess=()=>s(l.result)})}async saveOfflineAction(e){const t={...e,timestamp:new Date().toISOString(),synced:!1};await this.saveData("offlineActions",t)}async getOfflineActions(){return(await this.getData("offlineActions")).filter(t=>!t.synced)}async markActionSynced(e){return this.db||await this.init(),new Promise((t,s)=>{const i=this.db.transaction(["offlineActions"],"readwrite").objectStore("offlineActions"),o=i.get(e);o.onsuccess=()=>{const l=o.result;if(l){l.synced=!0;const c=i.put(l);c.onsuccess=()=>t(),c.onerror=()=>s(c.error)}else t()},o.onerror=()=>s(o.error)})}}const X=new Xs,Yt=()=>{const[r,e]=b.useState(navigator.onLine),[t,s]=b.useState(!1);return b.useEffect(()=>{const n=()=>{e(!0),t&&("serviceWorker"in navigator&&"sync"in window.ServiceWorkerRegistration.prototype&&navigator.serviceWorker.ready.then(o=>o.sync.register("background-sync")),s(!1))},i=()=>{e(!1),s(!0)};return window.addEventListener("online",n),window.addEventListener("offline",i),()=>{window.removeEventListener("online",n),window.removeEventListener("offline",i)}},[t]),{isOnline:r,wasOffline:t}},Zs="modulepreload",er=function(r){return"/"+r},At={},Oe=function(e,t,s){let n=Promise.resolve();if(t&&t.length>0){document.getElementsByTagName("link");const o=document.querySelector("meta[property=csp-nonce]"),l=(o==null?void 0:o.nonce)||(o==null?void 0:o.getAttribute("nonce"));n=Promise.allSettled(t.map(c=>{if(c=er(c),c in At)return;At[c]=!0;const u=c.endsWith(".css"),d=u?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${c}"]${d}`))return;const h=document.createElement("link");if(h.rel=u?"stylesheet":Zs,u||(h.as="script"),h.crossOrigin="",h.href=c,l&&h.setAttribute("nonce",l),document.head.appendChild(h),u)return new Promise((f,m)=>{h.addEventListener("load",f),h.addEventListener("error",()=>m(new Error(`Unable to preload CSS for ${c}`)))})}))}function i(o){const l=new Event("vite:preloadError",{cancelable:!0});if(l.payload=o,window.dispatchEvent(l),!l.defaultPrevented)throw o}return n.then(o=>{for(const l of o||[])l.status==="rejected"&&i(l.reason);return e().catch(i)})},tr=r=>{let e;return r?e=r:typeof fetch>"u"?e=(...t)=>Oe(async()=>{const{default:s}=await Promise.resolve().then(()=>we);return{default:s}},void 0).then(({default:s})=>s(...t)):e=fetch,(...t)=>e(...t)};class bt extends Error{constructor(e,t="FunctionsError",s){super(e),this.name=t,this.context=s}}class sr extends bt{constructor(e){super("Failed to send a request to the Edge Function","FunctionsFetchError",e)}}class rr extends bt{constructor(e){super("Relay Error invoking the Edge Function","FunctionsRelayError",e)}}class nr extends bt{constructor(e){super("Edge Function returned a non-2xx status code","FunctionsHttpError",e)}}var dt;(function(r){r.Any="any",r.ApNortheast1="ap-northeast-1",r.ApNortheast2="ap-northeast-2",r.ApSouth1="ap-south-1",r.ApSoutheast1="ap-southeast-1",r.ApSoutheast2="ap-southeast-2",r.CaCentral1="ca-central-1",r.EuCentral1="eu-central-1",r.EuWest1="eu-west-1",r.EuWest2="eu-west-2",r.EuWest3="eu-west-3",r.SaEast1="sa-east-1",r.UsEast1="us-east-1",r.UsWest1="us-west-1",r.UsWest2="us-west-2"})(dt||(dt={}));var ir=function(r,e,t,s){function n(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function l(d){try{u(s.next(d))}catch(h){o(h)}}function c(d){try{u(s.throw(d))}catch(h){o(h)}}function u(d){d.done?i(d.value):n(d.value).then(l,c)}u((s=s.apply(r,e||[])).next())})};class ar{constructor(e,{headers:t={},customFetch:s,region:n=dt.Any}={}){this.url=e,this.headers=t,this.region=n,this.fetch=tr(s)}setAuth(e){this.headers.Authorization=`Bearer ${e}`}invoke(e,t={}){var s;return ir(this,void 0,void 0,function*(){try{const{headers:n,method:i,body:o}=t;let l={},{region:c}=t;c||(c=this.region),c&&c!=="any"&&(l["x-region"]=c);let u;o&&(n&&!Object.prototype.hasOwnProperty.call(n,"Content-Type")||!n)&&(typeof Blob<"u"&&o instanceof Blob||o instanceof ArrayBuffer?(l["Content-Type"]="application/octet-stream",u=o):typeof o=="string"?(l["Content-Type"]="text/plain",u=o):typeof FormData<"u"&&o instanceof FormData?u=o:(l["Content-Type"]="application/json",u=JSON.stringify(o)));const d=yield this.fetch(`${this.url}/${e}`,{method:i||"POST",headers:Object.assign(Object.assign(Object.assign({},l),this.headers),n),body:u}).catch(g=>{throw new sr(g)}),h=d.headers.get("x-relay-error");if(h&&h==="true")throw new rr(d);if(!d.ok)throw new nr(d);let f=((s=d.headers.get("Content-Type"))!==null&&s!==void 0?s:"text/plain").split(";")[0].trim(),m;return f==="application/json"?m=yield d.json():f==="application/octet-stream"?m=yield d.blob():f==="text/event-stream"?m=d:f==="multipart/form-data"?m=yield d.formData():m=yield d.text(),{data:m,error:null}}catch(n){return{data:null,error:n}}})}}var W={},_t={},Je={},$e={},Ve={},Ke={},or=function(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("unable to locate global object")},ye=or();const lr=ye.fetch,Qt=ye.fetch.bind(ye),Xt=ye.Headers,cr=ye.Request,dr=ye.Response,we=Object.freeze(Object.defineProperty({__proto__:null,Headers:Xt,Request:cr,Response:dr,default:Qt,fetch:lr},Symbol.toStringTag,{value:"Module"})),ur=Ns(we);var Ge={};Object.defineProperty(Ge,"__esModule",{value:!0});let hr=class extends Error{constructor(e){super(e.message),this.name="PostgrestError",this.details=e.details,this.hint=e.hint,this.code=e.code}};Ge.default=hr;var Zt=F&&F.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(Ke,"__esModule",{value:!0});const fr=Zt(ur),mr=Zt(Ge);let gr=class{constructor(e){this.shouldThrowOnError=!1,this.method=e.method,this.url=e.url,this.headers=e.headers,this.schema=e.schema,this.body=e.body,this.shouldThrowOnError=e.shouldThrowOnError,this.signal=e.signal,this.isMaybeSingle=e.isMaybeSingle,e.fetch?this.fetch=e.fetch:typeof fetch>"u"?this.fetch=fr.default:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(e,t){return this.headers=Object.assign({},this.headers),this.headers[e]=t,this}then(e,t){this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers["Accept-Profile"]=this.schema:this.headers["Content-Profile"]=this.schema),this.method!=="GET"&&this.method!=="HEAD"&&(this.headers["Content-Type"]="application/json");const s=this.fetch;let n=s(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async i=>{var o,l,c;let u=null,d=null,h=null,f=i.status,m=i.statusText;if(i.ok){if(this.method!=="HEAD"){const x=await i.text();x===""||(this.headers.Accept==="text/csv"||this.headers.Accept&&this.headers.Accept.includes("application/vnd.pgrst.plan+text")?d=x:d=JSON.parse(x))}const p=(o=this.headers.Prefer)===null||o===void 0?void 0:o.match(/count=(exact|planned|estimated)/),w=(l=i.headers.get("content-range"))===null||l===void 0?void 0:l.split("/");p&&w&&w.length>1&&(h=parseInt(w[1])),this.isMaybeSingle&&this.method==="GET"&&Array.isArray(d)&&(d.length>1?(u={code:"PGRST116",details:`Results contain ${d.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},d=null,h=null,f=406,m="Not Acceptable"):d.length===1?d=d[0]:d=null)}else{const p=await i.text();try{u=JSON.parse(p),Array.isArray(u)&&i.status===404&&(d=[],u=null,f=200,m="OK")}catch{i.status===404&&p===""?(f=204,m="No Content"):u={message:p}}if(u&&this.isMaybeSingle&&(!((c=u==null?void 0:u.details)===null||c===void 0)&&c.includes("0 rows"))&&(u=null,f=200,m="OK"),u&&this.shouldThrowOnError)throw new mr.default(u)}return{error:u,data:d,count:h,status:f,statusText:m}});return this.shouldThrowOnError||(n=n.catch(i=>{var o,l,c;return{error:{message:`${(o=i==null?void 0:i.name)!==null&&o!==void 0?o:"FetchError"}: ${i==null?void 0:i.message}`,details:`${(l=i==null?void 0:i.stack)!==null&&l!==void 0?l:""}`,hint:"",code:`${(c=i==null?void 0:i.code)!==null&&c!==void 0?c:""}`},data:null,count:null,status:0,statusText:""}})),n.then(e,t)}returns(){return this}overrideTypes(){return this}};Ke.default=gr;var pr=F&&F.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(Ve,"__esModule",{value:!0});const yr=pr(Ke);let wr=class extends yr.default{select(e){let t=!1;const s=(e??"*").split("").map(n=>/\s/.test(n)&&!t?"":(n==='"'&&(t=!t),n)).join("");return this.url.searchParams.set("select",s),this.headers.Prefer&&(this.headers.Prefer+=","),this.headers.Prefer+="return=representation",this}order(e,{ascending:t=!0,nullsFirst:s,foreignTable:n,referencedTable:i=n}={}){const o=i?`${i}.order`:"order",l=this.url.searchParams.get(o);return this.url.searchParams.set(o,`${l?`${l},`:""}${e}.${t?"asc":"desc"}${s===void 0?"":s?".nullsfirst":".nullslast"}`),this}limit(e,{foreignTable:t,referencedTable:s=t}={}){const n=typeof s>"u"?"limit":`${s}.limit`;return this.url.searchParams.set(n,`${e}`),this}range(e,t,{foreignTable:s,referencedTable:n=s}={}){const i=typeof n>"u"?"offset":`${n}.offset`,o=typeof n>"u"?"limit":`${n}.limit`;return this.url.searchParams.set(i,`${e}`),this.url.searchParams.set(o,`${t-e+1}`),this}abortSignal(e){return this.signal=e,this}single(){return this.headers.Accept="application/vnd.pgrst.object+json",this}maybeSingle(){return this.method==="GET"?this.headers.Accept="application/json":this.headers.Accept="application/vnd.pgrst.object+json",this.isMaybeSingle=!0,this}csv(){return this.headers.Accept="text/csv",this}geojson(){return this.headers.Accept="application/geo+json",this}explain({analyze:e=!1,verbose:t=!1,settings:s=!1,buffers:n=!1,wal:i=!1,format:o="text"}={}){var l;const c=[e?"analyze":null,t?"verbose":null,s?"settings":null,n?"buffers":null,i?"wal":null].filter(Boolean).join("|"),u=(l=this.headers.Accept)!==null&&l!==void 0?l:"application/json";return this.headers.Accept=`application/vnd.pgrst.plan+${o}; for="${u}"; options=${c};`,o==="json"?this:this}rollback(){var e;return((e=this.headers.Prefer)!==null&&e!==void 0?e:"").trim().length>0?this.headers.Prefer+=",tx=rollback":this.headers.Prefer="tx=rollback",this}returns(){return this}};Ve.default=wr;var vr=F&&F.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty($e,"__esModule",{value:!0});const xr=vr(Ve);let br=class extends xr.default{eq(e,t){return this.url.searchParams.append(e,`eq.${t}`),this}neq(e,t){return this.url.searchParams.append(e,`neq.${t}`),this}gt(e,t){return this.url.searchParams.append(e,`gt.${t}`),this}gte(e,t){return this.url.searchParams.append(e,`gte.${t}`),this}lt(e,t){return this.url.searchParams.append(e,`lt.${t}`),this}lte(e,t){return this.url.searchParams.append(e,`lte.${t}`),this}like(e,t){return this.url.searchParams.append(e,`like.${t}`),this}likeAllOf(e,t){return this.url.searchParams.append(e,`like(all).{${t.join(",")}}`),this}likeAnyOf(e,t){return this.url.searchParams.append(e,`like(any).{${t.join(",")}}`),this}ilike(e,t){return this.url.searchParams.append(e,`ilike.${t}`),this}ilikeAllOf(e,t){return this.url.searchParams.append(e,`ilike(all).{${t.join(",")}}`),this}ilikeAnyOf(e,t){return this.url.searchParams.append(e,`ilike(any).{${t.join(",")}}`),this}is(e,t){return this.url.searchParams.append(e,`is.${t}`),this}in(e,t){const s=Array.from(new Set(t)).map(n=>typeof n=="string"&&new RegExp("[,()]").test(n)?`"${n}"`:`${n}`).join(",");return this.url.searchParams.append(e,`in.(${s})`),this}contains(e,t){return typeof t=="string"?this.url.searchParams.append(e,`cs.${t}`):Array.isArray(t)?this.url.searchParams.append(e,`cs.{${t.join(",")}}`):this.url.searchParams.append(e,`cs.${JSON.stringify(t)}`),this}containedBy(e,t){return typeof t=="string"?this.url.searchParams.append(e,`cd.${t}`):Array.isArray(t)?this.url.searchParams.append(e,`cd.{${t.join(",")}}`):this.url.searchParams.append(e,`cd.${JSON.stringify(t)}`),this}rangeGt(e,t){return this.url.searchParams.append(e,`sr.${t}`),this}rangeGte(e,t){return this.url.searchParams.append(e,`nxl.${t}`),this}rangeLt(e,t){return this.url.searchParams.append(e,`sl.${t}`),this}rangeLte(e,t){return this.url.searchParams.append(e,`nxr.${t}`),this}rangeAdjacent(e,t){return this.url.searchParams.append(e,`adj.${t}`),this}overlaps(e,t){return typeof t=="string"?this.url.searchParams.append(e,`ov.${t}`):this.url.searchParams.append(e,`ov.{${t.join(",")}}`),this}textSearch(e,t,{config:s,type:n}={}){let i="";n==="plain"?i="pl":n==="phrase"?i="ph":n==="websearch"&&(i="w");const o=s===void 0?"":`(${s})`;return this.url.searchParams.append(e,`${i}fts${o}.${t}`),this}match(e){return Object.entries(e).forEach(([t,s])=>{this.url.searchParams.append(t,`eq.${s}`)}),this}not(e,t,s){return this.url.searchParams.append(e,`not.${t}.${s}`),this}or(e,{foreignTable:t,referencedTable:s=t}={}){const n=s?`${s}.or`:"or";return this.url.searchParams.append(n,`(${e})`),this}filter(e,t,s){return this.url.searchParams.append(e,`${t}.${s}`),this}};$e.default=br;var _r=F&&F.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(Je,"__esModule",{value:!0});const _e=_r($e);let jr=class{constructor(e,{headers:t={},schema:s,fetch:n}){this.url=e,this.headers=t,this.schema=s,this.fetch=n}select(e,{head:t=!1,count:s}={}){const n=t?"HEAD":"GET";let i=!1;const o=(e??"*").split("").map(l=>/\s/.test(l)&&!i?"":(l==='"'&&(i=!i),l)).join("");return this.url.searchParams.set("select",o),s&&(this.headers.Prefer=`count=${s}`),new _e.default({method:n,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}insert(e,{count:t,defaultToNull:s=!0}={}){const n="POST",i=[];if(this.headers.Prefer&&i.push(this.headers.Prefer),t&&i.push(`count=${t}`),s||i.push("missing=default"),this.headers.Prefer=i.join(","),Array.isArray(e)){const o=e.reduce((l,c)=>l.concat(Object.keys(c)),[]);if(o.length>0){const l=[...new Set(o)].map(c=>`"${c}"`);this.url.searchParams.set("columns",l.join(","))}}return new _e.default({method:n,url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:this.fetch,allowEmpty:!1})}upsert(e,{onConflict:t,ignoreDuplicates:s=!1,count:n,defaultToNull:i=!0}={}){const o="POST",l=[`resolution=${s?"ignore":"merge"}-duplicates`];if(t!==void 0&&this.url.searchParams.set("on_conflict",t),this.headers.Prefer&&l.push(this.headers.Prefer),n&&l.push(`count=${n}`),i||l.push("missing=default"),this.headers.Prefer=l.join(","),Array.isArray(e)){const c=e.reduce((u,d)=>u.concat(Object.keys(d)),[]);if(c.length>0){const u=[...new Set(c)].map(d=>`"${d}"`);this.url.searchParams.set("columns",u.join(","))}}return new _e.default({method:o,url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:this.fetch,allowEmpty:!1})}update(e,{count:t}={}){const s="PATCH",n=[];return this.headers.Prefer&&n.push(this.headers.Prefer),t&&n.push(`count=${t}`),this.headers.Prefer=n.join(","),new _e.default({method:s,url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:this.fetch,allowEmpty:!1})}delete({count:e}={}){const t="DELETE",s=[];return e&&s.push(`count=${e}`),this.headers.Prefer&&s.unshift(this.headers.Prefer),this.headers.Prefer=s.join(","),new _e.default({method:t,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}};Je.default=jr;var Ye={},Qe={};Object.defineProperty(Qe,"__esModule",{value:!0});Qe.version=void 0;Qe.version="0.0.0-automated";Object.defineProperty(Ye,"__esModule",{value:!0});Ye.DEFAULT_HEADERS=void 0;const kr=Qe;Ye.DEFAULT_HEADERS={"X-Client-Info":`postgrest-js/${kr.version}`};var es=F&&F.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(_t,"__esModule",{value:!0});const Sr=es(Je),Nr=es($e),Er=Ye;let Pr=class ts{constructor(e,{headers:t={},schema:s,fetch:n}={}){this.url=e,this.headers=Object.assign(Object.assign({},Er.DEFAULT_HEADERS),t),this.schemaName=s,this.fetch=n}from(e){const t=new URL(`${this.url}/${e}`);return new Sr.default(t,{headers:Object.assign({},this.headers),schema:this.schemaName,fetch:this.fetch})}schema(e){return new ts(this.url,{headers:this.headers,schema:e,fetch:this.fetch})}rpc(e,t={},{head:s=!1,get:n=!1,count:i}={}){let o;const l=new URL(`${this.url}/rpc/${e}`);let c;s||n?(o=s?"HEAD":"GET",Object.entries(t).filter(([d,h])=>h!==void 0).map(([d,h])=>[d,Array.isArray(h)?`{${h.join(",")}}`:`${h}`]).forEach(([d,h])=>{l.searchParams.append(d,h)})):(o="POST",c=t);const u=Object.assign({},this.headers);return i&&(u.Prefer=`count=${i}`),new Nr.default({method:o,url:l,headers:u,schema:this.schemaName,body:c,fetch:this.fetch,allowEmpty:!1})}};_t.default=Pr;var ve=F&&F.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(W,"__esModule",{value:!0});W.PostgrestError=W.PostgrestBuilder=W.PostgrestTransformBuilder=W.PostgrestFilterBuilder=W.PostgrestQueryBuilder=W.PostgrestClient=void 0;const ss=ve(_t);W.PostgrestClient=ss.default;const rs=ve(Je);W.PostgrestQueryBuilder=rs.default;const ns=ve($e);W.PostgrestFilterBuilder=ns.default;const is=ve(Ve);W.PostgrestTransformBuilder=is.default;const as=ve(Ke);W.PostgrestBuilder=as.default;const os=ve(Ge);W.PostgrestError=os.default;var Tr=W.default={PostgrestClient:ss.default,PostgrestQueryBuilder:rs.default,PostgrestFilterBuilder:ns.default,PostgrestTransformBuilder:is.default,PostgrestBuilder:as.default,PostgrestError:os.default};const{PostgrestClient:Ar,PostgrestQueryBuilder:zi,PostgrestFilterBuilder:Hi,PostgrestTransformBuilder:Ji,PostgrestBuilder:Vi,PostgrestError:Ki}=Tr;function Or(){if(typeof WebSocket<"u")return WebSocket;if(typeof global.WebSocket<"u")return global.WebSocket;if(typeof window.WebSocket<"u")return window.WebSocket;if(typeof self.WebSocket<"u")return self.WebSocket;throw new Error("`WebSocket` is not supported in this environment")}const $r=Or(),Cr="2.11.15",Ir=`realtime-js/${Cr}`,Rr="1.0.0",ls=1e4,Lr=1e3;var ke;(function(r){r[r.connecting=0]="connecting",r[r.open=1]="open",r[r.closing=2]="closing",r[r.closed=3]="closed"})(ke||(ke={}));var B;(function(r){r.closed="closed",r.errored="errored",r.joined="joined",r.joining="joining",r.leaving="leaving"})(B||(B={}));var H;(function(r){r.close="phx_close",r.error="phx_error",r.join="phx_join",r.reply="phx_reply",r.leave="phx_leave",r.access_token="access_token"})(H||(H={}));var ut;(function(r){r.websocket="websocket"})(ut||(ut={}));var ae;(function(r){r.Connecting="connecting",r.Open="open",r.Closing="closing",r.Closed="closed"})(ae||(ae={}));class Dr{constructor(){this.HEADER_LENGTH=1}decode(e,t){return e.constructor===ArrayBuffer?t(this._binaryDecode(e)):t(typeof e=="string"?JSON.parse(e):{})}_binaryDecode(e){const t=new DataView(e),s=new TextDecoder;return this._decodeBroadcast(e,t,s)}_decodeBroadcast(e,t,s){const n=t.getUint8(1),i=t.getUint8(2);let o=this.HEADER_LENGTH+2;const l=s.decode(e.slice(o,o+n));o=o+n;const c=s.decode(e.slice(o,o+i));o=o+i;const u=JSON.parse(s.decode(e.slice(o,e.byteLength)));return{ref:null,topic:l,event:c,payload:u}}}class cs{constructor(e,t){this.callback=e,this.timerCalc=t,this.timer=void 0,this.tries=0,this.callback=e,this.timerCalc=t}reset(){this.tries=0,clearTimeout(this.timer)}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}var I;(function(r){r.abstime="abstime",r.bool="bool",r.date="date",r.daterange="daterange",r.float4="float4",r.float8="float8",r.int2="int2",r.int4="int4",r.int4range="int4range",r.int8="int8",r.int8range="int8range",r.json="json",r.jsonb="jsonb",r.money="money",r.numeric="numeric",r.oid="oid",r.reltime="reltime",r.text="text",r.time="time",r.timestamp="timestamp",r.timestamptz="timestamptz",r.timetz="timetz",r.tsrange="tsrange",r.tstzrange="tstzrange"})(I||(I={}));const Ot=(r,e,t={})=>{var s;const n=(s=t.skipTypes)!==null&&s!==void 0?s:[];return Object.keys(e).reduce((i,o)=>(i[o]=Ur(o,r,e,n),i),{})},Ur=(r,e,t,s)=>{const n=e.find(l=>l.name===r),i=n==null?void 0:n.type,o=t[r];return i&&!s.includes(i)?ds(i,o):ht(o)},ds=(r,e)=>{if(r.charAt(0)==="_"){const t=r.slice(1,r.length);return Wr(e,t)}switch(r){case I.bool:return Br(e);case I.float4:case I.float8:case I.int2:case I.int4:case I.int8:case I.numeric:case I.oid:return qr(e);case I.json:case I.jsonb:return Mr(e);case I.timestamp:return Fr(e);case I.abstime:case I.date:case I.daterange:case I.int4range:case I.int8range:case I.money:case I.reltime:case I.text:case I.time:case I.timestamptz:case I.timetz:case I.tsrange:case I.tstzrange:return ht(e);default:return ht(e)}},ht=r=>r,Br=r=>{switch(r){case"t":return!0;case"f":return!1;default:return r}},qr=r=>{if(typeof r=="string"){const e=parseFloat(r);if(!Number.isNaN(e))return e}return r},Mr=r=>{if(typeof r=="string")try{return JSON.parse(r)}catch(e){return console.log(`JSON parse error: ${e}`),r}return r},Wr=(r,e)=>{if(typeof r!="string")return r;const t=r.length-1,s=r[t];if(r[0]==="{"&&s==="}"){let i;const o=r.slice(1,t);try{i=JSON.parse("["+o+"]")}catch{i=o?o.split(","):[]}return i.map(l=>ds(e,l))}return r},Fr=r=>typeof r=="string"?r.replace(" ","T"):r,us=r=>{let e=r;return e=e.replace(/^ws/i,"http"),e=e.replace(/(\/socket\/websocket|\/socket|\/websocket)\/?$/i,""),e.replace(/\/+$/,"")};class Ze{constructor(e,t,s={},n=ls){this.channel=e,this.event=t,this.payload=s,this.timeout=n,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(e){this.timeout=e,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(e){this.payload=Object.assign(Object.assign({},this.payload),e)}receive(e,t){var s;return this._hasReceived(e)&&t((s=this.receivedResp)===null||s===void 0?void 0:s.response),this.recHooks.push({status:e,callback:t}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const e=t=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=t,this._matchReceive(t)};this.channel._on(this.refEvent,{},e),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(e,t){this.refEvent&&this.channel._trigger(this.refEvent,{status:e,response:t})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:e,response:t}){this.recHooks.filter(s=>s.status===e).forEach(s=>s.callback(t))}_hasReceived(e){return this.receivedResp&&this.receivedResp.status===e}}var $t;(function(r){r.SYNC="sync",r.JOIN="join",r.LEAVE="leave"})($t||($t={}));class Se{constructor(e,t){this.channel=e,this.state={},this.pendingDiffs=[],this.joinRef=null,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const s=(t==null?void 0:t.events)||{state:"presence_state",diff:"presence_diff"};this.channel._on(s.state,{},n=>{const{onJoin:i,onLeave:o,onSync:l}=this.caller;this.joinRef=this.channel._joinRef(),this.state=Se.syncState(this.state,n,i,o),this.pendingDiffs.forEach(c=>{this.state=Se.syncDiff(this.state,c,i,o)}),this.pendingDiffs=[],l()}),this.channel._on(s.diff,{},n=>{const{onJoin:i,onLeave:o,onSync:l}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(n):(this.state=Se.syncDiff(this.state,n,i,o),l())}),this.onJoin((n,i,o)=>{this.channel._trigger("presence",{event:"join",key:n,currentPresences:i,newPresences:o})}),this.onLeave((n,i,o)=>{this.channel._trigger("presence",{event:"leave",key:n,currentPresences:i,leftPresences:o})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(e,t,s,n){const i=this.cloneDeep(e),o=this.transformState(t),l={},c={};return this.map(i,(u,d)=>{o[u]||(c[u]=d)}),this.map(o,(u,d)=>{const h=i[u];if(h){const f=d.map(w=>w.presence_ref),m=h.map(w=>w.presence_ref),g=d.filter(w=>m.indexOf(w.presence_ref)<0),p=h.filter(w=>f.indexOf(w.presence_ref)<0);g.length>0&&(l[u]=g),p.length>0&&(c[u]=p)}else l[u]=d}),this.syncDiff(i,{joins:l,leaves:c},s,n)}static syncDiff(e,t,s,n){const{joins:i,leaves:o}={joins:this.transformState(t.joins),leaves:this.transformState(t.leaves)};return s||(s=()=>{}),n||(n=()=>{}),this.map(i,(l,c)=>{var u;const d=(u=e[l])!==null&&u!==void 0?u:[];if(e[l]=this.cloneDeep(c),d.length>0){const h=e[l].map(m=>m.presence_ref),f=d.filter(m=>h.indexOf(m.presence_ref)<0);e[l].unshift(...f)}s(l,d,c)}),this.map(o,(l,c)=>{let u=e[l];if(!u)return;const d=c.map(h=>h.presence_ref);u=u.filter(h=>d.indexOf(h.presence_ref)<0),e[l]=u,n(l,u,c),u.length===0&&delete e[l]}),e}static map(e,t){return Object.getOwnPropertyNames(e).map(s=>t(s,e[s]))}static transformState(e){return e=this.cloneDeep(e),Object.getOwnPropertyNames(e).reduce((t,s)=>{const n=e[s];return"metas"in n?t[s]=n.metas.map(i=>(i.presence_ref=i.phx_ref,delete i.phx_ref,delete i.phx_ref_prev,i)):t[s]=n,t},{})}static cloneDeep(e){return JSON.parse(JSON.stringify(e))}onJoin(e){this.caller.onJoin=e}onLeave(e){this.caller.onLeave=e}onSync(e){this.caller.onSync=e}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var Ct;(function(r){r.ALL="*",r.INSERT="INSERT",r.UPDATE="UPDATE",r.DELETE="DELETE"})(Ct||(Ct={}));var It;(function(r){r.BROADCAST="broadcast",r.PRESENCE="presence",r.POSTGRES_CHANGES="postgres_changes",r.SYSTEM="system"})(It||(It={}));var Y;(function(r){r.SUBSCRIBED="SUBSCRIBED",r.TIMED_OUT="TIMED_OUT",r.CLOSED="CLOSED",r.CHANNEL_ERROR="CHANNEL_ERROR"})(Y||(Y={}));class jt{constructor(e,t={config:{}},s){this.topic=e,this.params=t,this.socket=s,this.bindings={},this.state=B.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=e.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:""},private:!1},t.config),this.timeout=this.socket.timeout,this.joinPush=new Ze(this,H.join,this.params,this.timeout),this.rejoinTimer=new cs(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=B.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(n=>n.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=B.closed,this.socket._remove(this)}),this._onError(n=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,n),this.state=B.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=B.errored,this.rejoinTimer.scheduleTimeout())}),this._on(H.reply,{},(n,i)=>{this._trigger(this._replyEventName(i),n)}),this.presence=new Se(this),this.broadcastEndpointURL=us(this.socket.endPoint)+"/api/broadcast",this.private=this.params.config.private||!1}subscribe(e,t=this.timeout){var s,n;if(this.socket.isConnected()||this.socket.connect(),this.state==B.closed){const{config:{broadcast:i,presence:o,private:l}}=this.params;this._onError(d=>e==null?void 0:e(Y.CHANNEL_ERROR,d)),this._onClose(()=>e==null?void 0:e(Y.CLOSED));const c={},u={broadcast:i,presence:o,postgres_changes:(n=(s=this.bindings.postgres_changes)===null||s===void 0?void 0:s.map(d=>d.filter))!==null&&n!==void 0?n:[],private:l};this.socket.accessTokenValue&&(c.access_token=this.socket.accessTokenValue),this.updateJoinPayload(Object.assign({config:u},c)),this.joinedOnce=!0,this._rejoin(t),this.joinPush.receive("ok",async({postgres_changes:d})=>{var h;if(this.socket.setAuth(),d===void 0){e==null||e(Y.SUBSCRIBED);return}else{const f=this.bindings.postgres_changes,m=(h=f==null?void 0:f.length)!==null&&h!==void 0?h:0,g=[];for(let p=0;p<m;p++){const w=f[p],{filter:{event:x,schema:v,table:y,filter:N}}=w,_=d&&d[p];if(_&&_.event===x&&_.schema===v&&_.table===y&&_.filter===N)g.push(Object.assign(Object.assign({},w),{id:_.id}));else{this.unsubscribe(),this.state=B.errored,e==null||e(Y.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=g,e&&e(Y.SUBSCRIBED);return}}).receive("error",d=>{this.state=B.errored,e==null||e(Y.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(d).join(", ")||"error")))}).receive("timeout",()=>{e==null||e(Y.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(e,t={}){return await this.send({type:"presence",event:"track",payload:e},t.timeout||this.timeout)}async untrack(e={}){return await this.send({type:"presence",event:"untrack"},e)}on(e,t,s){return this._on(e,t,s)}async send(e,t={}){var s,n;if(!this._canPush()&&e.type==="broadcast"){const{event:i,payload:o}=e,c={method:"POST",headers:{Authorization:this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"",apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:i,payload:o,private:this.private}]})};try{const u=await this._fetchWithTimeout(this.broadcastEndpointURL,c,(s=t.timeout)!==null&&s!==void 0?s:this.timeout);return await((n=u.body)===null||n===void 0?void 0:n.cancel()),u.ok?"ok":"error"}catch(u){return u.name==="AbortError"?"timed out":"error"}}else return new Promise(i=>{var o,l,c;const u=this._push(e.type,e,t.timeout||this.timeout);e.type==="broadcast"&&!(!((c=(l=(o=this.params)===null||o===void 0?void 0:o.config)===null||l===void 0?void 0:l.broadcast)===null||c===void 0)&&c.ack)&&i("ok"),u.receive("ok",()=>i("ok")),u.receive("error",()=>i("error")),u.receive("timeout",()=>i("timed out"))})}updateJoinPayload(e){this.joinPush.updatePayload(e)}unsubscribe(e=this.timeout){this.state=B.leaving;const t=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(H.close,"leave",this._joinRef())};this.joinPush.destroy();let s=null;return new Promise(n=>{s=new Ze(this,H.leave,{},e),s.receive("ok",()=>{t(),n("ok")}).receive("timeout",()=>{t(),n("timed out")}).receive("error",()=>{n("error")}),s.send(),this._canPush()||s.trigger("ok",{})}).finally(()=>{s==null||s.destroy()})}teardown(){this.pushBuffer.forEach(e=>e.destroy()),this.rejoinTimer&&clearTimeout(this.rejoinTimer.timer),this.joinPush.destroy()}async _fetchWithTimeout(e,t,s){const n=new AbortController,i=setTimeout(()=>n.abort(),s),o=await this.socket.fetch(e,Object.assign(Object.assign({},t),{signal:n.signal}));return clearTimeout(i),o}_push(e,t,s=this.timeout){if(!this.joinedOnce)throw`tried to push '${e}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let n=new Ze(this,e,t,s);return this._canPush()?n.send():(n.startTimeout(),this.pushBuffer.push(n)),n}_onMessage(e,t,s){return t}_isMember(e){return this.topic===e}_joinRef(){return this.joinPush.ref}_trigger(e,t,s){var n,i;const o=e.toLocaleLowerCase(),{close:l,error:c,leave:u,join:d}=H;if(s&&[l,c,u,d].indexOf(o)>=0&&s!==this._joinRef())return;let f=this._onMessage(o,t,s);if(t&&!f)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(o)?(n=this.bindings.postgres_changes)===null||n===void 0||n.filter(m=>{var g,p,w;return((g=m.filter)===null||g===void 0?void 0:g.event)==="*"||((w=(p=m.filter)===null||p===void 0?void 0:p.event)===null||w===void 0?void 0:w.toLocaleLowerCase())===o}).map(m=>m.callback(f,s)):(i=this.bindings[o])===null||i===void 0||i.filter(m=>{var g,p,w,x,v,y;if(["broadcast","presence","postgres_changes"].includes(o))if("id"in m){const N=m.id,_=(g=m.filter)===null||g===void 0?void 0:g.event;return N&&((p=t.ids)===null||p===void 0?void 0:p.includes(N))&&(_==="*"||(_==null?void 0:_.toLocaleLowerCase())===((w=t.data)===null||w===void 0?void 0:w.type.toLocaleLowerCase()))}else{const N=(v=(x=m==null?void 0:m.filter)===null||x===void 0?void 0:x.event)===null||v===void 0?void 0:v.toLocaleLowerCase();return N==="*"||N===((y=t==null?void 0:t.event)===null||y===void 0?void 0:y.toLocaleLowerCase())}else return m.type.toLocaleLowerCase()===o}).map(m=>{if(typeof f=="object"&&"ids"in f){const g=f.data,{schema:p,table:w,commit_timestamp:x,type:v,errors:y}=g;f=Object.assign(Object.assign({},{schema:p,table:w,commit_timestamp:x,eventType:v,new:{},old:{},errors:y}),this._getPayloadRecords(g))}m.callback(f,s)})}_isClosed(){return this.state===B.closed}_isJoined(){return this.state===B.joined}_isJoining(){return this.state===B.joining}_isLeaving(){return this.state===B.leaving}_replyEventName(e){return`chan_reply_${e}`}_on(e,t,s){const n=e.toLocaleLowerCase(),i={type:n,filter:t,callback:s};return this.bindings[n]?this.bindings[n].push(i):this.bindings[n]=[i],this}_off(e,t){const s=e.toLocaleLowerCase();return this.bindings[s]=this.bindings[s].filter(n=>{var i;return!(((i=n.type)===null||i===void 0?void 0:i.toLocaleLowerCase())===s&&jt.isEqual(n.filter,t))}),this}static isEqual(e,t){if(Object.keys(e).length!==Object.keys(t).length)return!1;for(const s in e)if(e[s]!==t[s])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(e){this._on(H.close,{},e)}_onError(e){this._on(H.error,{},t=>e(t))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(e=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=B.joining,this.joinPush.resend(e))}_getPayloadRecords(e){const t={new:{},old:{}};return(e.type==="INSERT"||e.type==="UPDATE")&&(t.new=Ot(e.columns,e.record)),(e.type==="UPDATE"||e.type==="DELETE")&&(t.old=Ot(e.columns,e.old_record)),t}}const Rt=()=>{},zr=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`;class Hr{constructor(e,t){var s;this.accessTokenValue=null,this.apiKey=null,this.channels=new Array,this.endPoint="",this.httpEndpoint="",this.headers={},this.params={},this.timeout=ls,this.heartbeatIntervalMs=25e3,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=Rt,this.ref=0,this.logger=Rt,this.conn=null,this.sendBuffer=[],this.serializer=new Dr,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._resolveFetch=i=>{let o;return i?o=i:typeof fetch>"u"?o=(...l)=>Oe(async()=>{const{default:c}=await Promise.resolve().then(()=>we);return{default:c}},void 0).then(({default:c})=>c(...l)):o=fetch,(...l)=>o(...l)},this.endPoint=`${e}/${ut.websocket}`,this.httpEndpoint=us(e),t!=null&&t.transport?this.transport=t.transport:this.transport=null,t!=null&&t.params&&(this.params=t.params),t!=null&&t.timeout&&(this.timeout=t.timeout),t!=null&&t.logger&&(this.logger=t.logger),(t!=null&&t.logLevel||t!=null&&t.log_level)&&(this.logLevel=t.logLevel||t.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),t!=null&&t.heartbeatIntervalMs&&(this.heartbeatIntervalMs=t.heartbeatIntervalMs);const n=(s=t==null?void 0:t.params)===null||s===void 0?void 0:s.apikey;if(n&&(this.accessTokenValue=n,this.apiKey=n),this.reconnectAfterMs=t!=null&&t.reconnectAfterMs?t.reconnectAfterMs:i=>[1e3,2e3,5e3,1e4][i-1]||1e4,this.encode=t!=null&&t.encode?t.encode:(i,o)=>o(JSON.stringify(i)),this.decode=t!=null&&t.decode?t.decode:this.serializer.decode.bind(this.serializer),this.reconnectTimer=new cs(async()=>{this.disconnect(),this.connect()},this.reconnectAfterMs),this.fetch=this._resolveFetch(t==null?void 0:t.fetch),t!=null&&t.worker){if(typeof window<"u"&&!window.Worker)throw new Error("Web Worker is not supported");this.worker=(t==null?void 0:t.worker)||!1,this.workerUrl=t==null?void 0:t.workerUrl}this.accessToken=(t==null?void 0:t.accessToken)||null}connect(){if(!this.conn){if(this.transport||(this.transport=$r),!this.transport)throw new Error("No transport provided");this.conn=new this.transport(this.endpointURL()),this.setupConnection()}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:Rr}))}disconnect(e,t){this.conn&&(this.conn.onclose=function(){},e?this.conn.close(e,t??""):this.conn.close(),this.conn=null,this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.reset(),this.channels.forEach(s=>s.teardown()))}getChannels(){return this.channels}async removeChannel(e){const t=await e.unsubscribe();return this.channels.length===0&&this.disconnect(),t}async removeAllChannels(){const e=await Promise.all(this.channels.map(t=>t.unsubscribe()));return this.channels=[],this.disconnect(),e}log(e,t,s){this.logger(e,t,s)}connectionState(){switch(this.conn&&this.conn.readyState){case ke.connecting:return ae.Connecting;case ke.open:return ae.Open;case ke.closing:return ae.Closing;default:return ae.Closed}}isConnected(){return this.connectionState()===ae.Open}channel(e,t={config:{}}){const s=`realtime:${e}`,n=this.getChannels().find(i=>i.topic===s);if(n)return n;{const i=new jt(`realtime:${e}`,t,this);return this.channels.push(i),i}}push(e){const{topic:t,event:s,payload:n,ref:i}=e,o=()=>{this.encode(e,l=>{var c;(c=this.conn)===null||c===void 0||c.send(l)})};this.log("push",`${t} ${s} (${i})`,n),this.isConnected()?o():this.sendBuffer.push(o)}async setAuth(e=null){let t=e||this.accessToken&&await this.accessToken()||this.accessTokenValue;this.accessTokenValue!=t&&(this.accessTokenValue=t,this.channels.forEach(s=>{const n={access_token:t,version:Ir};t&&s.updateJoinPayload(n),s.joinedOnce&&s._isJoined()&&s._push(H.access_token,{access_token:t})}))}async sendHeartbeat(){var e;if(!this.isConnected()){this.heartbeatCallback("disconnected");return}if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection"),this.heartbeatCallback("timeout"),(e=this.conn)===null||e===void 0||e.close(Lr,"hearbeat timeout");return}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef}),this.heartbeatCallback("sent"),await this.setAuth()}onHeartbeat(e){this.heartbeatCallback=e}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(e=>e()),this.sendBuffer=[])}_makeRef(){let e=this.ref+1;return e===this.ref?this.ref=0:this.ref=e,this.ref.toString()}_leaveOpenTopic(e){let t=this.channels.find(s=>s.topic===e&&(s._isJoined()||s._isJoining()));t&&(this.log("transport",`leaving duplicate topic "${e}"`),t.unsubscribe())}_remove(e){this.channels=this.channels.filter(t=>t.topic!==e.topic)}setupConnection(){this.conn&&(this.conn.binaryType="arraybuffer",this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=e=>this._onConnError(e),this.conn.onmessage=e=>this._onConnMessage(e),this.conn.onclose=e=>this._onConnClose(e))}_onConnMessage(e){this.decode(e.data,t=>{let{topic:s,event:n,payload:i,ref:o}=t;s==="phoenix"&&n==="phx_reply"&&this.heartbeatCallback(t.payload.status=="ok"?"ok":"error"),o&&o===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null),this.log("receive",`${i.status||""} ${s} ${n} ${o&&"("+o+")"||""}`,i),Array.from(this.channels).filter(l=>l._isMember(s)).forEach(l=>l._trigger(n,i,o)),this.stateChangeCallbacks.message.forEach(l=>l(t))})}_onConnOpen(){this.log("transport",`connected to ${this.endpointURL()}`),this.flushSendBuffer(),this.reconnectTimer.reset(),this.worker?this.workerRef||this._startWorkerHeartbeat():this._startHeartbeat(),this.stateChangeCallbacks.open.forEach(e=>e())}_startHeartbeat(){this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs)}_startWorkerHeartbeat(){this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const e=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(e),this.workerRef.onerror=t=>{this.log("worker","worker error",t.message),this.workerRef.terminate()},this.workerRef.onmessage=t=>{t.data.event==="keepAlive"&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}_onConnClose(e){this.log("transport","close",e),this._triggerChanError(),this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.scheduleTimeout(),this.stateChangeCallbacks.close.forEach(t=>t(e))}_onConnError(e){this.log("transport",`${e}`),this._triggerChanError(),this.stateChangeCallbacks.error.forEach(t=>t(e))}_triggerChanError(){this.channels.forEach(e=>e._trigger(H.error))}_appendParams(e,t){if(Object.keys(t).length===0)return e;const s=e.match(/\?/)?"&":"?",n=new URLSearchParams(t);return`${e}${s}${n}`}_workerObjectUrl(e){let t;if(e)t=e;else{const s=new Blob([zr],{type:"application/javascript"});t=URL.createObjectURL(s)}return t}}class kt extends Error{constructor(e){super(e),this.__isStorageError=!0,this.name="StorageError"}}function D(r){return typeof r=="object"&&r!==null&&"__isStorageError"in r}class Jr extends kt{constructor(e,t){super(e),this.name="StorageApiError",this.status=t}toJSON(){return{name:this.name,message:this.message,status:this.status}}}class ft extends kt{constructor(e,t){super(e),this.name="StorageUnknownError",this.originalError=t}}var Vr=function(r,e,t,s){function n(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function l(d){try{u(s.next(d))}catch(h){o(h)}}function c(d){try{u(s.throw(d))}catch(h){o(h)}}function u(d){d.done?i(d.value):n(d.value).then(l,c)}u((s=s.apply(r,e||[])).next())})};const hs=r=>{let e;return r?e=r:typeof fetch>"u"?e=(...t)=>Oe(async()=>{const{default:s}=await Promise.resolve().then(()=>we);return{default:s}},void 0).then(({default:s})=>s(...t)):e=fetch,(...t)=>e(...t)},Kr=()=>Vr(void 0,void 0,void 0,function*(){return typeof Response>"u"?(yield Oe(()=>Promise.resolve().then(()=>we),void 0)).Response:Response}),mt=r=>{if(Array.isArray(r))return r.map(t=>mt(t));if(typeof r=="function"||r!==Object(r))return r;const e={};return Object.entries(r).forEach(([t,s])=>{const n=t.replace(/([-_][a-z])/gi,i=>i.toUpperCase().replace(/[-_]/g,""));e[n]=mt(s)}),e};var oe=function(r,e,t,s){function n(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function l(d){try{u(s.next(d))}catch(h){o(h)}}function c(d){try{u(s.throw(d))}catch(h){o(h)}}function u(d){d.done?i(d.value):n(d.value).then(l,c)}u((s=s.apply(r,e||[])).next())})};const et=r=>r.msg||r.message||r.error_description||r.error||JSON.stringify(r),Gr=(r,e,t)=>oe(void 0,void 0,void 0,function*(){const s=yield Kr();r instanceof s&&!(t!=null&&t.noResolveJson)?r.json().then(n=>{e(new Jr(et(n),r.status||500))}).catch(n=>{e(new ft(et(n),n))}):e(new ft(et(r),r))}),Yr=(r,e,t,s)=>{const n={method:r,headers:(e==null?void 0:e.headers)||{}};return r==="GET"?n:(n.headers=Object.assign({"Content-Type":"application/json"},e==null?void 0:e.headers),s&&(n.body=JSON.stringify(s)),Object.assign(Object.assign({},n),t))};function Ce(r,e,t,s,n,i){return oe(this,void 0,void 0,function*(){return new Promise((o,l)=>{r(t,Yr(e,s,n,i)).then(c=>{if(!c.ok)throw c;return s!=null&&s.noResolveJson?c:c.json()}).then(c=>o(c)).catch(c=>Gr(c,l,s))})})}function We(r,e,t,s){return oe(this,void 0,void 0,function*(){return Ce(r,"GET",e,t,s)})}function ee(r,e,t,s,n){return oe(this,void 0,void 0,function*(){return Ce(r,"POST",e,s,n,t)})}function Qr(r,e,t,s,n){return oe(this,void 0,void 0,function*(){return Ce(r,"PUT",e,s,n,t)})}function Xr(r,e,t,s){return oe(this,void 0,void 0,function*(){return Ce(r,"HEAD",e,Object.assign(Object.assign({},t),{noResolveJson:!0}),s)})}function fs(r,e,t,s,n){return oe(this,void 0,void 0,function*(){return Ce(r,"DELETE",e,s,n,t)})}var M=function(r,e,t,s){function n(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function l(d){try{u(s.next(d))}catch(h){o(h)}}function c(d){try{u(s.throw(d))}catch(h){o(h)}}function u(d){d.done?i(d.value):n(d.value).then(l,c)}u((s=s.apply(r,e||[])).next())})};const Zr={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},Lt={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class en{constructor(e,t={},s,n){this.url=e,this.headers=t,this.bucketId=s,this.fetch=hs(n)}uploadOrUpdate(e,t,s,n){return M(this,void 0,void 0,function*(){try{let i;const o=Object.assign(Object.assign({},Lt),n);let l=Object.assign(Object.assign({},this.headers),e==="POST"&&{"x-upsert":String(o.upsert)});const c=o.metadata;typeof Blob<"u"&&s instanceof Blob?(i=new FormData,i.append("cacheControl",o.cacheControl),c&&i.append("metadata",this.encodeMetadata(c)),i.append("",s)):typeof FormData<"u"&&s instanceof FormData?(i=s,i.append("cacheControl",o.cacheControl),c&&i.append("metadata",this.encodeMetadata(c))):(i=s,l["cache-control"]=`max-age=${o.cacheControl}`,l["content-type"]=o.contentType,c&&(l["x-metadata"]=this.toBase64(this.encodeMetadata(c)))),n!=null&&n.headers&&(l=Object.assign(Object.assign({},l),n.headers));const u=this._removeEmptyFolders(t),d=this._getFinalPath(u),h=yield this.fetch(`${this.url}/object/${d}`,Object.assign({method:e,body:i,headers:l},o!=null&&o.duplex?{duplex:o.duplex}:{})),f=yield h.json();return h.ok?{data:{path:u,id:f.Id,fullPath:f.Key},error:null}:{data:null,error:f}}catch(i){if(D(i))return{data:null,error:i};throw i}})}upload(e,t,s){return M(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",e,t,s)})}uploadToSignedUrl(e,t,s,n){return M(this,void 0,void 0,function*(){const i=this._removeEmptyFolders(e),o=this._getFinalPath(i),l=new URL(this.url+`/object/upload/sign/${o}`);l.searchParams.set("token",t);try{let c;const u=Object.assign({upsert:Lt.upsert},n),d=Object.assign(Object.assign({},this.headers),{"x-upsert":String(u.upsert)});typeof Blob<"u"&&s instanceof Blob?(c=new FormData,c.append("cacheControl",u.cacheControl),c.append("",s)):typeof FormData<"u"&&s instanceof FormData?(c=s,c.append("cacheControl",u.cacheControl)):(c=s,d["cache-control"]=`max-age=${u.cacheControl}`,d["content-type"]=u.contentType);const h=yield this.fetch(l.toString(),{method:"PUT",body:c,headers:d}),f=yield h.json();return h.ok?{data:{path:i,fullPath:f.Key},error:null}:{data:null,error:f}}catch(c){if(D(c))return{data:null,error:c};throw c}})}createSignedUploadUrl(e,t){return M(this,void 0,void 0,function*(){try{let s=this._getFinalPath(e);const n=Object.assign({},this.headers);t!=null&&t.upsert&&(n["x-upsert"]="true");const i=yield ee(this.fetch,`${this.url}/object/upload/sign/${s}`,{},{headers:n}),o=new URL(this.url+i.url),l=o.searchParams.get("token");if(!l)throw new kt("No token returned by API");return{data:{signedUrl:o.toString(),path:e,token:l},error:null}}catch(s){if(D(s))return{data:null,error:s};throw s}})}update(e,t,s){return M(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",e,t,s)})}move(e,t,s){return M(this,void 0,void 0,function*(){try{return{data:yield ee(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:s==null?void 0:s.destinationBucket},{headers:this.headers}),error:null}}catch(n){if(D(n))return{data:null,error:n};throw n}})}copy(e,t,s){return M(this,void 0,void 0,function*(){try{return{data:{path:(yield ee(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:s==null?void 0:s.destinationBucket},{headers:this.headers})).Key},error:null}}catch(n){if(D(n))return{data:null,error:n};throw n}})}createSignedUrl(e,t,s){return M(this,void 0,void 0,function*(){try{let n=this._getFinalPath(e),i=yield ee(this.fetch,`${this.url}/object/sign/${n}`,Object.assign({expiresIn:t},s!=null&&s.transform?{transform:s.transform}:{}),{headers:this.headers});const o=s!=null&&s.download?`&download=${s.download===!0?"":s.download}`:"";return i={signedUrl:encodeURI(`${this.url}${i.signedURL}${o}`)},{data:i,error:null}}catch(n){if(D(n))return{data:null,error:n};throw n}})}createSignedUrls(e,t,s){return M(this,void 0,void 0,function*(){try{const n=yield ee(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:t,paths:e},{headers:this.headers}),i=s!=null&&s.download?`&download=${s.download===!0?"":s.download}`:"";return{data:n.map(o=>Object.assign(Object.assign({},o),{signedUrl:o.signedURL?encodeURI(`${this.url}${o.signedURL}${i}`):null})),error:null}}catch(n){if(D(n))return{data:null,error:n};throw n}})}download(e,t){return M(this,void 0,void 0,function*(){const n=typeof(t==null?void 0:t.transform)<"u"?"render/image/authenticated":"object",i=this.transformOptsToQueryString((t==null?void 0:t.transform)||{}),o=i?`?${i}`:"";try{const l=this._getFinalPath(e);return{data:yield(yield We(this.fetch,`${this.url}/${n}/${l}${o}`,{headers:this.headers,noResolveJson:!0})).blob(),error:null}}catch(l){if(D(l))return{data:null,error:l};throw l}})}info(e){return M(this,void 0,void 0,function*(){const t=this._getFinalPath(e);try{const s=yield We(this.fetch,`${this.url}/object/info/${t}`,{headers:this.headers});return{data:mt(s),error:null}}catch(s){if(D(s))return{data:null,error:s};throw s}})}exists(e){return M(this,void 0,void 0,function*(){const t=this._getFinalPath(e);try{return yield Xr(this.fetch,`${this.url}/object/${t}`,{headers:this.headers}),{data:!0,error:null}}catch(s){if(D(s)&&s instanceof ft){const n=s.originalError;if([400,404].includes(n==null?void 0:n.status))return{data:!1,error:s}}throw s}})}getPublicUrl(e,t){const s=this._getFinalPath(e),n=[],i=t!=null&&t.download?`download=${t.download===!0?"":t.download}`:"";i!==""&&n.push(i);const l=typeof(t==null?void 0:t.transform)<"u"?"render/image":"object",c=this.transformOptsToQueryString((t==null?void 0:t.transform)||{});c!==""&&n.push(c);let u=n.join("&");return u!==""&&(u=`?${u}`),{data:{publicUrl:encodeURI(`${this.url}/${l}/public/${s}${u}`)}}}remove(e){return M(this,void 0,void 0,function*(){try{return{data:yield fs(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:e},{headers:this.headers}),error:null}}catch(t){if(D(t))return{data:null,error:t};throw t}})}list(e,t,s){return M(this,void 0,void 0,function*(){try{const n=Object.assign(Object.assign(Object.assign({},Zr),t),{prefix:e||""});return{data:yield ee(this.fetch,`${this.url}/object/list/${this.bucketId}`,n,{headers:this.headers},s),error:null}}catch(n){if(D(n))return{data:null,error:n};throw n}})}encodeMetadata(e){return JSON.stringify(e)}toBase64(e){return typeof Buffer<"u"?Buffer.from(e).toString("base64"):btoa(e)}_getFinalPath(e){return`${this.bucketId}/${e}`}_removeEmptyFolders(e){return e.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(e){const t=[];return e.width&&t.push(`width=${e.width}`),e.height&&t.push(`height=${e.height}`),e.resize&&t.push(`resize=${e.resize}`),e.format&&t.push(`format=${e.format}`),e.quality&&t.push(`quality=${e.quality}`),t.join("&")}}const tn="2.7.1",sn={"X-Client-Info":`storage-js/${tn}`};var he=function(r,e,t,s){function n(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function l(d){try{u(s.next(d))}catch(h){o(h)}}function c(d){try{u(s.throw(d))}catch(h){o(h)}}function u(d){d.done?i(d.value):n(d.value).then(l,c)}u((s=s.apply(r,e||[])).next())})};class rn{constructor(e,t={},s){this.url=e,this.headers=Object.assign(Object.assign({},sn),t),this.fetch=hs(s)}listBuckets(){return he(this,void 0,void 0,function*(){try{return{data:yield We(this.fetch,`${this.url}/bucket`,{headers:this.headers}),error:null}}catch(e){if(D(e))return{data:null,error:e};throw e}})}getBucket(e){return he(this,void 0,void 0,function*(){try{return{data:yield We(this.fetch,`${this.url}/bucket/${e}`,{headers:this.headers}),error:null}}catch(t){if(D(t))return{data:null,error:t};throw t}})}createBucket(e,t={public:!1}){return he(this,void 0,void 0,function*(){try{return{data:yield ee(this.fetch,`${this.url}/bucket`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(s){if(D(s))return{data:null,error:s};throw s}})}updateBucket(e,t){return he(this,void 0,void 0,function*(){try{return{data:yield Qr(this.fetch,`${this.url}/bucket/${e}`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(s){if(D(s))return{data:null,error:s};throw s}})}emptyBucket(e){return he(this,void 0,void 0,function*(){try{return{data:yield ee(this.fetch,`${this.url}/bucket/${e}/empty`,{},{headers:this.headers}),error:null}}catch(t){if(D(t))return{data:null,error:t};throw t}})}deleteBucket(e){return he(this,void 0,void 0,function*(){try{return{data:yield fs(this.fetch,`${this.url}/bucket/${e}`,{},{headers:this.headers}),error:null}}catch(t){if(D(t))return{data:null,error:t};throw t}})}}class nn extends rn{constructor(e,t={},s){super(e,t,s)}from(e){return new en(this.url,this.headers,e,this.fetch)}}const an="2.50.2";let je="";typeof Deno<"u"?je="deno":typeof document<"u"?je="web":typeof navigator<"u"&&navigator.product==="ReactNative"?je="react-native":je="node";const on={"X-Client-Info":`supabase-js-${je}/${an}`},ln={headers:on},cn={schema:"public"},dn={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},un={};var hn=function(r,e,t,s){function n(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function l(d){try{u(s.next(d))}catch(h){o(h)}}function c(d){try{u(s.throw(d))}catch(h){o(h)}}function u(d){d.done?i(d.value):n(d.value).then(l,c)}u((s=s.apply(r,e||[])).next())})};const fn=r=>{let e;return r?e=r:typeof fetch>"u"?e=Qt:e=fetch,(...t)=>e(...t)},mn=()=>typeof Headers>"u"?Xt:Headers,gn=(r,e,t)=>{const s=fn(t),n=mn();return(i,o)=>hn(void 0,void 0,void 0,function*(){var l;const c=(l=yield e())!==null&&l!==void 0?l:r;let u=new n(o==null?void 0:o.headers);return u.has("apikey")||u.set("apikey",r),u.has("Authorization")||u.set("Authorization",`Bearer ${c}`),s(i,Object.assign(Object.assign({},o),{headers:u}))})};var pn=function(r,e,t,s){function n(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function l(d){try{u(s.next(d))}catch(h){o(h)}}function c(d){try{u(s.throw(d))}catch(h){o(h)}}function u(d){d.done?i(d.value):n(d.value).then(l,c)}u((s=s.apply(r,e||[])).next())})};function yn(r){return r.endsWith("/")?r:r+"/"}function wn(r,e){var t,s;const{db:n,auth:i,realtime:o,global:l}=r,{db:c,auth:u,realtime:d,global:h}=e,f={db:Object.assign(Object.assign({},c),n),auth:Object.assign(Object.assign({},u),i),realtime:Object.assign(Object.assign({},d),o),global:Object.assign(Object.assign(Object.assign({},h),l),{headers:Object.assign(Object.assign({},(t=h==null?void 0:h.headers)!==null&&t!==void 0?t:{}),(s=l==null?void 0:l.headers)!==null&&s!==void 0?s:{})}),accessToken:()=>pn(this,void 0,void 0,function*(){return""})};return r.accessToken?f.accessToken=r.accessToken:delete f.accessToken,f}const ms="2.70.0",pe=30*1e3,gt=3,tt=gt*pe,vn="http://localhost:9999",xn="supabase.auth.token",bn={"X-Client-Info":`gotrue-js/${ms}`},pt="X-Supabase-Api-Version",gs={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}},_n=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i,jn=6e5;class St extends Error{constructor(e,t,s){super(e),this.__isAuthError=!0,this.name="AuthError",this.status=t,this.code=s}}function E(r){return typeof r=="object"&&r!==null&&"__isAuthError"in r}class kn extends St{constructor(e,t,s){super(e,t,s),this.name="AuthApiError",this.status=t,this.code=s}}function Sn(r){return E(r)&&r.name==="AuthApiError"}class ps extends St{constructor(e,t){super(e),this.name="AuthUnknownError",this.originalError=t}}class se extends St{constructor(e,t,s,n){super(e,s,n),this.name=t,this.status=s}}class Z extends se{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}function Nn(r){return E(r)&&r.name==="AuthSessionMissingError"}class Le extends se{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class De extends se{constructor(e){super(e,"AuthInvalidCredentialsError",400,void 0)}}class Ue extends se{constructor(e,t=null){super(e,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}function En(r){return E(r)&&r.name==="AuthImplicitGrantRedirectError"}class Dt extends se{constructor(e,t=null){super(e,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class yt extends se{constructor(e,t){super(e,"AuthRetryableFetchError",t,void 0)}}function st(r){return E(r)&&r.name==="AuthRetryableFetchError"}class Ut extends se{constructor(e,t,s){super(e,"AuthWeakPasswordError",t,"weak_password"),this.reasons=s}}class Ne extends se{constructor(e){super(e,"AuthInvalidJwtError",400,"invalid_jwt")}}const Fe="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),Bt=` 	
\r=`.split(""),Pn=(()=>{const r=new Array(128);for(let e=0;e<r.length;e+=1)r[e]=-1;for(let e=0;e<Bt.length;e+=1)r[Bt[e].charCodeAt(0)]=-2;for(let e=0;e<Fe.length;e+=1)r[Fe[e].charCodeAt(0)]=e;return r})();function qt(r,e,t){if(r!==null)for(e.queue=e.queue<<8|r,e.queuedBits+=8;e.queuedBits>=6;){const s=e.queue>>e.queuedBits-6&63;t(Fe[s]),e.queuedBits-=6}else if(e.queuedBits>0)for(e.queue=e.queue<<6-e.queuedBits,e.queuedBits=6;e.queuedBits>=6;){const s=e.queue>>e.queuedBits-6&63;t(Fe[s]),e.queuedBits-=6}}function ys(r,e,t){const s=Pn[r];if(s>-1)for(e.queue=e.queue<<6|s,e.queuedBits+=6;e.queuedBits>=8;)t(e.queue>>e.queuedBits-8&255),e.queuedBits-=8;else{if(s===-2)return;throw new Error(`Invalid Base64-URL character "${String.fromCharCode(r)}"`)}}function Mt(r){const e=[],t=o=>{e.push(String.fromCodePoint(o))},s={utf8seq:0,codepoint:0},n={queue:0,queuedBits:0},i=o=>{On(o,s,t)};for(let o=0;o<r.length;o+=1)ys(r.charCodeAt(o),n,i);return e.join("")}function Tn(r,e){if(r<=127){e(r);return}else if(r<=2047){e(192|r>>6),e(128|r&63);return}else if(r<=65535){e(224|r>>12),e(128|r>>6&63),e(128|r&63);return}else if(r<=1114111){e(240|r>>18),e(128|r>>12&63),e(128|r>>6&63),e(128|r&63);return}throw new Error(`Unrecognized Unicode codepoint: ${r.toString(16)}`)}function An(r,e){for(let t=0;t<r.length;t+=1){let s=r.charCodeAt(t);if(s>55295&&s<=56319){const n=(s-55296)*1024&65535;s=(r.charCodeAt(t+1)-56320&65535|n)+65536,t+=1}Tn(s,e)}}function On(r,e,t){if(e.utf8seq===0){if(r<=127){t(r);return}for(let s=1;s<6;s+=1)if(!(r>>7-s&1)){e.utf8seq=s;break}if(e.utf8seq===2)e.codepoint=r&31;else if(e.utf8seq===3)e.codepoint=r&15;else if(e.utf8seq===4)e.codepoint=r&7;else throw new Error("Invalid UTF-8 sequence");e.utf8seq-=1}else if(e.utf8seq>0){if(r<=127)throw new Error("Invalid UTF-8 sequence");e.codepoint=e.codepoint<<6|r&63,e.utf8seq-=1,e.utf8seq===0&&t(e.codepoint)}}function $n(r){const e=[],t={queue:0,queuedBits:0},s=n=>{e.push(n)};for(let n=0;n<r.length;n+=1)ys(r.charCodeAt(n),t,s);return new Uint8Array(e)}function Cn(r){const e=[];return An(r,t=>e.push(t)),new Uint8Array(e)}function In(r){const e=[],t={queue:0,queuedBits:0},s=n=>{e.push(n)};return r.forEach(n=>qt(n,t,s)),qt(null,t,s),e.join("")}function Rn(r){return Math.round(Date.now()/1e3)+r}function Ln(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(r){const e=Math.random()*16|0;return(r=="x"?e:e&3|8).toString(16)})}const z=()=>typeof window<"u"&&typeof document<"u",ne={tested:!1,writable:!1},Ee=()=>{if(!z())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(ne.tested)return ne.writable;const r=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(r,r),globalThis.localStorage.removeItem(r),ne.tested=!0,ne.writable=!0}catch{ne.tested=!0,ne.writable=!1}return ne.writable};function Dn(r){const e={},t=new URL(r);if(t.hash&&t.hash[0]==="#")try{new URLSearchParams(t.hash.substring(1)).forEach((n,i)=>{e[i]=n})}catch{}return t.searchParams.forEach((s,n)=>{e[n]=s}),e}const ws=r=>{let e;return r?e=r:typeof fetch>"u"?e=(...t)=>Oe(async()=>{const{default:s}=await Promise.resolve().then(()=>we);return{default:s}},void 0).then(({default:s})=>s(...t)):e=fetch,(...t)=>e(...t)},Un=r=>typeof r=="object"&&r!==null&&"status"in r&&"ok"in r&&"json"in r&&typeof r.json=="function",vs=async(r,e,t)=>{await r.setItem(e,JSON.stringify(t))},Be=async(r,e)=>{const t=await r.getItem(e);if(!t)return null;try{return JSON.parse(t)}catch{return t}},qe=async(r,e)=>{await r.removeItem(e)};class Xe{constructor(){this.promise=new Xe.promiseConstructor((e,t)=>{this.resolve=e,this.reject=t})}}Xe.promiseConstructor=Promise;function rt(r){const e=r.split(".");if(e.length!==3)throw new Ne("Invalid JWT structure");for(let s=0;s<e.length;s++)if(!_n.test(e[s]))throw new Ne("JWT not in base64url format");return{header:JSON.parse(Mt(e[0])),payload:JSON.parse(Mt(e[1])),signature:$n(e[2]),raw:{header:e[0],payload:e[1]}}}async function Bn(r){return await new Promise(e=>{setTimeout(()=>e(null),r)})}function qn(r,e){return new Promise((s,n)=>{(async()=>{for(let i=0;i<1/0;i++)try{const o=await r(i);if(!e(i,null,o)){s(o);return}}catch(o){if(!e(i,o)){n(o);return}}})()})}function Mn(r){return("0"+r.toString(16)).substr(-2)}function Wn(){const e=new Uint32Array(56);if(typeof crypto>"u"){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",s=t.length;let n="";for(let i=0;i<56;i++)n+=t.charAt(Math.floor(Math.random()*s));return n}return crypto.getRandomValues(e),Array.from(e,Mn).join("")}async function Fn(r){const t=new TextEncoder().encode(r),s=await crypto.subtle.digest("SHA-256",t),n=new Uint8Array(s);return Array.from(n).map(i=>String.fromCharCode(i)).join("")}async function zn(r){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),r;const t=await Fn(r);return btoa(t).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function fe(r,e,t=!1){const s=Wn();let n=s;t&&(n+="/PASSWORD_RECOVERY"),await vs(r,`${e}-code-verifier`,n);const i=await zn(s);return[i,s===i?"plain":"s256"]}const Hn=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function Jn(r){const e=r.headers.get(pt);if(!e||!e.match(Hn))return null;try{return new Date(`${e}T00:00:00.0Z`)}catch{return null}}function Vn(r){if(!r)throw new Error("Missing exp claim");const e=Math.floor(Date.now()/1e3);if(r<=e)throw new Error("JWT has expired")}function Kn(r){switch(r){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}const Gn=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/;function me(r){if(!Gn.test(r))throw new Error("@supabase/auth-js: Expected parameter to be UUID but is not")}var Yn=function(r,e){var t={};for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&e.indexOf(s)<0&&(t[s]=r[s]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var n=0,s=Object.getOwnPropertySymbols(r);n<s.length;n++)e.indexOf(s[n])<0&&Object.prototype.propertyIsEnumerable.call(r,s[n])&&(t[s[n]]=r[s[n]]);return t};const ie=r=>r.msg||r.message||r.error_description||r.error||JSON.stringify(r),Qn=[502,503,504];async function Wt(r){var e;if(!Un(r))throw new yt(ie(r),0);if(Qn.includes(r.status))throw new yt(ie(r),r.status);let t;try{t=await r.json()}catch(i){throw new ps(ie(i),i)}let s;const n=Jn(r);if(n&&n.getTime()>=gs["2024-01-01"].timestamp&&typeof t=="object"&&t&&typeof t.code=="string"?s=t.code:typeof t=="object"&&t&&typeof t.error_code=="string"&&(s=t.error_code),s){if(s==="weak_password")throw new Ut(ie(t),r.status,((e=t.weak_password)===null||e===void 0?void 0:e.reasons)||[]);if(s==="session_not_found")throw new Z}else if(typeof t=="object"&&t&&typeof t.weak_password=="object"&&t.weak_password&&Array.isArray(t.weak_password.reasons)&&t.weak_password.reasons.length&&t.weak_password.reasons.reduce((i,o)=>i&&typeof o=="string",!0))throw new Ut(ie(t),r.status,t.weak_password.reasons);throw new kn(ie(t),r.status||500,s)}const Xn=(r,e,t,s)=>{const n={method:r,headers:(e==null?void 0:e.headers)||{}};return r==="GET"?n:(n.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},e==null?void 0:e.headers),n.body=JSON.stringify(s),Object.assign(Object.assign({},n),t))};async function A(r,e,t,s){var n;const i=Object.assign({},s==null?void 0:s.headers);i[pt]||(i[pt]=gs["2024-01-01"].name),s!=null&&s.jwt&&(i.Authorization=`Bearer ${s.jwt}`);const o=(n=s==null?void 0:s.query)!==null&&n!==void 0?n:{};s!=null&&s.redirectTo&&(o.redirect_to=s.redirectTo);const l=Object.keys(o).length?"?"+new URLSearchParams(o).toString():"",c=await Zn(r,e,t+l,{headers:i,noResolveJson:s==null?void 0:s.noResolveJson},{},s==null?void 0:s.body);return s!=null&&s.xform?s==null?void 0:s.xform(c):{data:Object.assign({},c),error:null}}async function Zn(r,e,t,s,n,i){const o=Xn(e,s,n,i);let l;try{l=await r(t,Object.assign({},o))}catch(c){throw console.error(c),new yt(ie(c),0)}if(l.ok||await Wt(l),s!=null&&s.noResolveJson)return l;try{return await l.json()}catch(c){await Wt(c)}}function G(r){var e;let t=null;ri(r)&&(t=Object.assign({},r),r.expires_at||(t.expires_at=Rn(r.expires_in)));const s=(e=r.user)!==null&&e!==void 0?e:r;return{data:{session:t,user:s},error:null}}function Ft(r){const e=G(r);return!e.error&&r.weak_password&&typeof r.weak_password=="object"&&Array.isArray(r.weak_password.reasons)&&r.weak_password.reasons.length&&r.weak_password.message&&typeof r.weak_password.message=="string"&&r.weak_password.reasons.reduce((t,s)=>t&&typeof s=="string",!0)&&(e.data.weak_password=r.weak_password),e}function te(r){var e;return{data:{user:(e=r.user)!==null&&e!==void 0?e:r},error:null}}function ei(r){return{data:r,error:null}}function ti(r){const{action_link:e,email_otp:t,hashed_token:s,redirect_to:n,verification_type:i}=r,o=Yn(r,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),l={action_link:e,email_otp:t,hashed_token:s,redirect_to:n,verification_type:i},c=Object.assign({},o);return{data:{properties:l,user:c},error:null}}function si(r){return r}function ri(r){return r.access_token&&r.refresh_token&&r.expires_in}const nt=["global","local","others"];var ni=function(r,e){var t={};for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&e.indexOf(s)<0&&(t[s]=r[s]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var n=0,s=Object.getOwnPropertySymbols(r);n<s.length;n++)e.indexOf(s[n])<0&&Object.prototype.propertyIsEnumerable.call(r,s[n])&&(t[s[n]]=r[s[n]]);return t};class ii{constructor({url:e="",headers:t={},fetch:s}){this.url=e,this.headers=t,this.fetch=ws(s),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)}}async signOut(e,t=nt[0]){if(nt.indexOf(t)<0)throw new Error(`@supabase/auth-js: Parameter scope must be one of ${nt.join(", ")}`);try{return await A(this.fetch,"POST",`${this.url}/logout?scope=${t}`,{headers:this.headers,jwt:e,noResolveJson:!0}),{data:null,error:null}}catch(s){if(E(s))return{data:null,error:s};throw s}}async inviteUserByEmail(e,t={}){try{return await A(this.fetch,"POST",`${this.url}/invite`,{body:{email:e,data:t.data},headers:this.headers,redirectTo:t.redirectTo,xform:te})}catch(s){if(E(s))return{data:{user:null},error:s};throw s}}async generateLink(e){try{const{options:t}=e,s=ni(e,["options"]),n=Object.assign(Object.assign({},s),t);return"newEmail"in s&&(n.new_email=s==null?void 0:s.newEmail,delete n.newEmail),await A(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:n,headers:this.headers,xform:ti,redirectTo:t==null?void 0:t.redirectTo})}catch(t){if(E(t))return{data:{properties:null,user:null},error:t};throw t}}async createUser(e){try{return await A(this.fetch,"POST",`${this.url}/admin/users`,{body:e,headers:this.headers,xform:te})}catch(t){if(E(t))return{data:{user:null},error:t};throw t}}async listUsers(e){var t,s,n,i,o,l,c;try{const u={nextPage:null,lastPage:0,total:0},d=await A(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(s=(t=e==null?void 0:e.page)===null||t===void 0?void 0:t.toString())!==null&&s!==void 0?s:"",per_page:(i=(n=e==null?void 0:e.perPage)===null||n===void 0?void 0:n.toString())!==null&&i!==void 0?i:""},xform:si});if(d.error)throw d.error;const h=await d.json(),f=(o=d.headers.get("x-total-count"))!==null&&o!==void 0?o:0,m=(c=(l=d.headers.get("link"))===null||l===void 0?void 0:l.split(","))!==null&&c!==void 0?c:[];return m.length>0&&(m.forEach(g=>{const p=parseInt(g.split(";")[0].split("=")[1].substring(0,1)),w=JSON.parse(g.split(";")[1].split("=")[1]);u[`${w}Page`]=p}),u.total=parseInt(f)),{data:Object.assign(Object.assign({},h),u),error:null}}catch(u){if(E(u))return{data:{users:[]},error:u};throw u}}async getUserById(e){me(e);try{return await A(this.fetch,"GET",`${this.url}/admin/users/${e}`,{headers:this.headers,xform:te})}catch(t){if(E(t))return{data:{user:null},error:t};throw t}}async updateUserById(e,t){me(e);try{return await A(this.fetch,"PUT",`${this.url}/admin/users/${e}`,{body:t,headers:this.headers,xform:te})}catch(s){if(E(s))return{data:{user:null},error:s};throw s}}async deleteUser(e,t=!1){me(e);try{return await A(this.fetch,"DELETE",`${this.url}/admin/users/${e}`,{headers:this.headers,body:{should_soft_delete:t},xform:te})}catch(s){if(E(s))return{data:{user:null},error:s};throw s}}async _listFactors(e){me(e.userId);try{const{data:t,error:s}=await A(this.fetch,"GET",`${this.url}/admin/users/${e.userId}/factors`,{headers:this.headers,xform:n=>({data:{factors:n},error:null})});return{data:t,error:s}}catch(t){if(E(t))return{data:null,error:t};throw t}}async _deleteFactor(e){me(e.userId),me(e.id);try{return{data:await A(this.fetch,"DELETE",`${this.url}/admin/users/${e.userId}/factors/${e.id}`,{headers:this.headers}),error:null}}catch(t){if(E(t))return{data:null,error:t};throw t}}}const ai={getItem:r=>Ee()?globalThis.localStorage.getItem(r):null,setItem:(r,e)=>{Ee()&&globalThis.localStorage.setItem(r,e)},removeItem:r=>{Ee()&&globalThis.localStorage.removeItem(r)}};function zt(r={}){return{getItem:e=>r[e]||null,setItem:(e,t)=>{r[e]=t},removeItem:e=>{delete r[e]}}}function oi(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}const ge={debug:!!(globalThis&&Ee()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class xs extends Error{constructor(e){super(e),this.isAcquireTimeout=!0}}class li extends xs{}async function ci(r,e,t){ge.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",r,e);const s=new globalThis.AbortController;return e>0&&setTimeout(()=>{s.abort(),ge.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",r)},e),await Promise.resolve().then(()=>globalThis.navigator.locks.request(r,e===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:s.signal},async n=>{if(n){ge.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",r,n.name);try{return await t()}finally{ge.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",r,n.name)}}else{if(e===0)throw ge.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",r),new li(`Acquiring an exclusive Navigator LockManager lock "${r}" immediately failed`);if(ge.debug)try{const i=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(i,null,"  "))}catch(i){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",i)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await t()}}))}oi();const di={url:vn,storageKey:xn,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:bn,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1};async function Ht(r,e,t){return await t()}class Te{constructor(e){var t,s;this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log,this.instanceID=Te.nextInstanceID,Te.nextInstanceID+=1,this.instanceID>0&&z()&&console.warn("Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.");const n=Object.assign(Object.assign({},di),e);if(this.logDebugMessages=!!n.debug,typeof n.debug=="function"&&(this.logger=n.debug),this.persistSession=n.persistSession,this.storageKey=n.storageKey,this.autoRefreshToken=n.autoRefreshToken,this.admin=new ii({url:n.url,headers:n.headers,fetch:n.fetch}),this.url=n.url,this.headers=n.headers,this.fetch=ws(n.fetch),this.lock=n.lock||Ht,this.detectSessionInUrl=n.detectSessionInUrl,this.flowType=n.flowType,this.hasCustomAuthorizationHeader=n.hasCustomAuthorizationHeader,n.lock?this.lock=n.lock:z()&&(!((t=globalThis==null?void 0:globalThis.navigator)===null||t===void 0)&&t.locks)?this.lock=ci:this.lock=Ht,this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER,this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this)},this.persistSession?n.storage?this.storage=n.storage:Ee()?this.storage=ai:(this.memoryStorage={},this.storage=zt(this.memoryStorage)):(this.memoryStorage={},this.storage=zt(this.memoryStorage)),z()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(i){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",i)}(s=this.broadcastChannel)===null||s===void 0||s.addEventListener("message",async i=>{this._debug("received broadcast notification from other tab or client",i),await this._notifyAllSubscribers(i.data.event,i.data.session,!1)})}this.initialize()}_debug(...e){return this.logDebugMessages&&this.logger(`GoTrueClient@${this.instanceID} (${ms}) ${new Date().toISOString()}`,...e),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(-1,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){var e;try{const t=Dn(window.location.href);let s="none";if(this._isImplicitGrantCallback(t)?s="implicit":await this._isPKCECallback(t)&&(s="pkce"),z()&&this.detectSessionInUrl&&s!=="none"){const{data:n,error:i}=await this._getSessionFromURL(t,s);if(i){if(this._debug("#_initialize()","error detecting session from URL",i),En(i)){const c=(e=i.details)===null||e===void 0?void 0:e.code;if(c==="identity_already_exists"||c==="identity_not_found"||c==="single_identity_not_deletable")return{error:i}}return await this._removeSession(),{error:i}}const{session:o,redirectType:l}=n;return this._debug("#_initialize()","detected session in URL",o,"redirect type",l),await this._saveSession(o),setTimeout(async()=>{l==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",o):await this._notifyAllSubscribers("SIGNED_IN",o)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(t){return E(t)?{error:t}:{error:new ps("Unexpected error during initialization",t)}}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(e){var t,s,n;try{const i=await A(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(s=(t=e==null?void 0:e.options)===null||t===void 0?void 0:t.data)!==null&&s!==void 0?s:{},gotrue_meta_security:{captcha_token:(n=e==null?void 0:e.options)===null||n===void 0?void 0:n.captchaToken}},xform:G}),{data:o,error:l}=i;if(l||!o)return{data:{user:null,session:null},error:l};const c=o.session,u=o.user;return o.session&&(await this._saveSession(o.session),await this._notifyAllSubscribers("SIGNED_IN",c)),{data:{user:u,session:c},error:null}}catch(i){if(E(i))return{data:{user:null,session:null},error:i};throw i}}async signUp(e){var t,s,n;try{let i;if("email"in e){const{email:d,password:h,options:f}=e;let m=null,g=null;this.flowType==="pkce"&&([m,g]=await fe(this.storage,this.storageKey)),i=await A(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:f==null?void 0:f.emailRedirectTo,body:{email:d,password:h,data:(t=f==null?void 0:f.data)!==null&&t!==void 0?t:{},gotrue_meta_security:{captcha_token:f==null?void 0:f.captchaToken},code_challenge:m,code_challenge_method:g},xform:G})}else if("phone"in e){const{phone:d,password:h,options:f}=e;i=await A(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:d,password:h,data:(s=f==null?void 0:f.data)!==null&&s!==void 0?s:{},channel:(n=f==null?void 0:f.channel)!==null&&n!==void 0?n:"sms",gotrue_meta_security:{captcha_token:f==null?void 0:f.captchaToken}},xform:G})}else throw new De("You must provide either an email or phone number and a password");const{data:o,error:l}=i;if(l||!o)return{data:{user:null,session:null},error:l};const c=o.session,u=o.user;return o.session&&(await this._saveSession(o.session),await this._notifyAllSubscribers("SIGNED_IN",c)),{data:{user:u,session:c},error:null}}catch(i){if(E(i))return{data:{user:null,session:null},error:i};throw i}}async signInWithPassword(e){try{let t;if("email"in e){const{email:i,password:o,options:l}=e;t=await A(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:i,password:o,gotrue_meta_security:{captcha_token:l==null?void 0:l.captchaToken}},xform:Ft})}else if("phone"in e){const{phone:i,password:o,options:l}=e;t=await A(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:i,password:o,gotrue_meta_security:{captcha_token:l==null?void 0:l.captchaToken}},xform:Ft})}else throw new De("You must provide either an email or phone number and a password");const{data:s,error:n}=t;return n?{data:{user:null,session:null},error:n}:!s||!s.session||!s.user?{data:{user:null,session:null},error:new Le}:(s.session&&(await this._saveSession(s.session),await this._notifyAllSubscribers("SIGNED_IN",s.session)),{data:Object.assign({user:s.user,session:s.session},s.weak_password?{weakPassword:s.weak_password}:null),error:n})}catch(t){if(E(t))return{data:{user:null,session:null},error:t};throw t}}async signInWithOAuth(e){var t,s,n,i;return await this._handleProviderSignIn(e.provider,{redirectTo:(t=e.options)===null||t===void 0?void 0:t.redirectTo,scopes:(s=e.options)===null||s===void 0?void 0:s.scopes,queryParams:(n=e.options)===null||n===void 0?void 0:n.queryParams,skipBrowserRedirect:(i=e.options)===null||i===void 0?void 0:i.skipBrowserRedirect})}async exchangeCodeForSession(e){return await this.initializePromise,this._acquireLock(-1,async()=>this._exchangeCodeForSession(e))}async signInWithWeb3(e){const{chain:t}=e;if(t==="solana")return await this.signInWithSolana(e);throw new Error(`@supabase/auth-js: Unsupported chain "${t}"`)}async signInWithSolana(e){var t,s,n,i,o,l,c,u,d,h,f,m;let g,p;if("message"in e)g=e.message,p=e.signature;else{const{chain:w,wallet:x,statement:v,options:y}=e;let N;if(z())if(typeof x=="object")N=x;else{const j=window;if("solana"in j&&typeof j.solana=="object"&&("signIn"in j.solana&&typeof j.solana.signIn=="function"||"signMessage"in j.solana&&typeof j.solana.signMessage=="function"))N=j.solana;else throw new Error("@supabase/auth-js: No compatible Solana wallet interface on the window object (window.solana) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'solana', wallet: resolvedUserWallet }) instead.")}else{if(typeof x!="object"||!(y!=null&&y.url))throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");N=x}const _=new URL((t=y==null?void 0:y.url)!==null&&t!==void 0?t:window.location.href);if("signIn"in N&&N.signIn){const j=await N.signIn(Object.assign(Object.assign(Object.assign({issuedAt:new Date().toISOString()},y==null?void 0:y.signInWithSolana),{version:"1",domain:_.host,uri:_.href}),v?{statement:v}:null));let P;if(Array.isArray(j)&&j[0]&&typeof j[0]=="object")P=j[0];else if(j&&typeof j=="object"&&"signedMessage"in j&&"signature"in j)P=j;else throw new Error("@supabase/auth-js: Wallet method signIn() returned unrecognized value");if("signedMessage"in P&&"signature"in P&&(typeof P.signedMessage=="string"||P.signedMessage instanceof Uint8Array)&&P.signature instanceof Uint8Array)g=typeof P.signedMessage=="string"?P.signedMessage:new TextDecoder().decode(P.signedMessage),p=P.signature;else throw new Error("@supabase/auth-js: Wallet method signIn() API returned object without signedMessage and signature fields")}else{if(!("signMessage"in N)||typeof N.signMessage!="function"||!("publicKey"in N)||typeof N!="object"||!N.publicKey||!("toBase58"in N.publicKey)||typeof N.publicKey.toBase58!="function")throw new Error("@supabase/auth-js: Wallet does not have a compatible signMessage() and publicKey.toBase58() API");g=[`${_.host} wants you to sign in with your Solana account:`,N.publicKey.toBase58(),...v?["",v,""]:[""],"Version: 1",`URI: ${_.href}`,`Issued At: ${(n=(s=y==null?void 0:y.signInWithSolana)===null||s===void 0?void 0:s.issuedAt)!==null&&n!==void 0?n:new Date().toISOString()}`,...!((i=y==null?void 0:y.signInWithSolana)===null||i===void 0)&&i.notBefore?[`Not Before: ${y.signInWithSolana.notBefore}`]:[],...!((o=y==null?void 0:y.signInWithSolana)===null||o===void 0)&&o.expirationTime?[`Expiration Time: ${y.signInWithSolana.expirationTime}`]:[],...!((l=y==null?void 0:y.signInWithSolana)===null||l===void 0)&&l.chainId?[`Chain ID: ${y.signInWithSolana.chainId}`]:[],...!((c=y==null?void 0:y.signInWithSolana)===null||c===void 0)&&c.nonce?[`Nonce: ${y.signInWithSolana.nonce}`]:[],...!((u=y==null?void 0:y.signInWithSolana)===null||u===void 0)&&u.requestId?[`Request ID: ${y.signInWithSolana.requestId}`]:[],...!((h=(d=y==null?void 0:y.signInWithSolana)===null||d===void 0?void 0:d.resources)===null||h===void 0)&&h.length?["Resources",...y.signInWithSolana.resources.map(P=>`- ${P}`)]:[]].join(`
`);const j=await N.signMessage(new TextEncoder().encode(g),"utf8");if(!j||!(j instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet signMessage() API returned an recognized value");p=j}}try{const{data:w,error:x}=await A(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"solana",message:g,signature:In(p)},!((f=e.options)===null||f===void 0)&&f.captchaToken?{gotrue_meta_security:{captcha_token:(m=e.options)===null||m===void 0?void 0:m.captchaToken}}:null),xform:G});if(x)throw x;return!w||!w.session||!w.user?{data:{user:null,session:null},error:new Le}:(w.session&&(await this._saveSession(w.session),await this._notifyAllSubscribers("SIGNED_IN",w.session)),{data:Object.assign({},w),error:x})}catch(w){if(E(w))return{data:{user:null,session:null},error:w};throw w}}async _exchangeCodeForSession(e){const t=await Be(this.storage,`${this.storageKey}-code-verifier`),[s,n]=(t??"").split("/");try{const{data:i,error:o}=await A(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:e,code_verifier:s},xform:G});if(await qe(this.storage,`${this.storageKey}-code-verifier`),o)throw o;return!i||!i.session||!i.user?{data:{user:null,session:null,redirectType:null},error:new Le}:(i.session&&(await this._saveSession(i.session),await this._notifyAllSubscribers("SIGNED_IN",i.session)),{data:Object.assign(Object.assign({},i),{redirectType:n??null}),error:o})}catch(i){if(E(i))return{data:{user:null,session:null,redirectType:null},error:i};throw i}}async signInWithIdToken(e){try{const{options:t,provider:s,token:n,access_token:i,nonce:o}=e,l=await A(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:s,id_token:n,access_token:i,nonce:o,gotrue_meta_security:{captcha_token:t==null?void 0:t.captchaToken}},xform:G}),{data:c,error:u}=l;return u?{data:{user:null,session:null},error:u}:!c||!c.session||!c.user?{data:{user:null,session:null},error:new Le}:(c.session&&(await this._saveSession(c.session),await this._notifyAllSubscribers("SIGNED_IN",c.session)),{data:c,error:u})}catch(t){if(E(t))return{data:{user:null,session:null},error:t};throw t}}async signInWithOtp(e){var t,s,n,i,o;try{if("email"in e){const{email:l,options:c}=e;let u=null,d=null;this.flowType==="pkce"&&([u,d]=await fe(this.storage,this.storageKey));const{error:h}=await A(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:l,data:(t=c==null?void 0:c.data)!==null&&t!==void 0?t:{},create_user:(s=c==null?void 0:c.shouldCreateUser)!==null&&s!==void 0?s:!0,gotrue_meta_security:{captcha_token:c==null?void 0:c.captchaToken},code_challenge:u,code_challenge_method:d},redirectTo:c==null?void 0:c.emailRedirectTo});return{data:{user:null,session:null},error:h}}if("phone"in e){const{phone:l,options:c}=e,{data:u,error:d}=await A(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:l,data:(n=c==null?void 0:c.data)!==null&&n!==void 0?n:{},create_user:(i=c==null?void 0:c.shouldCreateUser)!==null&&i!==void 0?i:!0,gotrue_meta_security:{captcha_token:c==null?void 0:c.captchaToken},channel:(o=c==null?void 0:c.channel)!==null&&o!==void 0?o:"sms"}});return{data:{user:null,session:null,messageId:u==null?void 0:u.message_id},error:d}}throw new De("You must provide either an email or phone number.")}catch(l){if(E(l))return{data:{user:null,session:null},error:l};throw l}}async verifyOtp(e){var t,s;try{let n,i;"options"in e&&(n=(t=e.options)===null||t===void 0?void 0:t.redirectTo,i=(s=e.options)===null||s===void 0?void 0:s.captchaToken);const{data:o,error:l}=await A(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},e),{gotrue_meta_security:{captcha_token:i}}),redirectTo:n,xform:G});if(l)throw l;if(!o)throw new Error("An error occurred on token verification.");const c=o.session,u=o.user;return c!=null&&c.access_token&&(await this._saveSession(c),await this._notifyAllSubscribers(e.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",c)),{data:{user:u,session:c},error:null}}catch(n){if(E(n))return{data:{user:null,session:null},error:n};throw n}}async signInWithSSO(e){var t,s,n;try{let i=null,o=null;return this.flowType==="pkce"&&([i,o]=await fe(this.storage,this.storageKey)),await A(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in e?{provider_id:e.providerId}:null),"domain"in e?{domain:e.domain}:null),{redirect_to:(s=(t=e.options)===null||t===void 0?void 0:t.redirectTo)!==null&&s!==void 0?s:void 0}),!((n=e==null?void 0:e.options)===null||n===void 0)&&n.captchaToken?{gotrue_meta_security:{captcha_token:e.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:i,code_challenge_method:o}),headers:this.headers,xform:ei})}catch(i){if(E(i))return{data:null,error:i};throw i}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async e=>{const{data:{session:t},error:s}=e;if(s)throw s;if(!t)throw new Z;const{error:n}=await A(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:t.access_token});return{data:{user:null,session:null},error:n}})}catch(e){if(E(e))return{data:{user:null,session:null},error:e};throw e}}async resend(e){try{const t=`${this.url}/resend`;if("email"in e){const{email:s,type:n,options:i}=e,{error:o}=await A(this.fetch,"POST",t,{headers:this.headers,body:{email:s,type:n,gotrue_meta_security:{captcha_token:i==null?void 0:i.captchaToken}},redirectTo:i==null?void 0:i.emailRedirectTo});return{data:{user:null,session:null},error:o}}else if("phone"in e){const{phone:s,type:n,options:i}=e,{data:o,error:l}=await A(this.fetch,"POST",t,{headers:this.headers,body:{phone:s,type:n,gotrue_meta_security:{captcha_token:i==null?void 0:i.captchaToken}}});return{data:{user:null,session:null,messageId:o==null?void 0:o.message_id},error:l}}throw new De("You must provide either an email or phone number and a type")}catch(t){if(E(t))return{data:{user:null,session:null},error:t};throw t}}async getSession(){return await this.initializePromise,await this._acquireLock(-1,async()=>this._useSession(async t=>t))}async _acquireLock(e,t){this._debug("#_acquireLock","begin",e);try{if(this.lockAcquired){const s=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),n=(async()=>(await s,await t()))();return this.pendingInLock.push((async()=>{try{await n}catch{}})()),n}return await this.lock(`lock:${this.storageKey}`,e,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const s=t();for(this.pendingInLock.push((async()=>{try{await s}catch{}})()),await s;this.pendingInLock.length;){const n=[...this.pendingInLock];await Promise.all(n),this.pendingInLock.splice(0,n.length)}return await s}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(e){this._debug("#_useSession","begin");try{const t=await this.__loadSession();return await e(t)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let e=null;const t=await Be(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",t),t!==null&&(this._isValidSession(t)?e=t:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!e)return{data:{session:null},error:null};const s=e.expires_at?e.expires_at*1e3-Date.now()<tt:!1;if(this._debug("#__loadSession()",`session has${s?"":" not"} expired`,"expires_at",e.expires_at),!s){if(this.storage.isServer){let o=this.suppressGetSessionWarning;e=new Proxy(e,{get:(c,u,d)=>(!o&&u==="user"&&(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),o=!0,this.suppressGetSessionWarning=!0),Reflect.get(c,u,d))})}return{data:{session:e},error:null}}const{session:n,error:i}=await this._callRefreshToken(e.refresh_token);return i?{data:{session:null},error:i}:{data:{session:n},error:null}}finally{this._debug("#__loadSession()","end")}}async getUser(e){return e?await this._getUser(e):(await this.initializePromise,await this._acquireLock(-1,async()=>await this._getUser()))}async _getUser(e){try{return e?await A(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:e,xform:te}):await this._useSession(async t=>{var s,n,i;const{data:o,error:l}=t;if(l)throw l;return!(!((s=o.session)===null||s===void 0)&&s.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new Z}:await A(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(i=(n=o.session)===null||n===void 0?void 0:n.access_token)!==null&&i!==void 0?i:void 0,xform:te})})}catch(t){if(E(t))return Nn(t)&&(await this._removeSession(),await qe(this.storage,`${this.storageKey}-code-verifier`)),{data:{user:null},error:t};throw t}}async updateUser(e,t={}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._updateUser(e,t))}async _updateUser(e,t={}){try{return await this._useSession(async s=>{const{data:n,error:i}=s;if(i)throw i;if(!n.session)throw new Z;const o=n.session;let l=null,c=null;this.flowType==="pkce"&&e.email!=null&&([l,c]=await fe(this.storage,this.storageKey));const{data:u,error:d}=await A(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:t==null?void 0:t.emailRedirectTo,body:Object.assign(Object.assign({},e),{code_challenge:l,code_challenge_method:c}),jwt:o.access_token,xform:te});if(d)throw d;return o.user=u.user,await this._saveSession(o),await this._notifyAllSubscribers("USER_UPDATED",o),{data:{user:o.user},error:null}})}catch(s){if(E(s))return{data:{user:null},error:s};throw s}}async setSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._setSession(e))}async _setSession(e){try{if(!e.access_token||!e.refresh_token)throw new Z;const t=Date.now()/1e3;let s=t,n=!0,i=null;const{payload:o}=rt(e.access_token);if(o.exp&&(s=o.exp,n=s<=t),n){const{session:l,error:c}=await this._callRefreshToken(e.refresh_token);if(c)return{data:{user:null,session:null},error:c};if(!l)return{data:{user:null,session:null},error:null};i=l}else{const{data:l,error:c}=await this._getUser(e.access_token);if(c)throw c;i={access_token:e.access_token,refresh_token:e.refresh_token,user:l.user,token_type:"bearer",expires_in:s-t,expires_at:s},await this._saveSession(i),await this._notifyAllSubscribers("SIGNED_IN",i)}return{data:{user:i.user,session:i},error:null}}catch(t){if(E(t))return{data:{session:null,user:null},error:t};throw t}}async refreshSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._refreshSession(e))}async _refreshSession(e){try{return await this._useSession(async t=>{var s;if(!e){const{data:o,error:l}=t;if(l)throw l;e=(s=o.session)!==null&&s!==void 0?s:void 0}if(!(e!=null&&e.refresh_token))throw new Z;const{session:n,error:i}=await this._callRefreshToken(e.refresh_token);return i?{data:{user:null,session:null},error:i}:n?{data:{user:n.user,session:n},error:null}:{data:{user:null,session:null},error:null}})}catch(t){if(E(t))return{data:{user:null,session:null},error:t};throw t}}async _getSessionFromURL(e,t){try{if(!z())throw new Ue("No browser detected.");if(e.error||e.error_description||e.error_code)throw new Ue(e.error_description||"Error in URL with unspecified error_description",{error:e.error||"unspecified_error",code:e.error_code||"unspecified_code"});switch(t){case"implicit":if(this.flowType==="pkce")throw new Dt("Not a valid PKCE flow url.");break;case"pkce":if(this.flowType==="implicit")throw new Ue("Not a valid implicit grant flow url.");break;default:}if(t==="pkce"){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!e.code)throw new Dt("No code detected.");const{data:v,error:y}=await this._exchangeCodeForSession(e.code);if(y)throw y;const N=new URL(window.location.href);return N.searchParams.delete("code"),window.history.replaceState(window.history.state,"",N.toString()),{data:{session:v.session,redirectType:null},error:null}}const{provider_token:s,provider_refresh_token:n,access_token:i,refresh_token:o,expires_in:l,expires_at:c,token_type:u}=e;if(!i||!l||!o||!u)throw new Ue("No session defined in URL");const d=Math.round(Date.now()/1e3),h=parseInt(l);let f=d+h;c&&(f=parseInt(c));const m=f-d;m*1e3<=pe&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${m}s, should have been closer to ${h}s`);const g=f-h;d-g>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",g,f,d):d-g<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",g,f,d);const{data:p,error:w}=await this._getUser(i);if(w)throw w;const x={provider_token:s,provider_refresh_token:n,access_token:i,expires_in:h,expires_at:f,refresh_token:o,token_type:u,user:p.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),{data:{session:x,redirectType:e.type},error:null}}catch(s){if(E(s))return{data:{session:null,redirectType:null},error:s};throw s}}_isImplicitGrantCallback(e){return!!(e.access_token||e.error_description)}async _isPKCECallback(e){const t=await Be(this.storage,`${this.storageKey}-code-verifier`);return!!(e.code&&t)}async signOut(e={scope:"global"}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._signOut(e))}async _signOut({scope:e}={scope:"global"}){return await this._useSession(async t=>{var s;const{data:n,error:i}=t;if(i)return{error:i};const o=(s=n.session)===null||s===void 0?void 0:s.access_token;if(o){const{error:l}=await this.admin.signOut(o,e);if(l&&!(Sn(l)&&(l.status===404||l.status===401||l.status===403)))return{error:l}}return e!=="others"&&(await this._removeSession(),await qe(this.storage,`${this.storageKey}-code-verifier`)),{error:null}})}onAuthStateChange(e){const t=Ln(),s={id:t,callback:e,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",t),this.stateChangeEmitters.delete(t)}};return this._debug("#onAuthStateChange()","registered callback with id",t),this.stateChangeEmitters.set(t,s),(async()=>(await this.initializePromise,await this._acquireLock(-1,async()=>{this._emitInitialSession(t)})))(),{data:{subscription:s}}}async _emitInitialSession(e){return await this._useSession(async t=>{var s,n;try{const{data:{session:i},error:o}=t;if(o)throw o;await((s=this.stateChangeEmitters.get(e))===null||s===void 0?void 0:s.callback("INITIAL_SESSION",i)),this._debug("INITIAL_SESSION","callback id",e,"session",i)}catch(i){await((n=this.stateChangeEmitters.get(e))===null||n===void 0?void 0:n.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",e,"error",i),console.error(i)}})}async resetPasswordForEmail(e,t={}){let s=null,n=null;this.flowType==="pkce"&&([s,n]=await fe(this.storage,this.storageKey,!0));try{return await A(this.fetch,"POST",`${this.url}/recover`,{body:{email:e,code_challenge:s,code_challenge_method:n,gotrue_meta_security:{captcha_token:t.captchaToken}},headers:this.headers,redirectTo:t.redirectTo})}catch(i){if(E(i))return{data:null,error:i};throw i}}async getUserIdentities(){var e;try{const{data:t,error:s}=await this.getUser();if(s)throw s;return{data:{identities:(e=t.user.identities)!==null&&e!==void 0?e:[]},error:null}}catch(t){if(E(t))return{data:null,error:t};throw t}}async linkIdentity(e){var t;try{const{data:s,error:n}=await this._useSession(async i=>{var o,l,c,u,d;const{data:h,error:f}=i;if(f)throw f;const m=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,e.provider,{redirectTo:(o=e.options)===null||o===void 0?void 0:o.redirectTo,scopes:(l=e.options)===null||l===void 0?void 0:l.scopes,queryParams:(c=e.options)===null||c===void 0?void 0:c.queryParams,skipBrowserRedirect:!0});return await A(this.fetch,"GET",m,{headers:this.headers,jwt:(d=(u=h.session)===null||u===void 0?void 0:u.access_token)!==null&&d!==void 0?d:void 0})});if(n)throw n;return z()&&!(!((t=e.options)===null||t===void 0)&&t.skipBrowserRedirect)&&window.location.assign(s==null?void 0:s.url),{data:{provider:e.provider,url:s==null?void 0:s.url},error:null}}catch(s){if(E(s))return{data:{provider:e.provider,url:null},error:s};throw s}}async unlinkIdentity(e){try{return await this._useSession(async t=>{var s,n;const{data:i,error:o}=t;if(o)throw o;return await A(this.fetch,"DELETE",`${this.url}/user/identities/${e.identity_id}`,{headers:this.headers,jwt:(n=(s=i.session)===null||s===void 0?void 0:s.access_token)!==null&&n!==void 0?n:void 0})})}catch(t){if(E(t))return{data:null,error:t};throw t}}async _refreshAccessToken(e){const t=`#_refreshAccessToken(${e.substring(0,5)}...)`;this._debug(t,"begin");try{const s=Date.now();return await qn(async n=>(n>0&&await Bn(200*Math.pow(2,n-1)),this._debug(t,"refreshing attempt",n),await A(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:e},headers:this.headers,xform:G})),(n,i)=>{const o=200*Math.pow(2,n);return i&&st(i)&&Date.now()+o-s<pe})}catch(s){if(this._debug(t,"error",s),E(s))return{data:{session:null,user:null},error:s};throw s}finally{this._debug(t,"end")}}_isValidSession(e){return typeof e=="object"&&e!==null&&"access_token"in e&&"refresh_token"in e&&"expires_at"in e}async _handleProviderSignIn(e,t){const s=await this._getUrlForProvider(`${this.url}/authorize`,e,{redirectTo:t.redirectTo,scopes:t.scopes,queryParams:t.queryParams});return this._debug("#_handleProviderSignIn()","provider",e,"options",t,"url",s),z()&&!t.skipBrowserRedirect&&window.location.assign(s),{data:{provider:e,url:s},error:null}}async _recoverAndRefresh(){var e;const t="#_recoverAndRefresh()";this._debug(t,"begin");try{const s=await Be(this.storage,this.storageKey);if(this._debug(t,"session from storage",s),!this._isValidSession(s)){this._debug(t,"session is not valid"),s!==null&&await this._removeSession();return}const n=((e=s.expires_at)!==null&&e!==void 0?e:1/0)*1e3-Date.now()<tt;if(this._debug(t,`session has${n?"":" not"} expired with margin of ${tt}s`),n){if(this.autoRefreshToken&&s.refresh_token){const{error:i}=await this._callRefreshToken(s.refresh_token);i&&(console.error(i),st(i)||(this._debug(t,"refresh failed with a non-retryable error, removing the session",i),await this._removeSession()))}}else await this._notifyAllSubscribers("SIGNED_IN",s)}catch(s){this._debug(t,"error",s),console.error(s);return}finally{this._debug(t,"end")}}async _callRefreshToken(e){var t,s;if(!e)throw new Z;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const n=`#_callRefreshToken(${e.substring(0,5)}...)`;this._debug(n,"begin");try{this.refreshingDeferred=new Xe;const{data:i,error:o}=await this._refreshAccessToken(e);if(o)throw o;if(!i.session)throw new Z;await this._saveSession(i.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",i.session);const l={session:i.session,error:null};return this.refreshingDeferred.resolve(l),l}catch(i){if(this._debug(n,"error",i),E(i)){const o={session:null,error:i};return st(i)||await this._removeSession(),(t=this.refreshingDeferred)===null||t===void 0||t.resolve(o),o}throw(s=this.refreshingDeferred)===null||s===void 0||s.reject(i),i}finally{this.refreshingDeferred=null,this._debug(n,"end")}}async _notifyAllSubscribers(e,t,s=!0){const n=`#_notifyAllSubscribers(${e})`;this._debug(n,"begin",t,`broadcast = ${s}`);try{this.broadcastChannel&&s&&this.broadcastChannel.postMessage({event:e,session:t});const i=[],o=Array.from(this.stateChangeEmitters.values()).map(async l=>{try{await l.callback(e,t)}catch(c){i.push(c)}});if(await Promise.all(o),i.length>0){for(let l=0;l<i.length;l+=1)console.error(i[l]);throw i[0]}}finally{this._debug(n,"end")}}async _saveSession(e){this._debug("#_saveSession()",e),this.suppressGetSessionWarning=!0,await vs(this.storage,this.storageKey,e)}async _removeSession(){this._debug("#_removeSession()"),await qe(this.storage,this.storageKey),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const e=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{e&&z()&&(window!=null&&window.removeEventListener)&&window.removeEventListener("visibilitychange",e)}catch(t){console.error("removing visibilitychange callback failed",t)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const e=setInterval(()=>this._autoRefreshTokenTick(),pe);this.autoRefreshTicker=e,e&&typeof e=="object"&&typeof e.unref=="function"?e.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(e),setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const e=this.autoRefreshTicker;this.autoRefreshTicker=null,e&&clearInterval(e)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const e=Date.now();try{return await this._useSession(async t=>{const{data:{session:s}}=t;if(!s||!s.refresh_token||!s.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const n=Math.floor((s.expires_at*1e3-e)/pe);this._debug("#_autoRefreshTokenTick()",`access token expires in ${n} ticks, a tick lasts ${pe}ms, refresh threshold is ${gt} ticks`),n<=gt&&await this._callRefreshToken(s.refresh_token)})}catch(t){console.error("Auto refresh tick failed with error. This is likely a transient error.",t)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(e){if(e.isAcquireTimeout||e instanceof xs)this._debug("auto refresh token tick lock not available");else throw e}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!z()||!(window!=null&&window.addEventListener))return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),window==null||window.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(e){console.error("_handleVisibilityChange",e)}}async _onVisibilityChanged(e){const t=`#_onVisibilityChanged(${e})`;this._debug(t,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),e||(await this.initializePromise,await this._acquireLock(-1,async()=>{if(document.visibilityState!=="visible"){this._debug(t,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(e,t,s){const n=[`provider=${encodeURIComponent(t)}`];if(s!=null&&s.redirectTo&&n.push(`redirect_to=${encodeURIComponent(s.redirectTo)}`),s!=null&&s.scopes&&n.push(`scopes=${encodeURIComponent(s.scopes)}`),this.flowType==="pkce"){const[i,o]=await fe(this.storage,this.storageKey),l=new URLSearchParams({code_challenge:`${encodeURIComponent(i)}`,code_challenge_method:`${encodeURIComponent(o)}`});n.push(l.toString())}if(s!=null&&s.queryParams){const i=new URLSearchParams(s.queryParams);n.push(i.toString())}return s!=null&&s.skipBrowserRedirect&&n.push(`skip_http_redirect=${s.skipBrowserRedirect}`),`${e}?${n.join("&")}`}async _unenroll(e){try{return await this._useSession(async t=>{var s;const{data:n,error:i}=t;return i?{data:null,error:i}:await A(this.fetch,"DELETE",`${this.url}/factors/${e.factorId}`,{headers:this.headers,jwt:(s=n==null?void 0:n.session)===null||s===void 0?void 0:s.access_token})})}catch(t){if(E(t))return{data:null,error:t};throw t}}async _enroll(e){try{return await this._useSession(async t=>{var s,n;const{data:i,error:o}=t;if(o)return{data:null,error:o};const l=Object.assign({friendly_name:e.friendlyName,factor_type:e.factorType},e.factorType==="phone"?{phone:e.phone}:{issuer:e.issuer}),{data:c,error:u}=await A(this.fetch,"POST",`${this.url}/factors`,{body:l,headers:this.headers,jwt:(s=i==null?void 0:i.session)===null||s===void 0?void 0:s.access_token});return u?{data:null,error:u}:(e.factorType==="totp"&&(!((n=c==null?void 0:c.totp)===null||n===void 0)&&n.qr_code)&&(c.totp.qr_code=`data:image/svg+xml;utf-8,${c.totp.qr_code}`),{data:c,error:null})})}catch(t){if(E(t))return{data:null,error:t};throw t}}async _verify(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var s;const{data:n,error:i}=t;if(i)return{data:null,error:i};const{data:o,error:l}=await A(this.fetch,"POST",`${this.url}/factors/${e.factorId}/verify`,{body:{code:e.code,challenge_id:e.challengeId},headers:this.headers,jwt:(s=n==null?void 0:n.session)===null||s===void 0?void 0:s.access_token});return l?{data:null,error:l}:(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+o.expires_in},o)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",o),{data:o,error:l})})}catch(t){if(E(t))return{data:null,error:t};throw t}})}async _challenge(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var s;const{data:n,error:i}=t;return i?{data:null,error:i}:await A(this.fetch,"POST",`${this.url}/factors/${e.factorId}/challenge`,{body:{channel:e.channel},headers:this.headers,jwt:(s=n==null?void 0:n.session)===null||s===void 0?void 0:s.access_token})})}catch(t){if(E(t))return{data:null,error:t};throw t}})}async _challengeAndVerify(e){const{data:t,error:s}=await this._challenge({factorId:e.factorId});return s?{data:null,error:s}:await this._verify({factorId:e.factorId,challengeId:t.id,code:e.code})}async _listFactors(){const{data:{user:e},error:t}=await this.getUser();if(t)return{data:null,error:t};const s=(e==null?void 0:e.factors)||[],n=s.filter(o=>o.factor_type==="totp"&&o.status==="verified"),i=s.filter(o=>o.factor_type==="phone"&&o.status==="verified");return{data:{all:s,totp:n,phone:i},error:null}}async _getAuthenticatorAssuranceLevel(){return this._acquireLock(-1,async()=>await this._useSession(async e=>{var t,s;const{data:{session:n},error:i}=e;if(i)return{data:null,error:i};if(!n)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:o}=rt(n.access_token);let l=null;o.aal&&(l=o.aal);let c=l;((s=(t=n.user.factors)===null||t===void 0?void 0:t.filter(h=>h.status==="verified"))!==null&&s!==void 0?s:[]).length>0&&(c="aal2");const d=o.amr||[];return{data:{currentLevel:l,nextLevel:c,currentAuthenticationMethods:d},error:null}}))}async fetchJwk(e,t={keys:[]}){let s=t.keys.find(o=>o.kid===e);if(s||(s=this.jwks.keys.find(o=>o.kid===e),s&&this.jwks_cached_at+jn>Date.now()))return s;const{data:n,error:i}=await A(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(i)throw i;if(!n.keys||n.keys.length===0)throw new Ne("JWKS is empty");if(this.jwks=n,this.jwks_cached_at=Date.now(),s=n.keys.find(o=>o.kid===e),!s)throw new Ne("No matching signing key found in JWKS");return s}async getClaims(e,t={keys:[]}){try{let s=e;if(!s){const{data:m,error:g}=await this.getSession();if(g||!m.session)return{data:null,error:g};s=m.session.access_token}const{header:n,payload:i,signature:o,raw:{header:l,payload:c}}=rt(s);if(Vn(i.exp),!n.kid||n.alg==="HS256"||!("crypto"in globalThis&&"subtle"in globalThis.crypto)){const{error:m}=await this.getUser(s);if(m)throw m;return{data:{claims:i,header:n,signature:o},error:null}}const u=Kn(n.alg),d=await this.fetchJwk(n.kid,t),h=await crypto.subtle.importKey("jwk",d,u,!0,["verify"]);if(!await crypto.subtle.verify(u,h,o,Cn(`${l}.${c}`)))throw new Ne("Invalid JWT signature");return{data:{claims:i,header:n,signature:o},error:null}}catch(s){if(E(s))return{data:null,error:s};throw s}}}Te.nextInstanceID=0;const ui=Te;class hi extends ui{constructor(e){super(e)}}var fi=function(r,e,t,s){function n(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function l(d){try{u(s.next(d))}catch(h){o(h)}}function c(d){try{u(s.throw(d))}catch(h){o(h)}}function u(d){d.done?i(d.value):n(d.value).then(l,c)}u((s=s.apply(r,e||[])).next())})};class mi{constructor(e,t,s){var n,i,o;if(this.supabaseUrl=e,this.supabaseKey=t,!e)throw new Error("supabaseUrl is required.");if(!t)throw new Error("supabaseKey is required.");const l=yn(e),c=new URL(l);this.realtimeUrl=new URL("realtime/v1",c),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",c),this.storageUrl=new URL("storage/v1",c),this.functionsUrl=new URL("functions/v1",c);const u=`sb-${c.hostname.split(".")[0]}-auth-token`,d={db:cn,realtime:un,auth:Object.assign(Object.assign({},dn),{storageKey:u}),global:ln},h=wn(s??{},d);this.storageKey=(n=h.auth.storageKey)!==null&&n!==void 0?n:"",this.headers=(i=h.global.headers)!==null&&i!==void 0?i:{},h.accessToken?(this.accessToken=h.accessToken,this.auth=new Proxy({},{get:(f,m)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(m)} is not possible`)}})):this.auth=this._initSupabaseAuthClient((o=h.auth)!==null&&o!==void 0?o:{},this.headers,h.global.fetch),this.fetch=gn(t,this._getAccessToken.bind(this),h.global.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers,accessToken:this._getAccessToken.bind(this)},h.realtime)),this.rest=new Ar(new URL("rest/v1",c).href,{headers:this.headers,schema:h.db.schema,fetch:this.fetch}),h.accessToken||this._listenForAuthEvents()}get functions(){return new ar(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}get storage(){return new nn(this.storageUrl.href,this.headers,this.fetch)}from(e){return this.rest.from(e)}schema(e){return this.rest.schema(e)}rpc(e,t={},s={}){return this.rest.rpc(e,t,s)}channel(e,t={config:{}}){return this.realtime.channel(e,t)}getChannels(){return this.realtime.getChannels()}removeChannel(e){return this.realtime.removeChannel(e)}removeAllChannels(){return this.realtime.removeAllChannels()}_getAccessToken(){var e,t;return fi(this,void 0,void 0,function*(){if(this.accessToken)return yield this.accessToken();const{data:s}=yield this.auth.getSession();return(t=(e=s.session)===null||e===void 0?void 0:e.access_token)!==null&&t!==void 0?t:null})}_initSupabaseAuthClient({autoRefreshToken:e,persistSession:t,detectSessionInUrl:s,storage:n,storageKey:i,flowType:o,lock:l,debug:c},u,d){const h={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new hi({url:this.authUrl.href,headers:Object.assign(Object.assign({},h),u),storageKey:i,autoRefreshToken:e,persistSession:t,detectSessionInUrl:s,storage:n,flowType:o,lock:l,debug:c,fetch:d,hasCustomAuthorizationHeader:"Authorization"in this.headers})}_initRealtimeClient(e){return new Hr(this.realtimeUrl.href,Object.assign(Object.assign({},e),{params:Object.assign({apikey:this.supabaseKey},e==null?void 0:e.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((t,s)=>{this._handleTokenChanged(t,"CLIENT",s==null?void 0:s.access_token)})}_handleTokenChanged(e,t,s){(e==="TOKEN_REFRESHED"||e==="SIGNED_IN")&&this.changedAccessToken!==s?this.changedAccessToken=s:e==="SIGNED_OUT"&&(this.realtime.setAuth(),t=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}}const gi=(r,e,t)=>new mi(r,e,t),pi="https://pgmdmedvdfukqvyistvf.supabase.co",yi="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InBnbWRtZWR2ZGZ1a3F2eWlzdHZmIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTEzNTQyNjIsImV4cCI6MjA2NjkzMDI2Mn0.x6jNBCNBh86qpjPs5kGKIIK_sE4T6XXbfYeBk6AvUHM",$=gi(pi,yi);class Ae{static async sendOTP(e){try{const{data:t,error:s}=await $.rpc("can_resend_otp",{user_email:e});if(s)throw s;if(!t)return{success:!1,message:"Please wait before requesting another OTP. You can resend after 1 minute."};const{data:n,error:i}=await $.rpc("create_email_verification",{user_email:e});if(i)throw i;if(n&&n.length>0){const{otp_code:o,expires_at:l}=n[0];return console.log(`OTP for ${e}: ${o}`),console.log(`Expires at: ${l}`),await this.simulateEmailSending(e,o),{success:!0,message:"OTP sent successfully to your email address.",data:{expires_at:l,otp_code:void 0}}}return{success:!1,message:"Failed to generate OTP. Please try again."}}catch(t){return console.error("Error sending OTP:",t),{success:!1,message:"Failed to send OTP. Please try again later."}}}static async verifyOTP(e,t){try{const{data:s,error:n}=await $.rpc("verify_otp",{user_email:e,provided_otp:t});if(n)throw n;return s===!0?{success:!0,message:"Email verified successfully!"}:{success:!1,message:"Invalid or expired OTP code. Please try again."}}catch(s){return console.error("Error verifying OTP:",s),{success:!1,message:"Verification failed. Please try again."}}}static async isEmailVerified(e){try{const{data:t,error:s}=await $.rpc("is_email_verified",{user_email:e});return s?(console.error("Error checking email verification:",s),!1):t===!0}catch(t){return console.error("Error checking email verification:",t),!1}}static async simulateEmailSending(e,t){console.log(`
       Email Simulation
      To: ${e}
      Subject: LuckyPick - Email Verification Code
      
      Your verification code is: ${t}
      
      This code will expire in 10 minutes.
      
      If you didn't request this code, please ignore this email.
    `),await new Promise(s=>setTimeout(s,1e3))}static async cleanupExpiredOTPs(){try{const{error:e}=await $.rpc("cleanup_expired_otps");e&&console.error("Error cleaning up expired OTPs:",e)}catch(e){console.error("Error cleaning up expired OTPs:",e)}}}const bs=b.createContext(void 0),le=()=>{const r=b.useContext(bs);if(!r)throw new Error("useAuth must be used within an AuthProvider");return r},wi=({children:r})=>{const[e,t]=b.useState(null),[s,n]=b.useState(!0),{isOnline:i}=Yt();b.useEffect(()=>{const d=async()=>{n(!0);try{const f=localStorage.getItem("user");if(f){const m=JSON.parse(f);t(m),await X.saveData("user",m)}else if(!i){const m=await X.getData("user","user1");m&&t(m)}}catch(f){console.error("Failed to load user data:",f)}finally{n(!1)}},{data:{subscription:h}}=$.auth.onAuthStateChange(async(f,m)=>{if(m!=null&&m.user){console.log("User signed in:",m.user);try{const{data:g,error:p}=await $.from("users").select("*").eq("email",m.user.email).single();if(g&&!p){const w={id:g.id,email:g.email,fullName:g.full_name,phone:g.phone,isAdmin:g.is_admin,walletBalance:Number(g.wallet_balance),createdAt:new Date(g.created_at)};t(w),localStorage.setItem("user",JSON.stringify(w)),await X.saveData("user",w)}}catch(g){console.error("Error loading user data:",g)}}else console.log("User signed out"),t(null),localStorage.removeItem("user");n(!1)});return d(),()=>{h.unsubscribe()}},[i]);const o=async(d,h)=>{try{if(d==="test@gmail.com"&&h==="12345677"){const g={id:"user1",email:d,fullName:"Demo User",isAdmin:!1,walletBalance:1e3,createdAt:new Date};return t(g),localStorage.setItem("user",JSON.stringify(g)),await X.saveData("user",g),!0}else if(d==="Admin@admin.com"&&h==="9794478972"){const g={id:"admin1",email:d,fullName:"System Admin",isAdmin:!0,walletBalance:0,createdAt:new Date};return t(g),localStorage.setItem("user",JSON.stringify(g)),await X.saveData("user",g),!0}const{data:f,error:m}=await $.auth.signInWithPassword({email:d,password:h});return m?(console.error("Login error:",m),!1):!!f.user}catch(f){return console.error("Login failed:",f),!1}},l=async d=>{try{if(!await Ae.isEmailVerified(d.email))throw new Error("Email must be verified before creating account");const{data:f,error:m}=await $.from("users").insert({email:d.email,full_name:d.fullName,phone:d.phone,email_verified:!0,email_verified_at:new Date().toISOString()}).select().single();if(m)return console.error("User creation error:",m),!1;if(f){try{await $.auth.signUp({email:d.email,password:d.password,options:{data:{full_name:d.fullName,phone:d.phone}}})}catch(p){console.warn("Auth user creation failed, but database user created:",p)}const g={id:f.id,email:f.email,fullName:f.full_name,phone:f.phone,isAdmin:f.is_admin,walletBalance:Number(f.wallet_balance),createdAt:new Date(f.created_at)};return t(g),localStorage.setItem("user",JSON.stringify(g)),await X.saveData("user",g),!0}return!1}catch(h){return console.error("Signup failed:",h),!1}},c=async()=>{try{await $.auth.signOut()}catch(d){console.error("Logout error:",d)}t(null),localStorage.removeItem("user")},u=d=>{if(e){const h={...e,walletBalance:e.walletBalance+d};t(h),localStorage.setItem("user",JSON.stringify(h)),X.saveData("user",h),i||X.saveOfflineAction({type:"updateWallet",data:{userId:e.id,amount:d}})}};return a.jsx(bs.Provider,{value:{user:e,loading:s,login:o,signup:l,logout:c,updateWallet:u},children:r})},_s=b.createContext(void 0),ce=()=>{const r=b.useContext(_s);if(!r)throw new Error("useApp must be used within an AppProvider");return r},vi=({children:r})=>{const{user:e}=le(),[t,s]=b.useState([]),[n,i]=b.useState([]),[o,l]=b.useState([]),[c,u]=b.useState([]),[d,h]=b.useState([]),[f,m]=b.useState(!0);b.useEffect(()=>{e&&g()},[e]),b.useEffect(()=>{if(!e)return;const S=$.channel("sessions_changes").on("postgres_changes",{event:"*",schema:"public",table:"sessions"},()=>{p()}).subscribe(),T=$.channel("bets_changes").on("postgres_changes",{event:"*",schema:"public",table:"bets"},()=>{w()}).subscribe(),O=$.channel("results_changes").on("postgres_changes",{event:"*",schema:"public",table:"results"},()=>{x()}).subscribe();return()=>{S.unsubscribe(),T.unsubscribe(),O.unsubscribe()}},[e]);const g=async()=>{m(!0),await Promise.all([p(),w(),x(),v(),y()]),m(!1)},p=async()=>{try{const{data:S,error:T}=await $.from("sessions").select("*").order("created_at",{ascending:!1});if(T)throw T;const O=S.map(k=>({id:k.id,name:k.name,time:k.time,date:k.date,isActive:k.is_active,betsCloseAt:k.bets_close_at,totalPool:Number(k.total_pool),createdBy:k.created_by}));s(O)}catch(S){console.error("Error loading sessions:",S)}},w=async()=>{try{const{data:S,error:T}=await $.from("bets").select("*").order("created_at",{ascending:!1});if(T)throw T;const O=S.map(k=>({id:k.id,userId:k.user_id,sessionId:k.session_id,number:k.number,amount:Number(k.amount),timestamp:new Date(k.created_at)}));i(O)}catch(S){console.error("Error loading bets:",S)}},x=async()=>{try{const{data:S,error:T}=await $.from("results").select("*").order("created_at",{ascending:!1});if(T)throw T;const O=S.map(k=>({id:k.id,sessionId:k.session_id,winningNumber:k.winning_number,totalPool:Number(k.total_pool),adminFee:Number(k.admin_fee),winnerCount:k.winner_count,winnerPayout:Number(k.winner_payout),timestamp:new Date(k.created_at),isZeroBetWin:k.is_zero_bet_win}));l(O)}catch(S){console.error("Error loading results:",S)}},v=async()=>{if(e)try{const{data:S,error:T}=await $.from("transactions").select("*").eq("user_id",e.id).order("created_at",{ascending:!1});if(T)throw T;const O=S.map(k=>({id:k.id,userId:k.user_id,type:k.type,amount:Number(k.amount),status:k.status,timestamp:new Date(k.created_at),description:k.description}));u(O)}catch(S){console.error("Error loading transactions:",S)}},y=async()=>{try{let S=$.from("withdrawals").select("*");e&&!e.isAdmin&&(S=S.eq("user_id",e.id));const{data:T,error:O}=await S.order("requested_at",{ascending:!1});if(O)throw O;const k=T.map(R=>({id:R.id,userId:R.user_id,amount:Number(R.amount),status:R.status,requestedAt:new Date(R.requested_at),processedAt:R.processed_at?new Date(R.processed_at):void 0,processedBy:R.processed_by||void 0}));h(k)}catch(S){console.error("Error loading withdrawals:",S)}},N=async(S,T)=>{if(e!=null&&e.isAdmin)try{const O=J(new Date,"yyyy-MM-dd"),k=J(Ps(new Date(`${O}T${S}:00`),-5),"HH:mm"),{error:R}=await $.from("sessions").insert({name:T,time:S,date:O,is_active:!0,bets_close_at:k,total_pool:0,created_by:"admin"});if(R)throw R}catch(O){console.error("Error creating session:",O)}},_=async(S,T,O)=>{if(!e)return!1;try{const k=t.find(C=>C.id===S);if(!k)return!1;const R=new Date,re=J(R,"yyyy-MM-dd"),V=new Date(`${re}T${k.betsCloseAt}:00`);if(Me(R,V))return!1;const{error:Q}=await $.from("bets").insert({user_id:e.id,session_id:S,number:T,amount:O});if(Q)throw Q;const{error:K}=await $.from("sessions").update({total_pool:k.totalPool+O}).eq("id",S);if(K)throw K;return!0}catch(k){return console.error("Error placing bet:",k),!1}},j=async S=>{if(e!=null&&e.isAdmin)try{const T=t.find(L=>L.id===S),O=n.filter(L=>L.sessionId===S);if(!T||O.length===0)return;const k={};for(let L=0;L<=9;L++)k[L]=0;O.forEach(L=>{k[L.number]+=L.amount});let R=0,re=k[0];for(let L=1;L<=9;L++)k[L]<re&&(R=L,re=k[L]);const V=T.totalPool,Q=re===0&&V>0;let K,C,q;if(Q)K=V,C=0,q=0;else{K=V*.1;const L=V*.9;q=O.filter(Ie=>Ie.number===R).length,C=q>0?L/q:0}const{error:be}=await $.from("results").insert({session_id:S,winning_number:R,total_pool:V,admin_fee:K,winner_count:q,winner_payout:C,is_zero_bet_win:Q});if(be)throw be;const{error:de}=await $.from("sessions").update({is_active:!1}).eq("id",S);if(de)throw de;if(q>0&&C>0){const L=O.filter(ue=>ue.number===R);for(const ue of L){const{data:Ie}=await $.from("users").select("wallet_balance").eq("id",ue.userId).single();Ie&&(await $.from("users").update({wallet_balance:Number(Ie.wallet_balance)+C}).eq("id",ue.userId),await $.from("transactions").insert({user_id:ue.userId,type:"win",amount:C,status:"completed",description:`Won ${C} on number ${R}`}))}}}catch(T){console.error("Error processing jackpot:",T)}},P=async S=>{if(e)try{const{error:T}=await $.from("transactions").insert({user_id:S.userId,type:S.type,amount:S.amount,status:S.status,description:S.description});if(T)throw T}catch(T){console.error("Error adding transaction:",T)}},U=async S=>{if(e)try{const{error:T}=await $.from("withdrawals").insert({user_id:e.id,amount:S,status:"pending"});if(T)throw T}catch(T){console.error("Error requesting withdrawal:",T)}},xe=async(S,T)=>{if(e!=null&&e.isAdmin)try{const{error:O}=await $.from("withdrawals").update({status:T,processed_at:new Date().toISOString(),processed_by:e.id}).eq("id",S);if(O)throw O}catch(O){console.error("Error processing withdrawal:",O)}};return a.jsx(_s.Provider,{value:{sessions:t,bets:n,results:o,transactions:c,withdrawals:d,loading:f,createSession:N,placeBet:_,processJackpot:j,addTransaction:P,requestWithdrawal:U,processWithdrawal:xe},children:r})},xi=({email:r,onVerified:e,onBack:t})=>{const[s,n]=b.useState(["","","","","",""]),[i,o]=b.useState(!1),[l,c]=b.useState(""),[u,d]=b.useState(!1),[h,f]=b.useState(!1),[m,g]=b.useState(0);b.useEffect(()=>{if(m>0){const _=setTimeout(()=>{g(m-1)},1e3);return()=>clearTimeout(_)}},[m]),b.useEffect(()=>{const _=document.getElementById("otp-0");_==null||_.focus()},[]);const p=(_,j)=>{if(j.length>1)return;const P=[...s];if(P[_]=j,n(P),c(""),j&&_<5){const U=document.getElementById(`otp-${_+1}`);U==null||U.focus()}P.every(U=>U!=="")&&P.join("").length===6&&v(P.join(""))},w=(_,j)=>{if(j.key==="Backspace"&&!s[_]&&_>0){const P=document.getElementById(`otp-${_-1}`);P==null||P.focus()}},x=_=>{_.preventDefault();const j=_.clipboardData.getData("text").replace(/\D/g,"").slice(0,6);if(j.length===6){const P=j.split("");n(P),c("");const U=document.getElementById("otp-5");U==null||U.focus(),v(j)}},v=async _=>{o(!0),c("");try{const j=await Ae.verifyOTP(r,_);if(j.success)d(!0),setTimeout(()=>{e()},1500);else{c(j.message),n(["","","","","",""]);const P=document.getElementById("otp-0");P==null||P.focus()}}catch{c("Verification failed. Please try again.")}finally{o(!1)}},y=async()=>{if(!(m>0)){f(!0),c("");try{const _=await Ae.sendOTP(r);if(_.success){g(60),n(["","","","","",""]);const j=document.getElementById("otp-0");j==null||j.focus(),c("")}else c(_.message)}catch{c("Failed to resend OTP. Please try again.")}finally{f(!1)}}},N=_=>{_.preventDefault();const j=s.join("");j.length===6?v(j):c("Please enter the complete 6-digit code.")};return u?a.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 flex items-center justify-center p-4",children:a.jsx("div",{className:"bg-white rounded-2xl shadow-xl w-full max-w-md p-8 text-center",children:a.jsxs("div",{className:"mb-6",children:[a.jsx(As,{className:"w-16 h-16 text-green-500 mx-auto mb-4"}),a.jsx("h1",{className:"text-2xl font-bold text-gray-800 mb-2",children:"Email Verified!"}),a.jsx("p",{className:"text-gray-600",children:"Your email has been successfully verified."})]})})}):a.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 flex items-center justify-center p-4",children:a.jsxs("div",{className:"bg-white rounded-2xl shadow-xl w-full max-w-md p-8 relative",children:[a.jsx("button",{onClick:t,className:"absolute top-6 left-6 p-2 text-gray-400 hover:text-gray-600 transition-colors",children:a.jsx(Os,{className:"w-5 h-5"})}),a.jsxs("div",{className:"text-center mb-8",children:[a.jsx("div",{className:"w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-4",children:a.jsx(at,{className:"w-8 h-8 text-blue-600"})}),a.jsx("h1",{className:"text-2xl font-bold text-gray-800 mb-2",children:"Verify Your Email"}),a.jsx("p",{className:"text-gray-600 text-sm",children:"We've sent a 6-digit verification code to"}),a.jsx("p",{className:"text-blue-600 font-medium",children:r})]}),a.jsxs("form",{onSubmit:N,className:"space-y-6",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-3 text-center",children:"Enter Verification Code"}),a.jsx("div",{className:"flex justify-center space-x-2",children:s.map((_,j)=>a.jsx("input",{id:`otp-${j}`,type:"text",inputMode:"numeric",pattern:"[0-9]",maxLength:1,value:_,onChange:P=>p(j,P.target.value),onKeyDown:P=>w(j,P),onPaste:j===0?x:void 0,className:"w-12 h-12 text-center text-lg font-semibold border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-colors",disabled:i},j))}),a.jsx("p",{className:"text-xs text-gray-500 text-center mt-2",children:"You can paste the 6-digit code directly"})]}),l&&a.jsx("div",{className:"text-red-600 text-sm text-center bg-red-50 p-3 rounded-lg",children:l}),a.jsxs("button",{type:"submit",disabled:i||s.some(_=>!_),className:"w-full bg-blue-600 text-white py-3 rounded-lg font-medium hover:bg-blue-700 focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed transition-colors flex items-center justify-center",children:[i&&a.jsx(wt,{className:"w-4 h-4 mr-2 animate-spin"}),i?"Verifying...":"Verify Email"]})]}),a.jsxs("div",{className:"mt-6 text-center",children:[a.jsx("p",{className:"text-sm text-gray-600 mb-3",children:"Didn't receive the code?"}),a.jsxs("button",{onClick:y,disabled:h||m>0,className:"inline-flex items-center text-blue-600 hover:text-blue-700 font-medium text-sm disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:[a.jsx($s,{className:`w-4 h-4 mr-2 ${h?"animate-spin":""}`}),m>0?`Resend in ${m}s`:h?"Sending...":"Resend Code"]})]}),a.jsx("div",{className:"mt-8 p-4 bg-blue-50 rounded-lg",children:a.jsxs("p",{className:"text-xs text-blue-800 text-center",children:[a.jsx("strong",{children:"Demo:"})," Check the browser console for the OTP code. In production, this would be sent to your email address."]})})]})})},bi=()=>{const[r,e]=b.useState("login"),[t,s]=b.useState("email"),[n,i]=b.useState(""),[o,l]=b.useState(""),[c,u]=b.useState(""),[d,h]=b.useState(""),[f,m]=b.useState(""),[g,p]=b.useState(!1),[w,x]=b.useState(!1),[v,y]=b.useState(""),[N,_]=b.useState(!1),[j,P]=b.useState(!1),[U,xe]=b.useState(null),{login:S,signup:T}=le(),O=()=>{if(r==="signup"){if(!f.trim())return y("Full name is required"),!1;if(c.length<6)return y("Password must be at least 6 characters long"),!1;if(c!==d)return y("Passwords do not match"),!1;if(t==="email"&&!n.includes("@"))return y("Please enter a valid email address"),!1;if(t==="phone"&&o.length<10)return y("Please enter a valid phone number"),!1}return!0},k=async C=>{if(C.preventDefault(),y(""),!!O()){_(!0);try{if(r==="login")await S(n,c)||y("Invalid credentials. Please check your email and password.");else{const q=t==="email"?n:`${o}@phone.local`;if(await Ae.isEmailVerified(q))await T({fullName:f,email:q,phone:t==="phone"?o:"",password:c})||y("Registration failed. Email may already be in use.");else{const de=await Ae.sendOTP(q);de.success?(xe({fullName:f,email:q,phone:t==="phone"?o:"",password:c}),P(!0)):y(de.message)}}}catch{y(r==="login"?"Login failed":"Registration failed")}finally{_(!1)}}},R=async()=>{if(U){_(!0);try{await T(U)||(y("Registration failed. Please try again."),P(!1))}catch{y("Registration failed"),P(!1)}finally{_(!1)}}},re=()=>{P(!1),xe(null)},V=()=>{i(""),l(""),u(""),h(""),m(""),y(""),P(!1),xe(null)},Q=C=>{e(C),V()},K=async(C,q)=>{_(!0),y("");try{await S(C,q)||y("Demo login failed. Please try again.")}catch{y("Demo login failed")}finally{_(!1)}};return j&&U?a.jsx(xi,{email:U.email,onVerified:R,onBack:re}):a.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 flex items-center justify-center p-4",children:a.jsxs("div",{className:"bg-white rounded-2xl shadow-xl w-full max-w-md p-8",children:[a.jsxs("div",{className:"text-center mb-8",children:[a.jsx("h1",{className:"text-3xl font-bold text-gray-800 mb-2",children:"LuckyPick"}),a.jsx("p",{className:"text-gray-600",children:"Daily Number Lottery"})]}),a.jsxs("div",{className:"flex mb-6 bg-gray-100 rounded-lg p-1",children:[a.jsx("button",{type:"button",onClick:()=>Q("login"),className:`flex-1 py-2 px-4 rounded-md text-sm font-medium transition-colors ${r==="login"?"bg-white text-blue-600 shadow-sm":"text-gray-600 hover:text-gray-800"}`,children:"Sign In"}),a.jsx("button",{type:"button",onClick:()=>Q("signup"),className:`flex-1 py-2 px-4 rounded-md text-sm font-medium transition-colors ${r==="signup"?"bg-white text-blue-600 shadow-sm":"text-gray-600 hover:text-gray-800"}`,children:"Sign Up"})]}),r==="signup"&&a.jsxs("div",{className:"flex mb-6 bg-gray-100 rounded-lg p-1",children:[a.jsxs("button",{type:"button",onClick:()=>s("email"),className:`flex-1 py-2 px-4 rounded-md text-sm font-medium transition-colors ${t==="email"?"bg-white text-blue-600 shadow-sm":"text-gray-600 hover:text-gray-800"}`,children:[a.jsx(at,{className:"w-4 h-4 inline mr-2"}),"Email"]}),a.jsxs("button",{type:"button",onClick:()=>s("phone"),className:`flex-1 py-2 px-4 rounded-md text-sm font-medium transition-colors ${t==="phone"?"bg-white text-blue-600 shadow-sm":"text-gray-600 hover:text-gray-800"}`,children:[a.jsx(Nt,{className:"w-4 h-4 inline mr-2"}),"Phone"]})]}),a.jsxs("form",{onSubmit:k,className:"space-y-4",children:[r==="signup"&&a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Full Name"}),a.jsxs("div",{className:"relative",children:[a.jsx(Cs,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"}),a.jsx("input",{type:"text",value:f,onChange:C=>m(C.target.value),className:"w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Enter your full name",required:!0})]})]}),r==="login"||t==="email"?a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Email Address"}),a.jsxs("div",{className:"relative",children:[a.jsx(at,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"}),a.jsx("input",{type:"email",value:n,onChange:C=>i(C.target.value),className:"w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Enter your email",required:!0})]})]}):a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Phone Number"}),a.jsxs("div",{className:"relative",children:[a.jsx(Nt,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"}),a.jsx("input",{type:"tel",value:o,onChange:C=>l(C.target.value),className:"w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Enter your phone number",required:!0})]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Password"}),a.jsxs("div",{className:"relative",children:[a.jsx(Et,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"}),a.jsx("input",{type:g?"text":"password",value:c,onChange:C=>u(C.target.value),className:"w-full pl-10 pr-12 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:r==="signup"?"Create a password (min 6 characters)":"Enter your password",required:!0,minLength:r==="signup"?6:void 0}),a.jsx("button",{type:"button",onClick:()=>p(!g),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600",children:g?a.jsx(Pt,{className:"w-5 h-5"}):a.jsx(ot,{className:"w-5 h-5"})})]})]}),r==="signup"&&a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Confirm Password"}),a.jsxs("div",{className:"relative",children:[a.jsx(Et,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"}),a.jsx("input",{type:w?"text":"password",value:d,onChange:C=>h(C.target.value),className:"w-full pl-10 pr-12 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Confirm your password",required:!0}),a.jsx("button",{type:"button",onClick:()=>x(!w),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600",children:w?a.jsx(Pt,{className:"w-5 h-5"}):a.jsx(ot,{className:"w-5 h-5"})})]})]}),v&&a.jsx("div",{className:"text-red-600 text-sm text-center bg-red-50 p-3 rounded-lg",children:v}),a.jsxs("button",{type:"submit",disabled:N,className:"w-full bg-blue-600 text-white py-3 rounded-lg font-medium hover:bg-blue-700 focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed transition-colors flex items-center justify-center",children:[N&&a.jsx(wt,{className:"w-4 h-4 mr-2 animate-spin"}),N?r==="login"?"Signing In...":"Creating Account...":r==="login"?"Sign In":"Create Account"]})]}),r==="login"&&a.jsxs("div",{className:"mt-8 p-4 bg-gray-50 rounded-lg",children:[a.jsx("h3",{className:"font-medium text-gray-800 mb-3",children:"Demo Accounts:"}),a.jsxs("div",{className:"space-y-2",children:[a.jsxs("button",{onClick:()=>K("test@gmail.com","12345677"),disabled:N,className:"w-full text-left p-2 bg-white rounded border hover:bg-gray-50 transition-colors disabled:opacity-50",children:[a.jsxs("div",{className:"text-sm",children:[a.jsx("strong",{children:"Demo User:"})," test@gmail.com"]}),a.jsx("div",{className:"text-xs text-gray-500",children:"Password: 12345677"})]}),a.jsxs("button",{onClick:()=>K("Admin@admin.com","9794478972"),disabled:N,className:"w-full text-left p-2 bg-white rounded border hover:bg-gray-50 transition-colors disabled:opacity-50",children:[a.jsxs("div",{className:"text-sm",children:[a.jsx("strong",{children:"Admin:"})," Admin@admin.com"]}),a.jsx("div",{className:"text-xs text-gray-500",children:"Password: 9794478972"})]})]})]}),r==="signup"&&a.jsx("div",{className:"mt-6 p-4 bg-blue-50 rounded-lg",children:a.jsxs("p",{className:"text-sm text-blue-800",children:[a.jsx("strong",{children:"Email Verification Required!"})," We'll send a 6-digit verification code to your email address to confirm your account."]})})]})})},_i=({sessionId:r,onClose:e})=>{const{user:t,updateWallet:s}=le(),{sessions:n,placeBet:i,addTransaction:o}=ce(),[l,c]=b.useState(null),[u,d]=b.useState(""),[h,f]=b.useState(""),[m,g]=b.useState(!1),p=n.find(x=>x.id===r),w=async()=>{if(l===null){f("Please select a number");return}const x=parseFloat(u);if(isNaN(x)||x<1){f("Minimum bet amount is 1");return}if(!t||x>t.walletBalance){f("Insufficient wallet balance");return}g(!0),f("");try{await i(r,l,x)?(await s(-x),await o({userId:t.id,type:"bet",amount:-x,status:"completed",description:`Bet on number ${l} for session ${p==null?void 0:p.time}`}),e()):f("Failed to place bet. Betting may be closed.")}catch{f("Failed to place bet. Please try again.")}finally{g(!1)}};return a.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:a.jsxs("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-md",children:[a.jsxs("div",{className:"flex justify-between items-center p-6 border-b",children:[a.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Place Your Bet"}),a.jsx("button",{onClick:e,className:"text-gray-400 hover:text-gray-600 transition-colors",children:a.jsx(ze,{className:"w-6 h-6"})})]}),a.jsxs("div",{className:"p-6",children:[a.jsxs("div",{className:"mb-6",children:[a.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:(p==null?void 0:p.name)||`Session ${p==null?void 0:p.time}`}),a.jsx("p",{className:"text-gray-600",children:"Choose a number from 0-9"})]}),a.jsxs("div",{className:"mb-6",children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"Select Number"}),a.jsx("div",{className:"grid grid-cols-5 gap-2",children:[0,1,2,3,4,5,6,7,8,9].map(x=>a.jsx("button",{onClick:()=>c(x),className:`h-12 rounded-lg font-semibold transition-colors ${l===x?"bg-blue-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:x},x))})]}),a.jsxs("div",{className:"mb-6",children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Bet Amount ()"}),a.jsxs("div",{className:"relative",children:[a.jsx(Pe,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"}),a.jsx("input",{type:"number",value:u,onChange:x=>d(x.target.value),className:"w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Enter amount (min 1)",min:"1",step:"1"})]}),a.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:["Wallet Balance: ",t==null?void 0:t.walletBalance]})]}),h&&a.jsx("div",{className:"mb-4 text-red-600 text-sm bg-red-50 p-3 rounded-lg",children:h}),a.jsxs("div",{className:"flex space-x-3",children:[a.jsx("button",{onClick:e,disabled:m,className:"flex-1 py-3 px-4 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 transition-colors disabled:opacity-50",children:"Cancel"}),a.jsx("button",{onClick:w,disabled:m,className:"flex-1 py-3 px-4 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors disabled:opacity-50",children:m?"Placing Bet...":"Place Bet"})]})]})]})})},ji=({onClose:r})=>{const{user:e,updateWallet:t}=le(),{transactions:s,addTransaction:n,requestWithdrawal:i}=ce(),[o,l]=b.useState("balance"),[c,u]=b.useState(""),[d,h]=b.useState(""),[f,m]=b.useState(""),[g,p]=b.useState(!1),w=async()=>{const v=parseFloat(c);if(isNaN(v)||v<10){m("Minimum deposit amount is 10");return}p(!0),m("");try{e&&(await t(v),await n({userId:e.id,type:"deposit",amount:v,status:"completed",description:"Wallet deposit via UPI"}),u(""))}catch{m("Failed to add funds. Please try again.")}finally{p(!1)}},x=async()=>{const v=parseFloat(d);if(isNaN(v)||v<50){m("Minimum withdrawal amount is 50");return}if(!e||v>e.walletBalance){m("Insufficient balance");return}p(!0),m("");try{await i(v),await n({userId:e.id,type:"withdrawal",amount:-v,status:"pending",description:`Withdrawal request for ${v}`}),h("")}catch{m("Failed to request withdrawal. Please try again.")}finally{p(!1)}};return a.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:a.jsxs("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-2xl max-h-[90vh] overflow-hidden",children:[a.jsxs("div",{className:"flex justify-between items-center p-6 border-b",children:[a.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"My Wallet"}),a.jsx("button",{onClick:r,className:"text-gray-400 hover:text-gray-600 transition-colors",children:a.jsx(ze,{className:"w-6 h-6"})})]}),a.jsxs("div",{className:"flex border-b",children:[a.jsxs("button",{onClick:()=>l("balance"),className:`flex-1 py-3 px-4 text-center font-medium transition-colors ${o==="balance"?"text-blue-600 border-b-2 border-blue-600":"text-gray-600 hover:text-gray-800"}`,children:[a.jsx(Is,{className:"w-4 h-4 inline mr-2"}),"Balance"]}),a.jsxs("button",{onClick:()=>l("history"),className:`flex-1 py-3 px-4 text-center font-medium transition-colors ${o==="history"?"text-blue-600 border-b-2 border-blue-600":"text-gray-600 hover:text-gray-800"}`,children:[a.jsx(Rs,{className:"w-4 h-4 inline mr-2"}),"History"]})]}),a.jsxs("div",{className:"p-6 overflow-y-auto max-h-[60vh]",children:[o==="balance"&&a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{className:"text-center",children:[a.jsxs("h3",{className:"text-2xl font-bold text-gray-900",children:["",e==null?void 0:e.walletBalance]}),a.jsx("p",{className:"text-gray-600",children:"Current Balance"})]}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[a.jsxs("div",{className:"bg-green-50 rounded-lg p-4",children:[a.jsxs("h4",{className:"font-semibold text-green-800 mb-3 flex items-center",children:[a.jsx(Jt,{className:"w-4 h-4 mr-2"}),"Add Funds"]}),a.jsxs("div",{className:"space-y-3",children:[a.jsx("input",{type:"number",value:c,onChange:v=>u(v.target.value),className:"w-full px-3 py-2 border border-green-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent",placeholder:"Amount (min 10)",min:"10"}),a.jsx("button",{onClick:w,disabled:g,className:"w-full bg-green-600 text-white py-2 rounded-lg hover:bg-green-700 transition-colors disabled:opacity-50",children:g?"Processing...":"Add via UPI"})]})]}),a.jsxs("div",{className:"bg-red-50 rounded-lg p-4",children:[a.jsxs("h4",{className:"font-semibold text-red-800 mb-3 flex items-center",children:[a.jsx(Ls,{className:"w-4 h-4 mr-2"}),"Withdraw Funds"]}),a.jsxs("div",{className:"space-y-3",children:[a.jsx("input",{type:"number",value:d,onChange:v=>h(v.target.value),className:"w-full px-3 py-2 border border-red-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent",placeholder:"Amount (min 50)",min:"50"}),a.jsx("button",{onClick:x,disabled:g,className:"w-full bg-red-600 text-white py-2 rounded-lg hover:bg-red-700 transition-colors disabled:opacity-50",children:g?"Processing...":"Request Withdrawal"}),a.jsx("p",{className:"text-xs text-red-600",children:"Requires admin approval"})]})]})]}),f&&a.jsx("div",{className:"text-red-600 text-sm text-center bg-red-50 p-3 rounded-lg",children:f})]}),o==="history"&&a.jsx("div",{className:"space-y-4",children:s.length===0?a.jsx("p",{className:"text-gray-500 text-center",children:"No transactions yet"}):s.map(v=>a.jsxs("div",{className:"flex justify-between items-center p-3 bg-gray-50 rounded-lg",children:[a.jsxs("div",{children:[a.jsx("p",{className:"font-medium text-gray-900",children:v.description}),a.jsx("p",{className:"text-sm text-gray-600",children:J(v.timestamp,"MMM dd, yyyy HH:mm")})]}),a.jsxs("div",{className:"text-right",children:[a.jsxs("p",{className:`font-semibold ${v.amount>0?"text-green-600":"text-red-600"}`,children:[v.amount>0?"+":"","",Math.abs(v.amount)]}),a.jsx("p",{className:`text-xs ${v.status==="completed"?"text-green-600":v.status==="pending"?"text-yellow-600":"text-red-600"}`,children:v.status})]})]},v.id))})]})]})})},ki=()=>{const{user:r,logout:e}=le(),{sessions:t,results:s,bets:n}=ce(),[i,o]=b.useState(null),[l,c]=b.useState(!1),[u,d]=b.useState(new Date);b.useEffect(()=>{const g=setInterval(()=>{d(new Date)},1e3);return()=>clearInterval(g)},[]);const h=(g,p)=>{const w=J(new Date,"yyyy-MM-dd"),x=new Date(`${w}T${p}:00`),v=new Date(`${w}T${g}:00`);if(Me(u,v))return"Session Ended";if(Me(u,x))return"Betting Closed";const y=x.getTime()-u.getTime(),N=Math.floor(y/6e4),_=Math.floor(y%6e4/1e3);return`${N}:${_.toString().padStart(2,"0")}`},f=g=>{const p=J(new Date,"yyyy-MM-dd"),w=new Date(`${p}T${g}:00`);return Ts(u,w)},m=g=>n.filter(p=>p.sessionId===g&&p.userId===(r==null?void 0:r.id));return a.jsxs("div",{className:"min-h-screen bg-gray-50",children:[a.jsx("header",{className:"bg-white shadow-sm border-b",children:a.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:a.jsxs("div",{className:"flex justify-between items-center h-16",children:[a.jsxs("div",{children:[a.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"LuckyPick"}),a.jsxs("p",{className:"text-sm text-gray-600",children:["Welcome, ",(r==null?void 0:r.fullName)||(r==null?void 0:r.email)]})]}),a.jsxs("div",{className:"flex items-center space-x-4",children:[a.jsxs("button",{onClick:()=>c(!0),className:"flex items-center space-x-2 bg-green-100 text-green-800 px-4 py-2 rounded-lg hover:bg-green-200 transition-colors",children:[a.jsx(Ds,{className:"w-4 h-4"}),a.jsxs("span",{children:["",r==null?void 0:r.walletBalance]})]}),a.jsxs("button",{onClick:e,className:"flex items-center space-x-2 text-gray-600 hover:text-gray-800 transition-colors",children:[a.jsx(Vt,{className:"w-4 h-4"}),a.jsx("span",{children:"Logout"})]})]})]})})}),a.jsx("main",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:a.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[a.jsxs("div",{className:"lg:col-span-2",children:[a.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-6",children:"Active Sessions"}),a.jsx("div",{className:"space-y-4",children:t.filter(g=>g.isActive).map(g=>{const p=h(g.time,g.betsCloseAt),w=f(g.betsCloseAt),x=m(g.id),v=x.reduce((y,N)=>y+N.amount,0);return a.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6",children:[a.jsxs("div",{className:"flex justify-between items-start mb-4",children:[a.jsxs("div",{children:[a.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:g.name||`Session ${g.time}`}),a.jsxs("p",{className:"text-gray-600",children:["Time: ",g.time]}),a.jsxs("p",{className:"text-sm text-gray-500",children:["Betting closes at ",g.betsCloseAt]})]}),a.jsxs("div",{className:"text-right",children:[a.jsxs("div",{className:"flex items-center text-blue-600 mb-2",children:[a.jsx(vt,{className:"w-4 h-4 mr-1"}),a.jsx("span",{className:"font-mono",children:p})]}),a.jsxs("p",{className:"text-sm text-gray-500",children:["Pool: ",g.totalPool]})]})]}),x.length>0&&a.jsxs("div",{className:"mb-4 p-3 bg-blue-50 rounded-lg",children:[a.jsxs("p",{className:"text-sm text-blue-800",children:["Your bets: ",x.map(y=>`${y.number} (${y.amount})`).join(", ")]}),a.jsxs("p",{className:"text-sm text-blue-600",children:["Total: ",v]})]}),a.jsx("button",{onClick:()=>o(g.id),disabled:!w,className:`w-full py-2 px-4 rounded-lg font-medium transition-colors ${w?"bg-blue-600 text-white hover:bg-blue-700":"bg-gray-300 text-gray-500 cursor-not-allowed"}`,children:w?"Place Bet":"Betting Closed"})]},g.id)})})]}),a.jsxs("div",{children:[a.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-6",children:"Previous Results"}),a.jsx("div",{className:"space-y-4",children:s.slice(-5).reverse().map(g=>{const p=t.find(v=>v.id===g.sessionId),x=n.filter(v=>v.sessionId===g.sessionId&&v.userId===(r==null?void 0:r.id)&&v.number===g.winningNumber).length>0;return a.jsxs("div",{className:"bg-white rounded-lg shadow-md p-4",children:[a.jsxs("div",{className:"flex justify-between items-start mb-2",children:[a.jsxs("div",{children:[a.jsx("p",{className:"font-medium text-gray-900",children:(p==null?void 0:p.name)||`Session ${p==null?void 0:p.time}`}),a.jsx("p",{className:"text-sm text-gray-600",children:J(g.timestamp,"MMM dd, HH:mm")})]}),a.jsx("div",{className:"text-right",children:a.jsxs("div",{className:"flex items-center text-yellow-600",children:[a.jsx(xt,{className:"w-4 h-4 mr-1"}),a.jsx("span",{className:"font-bold text-lg",children:g.winningNumber})]})})]}),a.jsxs("div",{className:"text-sm text-gray-600",children:[a.jsxs("p",{children:["Pool: ",g.totalPool]}),a.jsxs("p",{children:["Winners: ",g.winnerCount]}),x&&a.jsxs("p",{className:"text-green-600 font-medium",children:["You won: ",g.winnerPayout]})]})]},g.id)})})]})]})}),i&&a.jsx(_i,{sessionId:i,onClose:()=>o(null)}),l&&a.jsx(ji,{onClose:()=>c(!1)})]})},Si=()=>{const{sessions:r,bets:e,createSession:t,processJackpot:s}=ce(),[n,i]=b.useState(!1),[o,l]=b.useState(""),[c,u]=b.useState(""),[d,h]=b.useState(new Date);b.useEffect(()=>{const p=setInterval(()=>{h(new Date),r.forEach(w=>{if(w.isActive){const x=J(new Date,"yyyy-MM-dd"),v=new Date(`${x}T${w.time}:00`);Me(d,v)&&s(w.id)}})},1e3);return()=>clearInterval(p)},[r,s,d]);const f=()=>{o&&(t(o,c||void 0),l(""),u(""),i(!1))},m=p=>e.filter(w=>w.sessionId===p),g=p=>{const w=m(p),x={};for(let v=0;v<=9;v++)x[v]=0;return w.forEach(v=>{x[v.number]+=v.amount}),x};return a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{className:"flex justify-between items-center",children:[a.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Session Management"}),a.jsxs("button",{onClick:()=>i(!0),className:"flex items-center space-x-2 bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors",children:[a.jsx(Jt,{className:"w-4 h-4"}),a.jsx("span",{children:"Create Session"})]})]}),a.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:r.map(p=>{const w=m(p.id),x=g(p.id),v=new Set(w.map(y=>y.userId)).size;return a.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6",children:[a.jsxs("div",{className:"flex justify-between items-start mb-4",children:[a.jsxs("div",{children:[a.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:p.name||`Session ${p.time}`}),a.jsxs("p",{className:"text-gray-600",children:["Time: ",p.time]}),a.jsxs("p",{className:"text-sm text-gray-500",children:["Created by: ",p.createdBy]})]}),a.jsx("div",{className:"text-right",children:a.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${p.isActive?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"}`,children:p.isActive?"Active":"Completed"})})]}),a.jsxs("div",{className:"grid grid-cols-3 gap-4 mb-4",children:[a.jsxs("div",{className:"text-center",children:[a.jsx("div",{className:"flex items-center justify-center text-blue-600 mb-1",children:a.jsx(Pe,{className:"w-4 h-4 mr-1"})}),a.jsx("p",{className:"text-sm text-gray-600",children:"Total Pool"}),a.jsxs("p",{className:"font-semibold",children:["",p.totalPool]})]}),a.jsxs("div",{className:"text-center",children:[a.jsx("div",{className:"flex items-center justify-center text-green-600 mb-1",children:a.jsx(lt,{className:"w-4 h-4 mr-1"})}),a.jsx("p",{className:"text-sm text-gray-600",children:"Bettors"}),a.jsx("p",{className:"font-semibold",children:v})]}),a.jsxs("div",{className:"text-center",children:[a.jsx("div",{className:"flex items-center justify-center text-purple-600 mb-1",children:a.jsx(xt,{className:"w-4 h-4 mr-1"})}),a.jsx("p",{className:"text-sm text-gray-600",children:"Total Bets"}),a.jsx("p",{className:"font-semibold",children:w.length})]})]}),a.jsxs("div",{className:"border-t pt-4",children:[a.jsx("h4",{className:"text-sm font-medium text-gray-700 mb-2",children:"Bets by Number"}),a.jsx("div",{className:"grid grid-cols-5 gap-2",children:Object.entries(x).map(([y,N])=>a.jsxs("div",{className:"text-center p-2 bg-gray-50 rounded",children:[a.jsx("div",{className:"font-semibold text-gray-900",children:y}),a.jsxs("div",{className:"text-xs text-gray-600",children:["",N]})]},y))})]})]},p.id)})}),n&&a.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:a.jsx("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-md",children:a.jsxs("div",{className:"p-6",children:[a.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Create New Session"}),a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Session Time *"}),a.jsx("input",{type:"time",value:o,onChange:p=>l(p.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Session Name (Optional)"}),a.jsx("input",{type:"text",value:c,onChange:p=>u(p.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"e.g., Evening Special"})]})]}),a.jsxs("div",{className:"flex space-x-3 mt-6",children:[a.jsx("button",{onClick:()=>i(!1),className:"flex-1 py-2 px-4 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 transition-colors",children:"Cancel"}),a.jsx("button",{onClick:f,className:"flex-1 py-2 px-4 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:"Create Session"})]})]})})})]})},Ni=()=>{const{withdrawals:r,processWithdrawal:e}=ce(),t=r.filter(o=>o.status==="pending"),s=r.filter(o=>o.status!=="pending"),n=o=>{e(o,"approved")},i=o=>{e(o,"rejected")};return a.jsxs("div",{className:"space-y-6",children:[a.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Withdrawal Management"}),a.jsxs("div",{className:"bg-white rounded-lg shadow-md",children:[a.jsx("div",{className:"px-6 py-4 border-b border-gray-200",children:a.jsxs("h3",{className:"text-lg font-semibold text-gray-900 flex items-center",children:[a.jsx(vt,{className:"w-5 h-5 mr-2 text-yellow-600"}),"Pending Withdrawals (",t.length,")"]})}),t.length===0?a.jsx("div",{className:"p-6 text-center text-gray-500",children:"No pending withdrawal requests"}):a.jsx("div",{className:"overflow-x-auto",children:a.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[a.jsx("thead",{className:"bg-gray-50",children:a.jsxs("tr",{children:[a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"User ID"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Amount"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Requested At"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),a.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:t.map(o=>a.jsxs("tr",{children:[a.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:o.userId}),a.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:["",o.amount]}),a.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:J(o.requestedAt,"MMM dd, yyyy HH:mm")}),a.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium space-x-2",children:[a.jsxs("button",{onClick:()=>n(o.id),className:"inline-flex items-center px-3 py-1 border border-transparent text-sm leading-4 font-medium rounded-md text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500",children:[a.jsx(Us,{className:"w-4 h-4 mr-1"}),"Approve"]}),a.jsxs("button",{onClick:()=>i(o.id),className:"inline-flex items-center px-3 py-1 border border-transparent text-sm leading-4 font-medium rounded-md text-white bg-red-600 hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500",children:[a.jsx(ze,{className:"w-4 h-4 mr-1"}),"Reject"]})]})]},o.id))})]})})]}),a.jsxs("div",{className:"bg-white rounded-lg shadow-md",children:[a.jsx("div",{className:"px-6 py-4 border-b border-gray-200",children:a.jsxs("h3",{className:"text-lg font-semibold text-gray-900",children:["Processed Withdrawals (",s.length,")"]})}),s.length===0?a.jsx("div",{className:"p-6 text-center text-gray-500",children:"No processed withdrawals yet"}):a.jsx("div",{className:"overflow-x-auto",children:a.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[a.jsx("thead",{className:"bg-gray-50",children:a.jsxs("tr",{children:[a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"User ID"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Amount"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Requested At"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Processed At"})]})}),a.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:s.slice().reverse().map(o=>a.jsxs("tr",{children:[a.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:o.userId}),a.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:["",o.amount]}),a.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:a.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${o.status==="approved"?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:o.status})}),a.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:J(o.requestedAt,"MMM dd, yyyy HH:mm")}),a.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:o.processedAt&&J(o.processedAt,"MMM dd, yyyy HH:mm")})]},o.id))})]})})]})]})},Ei=()=>{const{bets:r,transactions:e}=ce(),[t,s]=b.useState(""),n=[{id:"user1",email:"test@gmail.com",phone:"+91 9876543210",walletBalance:1e3,isAdmin:!1,createdAt:new Date("2024-01-15")}],i=c=>r.filter(u=>u.userId===c),o=c=>e.filter(u=>u.userId===c),l=n.filter(c=>{var u;return c.email.toLowerCase().includes(t.toLowerCase())||((u=c.phone)==null?void 0:u.includes(t))});return a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{className:"flex justify-between items-center",children:[a.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"User Management"}),a.jsxs("div",{className:"relative",children:[a.jsx(Bs,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"}),a.jsx("input",{type:"text",value:t,onChange:c=>s(c.target.value),className:"pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Search users..."})]})]}),a.jsx("div",{className:"bg-white rounded-lg shadow-md overflow-hidden",children:a.jsx("div",{className:"overflow-x-auto",children:a.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[a.jsx("thead",{className:"bg-gray-50",children:a.jsxs("tr",{children:[a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"User"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Contact"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Wallet Balance"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Total Bets"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Transactions"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),a.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:l.map(c=>{const u=i(c.id),d=o(c.id),h=u.reduce((f,m)=>f+m.amount,0);return a.jsxs("tr",{children:[a.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:a.jsxs("div",{children:[a.jsx("div",{className:"text-sm font-medium text-gray-900",children:c.email}),a.jsxs("div",{className:"text-sm text-gray-500",children:["ID: ",c.id]})]})}),a.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:c.phone||"N/A"}),a.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:a.jsxs("div",{className:"flex items-center text-sm font-medium text-green-600",children:[a.jsx(Pe,{className:"w-4 h-4 mr-1"}),"",c.walletBalance]})}),a.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:a.jsxs("div",{children:[a.jsxs("div",{children:[u.length," bets"]}),a.jsxs("div",{className:"text-xs text-gray-500",children:["",h," total"]})]})}),a.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:d.length}),a.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium space-x-2",children:[a.jsxs("button",{className:"text-blue-600 hover:text-blue-900 inline-flex items-center",children:[a.jsx(ot,{className:"w-4 h-4 mr-1"}),"View"]}),a.jsxs("button",{className:"text-indigo-600 hover:text-indigo-900 inline-flex items-center",children:[a.jsx(qs,{className:"w-4 h-4 mr-1"}),"Edit"]})]})]},c.id)})})]})})}),l.length===0&&a.jsx("div",{className:"text-center py-8 text-gray-500",children:"No users found matching your search."})]})},Pi=()=>{const{logout:r}=le(),{sessions:e,bets:t,results:s,withdrawals:n}=ce(),[i,o]=b.useState("overview"),l=e.reduce((f,m)=>f+m.totalPool,0),c=t.length,u=n.filter(f=>f.status==="pending").length,d=s.reduce((f,m)=>f+m.adminFee,0),h=[{id:"overview",label:"Overview",icon:Ms},{id:"sessions",label:"Sessions",icon:Ws},{id:"withdrawals",label:"Withdrawals",icon:Pe},{id:"users",label:"Users",icon:lt}];return a.jsxs("div",{className:"min-h-screen bg-gray-50",children:[a.jsx("header",{className:"bg-white shadow-sm border-b",children:a.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:a.jsxs("div",{className:"flex justify-between items-center h-16",children:[a.jsxs("div",{children:[a.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Admin Panel"}),a.jsx("p",{className:"text-sm text-gray-600",children:"LuckyPick Lottery Management"})]}),a.jsxs("button",{onClick:r,className:"flex items-center space-x-2 text-gray-600 hover:text-gray-800 transition-colors",children:[a.jsx(Vt,{className:"w-4 h-4"}),a.jsx("span",{children:"Logout"})]})]})})}),a.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:a.jsxs("div",{className:"flex space-x-8",children:[a.jsx("div",{className:"w-64 bg-white rounded-lg shadow-md p-4",children:a.jsx("nav",{className:"space-y-2",children:h.map(f=>{const m=f.icon;return a.jsxs("button",{onClick:()=>o(f.id),className:`w-full flex items-center space-x-3 px-3 py-2 rounded-lg text-left transition-colors ${i===f.id?"bg-blue-100 text-blue-700":"text-gray-600 hover:bg-gray-100"}`,children:[a.jsx(m,{className:"w-5 h-5"}),a.jsx("span",{children:f.label})]},f.id)})})}),a.jsxs("div",{className:"flex-1",children:[i==="overview"&&a.jsxs("div",{className:"space-y-6",children:[a.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Dashboard Overview"}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[a.jsx("div",{className:"bg-white rounded-lg shadow-md p-6",children:a.jsxs("div",{className:"flex items-center",children:[a.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:a.jsx(Pe,{className:"w-6 h-6 text-blue-600"})}),a.jsxs("div",{className:"ml-4",children:[a.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Total Pool"}),a.jsxs("p",{className:"text-2xl font-bold text-gray-900",children:["",l]})]})]})}),a.jsx("div",{className:"bg-white rounded-lg shadow-md p-6",children:a.jsxs("div",{className:"flex items-center",children:[a.jsx("div",{className:"p-2 bg-green-100 rounded-lg",children:a.jsx(xt,{className:"w-6 h-6 text-green-600"})}),a.jsxs("div",{className:"ml-4",children:[a.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Admin Earnings"}),a.jsxs("p",{className:"text-2xl font-bold text-gray-900",children:["",d]})]})]})}),a.jsx("div",{className:"bg-white rounded-lg shadow-md p-6",children:a.jsxs("div",{className:"flex items-center",children:[a.jsx("div",{className:"p-2 bg-purple-100 rounded-lg",children:a.jsx(vt,{className:"w-6 h-6 text-purple-600"})}),a.jsxs("div",{className:"ml-4",children:[a.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Total Bets"}),a.jsx("p",{className:"text-2xl font-bold text-gray-900",children:c})]})]})}),a.jsx("div",{className:"bg-white rounded-lg shadow-md p-6",children:a.jsxs("div",{className:"flex items-center",children:[a.jsx("div",{className:"p-2 bg-yellow-100 rounded-lg",children:a.jsx(lt,{className:"w-6 h-6 text-yellow-600"})}),a.jsxs("div",{className:"ml-4",children:[a.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Pending Withdrawals"}),a.jsx("p",{className:"text-2xl font-bold text-gray-900",children:u})]})]})})]}),a.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6",children:[a.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Recent Results"}),a.jsx("div",{className:"overflow-x-auto",children:a.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[a.jsx("thead",{className:"bg-gray-50",children:a.jsxs("tr",{children:[a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Session"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Winning Number"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Total Pool"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Admin Fee"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Winners"})]})}),a.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:s.slice(-5).reverse().map(f=>{const m=e.find(g=>g.id===f.sessionId);return a.jsxs("tr",{children:[a.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:(m==null?void 0:m.name)||(m==null?void 0:m.time)}),a.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:a.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800",children:f.winningNumber})}),a.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:["",f.totalPool]}),a.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-green-600",children:["",f.adminFee]}),a.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:f.winnerCount})]},f.id)})})]})})]})]}),i==="sessions"&&a.jsx(Si,{}),i==="withdrawals"&&a.jsx(Ni,{}),i==="users"&&a.jsx(Ei,{})]})]})})]})},Ti=()=>{const[r,e]=b.useState(null),[t,s]=b.useState(!1),[n,i]=b.useState(!1);return b.useEffect(()=>{const l=window.matchMedia("(display-mode: standalone)").matches,c=window.navigator.standalone===!0;i(l||c);const u=h=>{h.preventDefault(),e(h),s(!0)},d=()=>{i(!0),s(!1),e(null)};return window.addEventListener("beforeinstallprompt",u),window.addEventListener("appinstalled",d),()=>{window.removeEventListener("beforeinstallprompt",u),window.removeEventListener("appinstalled",d)}},[]),{isInstallable:t,isInstalled:n,installApp:async()=>{if(!r)return;r.prompt();const{outcome:l}=await r.userChoice;l==="accepted"&&(e(null),s(!1))}}},Ai=()=>{const{isInstallable:r,installApp:e}=Ti(),[t,s]=it.useState(!1);return it.useEffect(()=>{if(r){const n=setTimeout(()=>{s(!0)},3e3);return()=>clearTimeout(n)}},[r]),!r||!t?null:a.jsx("div",{className:"fixed bottom-4 left-4 right-4 bg-blue-600 text-white p-4 rounded-lg shadow-lg z-50 md:left-auto md:right-4 md:max-w-sm",children:a.jsxs("div",{className:"flex items-start space-x-3",children:[a.jsx("div",{className:"flex-shrink-0",children:a.jsx(Fs,{className:"w-6 h-6"})}),a.jsxs("div",{className:"flex-1",children:[a.jsx("h3",{className:"font-semibold text-sm",children:"Install LuckyPick"}),a.jsx("p",{className:"text-xs text-blue-100 mt-1",children:"Add to your home screen for quick access and offline use"}),a.jsxs("div",{className:"flex space-x-2 mt-3",children:[a.jsx("button",{onClick:e,className:"bg-white text-blue-600 px-3 py-1 rounded text-xs font-medium hover:bg-blue-50 transition-colors",children:"Install"}),a.jsx("button",{onClick:()=>s(!1),className:"text-blue-100 px-3 py-1 rounded text-xs hover:text-white transition-colors",children:"Later"})]})]}),a.jsx("button",{onClick:()=>s(!1),className:"flex-shrink-0 text-blue-200 hover:text-white transition-colors",children:a.jsx(ze,{className:"w-4 h-4"})})]})})},Oi=()=>{const{isOnline:r,wasOffline:e}=Yt();return r&&!e?null:a.jsx("div",{className:`fixed top-0 left-0 right-0 z-50 p-2 text-center text-sm font-medium transition-colors ${r?"bg-green-600 text-white":"bg-red-600 text-white"}`,children:a.jsx("div",{className:"flex items-center justify-center space-x-2",children:r?a.jsxs(a.Fragment,{children:[a.jsx(zs,{className:"w-4 h-4"}),a.jsx("span",{children:"Back online - syncing data..."})]}):a.jsxs(a.Fragment,{children:[a.jsx(Hs,{className:"w-4 h-4"}),a.jsx("span",{children:"You're offline - some features may be limited"})]})})})},$i=()=>{const{user:r,loading:e}=le();return e?a.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 flex items-center justify-center",children:a.jsxs("div",{className:"text-center",children:[a.jsx(wt,{className:"w-8 h-8 animate-spin text-blue-600 mx-auto mb-4"}),a.jsx("p",{className:"text-gray-600",children:"Loading LuckyPick..."})]})}):r?r.isAdmin?a.jsx(Pi,{}):a.jsx(ki,{}):a.jsx(bi,{})};function Ci(){return a.jsx(Es,{children:a.jsx(wi,{children:a.jsxs(vi,{children:[a.jsx(Oi,{}),a.jsx($i,{}),a.jsx(Ai,{})]})})})}ct.createRoot(document.getElementById("root")).render(a.jsx(it.StrictMode,{children:a.jsx(Ci,{})}));
