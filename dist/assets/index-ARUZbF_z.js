var _s=Object.defineProperty;var js=(r,e,t)=>e in r?_s(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var Ae=(r,e,t)=>js(r,typeof e!="symbol"?e+"":e,t);import{r as _,a as ks,g as Ss,c as q,b as st}from"./vendor-C1JoJ-56.js";import{B as Ns}from"./router-Cxn95ysK.js";import{f as F,i as Ue,a as Es,b as Ts}from"./utils-CsonoGMZ.js";import{M as jt,P as kt,U as Ps,L as St,E as Nt,a as rt,b as zt,X as Be,D as ke,C as As,H as Os,c as Ht,d as $s,W as Cs,e as Jt,f as mt,T as gt,g as nt,h as Is,S as Rs,i as Us,j as Ls,k as Ds,l as Bs,m as qs,n as Ms}from"./icons-BI4RZBVA.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))s(n);new MutationObserver(n=>{for(const i of n)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&s(o)}).observe(document,{childList:!0,subtree:!0});function t(n){const i={};return n.integrity&&(i.integrity=n.integrity),n.referrerPolicy&&(i.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?i.credentials="include":n.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function s(n){if(n.ep)return;n.ep=!0;const i=t(n);fetch(n.href,i)}})();var Kt={exports:{}},qe={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Ws=_,Fs=Symbol.for("react.element"),zs=Symbol.for("react.fragment"),Hs=Object.prototype.hasOwnProperty,Js=Ws.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,Ks={key:!0,ref:!0,__self:!0,__source:!0};function Gt(r,e,t){var s,n={},i=null,o=null;t!==void 0&&(i=""+t),e.key!==void 0&&(i=""+e.key),e.ref!==void 0&&(o=e.ref);for(s in e)Hs.call(e,s)&&!Ks.hasOwnProperty(s)&&(n[s]=e[s]);if(r&&r.defaultProps)for(s in e=r.defaultProps,e)n[s]===void 0&&(n[s]=e[s]);return{$$typeof:Fs,type:r,key:i,ref:o,props:n,_owner:Js.current}}qe.Fragment=zs;qe.jsx=Gt;qe.jsxs=Gt;Kt.exports=qe;var a=Kt.exports,it={},Et=ks;it.createRoot=Et.createRoot,it.hydrateRoot=Et.hydrateRoot;class Gs{constructor(){Ae(this,"dbName","LuckyPickDB");Ae(this,"version",1);Ae(this,"db",null)}async init(){return new Promise((e,t)=>{const s=indexedDB.open(this.dbName,this.version);s.onerror=()=>t(s.error),s.onsuccess=()=>{this.db=s.result,e()},s.onupgradeneeded=n=>{const i=n.target.result;i.objectStoreNames.contains("sessions")||i.createObjectStore("sessions",{keyPath:"id"}),i.objectStoreNames.contains("bets")||i.createObjectStore("bets",{keyPath:"id"}),i.objectStoreNames.contains("results")||i.createObjectStore("results",{keyPath:"id"}),i.objectStoreNames.contains("transactions")||i.createObjectStore("transactions",{keyPath:"id"}),i.objectStoreNames.contains("user")||i.createObjectStore("user",{keyPath:"id"}),i.objectStoreNames.contains("offlineActions")||i.createObjectStore("offlineActions",{keyPath:"id",autoIncrement:!0})}})}async saveData(e,t){return this.db||await this.init(),new Promise((s,n)=>{const l=this.db.transaction([e],"readwrite").objectStore(e).put(t);l.onerror=()=>n(l.error),l.onsuccess=()=>s()})}async getData(e,t){return this.db||await this.init(),new Promise((s,n)=>{const o=this.db.transaction([e],"readonly").objectStore(e),l=t?o.get(t):o.getAll();l.onerror=()=>n(l.error),l.onsuccess=()=>s(l.result)})}async saveOfflineAction(e){const t={...e,timestamp:new Date().toISOString(),synced:!1};await this.saveData("offlineActions",t)}async getOfflineActions(){return(await this.getData("offlineActions")).filter(t=>!t.synced)}async markActionSynced(e){return this.db||await this.init(),new Promise((t,s)=>{const i=this.db.transaction(["offlineActions"],"readwrite").objectStore("offlineActions"),o=i.get(e);o.onsuccess=()=>{const l=o.result;if(l){l.synced=!0;const c=i.put(l);c.onsuccess=()=>t(),c.onerror=()=>s(c.error)}else t()},o.onerror=()=>s(o.error)})}}const Z=new Gs,Vt=()=>{const[r,e]=_.useState(navigator.onLine),[t,s]=_.useState(!1);return _.useEffect(()=>{const n=()=>{e(!0),t&&("serviceWorker"in navigator&&"sync"in window.ServiceWorkerRegistration.prototype&&navigator.serviceWorker.ready.then(o=>o.sync.register("background-sync")),s(!1))},i=()=>{e(!1),s(!0)};return window.addEventListener("online",n),window.addEventListener("offline",i),()=>{window.removeEventListener("online",n),window.removeEventListener("offline",i)}},[t]),{isOnline:r,wasOffline:t}},Vs="modulepreload",Qs=function(r){return"/"+r},Tt={},Ne=function(e,t,s){let n=Promise.resolve();if(t&&t.length>0){document.getElementsByTagName("link");const o=document.querySelector("meta[property=csp-nonce]"),l=(o==null?void 0:o.nonce)||(o==null?void 0:o.getAttribute("nonce"));n=Promise.allSettled(t.map(c=>{if(c=Qs(c),c in Tt)return;Tt[c]=!0;const d=c.endsWith(".css"),u=d?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${c}"]${u}`))return;const h=document.createElement("link");if(h.rel=d?"stylesheet":Vs,d||(h.as="script"),h.crossOrigin="",h.href=c,l&&h.setAttribute("nonce",l),document.head.appendChild(h),d)return new Promise((f,m)=>{h.addEventListener("load",f),h.addEventListener("error",()=>m(new Error(`Unable to preload CSS for ${c}`)))})}))}function i(o){const l=new Event("vite:preloadError",{cancelable:!0});if(l.payload=o,window.dispatchEvent(l),!l.defaultPrevented)throw o}return n.then(o=>{for(const l of o||[])l.status==="rejected"&&i(l.reason);return e().catch(i)})},Ys=r=>{let e;return r?e=r:typeof fetch>"u"?e=(...t)=>Ne(async()=>{const{default:s}=await Promise.resolve().then(()=>ge);return{default:s}},void 0).then(({default:s})=>s(...t)):e=fetch,(...t)=>e(...t)};class pt extends Error{constructor(e,t="FunctionsError",s){super(e),this.name=t,this.context=s}}class Xs extends pt{constructor(e){super("Failed to send a request to the Edge Function","FunctionsFetchError",e)}}class Zs extends pt{constructor(e){super("Relay Error invoking the Edge Function","FunctionsRelayError",e)}}class er extends pt{constructor(e){super("Edge Function returned a non-2xx status code","FunctionsHttpError",e)}}var at;(function(r){r.Any="any",r.ApNortheast1="ap-northeast-1",r.ApNortheast2="ap-northeast-2",r.ApSouth1="ap-south-1",r.ApSoutheast1="ap-southeast-1",r.ApSoutheast2="ap-southeast-2",r.CaCentral1="ca-central-1",r.EuCentral1="eu-central-1",r.EuWest1="eu-west-1",r.EuWest2="eu-west-2",r.EuWest3="eu-west-3",r.SaEast1="sa-east-1",r.UsEast1="us-east-1",r.UsWest1="us-west-1",r.UsWest2="us-west-2"})(at||(at={}));var tr=function(r,e,t,s){function n(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function l(u){try{d(s.next(u))}catch(h){o(h)}}function c(u){try{d(s.throw(u))}catch(h){o(h)}}function d(u){u.done?i(u.value):n(u.value).then(l,c)}d((s=s.apply(r,e||[])).next())})};class sr{constructor(e,{headers:t={},customFetch:s,region:n=at.Any}={}){this.url=e,this.headers=t,this.region=n,this.fetch=Ys(s)}setAuth(e){this.headers.Authorization=`Bearer ${e}`}invoke(e,t={}){var s;return tr(this,void 0,void 0,function*(){try{const{headers:n,method:i,body:o}=t;let l={},{region:c}=t;c||(c=this.region),c&&c!=="any"&&(l["x-region"]=c);let d;o&&(n&&!Object.prototype.hasOwnProperty.call(n,"Content-Type")||!n)&&(typeof Blob<"u"&&o instanceof Blob||o instanceof ArrayBuffer?(l["Content-Type"]="application/octet-stream",d=o):typeof o=="string"?(l["Content-Type"]="text/plain",d=o):typeof FormData<"u"&&o instanceof FormData?d=o:(l["Content-Type"]="application/json",d=JSON.stringify(o)));const u=yield this.fetch(`${this.url}/${e}`,{method:i||"POST",headers:Object.assign(Object.assign(Object.assign({},l),this.headers),n),body:d}).catch(g=>{throw new Xs(g)}),h=u.headers.get("x-relay-error");if(h&&h==="true")throw new Zs(u);if(!u.ok)throw new er(u);let f=((s=u.headers.get("Content-Type"))!==null&&s!==void 0?s:"text/plain").split(";")[0].trim(),m;return f==="application/json"?m=yield u.json():f==="application/octet-stream"?m=yield u.blob():f==="text/event-stream"?m=u:f==="multipart/form-data"?m=yield u.formData():m=yield u.text(),{data:m,error:null}}catch(n){return{data:null,error:n}}})}}var B={},yt={},Me={},Ee={},We={},Fe={},rr=function(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("unable to locate global object")},me=rr();const nr=me.fetch,Qt=me.fetch.bind(me),Yt=me.Headers,ir=me.Request,ar=me.Response,ge=Object.freeze(Object.defineProperty({__proto__:null,Headers:Yt,Request:ir,Response:ar,default:Qt,fetch:nr},Symbol.toStringTag,{value:"Module"})),or=Ss(ge);var ze={};Object.defineProperty(ze,"__esModule",{value:!0});let lr=class extends Error{constructor(e){super(e.message),this.name="PostgrestError",this.details=e.details,this.hint=e.hint,this.code=e.code}};ze.default=lr;var Xt=q&&q.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(Fe,"__esModule",{value:!0});const cr=Xt(or),dr=Xt(ze);let ur=class{constructor(e){this.shouldThrowOnError=!1,this.method=e.method,this.url=e.url,this.headers=e.headers,this.schema=e.schema,this.body=e.body,this.shouldThrowOnError=e.shouldThrowOnError,this.signal=e.signal,this.isMaybeSingle=e.isMaybeSingle,e.fetch?this.fetch=e.fetch:typeof fetch>"u"?this.fetch=cr.default:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(e,t){return this.headers=Object.assign({},this.headers),this.headers[e]=t,this}then(e,t){this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers["Accept-Profile"]=this.schema:this.headers["Content-Profile"]=this.schema),this.method!=="GET"&&this.method!=="HEAD"&&(this.headers["Content-Type"]="application/json");const s=this.fetch;let n=s(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async i=>{var o,l,c;let d=null,u=null,h=null,f=i.status,m=i.statusText;if(i.ok){if(this.method!=="HEAD"){const x=await i.text();x===""||(this.headers.Accept==="text/csv"||this.headers.Accept&&this.headers.Accept.includes("application/vnd.pgrst.plan+text")?u=x:u=JSON.parse(x))}const p=(o=this.headers.Prefer)===null||o===void 0?void 0:o.match(/count=(exact|planned|estimated)/),w=(l=i.headers.get("content-range"))===null||l===void 0?void 0:l.split("/");p&&w&&w.length>1&&(h=parseInt(w[1])),this.isMaybeSingle&&this.method==="GET"&&Array.isArray(u)&&(u.length>1?(d={code:"PGRST116",details:`Results contain ${u.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},u=null,h=null,f=406,m="Not Acceptable"):u.length===1?u=u[0]:u=null)}else{const p=await i.text();try{d=JSON.parse(p),Array.isArray(d)&&i.status===404&&(u=[],d=null,f=200,m="OK")}catch{i.status===404&&p===""?(f=204,m="No Content"):d={message:p}}if(d&&this.isMaybeSingle&&(!((c=d==null?void 0:d.details)===null||c===void 0)&&c.includes("0 rows"))&&(d=null,f=200,m="OK"),d&&this.shouldThrowOnError)throw new dr.default(d)}return{error:d,data:u,count:h,status:f,statusText:m}});return this.shouldThrowOnError||(n=n.catch(i=>{var o,l,c;return{error:{message:`${(o=i==null?void 0:i.name)!==null&&o!==void 0?o:"FetchError"}: ${i==null?void 0:i.message}`,details:`${(l=i==null?void 0:i.stack)!==null&&l!==void 0?l:""}`,hint:"",code:`${(c=i==null?void 0:i.code)!==null&&c!==void 0?c:""}`},data:null,count:null,status:0,statusText:""}})),n.then(e,t)}returns(){return this}overrideTypes(){return this}};Fe.default=ur;var hr=q&&q.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(We,"__esModule",{value:!0});const fr=hr(Fe);let mr=class extends fr.default{select(e){let t=!1;const s=(e??"*").split("").map(n=>/\s/.test(n)&&!t?"":(n==='"'&&(t=!t),n)).join("");return this.url.searchParams.set("select",s),this.headers.Prefer&&(this.headers.Prefer+=","),this.headers.Prefer+="return=representation",this}order(e,{ascending:t=!0,nullsFirst:s,foreignTable:n,referencedTable:i=n}={}){const o=i?`${i}.order`:"order",l=this.url.searchParams.get(o);return this.url.searchParams.set(o,`${l?`${l},`:""}${e}.${t?"asc":"desc"}${s===void 0?"":s?".nullsfirst":".nullslast"}`),this}limit(e,{foreignTable:t,referencedTable:s=t}={}){const n=typeof s>"u"?"limit":`${s}.limit`;return this.url.searchParams.set(n,`${e}`),this}range(e,t,{foreignTable:s,referencedTable:n=s}={}){const i=typeof n>"u"?"offset":`${n}.offset`,o=typeof n>"u"?"limit":`${n}.limit`;return this.url.searchParams.set(i,`${e}`),this.url.searchParams.set(o,`${t-e+1}`),this}abortSignal(e){return this.signal=e,this}single(){return this.headers.Accept="application/vnd.pgrst.object+json",this}maybeSingle(){return this.method==="GET"?this.headers.Accept="application/json":this.headers.Accept="application/vnd.pgrst.object+json",this.isMaybeSingle=!0,this}csv(){return this.headers.Accept="text/csv",this}geojson(){return this.headers.Accept="application/geo+json",this}explain({analyze:e=!1,verbose:t=!1,settings:s=!1,buffers:n=!1,wal:i=!1,format:o="text"}={}){var l;const c=[e?"analyze":null,t?"verbose":null,s?"settings":null,n?"buffers":null,i?"wal":null].filter(Boolean).join("|"),d=(l=this.headers.Accept)!==null&&l!==void 0?l:"application/json";return this.headers.Accept=`application/vnd.pgrst.plan+${o}; for="${d}"; options=${c};`,o==="json"?this:this}rollback(){var e;return((e=this.headers.Prefer)!==null&&e!==void 0?e:"").trim().length>0?this.headers.Prefer+=",tx=rollback":this.headers.Prefer="tx=rollback",this}returns(){return this}};We.default=mr;var gr=q&&q.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(Ee,"__esModule",{value:!0});const pr=gr(We);let yr=class extends pr.default{eq(e,t){return this.url.searchParams.append(e,`eq.${t}`),this}neq(e,t){return this.url.searchParams.append(e,`neq.${t}`),this}gt(e,t){return this.url.searchParams.append(e,`gt.${t}`),this}gte(e,t){return this.url.searchParams.append(e,`gte.${t}`),this}lt(e,t){return this.url.searchParams.append(e,`lt.${t}`),this}lte(e,t){return this.url.searchParams.append(e,`lte.${t}`),this}like(e,t){return this.url.searchParams.append(e,`like.${t}`),this}likeAllOf(e,t){return this.url.searchParams.append(e,`like(all).{${t.join(",")}}`),this}likeAnyOf(e,t){return this.url.searchParams.append(e,`like(any).{${t.join(",")}}`),this}ilike(e,t){return this.url.searchParams.append(e,`ilike.${t}`),this}ilikeAllOf(e,t){return this.url.searchParams.append(e,`ilike(all).{${t.join(",")}}`),this}ilikeAnyOf(e,t){return this.url.searchParams.append(e,`ilike(any).{${t.join(",")}}`),this}is(e,t){return this.url.searchParams.append(e,`is.${t}`),this}in(e,t){const s=Array.from(new Set(t)).map(n=>typeof n=="string"&&new RegExp("[,()]").test(n)?`"${n}"`:`${n}`).join(",");return this.url.searchParams.append(e,`in.(${s})`),this}contains(e,t){return typeof t=="string"?this.url.searchParams.append(e,`cs.${t}`):Array.isArray(t)?this.url.searchParams.append(e,`cs.{${t.join(",")}}`):this.url.searchParams.append(e,`cs.${JSON.stringify(t)}`),this}containedBy(e,t){return typeof t=="string"?this.url.searchParams.append(e,`cd.${t}`):Array.isArray(t)?this.url.searchParams.append(e,`cd.{${t.join(",")}}`):this.url.searchParams.append(e,`cd.${JSON.stringify(t)}`),this}rangeGt(e,t){return this.url.searchParams.append(e,`sr.${t}`),this}rangeGte(e,t){return this.url.searchParams.append(e,`nxl.${t}`),this}rangeLt(e,t){return this.url.searchParams.append(e,`sl.${t}`),this}rangeLte(e,t){return this.url.searchParams.append(e,`nxr.${t}`),this}rangeAdjacent(e,t){return this.url.searchParams.append(e,`adj.${t}`),this}overlaps(e,t){return typeof t=="string"?this.url.searchParams.append(e,`ov.${t}`):this.url.searchParams.append(e,`ov.{${t.join(",")}}`),this}textSearch(e,t,{config:s,type:n}={}){let i="";n==="plain"?i="pl":n==="phrase"?i="ph":n==="websearch"&&(i="w");const o=s===void 0?"":`(${s})`;return this.url.searchParams.append(e,`${i}fts${o}.${t}`),this}match(e){return Object.entries(e).forEach(([t,s])=>{this.url.searchParams.append(t,`eq.${s}`)}),this}not(e,t,s){return this.url.searchParams.append(e,`not.${t}.${s}`),this}or(e,{foreignTable:t,referencedTable:s=t}={}){const n=s?`${s}.or`:"or";return this.url.searchParams.append(n,`(${e})`),this}filter(e,t,s){return this.url.searchParams.append(e,`${t}.${s}`),this}};Ee.default=yr;var wr=q&&q.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(Me,"__esModule",{value:!0});const we=wr(Ee);let vr=class{constructor(e,{headers:t={},schema:s,fetch:n}){this.url=e,this.headers=t,this.schema=s,this.fetch=n}select(e,{head:t=!1,count:s}={}){const n=t?"HEAD":"GET";let i=!1;const o=(e??"*").split("").map(l=>/\s/.test(l)&&!i?"":(l==='"'&&(i=!i),l)).join("");return this.url.searchParams.set("select",o),s&&(this.headers.Prefer=`count=${s}`),new we.default({method:n,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}insert(e,{count:t,defaultToNull:s=!0}={}){const n="POST",i=[];if(this.headers.Prefer&&i.push(this.headers.Prefer),t&&i.push(`count=${t}`),s||i.push("missing=default"),this.headers.Prefer=i.join(","),Array.isArray(e)){const o=e.reduce((l,c)=>l.concat(Object.keys(c)),[]);if(o.length>0){const l=[...new Set(o)].map(c=>`"${c}"`);this.url.searchParams.set("columns",l.join(","))}}return new we.default({method:n,url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:this.fetch,allowEmpty:!1})}upsert(e,{onConflict:t,ignoreDuplicates:s=!1,count:n,defaultToNull:i=!0}={}){const o="POST",l=[`resolution=${s?"ignore":"merge"}-duplicates`];if(t!==void 0&&this.url.searchParams.set("on_conflict",t),this.headers.Prefer&&l.push(this.headers.Prefer),n&&l.push(`count=${n}`),i||l.push("missing=default"),this.headers.Prefer=l.join(","),Array.isArray(e)){const c=e.reduce((d,u)=>d.concat(Object.keys(u)),[]);if(c.length>0){const d=[...new Set(c)].map(u=>`"${u}"`);this.url.searchParams.set("columns",d.join(","))}}return new we.default({method:o,url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:this.fetch,allowEmpty:!1})}update(e,{count:t}={}){const s="PATCH",n=[];return this.headers.Prefer&&n.push(this.headers.Prefer),t&&n.push(`count=${t}`),this.headers.Prefer=n.join(","),new we.default({method:s,url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:this.fetch,allowEmpty:!1})}delete({count:e}={}){const t="DELETE",s=[];return e&&s.push(`count=${e}`),this.headers.Prefer&&s.unshift(this.headers.Prefer),this.headers.Prefer=s.join(","),new we.default({method:t,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}};Me.default=vr;var He={},Je={};Object.defineProperty(Je,"__esModule",{value:!0});Je.version=void 0;Je.version="0.0.0-automated";Object.defineProperty(He,"__esModule",{value:!0});He.DEFAULT_HEADERS=void 0;const br=Je;He.DEFAULT_HEADERS={"X-Client-Info":`postgrest-js/${br.version}`};var Zt=q&&q.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(yt,"__esModule",{value:!0});const xr=Zt(Me),_r=Zt(Ee),jr=He;let kr=class es{constructor(e,{headers:t={},schema:s,fetch:n}={}){this.url=e,this.headers=Object.assign(Object.assign({},jr.DEFAULT_HEADERS),t),this.schemaName=s,this.fetch=n}from(e){const t=new URL(`${this.url}/${e}`);return new xr.default(t,{headers:Object.assign({},this.headers),schema:this.schemaName,fetch:this.fetch})}schema(e){return new es(this.url,{headers:this.headers,schema:e,fetch:this.fetch})}rpc(e,t={},{head:s=!1,get:n=!1,count:i}={}){let o;const l=new URL(`${this.url}/rpc/${e}`);let c;s||n?(o=s?"HEAD":"GET",Object.entries(t).filter(([u,h])=>h!==void 0).map(([u,h])=>[u,Array.isArray(h)?`{${h.join(",")}}`:`${h}`]).forEach(([u,h])=>{l.searchParams.append(u,h)})):(o="POST",c=t);const d=Object.assign({},this.headers);return i&&(d.Prefer=`count=${i}`),new _r.default({method:o,url:l,headers:d,schema:this.schemaName,body:c,fetch:this.fetch,allowEmpty:!1})}};yt.default=kr;var pe=q&&q.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(B,"__esModule",{value:!0});B.PostgrestError=B.PostgrestBuilder=B.PostgrestTransformBuilder=B.PostgrestFilterBuilder=B.PostgrestQueryBuilder=B.PostgrestClient=void 0;const ts=pe(yt);B.PostgrestClient=ts.default;const ss=pe(Me);B.PostgrestQueryBuilder=ss.default;const rs=pe(Ee);B.PostgrestFilterBuilder=rs.default;const ns=pe(We);B.PostgrestTransformBuilder=ns.default;const is=pe(Fe);B.PostgrestBuilder=is.default;const as=pe(ze);B.PostgrestError=as.default;var Sr=B.default={PostgrestClient:ts.default,PostgrestQueryBuilder:ss.default,PostgrestFilterBuilder:rs.default,PostgrestTransformBuilder:ns.default,PostgrestBuilder:is.default,PostgrestError:as.default};const{PostgrestClient:Nr,PostgrestQueryBuilder:Bi,PostgrestFilterBuilder:qi,PostgrestTransformBuilder:Mi,PostgrestBuilder:Wi,PostgrestError:Fi}=Sr;function Er(){if(typeof WebSocket<"u")return WebSocket;if(typeof global.WebSocket<"u")return global.WebSocket;if(typeof window.WebSocket<"u")return window.WebSocket;if(typeof self.WebSocket<"u")return self.WebSocket;throw new Error("`WebSocket` is not supported in this environment")}const Tr=Er(),Pr="2.11.15",Ar=`realtime-js/${Pr}`,Or="1.0.0",os=1e4,$r=1e3;var be;(function(r){r[r.connecting=0]="connecting",r[r.open=1]="open",r[r.closing=2]="closing",r[r.closed=3]="closed"})(be||(be={}));var L;(function(r){r.closed="closed",r.errored="errored",r.joined="joined",r.joining="joining",r.leaving="leaving"})(L||(L={}));var W;(function(r){r.close="phx_close",r.error="phx_error",r.join="phx_join",r.reply="phx_reply",r.leave="phx_leave",r.access_token="access_token"})(W||(W={}));var ot;(function(r){r.websocket="websocket"})(ot||(ot={}));var se;(function(r){r.Connecting="connecting",r.Open="open",r.Closing="closing",r.Closed="closed"})(se||(se={}));class Cr{constructor(){this.HEADER_LENGTH=1}decode(e,t){return e.constructor===ArrayBuffer?t(this._binaryDecode(e)):t(typeof e=="string"?JSON.parse(e):{})}_binaryDecode(e){const t=new DataView(e),s=new TextDecoder;return this._decodeBroadcast(e,t,s)}_decodeBroadcast(e,t,s){const n=t.getUint8(1),i=t.getUint8(2);let o=this.HEADER_LENGTH+2;const l=s.decode(e.slice(o,o+n));o=o+n;const c=s.decode(e.slice(o,o+i));o=o+i;const d=JSON.parse(s.decode(e.slice(o,e.byteLength)));return{ref:null,topic:l,event:c,payload:d}}}class ls{constructor(e,t){this.callback=e,this.timerCalc=t,this.timer=void 0,this.tries=0,this.callback=e,this.timerCalc=t}reset(){this.tries=0,clearTimeout(this.timer)}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}var O;(function(r){r.abstime="abstime",r.bool="bool",r.date="date",r.daterange="daterange",r.float4="float4",r.float8="float8",r.int2="int2",r.int4="int4",r.int4range="int4range",r.int8="int8",r.int8range="int8range",r.json="json",r.jsonb="jsonb",r.money="money",r.numeric="numeric",r.oid="oid",r.reltime="reltime",r.text="text",r.time="time",r.timestamp="timestamp",r.timestamptz="timestamptz",r.timetz="timetz",r.tsrange="tsrange",r.tstzrange="tstzrange"})(O||(O={}));const Pt=(r,e,t={})=>{var s;const n=(s=t.skipTypes)!==null&&s!==void 0?s:[];return Object.keys(e).reduce((i,o)=>(i[o]=Ir(o,r,e,n),i),{})},Ir=(r,e,t,s)=>{const n=e.find(l=>l.name===r),i=n==null?void 0:n.type,o=t[r];return i&&!s.includes(i)?cs(i,o):lt(o)},cs=(r,e)=>{if(r.charAt(0)==="_"){const t=r.slice(1,r.length);return Dr(e,t)}switch(r){case O.bool:return Rr(e);case O.float4:case O.float8:case O.int2:case O.int4:case O.int8:case O.numeric:case O.oid:return Ur(e);case O.json:case O.jsonb:return Lr(e);case O.timestamp:return Br(e);case O.abstime:case O.date:case O.daterange:case O.int4range:case O.int8range:case O.money:case O.reltime:case O.text:case O.time:case O.timestamptz:case O.timetz:case O.tsrange:case O.tstzrange:return lt(e);default:return lt(e)}},lt=r=>r,Rr=r=>{switch(r){case"t":return!0;case"f":return!1;default:return r}},Ur=r=>{if(typeof r=="string"){const e=parseFloat(r);if(!Number.isNaN(e))return e}return r},Lr=r=>{if(typeof r=="string")try{return JSON.parse(r)}catch(e){return console.log(`JSON parse error: ${e}`),r}return r},Dr=(r,e)=>{if(typeof r!="string")return r;const t=r.length-1,s=r[t];if(r[0]==="{"&&s==="}"){let i;const o=r.slice(1,t);try{i=JSON.parse("["+o+"]")}catch{i=o?o.split(","):[]}return i.map(l=>cs(e,l))}return r},Br=r=>typeof r=="string"?r.replace(" ","T"):r,ds=r=>{let e=r;return e=e.replace(/^ws/i,"http"),e=e.replace(/(\/socket\/websocket|\/socket|\/websocket)\/?$/i,""),e.replace(/\/+$/,"")};class Qe{constructor(e,t,s={},n=os){this.channel=e,this.event=t,this.payload=s,this.timeout=n,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(e){this.timeout=e,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(e){this.payload=Object.assign(Object.assign({},this.payload),e)}receive(e,t){var s;return this._hasReceived(e)&&t((s=this.receivedResp)===null||s===void 0?void 0:s.response),this.recHooks.push({status:e,callback:t}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const e=t=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=t,this._matchReceive(t)};this.channel._on(this.refEvent,{},e),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(e,t){this.refEvent&&this.channel._trigger(this.refEvent,{status:e,response:t})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:e,response:t}){this.recHooks.filter(s=>s.status===e).forEach(s=>s.callback(t))}_hasReceived(e){return this.receivedResp&&this.receivedResp.status===e}}var At;(function(r){r.SYNC="sync",r.JOIN="join",r.LEAVE="leave"})(At||(At={}));class xe{constructor(e,t){this.channel=e,this.state={},this.pendingDiffs=[],this.joinRef=null,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const s=(t==null?void 0:t.events)||{state:"presence_state",diff:"presence_diff"};this.channel._on(s.state,{},n=>{const{onJoin:i,onLeave:o,onSync:l}=this.caller;this.joinRef=this.channel._joinRef(),this.state=xe.syncState(this.state,n,i,o),this.pendingDiffs.forEach(c=>{this.state=xe.syncDiff(this.state,c,i,o)}),this.pendingDiffs=[],l()}),this.channel._on(s.diff,{},n=>{const{onJoin:i,onLeave:o,onSync:l}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(n):(this.state=xe.syncDiff(this.state,n,i,o),l())}),this.onJoin((n,i,o)=>{this.channel._trigger("presence",{event:"join",key:n,currentPresences:i,newPresences:o})}),this.onLeave((n,i,o)=>{this.channel._trigger("presence",{event:"leave",key:n,currentPresences:i,leftPresences:o})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(e,t,s,n){const i=this.cloneDeep(e),o=this.transformState(t),l={},c={};return this.map(i,(d,u)=>{o[d]||(c[d]=u)}),this.map(o,(d,u)=>{const h=i[d];if(h){const f=u.map(w=>w.presence_ref),m=h.map(w=>w.presence_ref),g=u.filter(w=>m.indexOf(w.presence_ref)<0),p=h.filter(w=>f.indexOf(w.presence_ref)<0);g.length>0&&(l[d]=g),p.length>0&&(c[d]=p)}else l[d]=u}),this.syncDiff(i,{joins:l,leaves:c},s,n)}static syncDiff(e,t,s,n){const{joins:i,leaves:o}={joins:this.transformState(t.joins),leaves:this.transformState(t.leaves)};return s||(s=()=>{}),n||(n=()=>{}),this.map(i,(l,c)=>{var d;const u=(d=e[l])!==null&&d!==void 0?d:[];if(e[l]=this.cloneDeep(c),u.length>0){const h=e[l].map(m=>m.presence_ref),f=u.filter(m=>h.indexOf(m.presence_ref)<0);e[l].unshift(...f)}s(l,u,c)}),this.map(o,(l,c)=>{let d=e[l];if(!d)return;const u=c.map(h=>h.presence_ref);d=d.filter(h=>u.indexOf(h.presence_ref)<0),e[l]=d,n(l,d,c),d.length===0&&delete e[l]}),e}static map(e,t){return Object.getOwnPropertyNames(e).map(s=>t(s,e[s]))}static transformState(e){return e=this.cloneDeep(e),Object.getOwnPropertyNames(e).reduce((t,s)=>{const n=e[s];return"metas"in n?t[s]=n.metas.map(i=>(i.presence_ref=i.phx_ref,delete i.phx_ref,delete i.phx_ref_prev,i)):t[s]=n,t},{})}static cloneDeep(e){return JSON.parse(JSON.stringify(e))}onJoin(e){this.caller.onJoin=e}onLeave(e){this.caller.onLeave=e}onSync(e){this.caller.onSync=e}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var Ot;(function(r){r.ALL="*",r.INSERT="INSERT",r.UPDATE="UPDATE",r.DELETE="DELETE"})(Ot||(Ot={}));var $t;(function(r){r.BROADCAST="broadcast",r.PRESENCE="presence",r.POSTGRES_CHANGES="postgres_changes",r.SYSTEM="system"})($t||($t={}));var J;(function(r){r.SUBSCRIBED="SUBSCRIBED",r.TIMED_OUT="TIMED_OUT",r.CLOSED="CLOSED",r.CHANNEL_ERROR="CHANNEL_ERROR"})(J||(J={}));class wt{constructor(e,t={config:{}},s){this.topic=e,this.params=t,this.socket=s,this.bindings={},this.state=L.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=e.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:""},private:!1},t.config),this.timeout=this.socket.timeout,this.joinPush=new Qe(this,W.join,this.params,this.timeout),this.rejoinTimer=new ls(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=L.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(n=>n.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=L.closed,this.socket._remove(this)}),this._onError(n=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,n),this.state=L.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=L.errored,this.rejoinTimer.scheduleTimeout())}),this._on(W.reply,{},(n,i)=>{this._trigger(this._replyEventName(i),n)}),this.presence=new xe(this),this.broadcastEndpointURL=ds(this.socket.endPoint)+"/api/broadcast",this.private=this.params.config.private||!1}subscribe(e,t=this.timeout){var s,n;if(this.socket.isConnected()||this.socket.connect(),this.state==L.closed){const{config:{broadcast:i,presence:o,private:l}}=this.params;this._onError(u=>e==null?void 0:e(J.CHANNEL_ERROR,u)),this._onClose(()=>e==null?void 0:e(J.CLOSED));const c={},d={broadcast:i,presence:o,postgres_changes:(n=(s=this.bindings.postgres_changes)===null||s===void 0?void 0:s.map(u=>u.filter))!==null&&n!==void 0?n:[],private:l};this.socket.accessTokenValue&&(c.access_token=this.socket.accessTokenValue),this.updateJoinPayload(Object.assign({config:d},c)),this.joinedOnce=!0,this._rejoin(t),this.joinPush.receive("ok",async({postgres_changes:u})=>{var h;if(this.socket.setAuth(),u===void 0){e==null||e(J.SUBSCRIBED);return}else{const f=this.bindings.postgres_changes,m=(h=f==null?void 0:f.length)!==null&&h!==void 0?h:0,g=[];for(let p=0;p<m;p++){const w=f[p],{filter:{event:x,schema:v,table:y,filter:S}}=w,$=u&&u[p];if($&&$.event===x&&$.schema===v&&$.table===y&&$.filter===S)g.push(Object.assign(Object.assign({},w),{id:$.id}));else{this.unsubscribe(),this.state=L.errored,e==null||e(J.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=g,e&&e(J.SUBSCRIBED);return}}).receive("error",u=>{this.state=L.errored,e==null||e(J.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(u).join(", ")||"error")))}).receive("timeout",()=>{e==null||e(J.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(e,t={}){return await this.send({type:"presence",event:"track",payload:e},t.timeout||this.timeout)}async untrack(e={}){return await this.send({type:"presence",event:"untrack"},e)}on(e,t,s){return this._on(e,t,s)}async send(e,t={}){var s,n;if(!this._canPush()&&e.type==="broadcast"){const{event:i,payload:o}=e,c={method:"POST",headers:{Authorization:this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"",apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:i,payload:o,private:this.private}]})};try{const d=await this._fetchWithTimeout(this.broadcastEndpointURL,c,(s=t.timeout)!==null&&s!==void 0?s:this.timeout);return await((n=d.body)===null||n===void 0?void 0:n.cancel()),d.ok?"ok":"error"}catch(d){return d.name==="AbortError"?"timed out":"error"}}else return new Promise(i=>{var o,l,c;const d=this._push(e.type,e,t.timeout||this.timeout);e.type==="broadcast"&&!(!((c=(l=(o=this.params)===null||o===void 0?void 0:o.config)===null||l===void 0?void 0:l.broadcast)===null||c===void 0)&&c.ack)&&i("ok"),d.receive("ok",()=>i("ok")),d.receive("error",()=>i("error")),d.receive("timeout",()=>i("timed out"))})}updateJoinPayload(e){this.joinPush.updatePayload(e)}unsubscribe(e=this.timeout){this.state=L.leaving;const t=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(W.close,"leave",this._joinRef())};this.joinPush.destroy();let s=null;return new Promise(n=>{s=new Qe(this,W.leave,{},e),s.receive("ok",()=>{t(),n("ok")}).receive("timeout",()=>{t(),n("timed out")}).receive("error",()=>{n("error")}),s.send(),this._canPush()||s.trigger("ok",{})}).finally(()=>{s==null||s.destroy()})}teardown(){this.pushBuffer.forEach(e=>e.destroy()),this.rejoinTimer&&clearTimeout(this.rejoinTimer.timer),this.joinPush.destroy()}async _fetchWithTimeout(e,t,s){const n=new AbortController,i=setTimeout(()=>n.abort(),s),o=await this.socket.fetch(e,Object.assign(Object.assign({},t),{signal:n.signal}));return clearTimeout(i),o}_push(e,t,s=this.timeout){if(!this.joinedOnce)throw`tried to push '${e}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let n=new Qe(this,e,t,s);return this._canPush()?n.send():(n.startTimeout(),this.pushBuffer.push(n)),n}_onMessage(e,t,s){return t}_isMember(e){return this.topic===e}_joinRef(){return this.joinPush.ref}_trigger(e,t,s){var n,i;const o=e.toLocaleLowerCase(),{close:l,error:c,leave:d,join:u}=W;if(s&&[l,c,d,u].indexOf(o)>=0&&s!==this._joinRef())return;let f=this._onMessage(o,t,s);if(t&&!f)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(o)?(n=this.bindings.postgres_changes)===null||n===void 0||n.filter(m=>{var g,p,w;return((g=m.filter)===null||g===void 0?void 0:g.event)==="*"||((w=(p=m.filter)===null||p===void 0?void 0:p.event)===null||w===void 0?void 0:w.toLocaleLowerCase())===o}).map(m=>m.callback(f,s)):(i=this.bindings[o])===null||i===void 0||i.filter(m=>{var g,p,w,x,v,y;if(["broadcast","presence","postgres_changes"].includes(o))if("id"in m){const S=m.id,$=(g=m.filter)===null||g===void 0?void 0:g.event;return S&&((p=t.ids)===null||p===void 0?void 0:p.includes(S))&&($==="*"||($==null?void 0:$.toLocaleLowerCase())===((w=t.data)===null||w===void 0?void 0:w.type.toLocaleLowerCase()))}else{const S=(v=(x=m==null?void 0:m.filter)===null||x===void 0?void 0:x.event)===null||v===void 0?void 0:v.toLocaleLowerCase();return S==="*"||S===((y=t==null?void 0:t.event)===null||y===void 0?void 0:y.toLocaleLowerCase())}else return m.type.toLocaleLowerCase()===o}).map(m=>{if(typeof f=="object"&&"ids"in f){const g=f.data,{schema:p,table:w,commit_timestamp:x,type:v,errors:y}=g;f=Object.assign(Object.assign({},{schema:p,table:w,commit_timestamp:x,eventType:v,new:{},old:{},errors:y}),this._getPayloadRecords(g))}m.callback(f,s)})}_isClosed(){return this.state===L.closed}_isJoined(){return this.state===L.joined}_isJoining(){return this.state===L.joining}_isLeaving(){return this.state===L.leaving}_replyEventName(e){return`chan_reply_${e}`}_on(e,t,s){const n=e.toLocaleLowerCase(),i={type:n,filter:t,callback:s};return this.bindings[n]?this.bindings[n].push(i):this.bindings[n]=[i],this}_off(e,t){const s=e.toLocaleLowerCase();return this.bindings[s]=this.bindings[s].filter(n=>{var i;return!(((i=n.type)===null||i===void 0?void 0:i.toLocaleLowerCase())===s&&wt.isEqual(n.filter,t))}),this}static isEqual(e,t){if(Object.keys(e).length!==Object.keys(t).length)return!1;for(const s in e)if(e[s]!==t[s])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(e){this._on(W.close,{},e)}_onError(e){this._on(W.error,{},t=>e(t))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(e=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=L.joining,this.joinPush.resend(e))}_getPayloadRecords(e){const t={new:{},old:{}};return(e.type==="INSERT"||e.type==="UPDATE")&&(t.new=Pt(e.columns,e.record)),(e.type==="UPDATE"||e.type==="DELETE")&&(t.old=Pt(e.columns,e.old_record)),t}}const Ct=()=>{},qr=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`;class Mr{constructor(e,t){var s;this.accessTokenValue=null,this.apiKey=null,this.channels=new Array,this.endPoint="",this.httpEndpoint="",this.headers={},this.params={},this.timeout=os,this.heartbeatIntervalMs=25e3,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=Ct,this.ref=0,this.logger=Ct,this.conn=null,this.sendBuffer=[],this.serializer=new Cr,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._resolveFetch=i=>{let o;return i?o=i:typeof fetch>"u"?o=(...l)=>Ne(async()=>{const{default:c}=await Promise.resolve().then(()=>ge);return{default:c}},void 0).then(({default:c})=>c(...l)):o=fetch,(...l)=>o(...l)},this.endPoint=`${e}/${ot.websocket}`,this.httpEndpoint=ds(e),t!=null&&t.transport?this.transport=t.transport:this.transport=null,t!=null&&t.params&&(this.params=t.params),t!=null&&t.timeout&&(this.timeout=t.timeout),t!=null&&t.logger&&(this.logger=t.logger),(t!=null&&t.logLevel||t!=null&&t.log_level)&&(this.logLevel=t.logLevel||t.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),t!=null&&t.heartbeatIntervalMs&&(this.heartbeatIntervalMs=t.heartbeatIntervalMs);const n=(s=t==null?void 0:t.params)===null||s===void 0?void 0:s.apikey;if(n&&(this.accessTokenValue=n,this.apiKey=n),this.reconnectAfterMs=t!=null&&t.reconnectAfterMs?t.reconnectAfterMs:i=>[1e3,2e3,5e3,1e4][i-1]||1e4,this.encode=t!=null&&t.encode?t.encode:(i,o)=>o(JSON.stringify(i)),this.decode=t!=null&&t.decode?t.decode:this.serializer.decode.bind(this.serializer),this.reconnectTimer=new ls(async()=>{this.disconnect(),this.connect()},this.reconnectAfterMs),this.fetch=this._resolveFetch(t==null?void 0:t.fetch),t!=null&&t.worker){if(typeof window<"u"&&!window.Worker)throw new Error("Web Worker is not supported");this.worker=(t==null?void 0:t.worker)||!1,this.workerUrl=t==null?void 0:t.workerUrl}this.accessToken=(t==null?void 0:t.accessToken)||null}connect(){if(!this.conn){if(this.transport||(this.transport=Tr),!this.transport)throw new Error("No transport provided");this.conn=new this.transport(this.endpointURL()),this.setupConnection()}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:Or}))}disconnect(e,t){this.conn&&(this.conn.onclose=function(){},e?this.conn.close(e,t??""):this.conn.close(),this.conn=null,this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.reset(),this.channels.forEach(s=>s.teardown()))}getChannels(){return this.channels}async removeChannel(e){const t=await e.unsubscribe();return this.channels.length===0&&this.disconnect(),t}async removeAllChannels(){const e=await Promise.all(this.channels.map(t=>t.unsubscribe()));return this.channels=[],this.disconnect(),e}log(e,t,s){this.logger(e,t,s)}connectionState(){switch(this.conn&&this.conn.readyState){case be.connecting:return se.Connecting;case be.open:return se.Open;case be.closing:return se.Closing;default:return se.Closed}}isConnected(){return this.connectionState()===se.Open}channel(e,t={config:{}}){const s=`realtime:${e}`,n=this.getChannels().find(i=>i.topic===s);if(n)return n;{const i=new wt(`realtime:${e}`,t,this);return this.channels.push(i),i}}push(e){const{topic:t,event:s,payload:n,ref:i}=e,o=()=>{this.encode(e,l=>{var c;(c=this.conn)===null||c===void 0||c.send(l)})};this.log("push",`${t} ${s} (${i})`,n),this.isConnected()?o():this.sendBuffer.push(o)}async setAuth(e=null){let t=e||this.accessToken&&await this.accessToken()||this.accessTokenValue;this.accessTokenValue!=t&&(this.accessTokenValue=t,this.channels.forEach(s=>{const n={access_token:t,version:Ar};t&&s.updateJoinPayload(n),s.joinedOnce&&s._isJoined()&&s._push(W.access_token,{access_token:t})}))}async sendHeartbeat(){var e;if(!this.isConnected()){this.heartbeatCallback("disconnected");return}if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection"),this.heartbeatCallback("timeout"),(e=this.conn)===null||e===void 0||e.close($r,"hearbeat timeout");return}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef}),this.heartbeatCallback("sent"),await this.setAuth()}onHeartbeat(e){this.heartbeatCallback=e}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(e=>e()),this.sendBuffer=[])}_makeRef(){let e=this.ref+1;return e===this.ref?this.ref=0:this.ref=e,this.ref.toString()}_leaveOpenTopic(e){let t=this.channels.find(s=>s.topic===e&&(s._isJoined()||s._isJoining()));t&&(this.log("transport",`leaving duplicate topic "${e}"`),t.unsubscribe())}_remove(e){this.channels=this.channels.filter(t=>t.topic!==e.topic)}setupConnection(){this.conn&&(this.conn.binaryType="arraybuffer",this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=e=>this._onConnError(e),this.conn.onmessage=e=>this._onConnMessage(e),this.conn.onclose=e=>this._onConnClose(e))}_onConnMessage(e){this.decode(e.data,t=>{let{topic:s,event:n,payload:i,ref:o}=t;s==="phoenix"&&n==="phx_reply"&&this.heartbeatCallback(t.payload.status=="ok"?"ok":"error"),o&&o===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null),this.log("receive",`${i.status||""} ${s} ${n} ${o&&"("+o+")"||""}`,i),Array.from(this.channels).filter(l=>l._isMember(s)).forEach(l=>l._trigger(n,i,o)),this.stateChangeCallbacks.message.forEach(l=>l(t))})}_onConnOpen(){this.log("transport",`connected to ${this.endpointURL()}`),this.flushSendBuffer(),this.reconnectTimer.reset(),this.worker?this.workerRef||this._startWorkerHeartbeat():this._startHeartbeat(),this.stateChangeCallbacks.open.forEach(e=>e())}_startHeartbeat(){this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs)}_startWorkerHeartbeat(){this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const e=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(e),this.workerRef.onerror=t=>{this.log("worker","worker error",t.message),this.workerRef.terminate()},this.workerRef.onmessage=t=>{t.data.event==="keepAlive"&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}_onConnClose(e){this.log("transport","close",e),this._triggerChanError(),this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.scheduleTimeout(),this.stateChangeCallbacks.close.forEach(t=>t(e))}_onConnError(e){this.log("transport",`${e}`),this._triggerChanError(),this.stateChangeCallbacks.error.forEach(t=>t(e))}_triggerChanError(){this.channels.forEach(e=>e._trigger(W.error))}_appendParams(e,t){if(Object.keys(t).length===0)return e;const s=e.match(/\?/)?"&":"?",n=new URLSearchParams(t);return`${e}${s}${n}`}_workerObjectUrl(e){let t;if(e)t=e;else{const s=new Blob([qr],{type:"application/javascript"});t=URL.createObjectURL(s)}return t}}class vt extends Error{constructor(e){super(e),this.__isStorageError=!0,this.name="StorageError"}}function R(r){return typeof r=="object"&&r!==null&&"__isStorageError"in r}class Wr extends vt{constructor(e,t){super(e),this.name="StorageApiError",this.status=t}toJSON(){return{name:this.name,message:this.message,status:this.status}}}class ct extends vt{constructor(e,t){super(e),this.name="StorageUnknownError",this.originalError=t}}var Fr=function(r,e,t,s){function n(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function l(u){try{d(s.next(u))}catch(h){o(h)}}function c(u){try{d(s.throw(u))}catch(h){o(h)}}function d(u){u.done?i(u.value):n(u.value).then(l,c)}d((s=s.apply(r,e||[])).next())})};const us=r=>{let e;return r?e=r:typeof fetch>"u"?e=(...t)=>Ne(async()=>{const{default:s}=await Promise.resolve().then(()=>ge);return{default:s}},void 0).then(({default:s})=>s(...t)):e=fetch,(...t)=>e(...t)},zr=()=>Fr(void 0,void 0,void 0,function*(){return typeof Response>"u"?(yield Ne(()=>Promise.resolve().then(()=>ge),void 0)).Response:Response}),dt=r=>{if(Array.isArray(r))return r.map(t=>dt(t));if(typeof r=="function"||r!==Object(r))return r;const e={};return Object.entries(r).forEach(([t,s])=>{const n=t.replace(/([-_][a-z])/gi,i=>i.toUpperCase().replace(/[-_]/g,""));e[n]=dt(s)}),e};var re=function(r,e,t,s){function n(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function l(u){try{d(s.next(u))}catch(h){o(h)}}function c(u){try{d(s.throw(u))}catch(h){o(h)}}function d(u){u.done?i(u.value):n(u.value).then(l,c)}d((s=s.apply(r,e||[])).next())})};const Ye=r=>r.msg||r.message||r.error_description||r.error||JSON.stringify(r),Hr=(r,e,t)=>re(void 0,void 0,void 0,function*(){const s=yield zr();r instanceof s&&!(t!=null&&t.noResolveJson)?r.json().then(n=>{e(new Wr(Ye(n),r.status||500))}).catch(n=>{e(new ct(Ye(n),n))}):e(new ct(Ye(r),r))}),Jr=(r,e,t,s)=>{const n={method:r,headers:(e==null?void 0:e.headers)||{}};return r==="GET"?n:(n.headers=Object.assign({"Content-Type":"application/json"},e==null?void 0:e.headers),s&&(n.body=JSON.stringify(s)),Object.assign(Object.assign({},n),t))};function Te(r,e,t,s,n,i){return re(this,void 0,void 0,function*(){return new Promise((o,l)=>{r(t,Jr(e,s,n,i)).then(c=>{if(!c.ok)throw c;return s!=null&&s.noResolveJson?c:c.json()}).then(c=>o(c)).catch(c=>Hr(c,l,s))})})}function Le(r,e,t,s){return re(this,void 0,void 0,function*(){return Te(r,"GET",e,t,s)})}function V(r,e,t,s,n){return re(this,void 0,void 0,function*(){return Te(r,"POST",e,s,n,t)})}function Kr(r,e,t,s,n){return re(this,void 0,void 0,function*(){return Te(r,"PUT",e,s,n,t)})}function Gr(r,e,t,s){return re(this,void 0,void 0,function*(){return Te(r,"HEAD",e,Object.assign(Object.assign({},t),{noResolveJson:!0}),s)})}function hs(r,e,t,s,n){return re(this,void 0,void 0,function*(){return Te(r,"DELETE",e,s,n,t)})}var D=function(r,e,t,s){function n(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function l(u){try{d(s.next(u))}catch(h){o(h)}}function c(u){try{d(s.throw(u))}catch(h){o(h)}}function d(u){u.done?i(u.value):n(u.value).then(l,c)}d((s=s.apply(r,e||[])).next())})};const Vr={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},It={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class Qr{constructor(e,t={},s,n){this.url=e,this.headers=t,this.bucketId=s,this.fetch=us(n)}uploadOrUpdate(e,t,s,n){return D(this,void 0,void 0,function*(){try{let i;const o=Object.assign(Object.assign({},It),n);let l=Object.assign(Object.assign({},this.headers),e==="POST"&&{"x-upsert":String(o.upsert)});const c=o.metadata;typeof Blob<"u"&&s instanceof Blob?(i=new FormData,i.append("cacheControl",o.cacheControl),c&&i.append("metadata",this.encodeMetadata(c)),i.append("",s)):typeof FormData<"u"&&s instanceof FormData?(i=s,i.append("cacheControl",o.cacheControl),c&&i.append("metadata",this.encodeMetadata(c))):(i=s,l["cache-control"]=`max-age=${o.cacheControl}`,l["content-type"]=o.contentType,c&&(l["x-metadata"]=this.toBase64(this.encodeMetadata(c)))),n!=null&&n.headers&&(l=Object.assign(Object.assign({},l),n.headers));const d=this._removeEmptyFolders(t),u=this._getFinalPath(d),h=yield this.fetch(`${this.url}/object/${u}`,Object.assign({method:e,body:i,headers:l},o!=null&&o.duplex?{duplex:o.duplex}:{})),f=yield h.json();return h.ok?{data:{path:d,id:f.Id,fullPath:f.Key},error:null}:{data:null,error:f}}catch(i){if(R(i))return{data:null,error:i};throw i}})}upload(e,t,s){return D(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",e,t,s)})}uploadToSignedUrl(e,t,s,n){return D(this,void 0,void 0,function*(){const i=this._removeEmptyFolders(e),o=this._getFinalPath(i),l=new URL(this.url+`/object/upload/sign/${o}`);l.searchParams.set("token",t);try{let c;const d=Object.assign({upsert:It.upsert},n),u=Object.assign(Object.assign({},this.headers),{"x-upsert":String(d.upsert)});typeof Blob<"u"&&s instanceof Blob?(c=new FormData,c.append("cacheControl",d.cacheControl),c.append("",s)):typeof FormData<"u"&&s instanceof FormData?(c=s,c.append("cacheControl",d.cacheControl)):(c=s,u["cache-control"]=`max-age=${d.cacheControl}`,u["content-type"]=d.contentType);const h=yield this.fetch(l.toString(),{method:"PUT",body:c,headers:u}),f=yield h.json();return h.ok?{data:{path:i,fullPath:f.Key},error:null}:{data:null,error:f}}catch(c){if(R(c))return{data:null,error:c};throw c}})}createSignedUploadUrl(e,t){return D(this,void 0,void 0,function*(){try{let s=this._getFinalPath(e);const n=Object.assign({},this.headers);t!=null&&t.upsert&&(n["x-upsert"]="true");const i=yield V(this.fetch,`${this.url}/object/upload/sign/${s}`,{},{headers:n}),o=new URL(this.url+i.url),l=o.searchParams.get("token");if(!l)throw new vt("No token returned by API");return{data:{signedUrl:o.toString(),path:e,token:l},error:null}}catch(s){if(R(s))return{data:null,error:s};throw s}})}update(e,t,s){return D(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",e,t,s)})}move(e,t,s){return D(this,void 0,void 0,function*(){try{return{data:yield V(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:s==null?void 0:s.destinationBucket},{headers:this.headers}),error:null}}catch(n){if(R(n))return{data:null,error:n};throw n}})}copy(e,t,s){return D(this,void 0,void 0,function*(){try{return{data:{path:(yield V(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:s==null?void 0:s.destinationBucket},{headers:this.headers})).Key},error:null}}catch(n){if(R(n))return{data:null,error:n};throw n}})}createSignedUrl(e,t,s){return D(this,void 0,void 0,function*(){try{let n=this._getFinalPath(e),i=yield V(this.fetch,`${this.url}/object/sign/${n}`,Object.assign({expiresIn:t},s!=null&&s.transform?{transform:s.transform}:{}),{headers:this.headers});const o=s!=null&&s.download?`&download=${s.download===!0?"":s.download}`:"";return i={signedUrl:encodeURI(`${this.url}${i.signedURL}${o}`)},{data:i,error:null}}catch(n){if(R(n))return{data:null,error:n};throw n}})}createSignedUrls(e,t,s){return D(this,void 0,void 0,function*(){try{const n=yield V(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:t,paths:e},{headers:this.headers}),i=s!=null&&s.download?`&download=${s.download===!0?"":s.download}`:"";return{data:n.map(o=>Object.assign(Object.assign({},o),{signedUrl:o.signedURL?encodeURI(`${this.url}${o.signedURL}${i}`):null})),error:null}}catch(n){if(R(n))return{data:null,error:n};throw n}})}download(e,t){return D(this,void 0,void 0,function*(){const n=typeof(t==null?void 0:t.transform)<"u"?"render/image/authenticated":"object",i=this.transformOptsToQueryString((t==null?void 0:t.transform)||{}),o=i?`?${i}`:"";try{const l=this._getFinalPath(e);return{data:yield(yield Le(this.fetch,`${this.url}/${n}/${l}${o}`,{headers:this.headers,noResolveJson:!0})).blob(),error:null}}catch(l){if(R(l))return{data:null,error:l};throw l}})}info(e){return D(this,void 0,void 0,function*(){const t=this._getFinalPath(e);try{const s=yield Le(this.fetch,`${this.url}/object/info/${t}`,{headers:this.headers});return{data:dt(s),error:null}}catch(s){if(R(s))return{data:null,error:s};throw s}})}exists(e){return D(this,void 0,void 0,function*(){const t=this._getFinalPath(e);try{return yield Gr(this.fetch,`${this.url}/object/${t}`,{headers:this.headers}),{data:!0,error:null}}catch(s){if(R(s)&&s instanceof ct){const n=s.originalError;if([400,404].includes(n==null?void 0:n.status))return{data:!1,error:s}}throw s}})}getPublicUrl(e,t){const s=this._getFinalPath(e),n=[],i=t!=null&&t.download?`download=${t.download===!0?"":t.download}`:"";i!==""&&n.push(i);const l=typeof(t==null?void 0:t.transform)<"u"?"render/image":"object",c=this.transformOptsToQueryString((t==null?void 0:t.transform)||{});c!==""&&n.push(c);let d=n.join("&");return d!==""&&(d=`?${d}`),{data:{publicUrl:encodeURI(`${this.url}/${l}/public/${s}${d}`)}}}remove(e){return D(this,void 0,void 0,function*(){try{return{data:yield hs(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:e},{headers:this.headers}),error:null}}catch(t){if(R(t))return{data:null,error:t};throw t}})}list(e,t,s){return D(this,void 0,void 0,function*(){try{const n=Object.assign(Object.assign(Object.assign({},Vr),t),{prefix:e||""});return{data:yield V(this.fetch,`${this.url}/object/list/${this.bucketId}`,n,{headers:this.headers},s),error:null}}catch(n){if(R(n))return{data:null,error:n};throw n}})}encodeMetadata(e){return JSON.stringify(e)}toBase64(e){return typeof Buffer<"u"?Buffer.from(e).toString("base64"):btoa(e)}_getFinalPath(e){return`${this.bucketId}/${e}`}_removeEmptyFolders(e){return e.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(e){const t=[];return e.width&&t.push(`width=${e.width}`),e.height&&t.push(`height=${e.height}`),e.resize&&t.push(`resize=${e.resize}`),e.format&&t.push(`format=${e.format}`),e.quality&&t.push(`quality=${e.quality}`),t.join("&")}}const Yr="2.7.1",Xr={"X-Client-Info":`storage-js/${Yr}`};var ce=function(r,e,t,s){function n(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function l(u){try{d(s.next(u))}catch(h){o(h)}}function c(u){try{d(s.throw(u))}catch(h){o(h)}}function d(u){u.done?i(u.value):n(u.value).then(l,c)}d((s=s.apply(r,e||[])).next())})};class Zr{constructor(e,t={},s){this.url=e,this.headers=Object.assign(Object.assign({},Xr),t),this.fetch=us(s)}listBuckets(){return ce(this,void 0,void 0,function*(){try{return{data:yield Le(this.fetch,`${this.url}/bucket`,{headers:this.headers}),error:null}}catch(e){if(R(e))return{data:null,error:e};throw e}})}getBucket(e){return ce(this,void 0,void 0,function*(){try{return{data:yield Le(this.fetch,`${this.url}/bucket/${e}`,{headers:this.headers}),error:null}}catch(t){if(R(t))return{data:null,error:t};throw t}})}createBucket(e,t={public:!1}){return ce(this,void 0,void 0,function*(){try{return{data:yield V(this.fetch,`${this.url}/bucket`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(s){if(R(s))return{data:null,error:s};throw s}})}updateBucket(e,t){return ce(this,void 0,void 0,function*(){try{return{data:yield Kr(this.fetch,`${this.url}/bucket/${e}`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(s){if(R(s))return{data:null,error:s};throw s}})}emptyBucket(e){return ce(this,void 0,void 0,function*(){try{return{data:yield V(this.fetch,`${this.url}/bucket/${e}/empty`,{},{headers:this.headers}),error:null}}catch(t){if(R(t))return{data:null,error:t};throw t}})}deleteBucket(e){return ce(this,void 0,void 0,function*(){try{return{data:yield hs(this.fetch,`${this.url}/bucket/${e}`,{},{headers:this.headers}),error:null}}catch(t){if(R(t))return{data:null,error:t};throw t}})}}class en extends Zr{constructor(e,t={},s){super(e,t,s)}from(e){return new Qr(this.url,this.headers,e,this.fetch)}}const tn="2.50.2";let ve="";typeof Deno<"u"?ve="deno":typeof document<"u"?ve="web":typeof navigator<"u"&&navigator.product==="ReactNative"?ve="react-native":ve="node";const sn={"X-Client-Info":`supabase-js-${ve}/${tn}`},rn={headers:sn},nn={schema:"public"},an={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},on={};var ln=function(r,e,t,s){function n(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function l(u){try{d(s.next(u))}catch(h){o(h)}}function c(u){try{d(s.throw(u))}catch(h){o(h)}}function d(u){u.done?i(u.value):n(u.value).then(l,c)}d((s=s.apply(r,e||[])).next())})};const cn=r=>{let e;return r?e=r:typeof fetch>"u"?e=Qt:e=fetch,(...t)=>e(...t)},dn=()=>typeof Headers>"u"?Yt:Headers,un=(r,e,t)=>{const s=cn(t),n=dn();return(i,o)=>ln(void 0,void 0,void 0,function*(){var l;const c=(l=yield e())!==null&&l!==void 0?l:r;let d=new n(o==null?void 0:o.headers);return d.has("apikey")||d.set("apikey",r),d.has("Authorization")||d.set("Authorization",`Bearer ${c}`),s(i,Object.assign(Object.assign({},o),{headers:d}))})};var hn=function(r,e,t,s){function n(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function l(u){try{d(s.next(u))}catch(h){o(h)}}function c(u){try{d(s.throw(u))}catch(h){o(h)}}function d(u){u.done?i(u.value):n(u.value).then(l,c)}d((s=s.apply(r,e||[])).next())})};function fn(r){return r.endsWith("/")?r:r+"/"}function mn(r,e){var t,s;const{db:n,auth:i,realtime:o,global:l}=r,{db:c,auth:d,realtime:u,global:h}=e,f={db:Object.assign(Object.assign({},c),n),auth:Object.assign(Object.assign({},d),i),realtime:Object.assign(Object.assign({},u),o),global:Object.assign(Object.assign(Object.assign({},h),l),{headers:Object.assign(Object.assign({},(t=h==null?void 0:h.headers)!==null&&t!==void 0?t:{}),(s=l==null?void 0:l.headers)!==null&&s!==void 0?s:{})}),accessToken:()=>hn(this,void 0,void 0,function*(){return""})};return r.accessToken?f.accessToken=r.accessToken:delete f.accessToken,f}const fs="2.70.0",fe=30*1e3,ut=3,Xe=ut*fe,gn="http://localhost:9999",pn="supabase.auth.token",yn={"X-Client-Info":`gotrue-js/${fs}`},ht="X-Supabase-Api-Version",ms={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}},wn=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i,vn=6e5;class bt extends Error{constructor(e,t,s){super(e),this.__isAuthError=!0,this.name="AuthError",this.status=t,this.code=s}}function k(r){return typeof r=="object"&&r!==null&&"__isAuthError"in r}class bn extends bt{constructor(e,t,s){super(e,t,s),this.name="AuthApiError",this.status=t,this.code=s}}function xn(r){return k(r)&&r.name==="AuthApiError"}class gs extends bt{constructor(e,t){super(e),this.name="AuthUnknownError",this.originalError=t}}class Y extends bt{constructor(e,t,s,n){super(e,s,n),this.name=t,this.status=s}}class G extends Y{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}function _n(r){return k(r)&&r.name==="AuthSessionMissingError"}class Oe extends Y{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class $e extends Y{constructor(e){super(e,"AuthInvalidCredentialsError",400,void 0)}}class Ce extends Y{constructor(e,t=null){super(e,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}function jn(r){return k(r)&&r.name==="AuthImplicitGrantRedirectError"}class Rt extends Y{constructor(e,t=null){super(e,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class ft extends Y{constructor(e,t){super(e,"AuthRetryableFetchError",t,void 0)}}function Ze(r){return k(r)&&r.name==="AuthRetryableFetchError"}class Ut extends Y{constructor(e,t,s){super(e,"AuthWeakPasswordError",t,"weak_password"),this.reasons=s}}class _e extends Y{constructor(e){super(e,"AuthInvalidJwtError",400,"invalid_jwt")}}const De="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),Lt=` 	
\r=`.split(""),kn=(()=>{const r=new Array(128);for(let e=0;e<r.length;e+=1)r[e]=-1;for(let e=0;e<Lt.length;e+=1)r[Lt[e].charCodeAt(0)]=-2;for(let e=0;e<De.length;e+=1)r[De[e].charCodeAt(0)]=e;return r})();function Dt(r,e,t){if(r!==null)for(e.queue=e.queue<<8|r,e.queuedBits+=8;e.queuedBits>=6;){const s=e.queue>>e.queuedBits-6&63;t(De[s]),e.queuedBits-=6}else if(e.queuedBits>0)for(e.queue=e.queue<<6-e.queuedBits,e.queuedBits=6;e.queuedBits>=6;){const s=e.queue>>e.queuedBits-6&63;t(De[s]),e.queuedBits-=6}}function ps(r,e,t){const s=kn[r];if(s>-1)for(e.queue=e.queue<<6|s,e.queuedBits+=6;e.queuedBits>=8;)t(e.queue>>e.queuedBits-8&255),e.queuedBits-=8;else{if(s===-2)return;throw new Error(`Invalid Base64-URL character "${String.fromCharCode(r)}"`)}}function Bt(r){const e=[],t=o=>{e.push(String.fromCodePoint(o))},s={utf8seq:0,codepoint:0},n={queue:0,queuedBits:0},i=o=>{En(o,s,t)};for(let o=0;o<r.length;o+=1)ps(r.charCodeAt(o),n,i);return e.join("")}function Sn(r,e){if(r<=127){e(r);return}else if(r<=2047){e(192|r>>6),e(128|r&63);return}else if(r<=65535){e(224|r>>12),e(128|r>>6&63),e(128|r&63);return}else if(r<=1114111){e(240|r>>18),e(128|r>>12&63),e(128|r>>6&63),e(128|r&63);return}throw new Error(`Unrecognized Unicode codepoint: ${r.toString(16)}`)}function Nn(r,e){for(let t=0;t<r.length;t+=1){let s=r.charCodeAt(t);if(s>55295&&s<=56319){const n=(s-55296)*1024&65535;s=(r.charCodeAt(t+1)-56320&65535|n)+65536,t+=1}Sn(s,e)}}function En(r,e,t){if(e.utf8seq===0){if(r<=127){t(r);return}for(let s=1;s<6;s+=1)if(!(r>>7-s&1)){e.utf8seq=s;break}if(e.utf8seq===2)e.codepoint=r&31;else if(e.utf8seq===3)e.codepoint=r&15;else if(e.utf8seq===4)e.codepoint=r&7;else throw new Error("Invalid UTF-8 sequence");e.utf8seq-=1}else if(e.utf8seq>0){if(r<=127)throw new Error("Invalid UTF-8 sequence");e.codepoint=e.codepoint<<6|r&63,e.utf8seq-=1,e.utf8seq===0&&t(e.codepoint)}}function Tn(r){const e=[],t={queue:0,queuedBits:0},s=n=>{e.push(n)};for(let n=0;n<r.length;n+=1)ps(r.charCodeAt(n),t,s);return new Uint8Array(e)}function Pn(r){const e=[];return Nn(r,t=>e.push(t)),new Uint8Array(e)}function An(r){const e=[],t={queue:0,queuedBits:0},s=n=>{e.push(n)};return r.forEach(n=>Dt(n,t,s)),Dt(null,t,s),e.join("")}function On(r){return Math.round(Date.now()/1e3)+r}function $n(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(r){const e=Math.random()*16|0;return(r=="x"?e:e&3|8).toString(16)})}const M=()=>typeof window<"u"&&typeof document<"u",ee={tested:!1,writable:!1},je=()=>{if(!M())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(ee.tested)return ee.writable;const r=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(r,r),globalThis.localStorage.removeItem(r),ee.tested=!0,ee.writable=!0}catch{ee.tested=!0,ee.writable=!1}return ee.writable};function Cn(r){const e={},t=new URL(r);if(t.hash&&t.hash[0]==="#")try{new URLSearchParams(t.hash.substring(1)).forEach((n,i)=>{e[i]=n})}catch{}return t.searchParams.forEach((s,n)=>{e[n]=s}),e}const ys=r=>{let e;return r?e=r:typeof fetch>"u"?e=(...t)=>Ne(async()=>{const{default:s}=await Promise.resolve().then(()=>ge);return{default:s}},void 0).then(({default:s})=>s(...t)):e=fetch,(...t)=>e(...t)},In=r=>typeof r=="object"&&r!==null&&"status"in r&&"ok"in r&&"json"in r&&typeof r.json=="function",ws=async(r,e,t)=>{await r.setItem(e,JSON.stringify(t))},Ie=async(r,e)=>{const t=await r.getItem(e);if(!t)return null;try{return JSON.parse(t)}catch{return t}},Re=async(r,e)=>{await r.removeItem(e)};class Ke{constructor(){this.promise=new Ke.promiseConstructor((e,t)=>{this.resolve=e,this.reject=t})}}Ke.promiseConstructor=Promise;function et(r){const e=r.split(".");if(e.length!==3)throw new _e("Invalid JWT structure");for(let s=0;s<e.length;s++)if(!wn.test(e[s]))throw new _e("JWT not in base64url format");return{header:JSON.parse(Bt(e[0])),payload:JSON.parse(Bt(e[1])),signature:Tn(e[2]),raw:{header:e[0],payload:e[1]}}}async function Rn(r){return await new Promise(e=>{setTimeout(()=>e(null),r)})}function Un(r,e){return new Promise((s,n)=>{(async()=>{for(let i=0;i<1/0;i++)try{const o=await r(i);if(!e(i,null,o)){s(o);return}}catch(o){if(!e(i,o)){n(o);return}}})()})}function Ln(r){return("0"+r.toString(16)).substr(-2)}function Dn(){const e=new Uint32Array(56);if(typeof crypto>"u"){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",s=t.length;let n="";for(let i=0;i<56;i++)n+=t.charAt(Math.floor(Math.random()*s));return n}return crypto.getRandomValues(e),Array.from(e,Ln).join("")}async function Bn(r){const t=new TextEncoder().encode(r),s=await crypto.subtle.digest("SHA-256",t),n=new Uint8Array(s);return Array.from(n).map(i=>String.fromCharCode(i)).join("")}async function qn(r){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),r;const t=await Bn(r);return btoa(t).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function de(r,e,t=!1){const s=Dn();let n=s;t&&(n+="/PASSWORD_RECOVERY"),await ws(r,`${e}-code-verifier`,n);const i=await qn(s);return[i,s===i?"plain":"s256"]}const Mn=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function Wn(r){const e=r.headers.get(ht);if(!e||!e.match(Mn))return null;try{return new Date(`${e}T00:00:00.0Z`)}catch{return null}}function Fn(r){if(!r)throw new Error("Missing exp claim");const e=Math.floor(Date.now()/1e3);if(r<=e)throw new Error("JWT has expired")}function zn(r){switch(r){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}const Hn=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/;function ue(r){if(!Hn.test(r))throw new Error("@supabase/auth-js: Expected parameter to be UUID but is not")}var Jn=function(r,e){var t={};for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&e.indexOf(s)<0&&(t[s]=r[s]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var n=0,s=Object.getOwnPropertySymbols(r);n<s.length;n++)e.indexOf(s[n])<0&&Object.prototype.propertyIsEnumerable.call(r,s[n])&&(t[s[n]]=r[s[n]]);return t};const te=r=>r.msg||r.message||r.error_description||r.error||JSON.stringify(r),Kn=[502,503,504];async function qt(r){var e;if(!In(r))throw new ft(te(r),0);if(Kn.includes(r.status))throw new ft(te(r),r.status);let t;try{t=await r.json()}catch(i){throw new gs(te(i),i)}let s;const n=Wn(r);if(n&&n.getTime()>=ms["2024-01-01"].timestamp&&typeof t=="object"&&t&&typeof t.code=="string"?s=t.code:typeof t=="object"&&t&&typeof t.error_code=="string"&&(s=t.error_code),s){if(s==="weak_password")throw new Ut(te(t),r.status,((e=t.weak_password)===null||e===void 0?void 0:e.reasons)||[]);if(s==="session_not_found")throw new G}else if(typeof t=="object"&&t&&typeof t.weak_password=="object"&&t.weak_password&&Array.isArray(t.weak_password.reasons)&&t.weak_password.reasons.length&&t.weak_password.reasons.reduce((i,o)=>i&&typeof o=="string",!0))throw new Ut(te(t),r.status,t.weak_password.reasons);throw new bn(te(t),r.status||500,s)}const Gn=(r,e,t,s)=>{const n={method:r,headers:(e==null?void 0:e.headers)||{}};return r==="GET"?n:(n.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},e==null?void 0:e.headers),n.body=JSON.stringify(s),Object.assign(Object.assign({},n),t))};async function E(r,e,t,s){var n;const i=Object.assign({},s==null?void 0:s.headers);i[ht]||(i[ht]=ms["2024-01-01"].name),s!=null&&s.jwt&&(i.Authorization=`Bearer ${s.jwt}`);const o=(n=s==null?void 0:s.query)!==null&&n!==void 0?n:{};s!=null&&s.redirectTo&&(o.redirect_to=s.redirectTo);const l=Object.keys(o).length?"?"+new URLSearchParams(o).toString():"",c=await Vn(r,e,t+l,{headers:i,noResolveJson:s==null?void 0:s.noResolveJson},{},s==null?void 0:s.body);return s!=null&&s.xform?s==null?void 0:s.xform(c):{data:Object.assign({},c),error:null}}async function Vn(r,e,t,s,n,i){const o=Gn(e,s,n,i);let l;try{l=await r(t,Object.assign({},o))}catch(c){throw console.error(c),new ft(te(c),0)}if(l.ok||await qt(l),s!=null&&s.noResolveJson)return l;try{return await l.json()}catch(c){await qt(c)}}function H(r){var e;let t=null;Zn(r)&&(t=Object.assign({},r),r.expires_at||(t.expires_at=On(r.expires_in)));const s=(e=r.user)!==null&&e!==void 0?e:r;return{data:{session:t,user:s},error:null}}function Mt(r){const e=H(r);return!e.error&&r.weak_password&&typeof r.weak_password=="object"&&Array.isArray(r.weak_password.reasons)&&r.weak_password.reasons.length&&r.weak_password.message&&typeof r.weak_password.message=="string"&&r.weak_password.reasons.reduce((t,s)=>t&&typeof s=="string",!0)&&(e.data.weak_password=r.weak_password),e}function Q(r){var e;return{data:{user:(e=r.user)!==null&&e!==void 0?e:r},error:null}}function Qn(r){return{data:r,error:null}}function Yn(r){const{action_link:e,email_otp:t,hashed_token:s,redirect_to:n,verification_type:i}=r,o=Jn(r,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),l={action_link:e,email_otp:t,hashed_token:s,redirect_to:n,verification_type:i},c=Object.assign({},o);return{data:{properties:l,user:c},error:null}}function Xn(r){return r}function Zn(r){return r.access_token&&r.refresh_token&&r.expires_in}const tt=["global","local","others"];var ei=function(r,e){var t={};for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&e.indexOf(s)<0&&(t[s]=r[s]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var n=0,s=Object.getOwnPropertySymbols(r);n<s.length;n++)e.indexOf(s[n])<0&&Object.prototype.propertyIsEnumerable.call(r,s[n])&&(t[s[n]]=r[s[n]]);return t};class ti{constructor({url:e="",headers:t={},fetch:s}){this.url=e,this.headers=t,this.fetch=ys(s),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)}}async signOut(e,t=tt[0]){if(tt.indexOf(t)<0)throw new Error(`@supabase/auth-js: Parameter scope must be one of ${tt.join(", ")}`);try{return await E(this.fetch,"POST",`${this.url}/logout?scope=${t}`,{headers:this.headers,jwt:e,noResolveJson:!0}),{data:null,error:null}}catch(s){if(k(s))return{data:null,error:s};throw s}}async inviteUserByEmail(e,t={}){try{return await E(this.fetch,"POST",`${this.url}/invite`,{body:{email:e,data:t.data},headers:this.headers,redirectTo:t.redirectTo,xform:Q})}catch(s){if(k(s))return{data:{user:null},error:s};throw s}}async generateLink(e){try{const{options:t}=e,s=ei(e,["options"]),n=Object.assign(Object.assign({},s),t);return"newEmail"in s&&(n.new_email=s==null?void 0:s.newEmail,delete n.newEmail),await E(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:n,headers:this.headers,xform:Yn,redirectTo:t==null?void 0:t.redirectTo})}catch(t){if(k(t))return{data:{properties:null,user:null},error:t};throw t}}async createUser(e){try{return await E(this.fetch,"POST",`${this.url}/admin/users`,{body:e,headers:this.headers,xform:Q})}catch(t){if(k(t))return{data:{user:null},error:t};throw t}}async listUsers(e){var t,s,n,i,o,l,c;try{const d={nextPage:null,lastPage:0,total:0},u=await E(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(s=(t=e==null?void 0:e.page)===null||t===void 0?void 0:t.toString())!==null&&s!==void 0?s:"",per_page:(i=(n=e==null?void 0:e.perPage)===null||n===void 0?void 0:n.toString())!==null&&i!==void 0?i:""},xform:Xn});if(u.error)throw u.error;const h=await u.json(),f=(o=u.headers.get("x-total-count"))!==null&&o!==void 0?o:0,m=(c=(l=u.headers.get("link"))===null||l===void 0?void 0:l.split(","))!==null&&c!==void 0?c:[];return m.length>0&&(m.forEach(g=>{const p=parseInt(g.split(";")[0].split("=")[1].substring(0,1)),w=JSON.parse(g.split(";")[1].split("=")[1]);d[`${w}Page`]=p}),d.total=parseInt(f)),{data:Object.assign(Object.assign({},h),d),error:null}}catch(d){if(k(d))return{data:{users:[]},error:d};throw d}}async getUserById(e){ue(e);try{return await E(this.fetch,"GET",`${this.url}/admin/users/${e}`,{headers:this.headers,xform:Q})}catch(t){if(k(t))return{data:{user:null},error:t};throw t}}async updateUserById(e,t){ue(e);try{return await E(this.fetch,"PUT",`${this.url}/admin/users/${e}`,{body:t,headers:this.headers,xform:Q})}catch(s){if(k(s))return{data:{user:null},error:s};throw s}}async deleteUser(e,t=!1){ue(e);try{return await E(this.fetch,"DELETE",`${this.url}/admin/users/${e}`,{headers:this.headers,body:{should_soft_delete:t},xform:Q})}catch(s){if(k(s))return{data:{user:null},error:s};throw s}}async _listFactors(e){ue(e.userId);try{const{data:t,error:s}=await E(this.fetch,"GET",`${this.url}/admin/users/${e.userId}/factors`,{headers:this.headers,xform:n=>({data:{factors:n},error:null})});return{data:t,error:s}}catch(t){if(k(t))return{data:null,error:t};throw t}}async _deleteFactor(e){ue(e.userId),ue(e.id);try{return{data:await E(this.fetch,"DELETE",`${this.url}/admin/users/${e.userId}/factors/${e.id}`,{headers:this.headers}),error:null}}catch(t){if(k(t))return{data:null,error:t};throw t}}}const si={getItem:r=>je()?globalThis.localStorage.getItem(r):null,setItem:(r,e)=>{je()&&globalThis.localStorage.setItem(r,e)},removeItem:r=>{je()&&globalThis.localStorage.removeItem(r)}};function Wt(r={}){return{getItem:e=>r[e]||null,setItem:(e,t)=>{r[e]=t},removeItem:e=>{delete r[e]}}}function ri(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}const he={debug:!!(globalThis&&je()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class vs extends Error{constructor(e){super(e),this.isAcquireTimeout=!0}}class ni extends vs{}async function ii(r,e,t){he.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",r,e);const s=new globalThis.AbortController;return e>0&&setTimeout(()=>{s.abort(),he.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",r)},e),await Promise.resolve().then(()=>globalThis.navigator.locks.request(r,e===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:s.signal},async n=>{if(n){he.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",r,n.name);try{return await t()}finally{he.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",r,n.name)}}else{if(e===0)throw he.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",r),new ni(`Acquiring an exclusive Navigator LockManager lock "${r}" immediately failed`);if(he.debug)try{const i=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(i,null,"  "))}catch(i){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",i)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await t()}}))}ri();const ai={url:gn,storageKey:pn,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:yn,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1};async function Ft(r,e,t){return await t()}class Se{constructor(e){var t,s;this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log,this.instanceID=Se.nextInstanceID,Se.nextInstanceID+=1,this.instanceID>0&&M()&&console.warn("Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.");const n=Object.assign(Object.assign({},ai),e);if(this.logDebugMessages=!!n.debug,typeof n.debug=="function"&&(this.logger=n.debug),this.persistSession=n.persistSession,this.storageKey=n.storageKey,this.autoRefreshToken=n.autoRefreshToken,this.admin=new ti({url:n.url,headers:n.headers,fetch:n.fetch}),this.url=n.url,this.headers=n.headers,this.fetch=ys(n.fetch),this.lock=n.lock||Ft,this.detectSessionInUrl=n.detectSessionInUrl,this.flowType=n.flowType,this.hasCustomAuthorizationHeader=n.hasCustomAuthorizationHeader,n.lock?this.lock=n.lock:M()&&(!((t=globalThis==null?void 0:globalThis.navigator)===null||t===void 0)&&t.locks)?this.lock=ii:this.lock=Ft,this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER,this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this)},this.persistSession?n.storage?this.storage=n.storage:je()?this.storage=si:(this.memoryStorage={},this.storage=Wt(this.memoryStorage)):(this.memoryStorage={},this.storage=Wt(this.memoryStorage)),M()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(i){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",i)}(s=this.broadcastChannel)===null||s===void 0||s.addEventListener("message",async i=>{this._debug("received broadcast notification from other tab or client",i),await this._notifyAllSubscribers(i.data.event,i.data.session,!1)})}this.initialize()}_debug(...e){return this.logDebugMessages&&this.logger(`GoTrueClient@${this.instanceID} (${fs}) ${new Date().toISOString()}`,...e),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(-1,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){var e;try{const t=Cn(window.location.href);let s="none";if(this._isImplicitGrantCallback(t)?s="implicit":await this._isPKCECallback(t)&&(s="pkce"),M()&&this.detectSessionInUrl&&s!=="none"){const{data:n,error:i}=await this._getSessionFromURL(t,s);if(i){if(this._debug("#_initialize()","error detecting session from URL",i),jn(i)){const c=(e=i.details)===null||e===void 0?void 0:e.code;if(c==="identity_already_exists"||c==="identity_not_found"||c==="single_identity_not_deletable")return{error:i}}return await this._removeSession(),{error:i}}const{session:o,redirectType:l}=n;return this._debug("#_initialize()","detected session in URL",o,"redirect type",l),await this._saveSession(o),setTimeout(async()=>{l==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",o):await this._notifyAllSubscribers("SIGNED_IN",o)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(t){return k(t)?{error:t}:{error:new gs("Unexpected error during initialization",t)}}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(e){var t,s,n;try{const i=await E(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(s=(t=e==null?void 0:e.options)===null||t===void 0?void 0:t.data)!==null&&s!==void 0?s:{},gotrue_meta_security:{captcha_token:(n=e==null?void 0:e.options)===null||n===void 0?void 0:n.captchaToken}},xform:H}),{data:o,error:l}=i;if(l||!o)return{data:{user:null,session:null},error:l};const c=o.session,d=o.user;return o.session&&(await this._saveSession(o.session),await this._notifyAllSubscribers("SIGNED_IN",c)),{data:{user:d,session:c},error:null}}catch(i){if(k(i))return{data:{user:null,session:null},error:i};throw i}}async signUp(e){var t,s,n;try{let i;if("email"in e){const{email:u,password:h,options:f}=e;let m=null,g=null;this.flowType==="pkce"&&([m,g]=await de(this.storage,this.storageKey)),i=await E(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:f==null?void 0:f.emailRedirectTo,body:{email:u,password:h,data:(t=f==null?void 0:f.data)!==null&&t!==void 0?t:{},gotrue_meta_security:{captcha_token:f==null?void 0:f.captchaToken},code_challenge:m,code_challenge_method:g},xform:H})}else if("phone"in e){const{phone:u,password:h,options:f}=e;i=await E(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:u,password:h,data:(s=f==null?void 0:f.data)!==null&&s!==void 0?s:{},channel:(n=f==null?void 0:f.channel)!==null&&n!==void 0?n:"sms",gotrue_meta_security:{captcha_token:f==null?void 0:f.captchaToken}},xform:H})}else throw new $e("You must provide either an email or phone number and a password");const{data:o,error:l}=i;if(l||!o)return{data:{user:null,session:null},error:l};const c=o.session,d=o.user;return o.session&&(await this._saveSession(o.session),await this._notifyAllSubscribers("SIGNED_IN",c)),{data:{user:d,session:c},error:null}}catch(i){if(k(i))return{data:{user:null,session:null},error:i};throw i}}async signInWithPassword(e){try{let t;if("email"in e){const{email:i,password:o,options:l}=e;t=await E(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:i,password:o,gotrue_meta_security:{captcha_token:l==null?void 0:l.captchaToken}},xform:Mt})}else if("phone"in e){const{phone:i,password:o,options:l}=e;t=await E(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:i,password:o,gotrue_meta_security:{captcha_token:l==null?void 0:l.captchaToken}},xform:Mt})}else throw new $e("You must provide either an email or phone number and a password");const{data:s,error:n}=t;return n?{data:{user:null,session:null},error:n}:!s||!s.session||!s.user?{data:{user:null,session:null},error:new Oe}:(s.session&&(await this._saveSession(s.session),await this._notifyAllSubscribers("SIGNED_IN",s.session)),{data:Object.assign({user:s.user,session:s.session},s.weak_password?{weakPassword:s.weak_password}:null),error:n})}catch(t){if(k(t))return{data:{user:null,session:null},error:t};throw t}}async signInWithOAuth(e){var t,s,n,i;return await this._handleProviderSignIn(e.provider,{redirectTo:(t=e.options)===null||t===void 0?void 0:t.redirectTo,scopes:(s=e.options)===null||s===void 0?void 0:s.scopes,queryParams:(n=e.options)===null||n===void 0?void 0:n.queryParams,skipBrowserRedirect:(i=e.options)===null||i===void 0?void 0:i.skipBrowserRedirect})}async exchangeCodeForSession(e){return await this.initializePromise,this._acquireLock(-1,async()=>this._exchangeCodeForSession(e))}async signInWithWeb3(e){const{chain:t}=e;if(t==="solana")return await this.signInWithSolana(e);throw new Error(`@supabase/auth-js: Unsupported chain "${t}"`)}async signInWithSolana(e){var t,s,n,i,o,l,c,d,u,h,f,m;let g,p;if("message"in e)g=e.message,p=e.signature;else{const{chain:w,wallet:x,statement:v,options:y}=e;let S;if(M())if(typeof x=="object")S=x;else{const P=window;if("solana"in P&&typeof P.solana=="object"&&("signIn"in P.solana&&typeof P.solana.signIn=="function"||"signMessage"in P.solana&&typeof P.solana.signMessage=="function"))S=P.solana;else throw new Error("@supabase/auth-js: No compatible Solana wallet interface on the window object (window.solana) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'solana', wallet: resolvedUserWallet }) instead.")}else{if(typeof x!="object"||!(y!=null&&y.url))throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");S=x}const $=new URL((t=y==null?void 0:y.url)!==null&&t!==void 0?t:window.location.href);if("signIn"in S&&S.signIn){const P=await S.signIn(Object.assign(Object.assign(Object.assign({issuedAt:new Date().toISOString()},y==null?void 0:y.signInWithSolana),{version:"1",domain:$.host,uri:$.href}),v?{statement:v}:null));let U;if(Array.isArray(P)&&P[0]&&typeof P[0]=="object")U=P[0];else if(P&&typeof P=="object"&&"signedMessage"in P&&"signature"in P)U=P;else throw new Error("@supabase/auth-js: Wallet method signIn() returned unrecognized value");if("signedMessage"in U&&"signature"in U&&(typeof U.signedMessage=="string"||U.signedMessage instanceof Uint8Array)&&U.signature instanceof Uint8Array)g=typeof U.signedMessage=="string"?U.signedMessage:new TextDecoder().decode(U.signedMessage),p=U.signature;else throw new Error("@supabase/auth-js: Wallet method signIn() API returned object without signedMessage and signature fields")}else{if(!("signMessage"in S)||typeof S.signMessage!="function"||!("publicKey"in S)||typeof S!="object"||!S.publicKey||!("toBase58"in S.publicKey)||typeof S.publicKey.toBase58!="function")throw new Error("@supabase/auth-js: Wallet does not have a compatible signMessage() and publicKey.toBase58() API");g=[`${$.host} wants you to sign in with your Solana account:`,S.publicKey.toBase58(),...v?["",v,""]:[""],"Version: 1",`URI: ${$.href}`,`Issued At: ${(n=(s=y==null?void 0:y.signInWithSolana)===null||s===void 0?void 0:s.issuedAt)!==null&&n!==void 0?n:new Date().toISOString()}`,...!((i=y==null?void 0:y.signInWithSolana)===null||i===void 0)&&i.notBefore?[`Not Before: ${y.signInWithSolana.notBefore}`]:[],...!((o=y==null?void 0:y.signInWithSolana)===null||o===void 0)&&o.expirationTime?[`Expiration Time: ${y.signInWithSolana.expirationTime}`]:[],...!((l=y==null?void 0:y.signInWithSolana)===null||l===void 0)&&l.chainId?[`Chain ID: ${y.signInWithSolana.chainId}`]:[],...!((c=y==null?void 0:y.signInWithSolana)===null||c===void 0)&&c.nonce?[`Nonce: ${y.signInWithSolana.nonce}`]:[],...!((d=y==null?void 0:y.signInWithSolana)===null||d===void 0)&&d.requestId?[`Request ID: ${y.signInWithSolana.requestId}`]:[],...!((h=(u=y==null?void 0:y.signInWithSolana)===null||u===void 0?void 0:u.resources)===null||h===void 0)&&h.length?["Resources",...y.signInWithSolana.resources.map(U=>`- ${U}`)]:[]].join(`
`);const P=await S.signMessage(new TextEncoder().encode(g),"utf8");if(!P||!(P instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet signMessage() API returned an recognized value");p=P}}try{const{data:w,error:x}=await E(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"solana",message:g,signature:An(p)},!((f=e.options)===null||f===void 0)&&f.captchaToken?{gotrue_meta_security:{captcha_token:(m=e.options)===null||m===void 0?void 0:m.captchaToken}}:null),xform:H});if(x)throw x;return!w||!w.session||!w.user?{data:{user:null,session:null},error:new Oe}:(w.session&&(await this._saveSession(w.session),await this._notifyAllSubscribers("SIGNED_IN",w.session)),{data:Object.assign({},w),error:x})}catch(w){if(k(w))return{data:{user:null,session:null},error:w};throw w}}async _exchangeCodeForSession(e){const t=await Ie(this.storage,`${this.storageKey}-code-verifier`),[s,n]=(t??"").split("/");try{const{data:i,error:o}=await E(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:e,code_verifier:s},xform:H});if(await Re(this.storage,`${this.storageKey}-code-verifier`),o)throw o;return!i||!i.session||!i.user?{data:{user:null,session:null,redirectType:null},error:new Oe}:(i.session&&(await this._saveSession(i.session),await this._notifyAllSubscribers("SIGNED_IN",i.session)),{data:Object.assign(Object.assign({},i),{redirectType:n??null}),error:o})}catch(i){if(k(i))return{data:{user:null,session:null,redirectType:null},error:i};throw i}}async signInWithIdToken(e){try{const{options:t,provider:s,token:n,access_token:i,nonce:o}=e,l=await E(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:s,id_token:n,access_token:i,nonce:o,gotrue_meta_security:{captcha_token:t==null?void 0:t.captchaToken}},xform:H}),{data:c,error:d}=l;return d?{data:{user:null,session:null},error:d}:!c||!c.session||!c.user?{data:{user:null,session:null},error:new Oe}:(c.session&&(await this._saveSession(c.session),await this._notifyAllSubscribers("SIGNED_IN",c.session)),{data:c,error:d})}catch(t){if(k(t))return{data:{user:null,session:null},error:t};throw t}}async signInWithOtp(e){var t,s,n,i,o;try{if("email"in e){const{email:l,options:c}=e;let d=null,u=null;this.flowType==="pkce"&&([d,u]=await de(this.storage,this.storageKey));const{error:h}=await E(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:l,data:(t=c==null?void 0:c.data)!==null&&t!==void 0?t:{},create_user:(s=c==null?void 0:c.shouldCreateUser)!==null&&s!==void 0?s:!0,gotrue_meta_security:{captcha_token:c==null?void 0:c.captchaToken},code_challenge:d,code_challenge_method:u},redirectTo:c==null?void 0:c.emailRedirectTo});return{data:{user:null,session:null},error:h}}if("phone"in e){const{phone:l,options:c}=e,{data:d,error:u}=await E(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:l,data:(n=c==null?void 0:c.data)!==null&&n!==void 0?n:{},create_user:(i=c==null?void 0:c.shouldCreateUser)!==null&&i!==void 0?i:!0,gotrue_meta_security:{captcha_token:c==null?void 0:c.captchaToken},channel:(o=c==null?void 0:c.channel)!==null&&o!==void 0?o:"sms"}});return{data:{user:null,session:null,messageId:d==null?void 0:d.message_id},error:u}}throw new $e("You must provide either an email or phone number.")}catch(l){if(k(l))return{data:{user:null,session:null},error:l};throw l}}async verifyOtp(e){var t,s;try{let n,i;"options"in e&&(n=(t=e.options)===null||t===void 0?void 0:t.redirectTo,i=(s=e.options)===null||s===void 0?void 0:s.captchaToken);const{data:o,error:l}=await E(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},e),{gotrue_meta_security:{captcha_token:i}}),redirectTo:n,xform:H});if(l)throw l;if(!o)throw new Error("An error occurred on token verification.");const c=o.session,d=o.user;return c!=null&&c.access_token&&(await this._saveSession(c),await this._notifyAllSubscribers(e.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",c)),{data:{user:d,session:c},error:null}}catch(n){if(k(n))return{data:{user:null,session:null},error:n};throw n}}async signInWithSSO(e){var t,s,n;try{let i=null,o=null;return this.flowType==="pkce"&&([i,o]=await de(this.storage,this.storageKey)),await E(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in e?{provider_id:e.providerId}:null),"domain"in e?{domain:e.domain}:null),{redirect_to:(s=(t=e.options)===null||t===void 0?void 0:t.redirectTo)!==null&&s!==void 0?s:void 0}),!((n=e==null?void 0:e.options)===null||n===void 0)&&n.captchaToken?{gotrue_meta_security:{captcha_token:e.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:i,code_challenge_method:o}),headers:this.headers,xform:Qn})}catch(i){if(k(i))return{data:null,error:i};throw i}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async e=>{const{data:{session:t},error:s}=e;if(s)throw s;if(!t)throw new G;const{error:n}=await E(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:t.access_token});return{data:{user:null,session:null},error:n}})}catch(e){if(k(e))return{data:{user:null,session:null},error:e};throw e}}async resend(e){try{const t=`${this.url}/resend`;if("email"in e){const{email:s,type:n,options:i}=e,{error:o}=await E(this.fetch,"POST",t,{headers:this.headers,body:{email:s,type:n,gotrue_meta_security:{captcha_token:i==null?void 0:i.captchaToken}},redirectTo:i==null?void 0:i.emailRedirectTo});return{data:{user:null,session:null},error:o}}else if("phone"in e){const{phone:s,type:n,options:i}=e,{data:o,error:l}=await E(this.fetch,"POST",t,{headers:this.headers,body:{phone:s,type:n,gotrue_meta_security:{captcha_token:i==null?void 0:i.captchaToken}}});return{data:{user:null,session:null,messageId:o==null?void 0:o.message_id},error:l}}throw new $e("You must provide either an email or phone number and a type")}catch(t){if(k(t))return{data:{user:null,session:null},error:t};throw t}}async getSession(){return await this.initializePromise,await this._acquireLock(-1,async()=>this._useSession(async t=>t))}async _acquireLock(e,t){this._debug("#_acquireLock","begin",e);try{if(this.lockAcquired){const s=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),n=(async()=>(await s,await t()))();return this.pendingInLock.push((async()=>{try{await n}catch{}})()),n}return await this.lock(`lock:${this.storageKey}`,e,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const s=t();for(this.pendingInLock.push((async()=>{try{await s}catch{}})()),await s;this.pendingInLock.length;){const n=[...this.pendingInLock];await Promise.all(n),this.pendingInLock.splice(0,n.length)}return await s}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(e){this._debug("#_useSession","begin");try{const t=await this.__loadSession();return await e(t)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let e=null;const t=await Ie(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",t),t!==null&&(this._isValidSession(t)?e=t:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!e)return{data:{session:null},error:null};const s=e.expires_at?e.expires_at*1e3-Date.now()<Xe:!1;if(this._debug("#__loadSession()",`session has${s?"":" not"} expired`,"expires_at",e.expires_at),!s){if(this.storage.isServer){let o=this.suppressGetSessionWarning;e=new Proxy(e,{get:(c,d,u)=>(!o&&d==="user"&&(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),o=!0,this.suppressGetSessionWarning=!0),Reflect.get(c,d,u))})}return{data:{session:e},error:null}}const{session:n,error:i}=await this._callRefreshToken(e.refresh_token);return i?{data:{session:null},error:i}:{data:{session:n},error:null}}finally{this._debug("#__loadSession()","end")}}async getUser(e){return e?await this._getUser(e):(await this.initializePromise,await this._acquireLock(-1,async()=>await this._getUser()))}async _getUser(e){try{return e?await E(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:e,xform:Q}):await this._useSession(async t=>{var s,n,i;const{data:o,error:l}=t;if(l)throw l;return!(!((s=o.session)===null||s===void 0)&&s.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new G}:await E(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(i=(n=o.session)===null||n===void 0?void 0:n.access_token)!==null&&i!==void 0?i:void 0,xform:Q})})}catch(t){if(k(t))return _n(t)&&(await this._removeSession(),await Re(this.storage,`${this.storageKey}-code-verifier`)),{data:{user:null},error:t};throw t}}async updateUser(e,t={}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._updateUser(e,t))}async _updateUser(e,t={}){try{return await this._useSession(async s=>{const{data:n,error:i}=s;if(i)throw i;if(!n.session)throw new G;const o=n.session;let l=null,c=null;this.flowType==="pkce"&&e.email!=null&&([l,c]=await de(this.storage,this.storageKey));const{data:d,error:u}=await E(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:t==null?void 0:t.emailRedirectTo,body:Object.assign(Object.assign({},e),{code_challenge:l,code_challenge_method:c}),jwt:o.access_token,xform:Q});if(u)throw u;return o.user=d.user,await this._saveSession(o),await this._notifyAllSubscribers("USER_UPDATED",o),{data:{user:o.user},error:null}})}catch(s){if(k(s))return{data:{user:null},error:s};throw s}}async setSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._setSession(e))}async _setSession(e){try{if(!e.access_token||!e.refresh_token)throw new G;const t=Date.now()/1e3;let s=t,n=!0,i=null;const{payload:o}=et(e.access_token);if(o.exp&&(s=o.exp,n=s<=t),n){const{session:l,error:c}=await this._callRefreshToken(e.refresh_token);if(c)return{data:{user:null,session:null},error:c};if(!l)return{data:{user:null,session:null},error:null};i=l}else{const{data:l,error:c}=await this._getUser(e.access_token);if(c)throw c;i={access_token:e.access_token,refresh_token:e.refresh_token,user:l.user,token_type:"bearer",expires_in:s-t,expires_at:s},await this._saveSession(i),await this._notifyAllSubscribers("SIGNED_IN",i)}return{data:{user:i.user,session:i},error:null}}catch(t){if(k(t))return{data:{session:null,user:null},error:t};throw t}}async refreshSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._refreshSession(e))}async _refreshSession(e){try{return await this._useSession(async t=>{var s;if(!e){const{data:o,error:l}=t;if(l)throw l;e=(s=o.session)!==null&&s!==void 0?s:void 0}if(!(e!=null&&e.refresh_token))throw new G;const{session:n,error:i}=await this._callRefreshToken(e.refresh_token);return i?{data:{user:null,session:null},error:i}:n?{data:{user:n.user,session:n},error:null}:{data:{user:null,session:null},error:null}})}catch(t){if(k(t))return{data:{user:null,session:null},error:t};throw t}}async _getSessionFromURL(e,t){try{if(!M())throw new Ce("No browser detected.");if(e.error||e.error_description||e.error_code)throw new Ce(e.error_description||"Error in URL with unspecified error_description",{error:e.error||"unspecified_error",code:e.error_code||"unspecified_code"});switch(t){case"implicit":if(this.flowType==="pkce")throw new Rt("Not a valid PKCE flow url.");break;case"pkce":if(this.flowType==="implicit")throw new Ce("Not a valid implicit grant flow url.");break;default:}if(t==="pkce"){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!e.code)throw new Rt("No code detected.");const{data:v,error:y}=await this._exchangeCodeForSession(e.code);if(y)throw y;const S=new URL(window.location.href);return S.searchParams.delete("code"),window.history.replaceState(window.history.state,"",S.toString()),{data:{session:v.session,redirectType:null},error:null}}const{provider_token:s,provider_refresh_token:n,access_token:i,refresh_token:o,expires_in:l,expires_at:c,token_type:d}=e;if(!i||!l||!o||!d)throw new Ce("No session defined in URL");const u=Math.round(Date.now()/1e3),h=parseInt(l);let f=u+h;c&&(f=parseInt(c));const m=f-u;m*1e3<=fe&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${m}s, should have been closer to ${h}s`);const g=f-h;u-g>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",g,f,u):u-g<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",g,f,u);const{data:p,error:w}=await this._getUser(i);if(w)throw w;const x={provider_token:s,provider_refresh_token:n,access_token:i,expires_in:h,expires_at:f,refresh_token:o,token_type:d,user:p.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),{data:{session:x,redirectType:e.type},error:null}}catch(s){if(k(s))return{data:{session:null,redirectType:null},error:s};throw s}}_isImplicitGrantCallback(e){return!!(e.access_token||e.error_description)}async _isPKCECallback(e){const t=await Ie(this.storage,`${this.storageKey}-code-verifier`);return!!(e.code&&t)}async signOut(e={scope:"global"}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._signOut(e))}async _signOut({scope:e}={scope:"global"}){return await this._useSession(async t=>{var s;const{data:n,error:i}=t;if(i)return{error:i};const o=(s=n.session)===null||s===void 0?void 0:s.access_token;if(o){const{error:l}=await this.admin.signOut(o,e);if(l&&!(xn(l)&&(l.status===404||l.status===401||l.status===403)))return{error:l}}return e!=="others"&&(await this._removeSession(),await Re(this.storage,`${this.storageKey}-code-verifier`)),{error:null}})}onAuthStateChange(e){const t=$n(),s={id:t,callback:e,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",t),this.stateChangeEmitters.delete(t)}};return this._debug("#onAuthStateChange()","registered callback with id",t),this.stateChangeEmitters.set(t,s),(async()=>(await this.initializePromise,await this._acquireLock(-1,async()=>{this._emitInitialSession(t)})))(),{data:{subscription:s}}}async _emitInitialSession(e){return await this._useSession(async t=>{var s,n;try{const{data:{session:i},error:o}=t;if(o)throw o;await((s=this.stateChangeEmitters.get(e))===null||s===void 0?void 0:s.callback("INITIAL_SESSION",i)),this._debug("INITIAL_SESSION","callback id",e,"session",i)}catch(i){await((n=this.stateChangeEmitters.get(e))===null||n===void 0?void 0:n.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",e,"error",i),console.error(i)}})}async resetPasswordForEmail(e,t={}){let s=null,n=null;this.flowType==="pkce"&&([s,n]=await de(this.storage,this.storageKey,!0));try{return await E(this.fetch,"POST",`${this.url}/recover`,{body:{email:e,code_challenge:s,code_challenge_method:n,gotrue_meta_security:{captcha_token:t.captchaToken}},headers:this.headers,redirectTo:t.redirectTo})}catch(i){if(k(i))return{data:null,error:i};throw i}}async getUserIdentities(){var e;try{const{data:t,error:s}=await this.getUser();if(s)throw s;return{data:{identities:(e=t.user.identities)!==null&&e!==void 0?e:[]},error:null}}catch(t){if(k(t))return{data:null,error:t};throw t}}async linkIdentity(e){var t;try{const{data:s,error:n}=await this._useSession(async i=>{var o,l,c,d,u;const{data:h,error:f}=i;if(f)throw f;const m=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,e.provider,{redirectTo:(o=e.options)===null||o===void 0?void 0:o.redirectTo,scopes:(l=e.options)===null||l===void 0?void 0:l.scopes,queryParams:(c=e.options)===null||c===void 0?void 0:c.queryParams,skipBrowserRedirect:!0});return await E(this.fetch,"GET",m,{headers:this.headers,jwt:(u=(d=h.session)===null||d===void 0?void 0:d.access_token)!==null&&u!==void 0?u:void 0})});if(n)throw n;return M()&&!(!((t=e.options)===null||t===void 0)&&t.skipBrowserRedirect)&&window.location.assign(s==null?void 0:s.url),{data:{provider:e.provider,url:s==null?void 0:s.url},error:null}}catch(s){if(k(s))return{data:{provider:e.provider,url:null},error:s};throw s}}async unlinkIdentity(e){try{return await this._useSession(async t=>{var s,n;const{data:i,error:o}=t;if(o)throw o;return await E(this.fetch,"DELETE",`${this.url}/user/identities/${e.identity_id}`,{headers:this.headers,jwt:(n=(s=i.session)===null||s===void 0?void 0:s.access_token)!==null&&n!==void 0?n:void 0})})}catch(t){if(k(t))return{data:null,error:t};throw t}}async _refreshAccessToken(e){const t=`#_refreshAccessToken(${e.substring(0,5)}...)`;this._debug(t,"begin");try{const s=Date.now();return await Un(async n=>(n>0&&await Rn(200*Math.pow(2,n-1)),this._debug(t,"refreshing attempt",n),await E(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:e},headers:this.headers,xform:H})),(n,i)=>{const o=200*Math.pow(2,n);return i&&Ze(i)&&Date.now()+o-s<fe})}catch(s){if(this._debug(t,"error",s),k(s))return{data:{session:null,user:null},error:s};throw s}finally{this._debug(t,"end")}}_isValidSession(e){return typeof e=="object"&&e!==null&&"access_token"in e&&"refresh_token"in e&&"expires_at"in e}async _handleProviderSignIn(e,t){const s=await this._getUrlForProvider(`${this.url}/authorize`,e,{redirectTo:t.redirectTo,scopes:t.scopes,queryParams:t.queryParams});return this._debug("#_handleProviderSignIn()","provider",e,"options",t,"url",s),M()&&!t.skipBrowserRedirect&&window.location.assign(s),{data:{provider:e,url:s},error:null}}async _recoverAndRefresh(){var e;const t="#_recoverAndRefresh()";this._debug(t,"begin");try{const s=await Ie(this.storage,this.storageKey);if(this._debug(t,"session from storage",s),!this._isValidSession(s)){this._debug(t,"session is not valid"),s!==null&&await this._removeSession();return}const n=((e=s.expires_at)!==null&&e!==void 0?e:1/0)*1e3-Date.now()<Xe;if(this._debug(t,`session has${n?"":" not"} expired with margin of ${Xe}s`),n){if(this.autoRefreshToken&&s.refresh_token){const{error:i}=await this._callRefreshToken(s.refresh_token);i&&(console.error(i),Ze(i)||(this._debug(t,"refresh failed with a non-retryable error, removing the session",i),await this._removeSession()))}}else await this._notifyAllSubscribers("SIGNED_IN",s)}catch(s){this._debug(t,"error",s),console.error(s);return}finally{this._debug(t,"end")}}async _callRefreshToken(e){var t,s;if(!e)throw new G;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const n=`#_callRefreshToken(${e.substring(0,5)}...)`;this._debug(n,"begin");try{this.refreshingDeferred=new Ke;const{data:i,error:o}=await this._refreshAccessToken(e);if(o)throw o;if(!i.session)throw new G;await this._saveSession(i.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",i.session);const l={session:i.session,error:null};return this.refreshingDeferred.resolve(l),l}catch(i){if(this._debug(n,"error",i),k(i)){const o={session:null,error:i};return Ze(i)||await this._removeSession(),(t=this.refreshingDeferred)===null||t===void 0||t.resolve(o),o}throw(s=this.refreshingDeferred)===null||s===void 0||s.reject(i),i}finally{this.refreshingDeferred=null,this._debug(n,"end")}}async _notifyAllSubscribers(e,t,s=!0){const n=`#_notifyAllSubscribers(${e})`;this._debug(n,"begin",t,`broadcast = ${s}`);try{this.broadcastChannel&&s&&this.broadcastChannel.postMessage({event:e,session:t});const i=[],o=Array.from(this.stateChangeEmitters.values()).map(async l=>{try{await l.callback(e,t)}catch(c){i.push(c)}});if(await Promise.all(o),i.length>0){for(let l=0;l<i.length;l+=1)console.error(i[l]);throw i[0]}}finally{this._debug(n,"end")}}async _saveSession(e){this._debug("#_saveSession()",e),this.suppressGetSessionWarning=!0,await ws(this.storage,this.storageKey,e)}async _removeSession(){this._debug("#_removeSession()"),await Re(this.storage,this.storageKey),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const e=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{e&&M()&&(window!=null&&window.removeEventListener)&&window.removeEventListener("visibilitychange",e)}catch(t){console.error("removing visibilitychange callback failed",t)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const e=setInterval(()=>this._autoRefreshTokenTick(),fe);this.autoRefreshTicker=e,e&&typeof e=="object"&&typeof e.unref=="function"?e.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(e),setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const e=this.autoRefreshTicker;this.autoRefreshTicker=null,e&&clearInterval(e)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const e=Date.now();try{return await this._useSession(async t=>{const{data:{session:s}}=t;if(!s||!s.refresh_token||!s.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const n=Math.floor((s.expires_at*1e3-e)/fe);this._debug("#_autoRefreshTokenTick()",`access token expires in ${n} ticks, a tick lasts ${fe}ms, refresh threshold is ${ut} ticks`),n<=ut&&await this._callRefreshToken(s.refresh_token)})}catch(t){console.error("Auto refresh tick failed with error. This is likely a transient error.",t)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(e){if(e.isAcquireTimeout||e instanceof vs)this._debug("auto refresh token tick lock not available");else throw e}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!M()||!(window!=null&&window.addEventListener))return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),window==null||window.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(e){console.error("_handleVisibilityChange",e)}}async _onVisibilityChanged(e){const t=`#_onVisibilityChanged(${e})`;this._debug(t,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),e||(await this.initializePromise,await this._acquireLock(-1,async()=>{if(document.visibilityState!=="visible"){this._debug(t,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(e,t,s){const n=[`provider=${encodeURIComponent(t)}`];if(s!=null&&s.redirectTo&&n.push(`redirect_to=${encodeURIComponent(s.redirectTo)}`),s!=null&&s.scopes&&n.push(`scopes=${encodeURIComponent(s.scopes)}`),this.flowType==="pkce"){const[i,o]=await de(this.storage,this.storageKey),l=new URLSearchParams({code_challenge:`${encodeURIComponent(i)}`,code_challenge_method:`${encodeURIComponent(o)}`});n.push(l.toString())}if(s!=null&&s.queryParams){const i=new URLSearchParams(s.queryParams);n.push(i.toString())}return s!=null&&s.skipBrowserRedirect&&n.push(`skip_http_redirect=${s.skipBrowserRedirect}`),`${e}?${n.join("&")}`}async _unenroll(e){try{return await this._useSession(async t=>{var s;const{data:n,error:i}=t;return i?{data:null,error:i}:await E(this.fetch,"DELETE",`${this.url}/factors/${e.factorId}`,{headers:this.headers,jwt:(s=n==null?void 0:n.session)===null||s===void 0?void 0:s.access_token})})}catch(t){if(k(t))return{data:null,error:t};throw t}}async _enroll(e){try{return await this._useSession(async t=>{var s,n;const{data:i,error:o}=t;if(o)return{data:null,error:o};const l=Object.assign({friendly_name:e.friendlyName,factor_type:e.factorType},e.factorType==="phone"?{phone:e.phone}:{issuer:e.issuer}),{data:c,error:d}=await E(this.fetch,"POST",`${this.url}/factors`,{body:l,headers:this.headers,jwt:(s=i==null?void 0:i.session)===null||s===void 0?void 0:s.access_token});return d?{data:null,error:d}:(e.factorType==="totp"&&(!((n=c==null?void 0:c.totp)===null||n===void 0)&&n.qr_code)&&(c.totp.qr_code=`data:image/svg+xml;utf-8,${c.totp.qr_code}`),{data:c,error:null})})}catch(t){if(k(t))return{data:null,error:t};throw t}}async _verify(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var s;const{data:n,error:i}=t;if(i)return{data:null,error:i};const{data:o,error:l}=await E(this.fetch,"POST",`${this.url}/factors/${e.factorId}/verify`,{body:{code:e.code,challenge_id:e.challengeId},headers:this.headers,jwt:(s=n==null?void 0:n.session)===null||s===void 0?void 0:s.access_token});return l?{data:null,error:l}:(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+o.expires_in},o)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",o),{data:o,error:l})})}catch(t){if(k(t))return{data:null,error:t};throw t}})}async _challenge(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var s;const{data:n,error:i}=t;return i?{data:null,error:i}:await E(this.fetch,"POST",`${this.url}/factors/${e.factorId}/challenge`,{body:{channel:e.channel},headers:this.headers,jwt:(s=n==null?void 0:n.session)===null||s===void 0?void 0:s.access_token})})}catch(t){if(k(t))return{data:null,error:t};throw t}})}async _challengeAndVerify(e){const{data:t,error:s}=await this._challenge({factorId:e.factorId});return s?{data:null,error:s}:await this._verify({factorId:e.factorId,challengeId:t.id,code:e.code})}async _listFactors(){const{data:{user:e},error:t}=await this.getUser();if(t)return{data:null,error:t};const s=(e==null?void 0:e.factors)||[],n=s.filter(o=>o.factor_type==="totp"&&o.status==="verified"),i=s.filter(o=>o.factor_type==="phone"&&o.status==="verified");return{data:{all:s,totp:n,phone:i},error:null}}async _getAuthenticatorAssuranceLevel(){return this._acquireLock(-1,async()=>await this._useSession(async e=>{var t,s;const{data:{session:n},error:i}=e;if(i)return{data:null,error:i};if(!n)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:o}=et(n.access_token);let l=null;o.aal&&(l=o.aal);let c=l;((s=(t=n.user.factors)===null||t===void 0?void 0:t.filter(h=>h.status==="verified"))!==null&&s!==void 0?s:[]).length>0&&(c="aal2");const u=o.amr||[];return{data:{currentLevel:l,nextLevel:c,currentAuthenticationMethods:u},error:null}}))}async fetchJwk(e,t={keys:[]}){let s=t.keys.find(o=>o.kid===e);if(s||(s=this.jwks.keys.find(o=>o.kid===e),s&&this.jwks_cached_at+vn>Date.now()))return s;const{data:n,error:i}=await E(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(i)throw i;if(!n.keys||n.keys.length===0)throw new _e("JWKS is empty");if(this.jwks=n,this.jwks_cached_at=Date.now(),s=n.keys.find(o=>o.kid===e),!s)throw new _e("No matching signing key found in JWKS");return s}async getClaims(e,t={keys:[]}){try{let s=e;if(!s){const{data:m,error:g}=await this.getSession();if(g||!m.session)return{data:null,error:g};s=m.session.access_token}const{header:n,payload:i,signature:o,raw:{header:l,payload:c}}=et(s);if(Fn(i.exp),!n.kid||n.alg==="HS256"||!("crypto"in globalThis&&"subtle"in globalThis.crypto)){const{error:m}=await this.getUser(s);if(m)throw m;return{data:{claims:i,header:n,signature:o},error:null}}const d=zn(n.alg),u=await this.fetchJwk(n.kid,t),h=await crypto.subtle.importKey("jwk",u,d,!0,["verify"]);if(!await crypto.subtle.verify(d,h,o,Pn(`${l}.${c}`)))throw new _e("Invalid JWT signature");return{data:{claims:i,header:n,signature:o},error:null}}catch(s){if(k(s))return{data:null,error:s};throw s}}}Se.nextInstanceID=0;const oi=Se;class li extends oi{constructor(e){super(e)}}var ci=function(r,e,t,s){function n(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function l(u){try{d(s.next(u))}catch(h){o(h)}}function c(u){try{d(s.throw(u))}catch(h){o(h)}}function d(u){u.done?i(u.value):n(u.value).then(l,c)}d((s=s.apply(r,e||[])).next())})};class di{constructor(e,t,s){var n,i,o;if(this.supabaseUrl=e,this.supabaseKey=t,!e)throw new Error("supabaseUrl is required.");if(!t)throw new Error("supabaseKey is required.");const l=fn(e),c=new URL(l);this.realtimeUrl=new URL("realtime/v1",c),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",c),this.storageUrl=new URL("storage/v1",c),this.functionsUrl=new URL("functions/v1",c);const d=`sb-${c.hostname.split(".")[0]}-auth-token`,u={db:nn,realtime:on,auth:Object.assign(Object.assign({},an),{storageKey:d}),global:rn},h=mn(s??{},u);this.storageKey=(n=h.auth.storageKey)!==null&&n!==void 0?n:"",this.headers=(i=h.global.headers)!==null&&i!==void 0?i:{},h.accessToken?(this.accessToken=h.accessToken,this.auth=new Proxy({},{get:(f,m)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(m)} is not possible`)}})):this.auth=this._initSupabaseAuthClient((o=h.auth)!==null&&o!==void 0?o:{},this.headers,h.global.fetch),this.fetch=un(t,this._getAccessToken.bind(this),h.global.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers,accessToken:this._getAccessToken.bind(this)},h.realtime)),this.rest=new Nr(new URL("rest/v1",c).href,{headers:this.headers,schema:h.db.schema,fetch:this.fetch}),h.accessToken||this._listenForAuthEvents()}get functions(){return new sr(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}get storage(){return new en(this.storageUrl.href,this.headers,this.fetch)}from(e){return this.rest.from(e)}schema(e){return this.rest.schema(e)}rpc(e,t={},s={}){return this.rest.rpc(e,t,s)}channel(e,t={config:{}}){return this.realtime.channel(e,t)}getChannels(){return this.realtime.getChannels()}removeChannel(e){return this.realtime.removeChannel(e)}removeAllChannels(){return this.realtime.removeAllChannels()}_getAccessToken(){var e,t;return ci(this,void 0,void 0,function*(){if(this.accessToken)return yield this.accessToken();const{data:s}=yield this.auth.getSession();return(t=(e=s.session)===null||e===void 0?void 0:e.access_token)!==null&&t!==void 0?t:null})}_initSupabaseAuthClient({autoRefreshToken:e,persistSession:t,detectSessionInUrl:s,storage:n,storageKey:i,flowType:o,lock:l,debug:c},d,u){const h={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new li({url:this.authUrl.href,headers:Object.assign(Object.assign({},h),d),storageKey:i,autoRefreshToken:e,persistSession:t,detectSessionInUrl:s,storage:n,flowType:o,lock:l,debug:c,fetch:u,hasCustomAuthorizationHeader:"Authorization"in this.headers})}_initRealtimeClient(e){return new Mr(this.realtimeUrl.href,Object.assign(Object.assign({},e),{params:Object.assign({apikey:this.supabaseKey},e==null?void 0:e.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((t,s)=>{this._handleTokenChanged(t,"CLIENT",s==null?void 0:s.access_token)})}_handleTokenChanged(e,t,s){(e==="TOKEN_REFRESHED"||e==="SIGNED_IN")&&this.changedAccessToken!==s?this.changedAccessToken=s:e==="SIGNED_OUT"&&(this.realtime.setAuth(),t=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}}const ui=(r,e,t)=>new di(r,e,t),hi="https://pgmdmedvdfukqvyistvf.supabase.co",fi="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InBnbWRtZWR2ZGZ1a3F2eWlzdHZmIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTEzNTQyNjIsImV4cCI6MjA2NjkzMDI2Mn0.x6jNBCNBh86qpjPs5kGKIIK_sE4T6XXbfYeBk6AvUHM",I=ui(hi,fi),bs=_.createContext(void 0),ne=()=>{const r=_.useContext(bs);if(!r)throw new Error("useAuth must be used within an AuthProvider");return r},mi=({children:r})=>{const[e,t]=_.useState(null),[s,n]=_.useState(!0),{isOnline:i}=Vt();_.useEffect(()=>{const u=async()=>{n(!0);try{const f=localStorage.getItem("user");if(f){const m=JSON.parse(f);t(m),await Z.saveData("user",m)}else if(!i){const m=await Z.getData("user","user1");m&&t(m)}}catch(f){console.error("Failed to load user data:",f)}finally{n(!1)}},{data:{subscription:h}}=I.auth.onAuthStateChange(async(f,m)=>{m!=null&&m.user?console.log("User signed in:",m.user):console.log("User signed out")});return u(),()=>{h.unsubscribe()}},[i]);const o=async(u,h)=>{if(u==="test@gmail.com"&&h==="12345677"){const f={id:"user1",email:u,fullName:"Demo User",isAdmin:!1,walletBalance:1e3,createdAt:new Date};return t(f),localStorage.setItem("user",JSON.stringify(f)),await Z.saveData("user",f),!0}else if(u==="Admin@admin.com"&&h==="9794478972"){const f={id:"admin1",email:u,fullName:"System Admin",isAdmin:!0,walletBalance:0,createdAt:new Date};return t(f),localStorage.setItem("user",JSON.stringify(f)),await Z.saveData("user",f),!0}return!1},l=async u=>{try{const h={id:`user_${Date.now()}`,email:u.email,fullName:u.fullName,phone:u.phone,isAdmin:!1,walletBalance:0,createdAt:new Date};return t(h),localStorage.setItem("user",JSON.stringify(h)),await Z.saveData("user",h),!0}catch(h){return console.error("Signup failed:",h),!1}},c=()=>{t(null),localStorage.removeItem("user")},d=u=>{if(e){const h={...e,walletBalance:e.walletBalance+u};t(h),localStorage.setItem("user",JSON.stringify(h)),Z.saveData("user",h),i||Z.saveOfflineAction({type:"updateWallet",data:{userId:e.id,amount:u}})}};return a.jsx(bs.Provider,{value:{user:e,loading:s,login:o,signup:l,logout:c,updateWallet:d},children:r})},xs=_.createContext(void 0),ie=()=>{const r=_.useContext(xs);if(!r)throw new Error("useApp must be used within an AppProvider");return r},gi=({children:r})=>{const{user:e}=ne(),[t,s]=_.useState([]),[n,i]=_.useState([]),[o,l]=_.useState([]),[c,d]=_.useState([]),[u,h]=_.useState([]),[f,m]=_.useState(!0);_.useEffect(()=>{e&&g()},[e]),_.useEffect(()=>{if(!e)return;const j=I.channel("sessions_changes").on("postgres_changes",{event:"*",schema:"public",table:"sessions"},()=>{p()}).subscribe(),N=I.channel("bets_changes").on("postgres_changes",{event:"*",schema:"public",table:"bets"},()=>{w()}).subscribe(),T=I.channel("results_changes").on("postgres_changes",{event:"*",schema:"public",table:"results"},()=>{x()}).subscribe();return()=>{j.unsubscribe(),N.unsubscribe(),T.unsubscribe()}},[e]);const g=async()=>{m(!0),await Promise.all([p(),w(),x(),v(),y()]),m(!1)},p=async()=>{try{const{data:j,error:N}=await I.from("sessions").select("*").order("created_at",{ascending:!1});if(N)throw N;const T=j.map(b=>({id:b.id,name:b.name,time:b.time,date:b.date,isActive:b.is_active,betsCloseAt:b.bets_close_at,totalPool:Number(b.total_pool),createdBy:b.created_by}));s(T)}catch(j){console.error("Error loading sessions:",j)}},w=async()=>{try{const{data:j,error:N}=await I.from("bets").select("*").order("created_at",{ascending:!1});if(N)throw N;const T=j.map(b=>({id:b.id,userId:b.user_id,sessionId:b.session_id,number:b.number,amount:Number(b.amount),timestamp:new Date(b.created_at)}));i(T)}catch(j){console.error("Error loading bets:",j)}},x=async()=>{try{const{data:j,error:N}=await I.from("results").select("*").order("created_at",{ascending:!1});if(N)throw N;const T=j.map(b=>({id:b.id,sessionId:b.session_id,winningNumber:b.winning_number,totalPool:Number(b.total_pool),adminFee:Number(b.admin_fee),winnerCount:b.winner_count,winnerPayout:Number(b.winner_payout),timestamp:new Date(b.created_at),isZeroBetWin:b.is_zero_bet_win}));l(T)}catch(j){console.error("Error loading results:",j)}},v=async()=>{if(e)try{const{data:j,error:N}=await I.from("transactions").select("*").eq("user_id",e.id).order("created_at",{ascending:!1});if(N)throw N;const T=j.map(b=>({id:b.id,userId:b.user_id,type:b.type,amount:Number(b.amount),status:b.status,timestamp:new Date(b.created_at),description:b.description}));d(T)}catch(j){console.error("Error loading transactions:",j)}},y=async()=>{try{let j=I.from("withdrawals").select("*");e&&!e.isAdmin&&(j=j.eq("user_id",e.id));const{data:N,error:T}=await j.order("requested_at",{ascending:!1});if(T)throw T;const b=N.map(A=>({id:A.id,userId:A.user_id,amount:Number(A.amount),status:A.status,requestedAt:new Date(A.requested_at),processedAt:A.processed_at?new Date(A.processed_at):void 0,processedBy:A.processed_by||void 0}));h(b)}catch(j){console.error("Error loading withdrawals:",j)}},S=async(j,N)=>{if(e!=null&&e.isAdmin)try{const T=F(new Date,"yyyy-MM-dd"),b=F(Es(new Date(`${T}T${j}:00`),-5),"HH:mm"),{error:A}=await I.from("sessions").insert({name:N,time:j,date:T,is_active:!0,bets_close_at:b,total_pool:0,created_by:"admin"});if(A)throw A}catch(T){console.error("Error creating session:",T)}},$=async(j,N,T)=>{if(!e)return!1;try{const b=t.find(z=>z.id===j);if(!b)return!1;const A=new Date,K=F(A,"yyyy-MM-dd"),X=new Date(`${K}T${b.betsCloseAt}:00`);if(Ue(A,X))return!1;const{error:ye}=await I.from("bets").insert({user_id:e.id,session_id:j,number:N,amount:T});if(ye)throw ye;const{error:ae}=await I.from("sessions").update({total_pool:b.totalPool+T}).eq("id",j);if(ae)throw ae;return!0}catch(b){return console.error("Error placing bet:",b),!1}},P=async j=>{if(e!=null&&e.isAdmin)try{const N=t.find(C=>C.id===j),T=n.filter(C=>C.sessionId===j);if(!N||T.length===0)return;const b={};for(let C=0;C<=9;C++)b[C]=0;T.forEach(C=>{b[C.number]+=C.amount});let A=0,K=b[0];for(let C=1;C<=9;C++)b[C]<K&&(A=C,K=b[C]);const X=N.totalPool,ye=K===0&&X>0;let ae,z,oe;if(ye)ae=X,z=0,oe=0;else{ae=X*.1;const C=X*.9;oe=T.filter(Pe=>Pe.number===A).length,z=oe>0?C/oe:0}const{error:xt}=await I.from("results").insert({session_id:j,winning_number:A,total_pool:X,admin_fee:ae,winner_count:oe,winner_payout:z,is_zero_bet_win:ye});if(xt)throw xt;const{error:_t}=await I.from("sessions").update({is_active:!1}).eq("id",j);if(_t)throw _t;if(oe>0&&z>0){const C=T.filter(le=>le.number===A);for(const le of C){const{data:Pe}=await I.from("users").select("wallet_balance").eq("id",le.userId).single();Pe&&(await I.from("users").update({wallet_balance:Number(Pe.wallet_balance)+z}).eq("id",le.userId),await I.from("transactions").insert({user_id:le.userId,type:"win",amount:z,status:"completed",description:`Won ${z} on number ${A}`}))}}}catch(N){console.error("Error processing jackpot:",N)}},U=async j=>{if(e)try{const{error:N}=await I.from("transactions").insert({user_id:j.userId,type:j.type,amount:j.amount,status:j.status,description:j.description});if(N)throw N}catch(N){console.error("Error adding transaction:",N)}},Ge=async j=>{if(e)try{const{error:N}=await I.from("withdrawals").insert({user_id:e.id,amount:j,status:"pending"});if(N)throw N}catch(N){console.error("Error requesting withdrawal:",N)}},Ve=async(j,N)=>{if(e!=null&&e.isAdmin)try{const{error:T}=await I.from("withdrawals").update({status:N,processed_at:new Date().toISOString(),processed_by:e.id}).eq("id",j);if(T)throw T}catch(T){console.error("Error processing withdrawal:",T)}};return a.jsx(xs.Provider,{value:{sessions:t,bets:n,results:o,transactions:c,withdrawals:u,loading:f,createSession:S,placeBet:$,processJackpot:P,addTransaction:U,requestWithdrawal:Ge,processWithdrawal:Ve},children:r})},pi=()=>{const[r,e]=_.useState("login"),[t,s]=_.useState("email"),[n,i]=_.useState(""),[o,l]=_.useState(""),[c,d]=_.useState(""),[u,h]=_.useState(""),[f,m]=_.useState(""),[g,p]=_.useState(!1),[w,x]=_.useState(!1),[v,y]=_.useState(""),[S,$]=_.useState(!1),{login:P,signup:U}=ne(),Ge=()=>{if(r==="signup"){if(!f.trim())return y("Full name is required"),!1;if(c.length<6)return y("Password must be at least 6 characters long"),!1;if(c!==u)return y("Passwords do not match"),!1;if(t==="email"&&!n.includes("@"))return y("Please enter a valid email address"),!1;if(t==="phone"&&o.length<10)return y("Please enter a valid phone number"),!1}return!0},Ve=async b=>{if(b.preventDefault(),y(""),!!Ge()){$(!0);try{if(r==="login")await P(n,c)||y("Invalid credentials. Please check your email and password.");else{const A={fullName:f,email:t==="email"?n:`${o}@phone.local`,phone:t==="phone"?o:"",password:c};await U(A)||y("Registration failed. Email may already be in use.")}}catch{y(r==="login"?"Login failed":"Registration failed")}finally{$(!1)}}},j=()=>{i(""),l(""),d(""),h(""),m(""),y("")},N=b=>{e(b),j()},T=async(b,A)=>{$(!0),y("");try{await P(b,A)||y("Demo login failed. Please try again.")}catch{y("Demo login failed")}finally{$(!1)}};return a.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 flex items-center justify-center p-4",children:a.jsxs("div",{className:"bg-white rounded-2xl shadow-xl w-full max-w-md p-8",children:[a.jsxs("div",{className:"text-center mb-8",children:[a.jsx("h1",{className:"text-3xl font-bold text-gray-800 mb-2",children:"LuckyPick"}),a.jsx("p",{className:"text-gray-600",children:"Daily Number Lottery"})]}),a.jsxs("div",{className:"flex mb-6 bg-gray-100 rounded-lg p-1",children:[a.jsx("button",{type:"button",onClick:()=>N("login"),className:`flex-1 py-2 px-4 rounded-md text-sm font-medium transition-colors ${r==="login"?"bg-white text-blue-600 shadow-sm":"text-gray-600 hover:text-gray-800"}`,children:"Sign In"}),a.jsx("button",{type:"button",onClick:()=>N("signup"),className:`flex-1 py-2 px-4 rounded-md text-sm font-medium transition-colors ${r==="signup"?"bg-white text-blue-600 shadow-sm":"text-gray-600 hover:text-gray-800"}`,children:"Sign Up"})]}),r==="signup"&&a.jsxs("div",{className:"flex mb-6 bg-gray-100 rounded-lg p-1",children:[a.jsxs("button",{type:"button",onClick:()=>s("email"),className:`flex-1 py-2 px-4 rounded-md text-sm font-medium transition-colors ${t==="email"?"bg-white text-blue-600 shadow-sm":"text-gray-600 hover:text-gray-800"}`,children:[a.jsx(jt,{className:"w-4 h-4 inline mr-2"}),"Email"]}),a.jsxs("button",{type:"button",onClick:()=>s("phone"),className:`flex-1 py-2 px-4 rounded-md text-sm font-medium transition-colors ${t==="phone"?"bg-white text-blue-600 shadow-sm":"text-gray-600 hover:text-gray-800"}`,children:[a.jsx(kt,{className:"w-4 h-4 inline mr-2"}),"Phone"]})]}),a.jsxs("form",{onSubmit:Ve,className:"space-y-4",children:[r==="signup"&&a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Full Name"}),a.jsxs("div",{className:"relative",children:[a.jsx(Ps,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"}),a.jsx("input",{type:"text",value:f,onChange:b=>m(b.target.value),className:"w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Enter your full name",required:!0})]})]}),r==="login"||t==="email"?a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Email Address"}),a.jsxs("div",{className:"relative",children:[a.jsx(jt,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"}),a.jsx("input",{type:"email",value:n,onChange:b=>i(b.target.value),className:"w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Enter your email",required:!0})]})]}):a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Phone Number"}),a.jsxs("div",{className:"relative",children:[a.jsx(kt,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"}),a.jsx("input",{type:"tel",value:o,onChange:b=>l(b.target.value),className:"w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Enter your phone number",required:!0})]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Password"}),a.jsxs("div",{className:"relative",children:[a.jsx(St,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"}),a.jsx("input",{type:g?"text":"password",value:c,onChange:b=>d(b.target.value),className:"w-full pl-10 pr-12 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:r==="signup"?"Create a password (min 6 characters)":"Enter your password",required:!0,minLength:r==="signup"?6:void 0}),a.jsx("button",{type:"button",onClick:()=>p(!g),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600",children:g?a.jsx(Nt,{className:"w-5 h-5"}):a.jsx(rt,{className:"w-5 h-5"})})]})]}),r==="signup"&&a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Confirm Password"}),a.jsxs("div",{className:"relative",children:[a.jsx(St,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"}),a.jsx("input",{type:w?"text":"password",value:u,onChange:b=>h(b.target.value),className:"w-full pl-10 pr-12 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Confirm your password",required:!0}),a.jsx("button",{type:"button",onClick:()=>x(!w),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600",children:w?a.jsx(Nt,{className:"w-5 h-5"}):a.jsx(rt,{className:"w-5 h-5"})})]})]}),v&&a.jsx("div",{className:"text-red-600 text-sm text-center bg-red-50 p-3 rounded-lg",children:v}),a.jsxs("button",{type:"submit",disabled:S,className:"w-full bg-blue-600 text-white py-3 rounded-lg font-medium hover:bg-blue-700 focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed transition-colors flex items-center justify-center",children:[S&&a.jsx(zt,{className:"w-4 h-4 mr-2 animate-spin"}),S?r==="login"?"Signing In...":"Creating Account...":r==="login"?"Sign In":"Create Account"]})]}),r==="login"&&a.jsxs("div",{className:"mt-8 p-4 bg-gray-50 rounded-lg",children:[a.jsx("h3",{className:"font-medium text-gray-800 mb-3",children:"Demo Accounts:"}),a.jsxs("div",{className:"space-y-2",children:[a.jsxs("button",{onClick:()=>T("demo@luckypick.com","demo123"),disabled:S,className:"w-full text-left p-2 bg-white rounded border hover:bg-gray-50 transition-colors disabled:opacity-50",children:[a.jsxs("div",{className:"text-sm",children:[a.jsx("strong",{children:"Demo User:"})," demo@luckypick.com"]}),a.jsx("div",{className:"text-xs text-gray-500",children:"Password: demo123"})]}),a.jsxs("button",{onClick:()=>T("admin@luckypick.com","admin123"),disabled:S,className:"w-full text-left p-2 bg-white rounded border hover:bg-gray-50 transition-colors disabled:opacity-50",children:[a.jsxs("div",{className:"text-sm",children:[a.jsx("strong",{children:"Admin:"})," admin@luckypick.com"]}),a.jsx("div",{className:"text-xs text-gray-500",children:"Password: admin123"})]})]})]}),r==="signup"&&a.jsx("div",{className:"mt-6 p-4 bg-blue-50 rounded-lg",children:a.jsxs("p",{className:"text-sm text-blue-800",children:[a.jsx("strong",{children:"Welcome to LuckyPick!"})," Create your account to start playing the daily number lottery. New users get 100 welcome bonus!"]})})]})})},yi=({sessionId:r,onClose:e})=>{const{user:t,updateWallet:s}=ne(),{sessions:n,placeBet:i,addTransaction:o}=ie(),[l,c]=_.useState(null),[d,u]=_.useState(""),[h,f]=_.useState(""),[m,g]=_.useState(!1),p=n.find(x=>x.id===r),w=async()=>{if(l===null){f("Please select a number");return}const x=parseFloat(d);if(isNaN(x)||x<1){f("Minimum bet amount is 1");return}if(!t||x>t.walletBalance){f("Insufficient wallet balance");return}g(!0),f("");try{await i(r,l,x)?(await s(-x),await o({userId:t.id,type:"bet",amount:-x,status:"completed",description:`Bet on number ${l} for session ${p==null?void 0:p.time}`}),e()):f("Failed to place bet. Betting may be closed.")}catch{f("Failed to place bet. Please try again.")}finally{g(!1)}};return a.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:a.jsxs("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-md",children:[a.jsxs("div",{className:"flex justify-between items-center p-6 border-b",children:[a.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Place Your Bet"}),a.jsx("button",{onClick:e,className:"text-gray-400 hover:text-gray-600 transition-colors",children:a.jsx(Be,{className:"w-6 h-6"})})]}),a.jsxs("div",{className:"p-6",children:[a.jsxs("div",{className:"mb-6",children:[a.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:(p==null?void 0:p.name)||`Session ${p==null?void 0:p.time}`}),a.jsx("p",{className:"text-gray-600",children:"Choose a number from 0-9"})]}),a.jsxs("div",{className:"mb-6",children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"Select Number"}),a.jsx("div",{className:"grid grid-cols-5 gap-2",children:[0,1,2,3,4,5,6,7,8,9].map(x=>a.jsx("button",{onClick:()=>c(x),className:`h-12 rounded-lg font-semibold transition-colors ${l===x?"bg-blue-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:x},x))})]}),a.jsxs("div",{className:"mb-6",children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Bet Amount ()"}),a.jsxs("div",{className:"relative",children:[a.jsx(ke,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"}),a.jsx("input",{type:"number",value:d,onChange:x=>u(x.target.value),className:"w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Enter amount (min 1)",min:"1",step:"1"})]}),a.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:["Wallet Balance: ",t==null?void 0:t.walletBalance]})]}),h&&a.jsx("div",{className:"mb-4 text-red-600 text-sm bg-red-50 p-3 rounded-lg",children:h}),a.jsxs("div",{className:"flex space-x-3",children:[a.jsx("button",{onClick:e,disabled:m,className:"flex-1 py-3 px-4 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 transition-colors disabled:opacity-50",children:"Cancel"}),a.jsx("button",{onClick:w,disabled:m,className:"flex-1 py-3 px-4 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors disabled:opacity-50",children:m?"Placing Bet...":"Place Bet"})]})]})]})})},wi=({onClose:r})=>{const{user:e,updateWallet:t}=ne(),{transactions:s,addTransaction:n,requestWithdrawal:i}=ie(),[o,l]=_.useState("balance"),[c,d]=_.useState(""),[u,h]=_.useState(""),[f,m]=_.useState(""),[g,p]=_.useState(!1),w=async()=>{const v=parseFloat(c);if(isNaN(v)||v<10){m("Minimum deposit amount is 10");return}p(!0),m("");try{e&&(await t(v),await n({userId:e.id,type:"deposit",amount:v,status:"completed",description:"Wallet deposit via UPI"}),d(""))}catch{m("Failed to add funds. Please try again.")}finally{p(!1)}},x=async()=>{const v=parseFloat(u);if(isNaN(v)||v<50){m("Minimum withdrawal amount is 50");return}if(!e||v>e.walletBalance){m("Insufficient balance");return}p(!0),m("");try{await i(v),await n({userId:e.id,type:"withdrawal",amount:-v,status:"pending",description:`Withdrawal request for ${v}`}),h("")}catch{m("Failed to request withdrawal. Please try again.")}finally{p(!1)}};return a.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:a.jsxs("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-2xl max-h-[90vh] overflow-hidden",children:[a.jsxs("div",{className:"flex justify-between items-center p-6 border-b",children:[a.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"My Wallet"}),a.jsx("button",{onClick:r,className:"text-gray-400 hover:text-gray-600 transition-colors",children:a.jsx(Be,{className:"w-6 h-6"})})]}),a.jsxs("div",{className:"flex border-b",children:[a.jsxs("button",{onClick:()=>l("balance"),className:`flex-1 py-3 px-4 text-center font-medium transition-colors ${o==="balance"?"text-blue-600 border-b-2 border-blue-600":"text-gray-600 hover:text-gray-800"}`,children:[a.jsx(As,{className:"w-4 h-4 inline mr-2"}),"Balance"]}),a.jsxs("button",{onClick:()=>l("history"),className:`flex-1 py-3 px-4 text-center font-medium transition-colors ${o==="history"?"text-blue-600 border-b-2 border-blue-600":"text-gray-600 hover:text-gray-800"}`,children:[a.jsx(Os,{className:"w-4 h-4 inline mr-2"}),"History"]})]}),a.jsxs("div",{className:"p-6 overflow-y-auto max-h-[60vh]",children:[o==="balance"&&a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{className:"text-center",children:[a.jsxs("h3",{className:"text-2xl font-bold text-gray-900",children:["",e==null?void 0:e.walletBalance]}),a.jsx("p",{className:"text-gray-600",children:"Current Balance"})]}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[a.jsxs("div",{className:"bg-green-50 rounded-lg p-4",children:[a.jsxs("h4",{className:"font-semibold text-green-800 mb-3 flex items-center",children:[a.jsx(Ht,{className:"w-4 h-4 mr-2"}),"Add Funds"]}),a.jsxs("div",{className:"space-y-3",children:[a.jsx("input",{type:"number",value:c,onChange:v=>d(v.target.value),className:"w-full px-3 py-2 border border-green-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent",placeholder:"Amount (min 10)",min:"10"}),a.jsx("button",{onClick:w,disabled:g,className:"w-full bg-green-600 text-white py-2 rounded-lg hover:bg-green-700 transition-colors disabled:opacity-50",children:g?"Processing...":"Add via UPI"})]})]}),a.jsxs("div",{className:"bg-red-50 rounded-lg p-4",children:[a.jsxs("h4",{className:"font-semibold text-red-800 mb-3 flex items-center",children:[a.jsx($s,{className:"w-4 h-4 mr-2"}),"Withdraw Funds"]}),a.jsxs("div",{className:"space-y-3",children:[a.jsx("input",{type:"number",value:u,onChange:v=>h(v.target.value),className:"w-full px-3 py-2 border border-red-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent",placeholder:"Amount (min 50)",min:"50"}),a.jsx("button",{onClick:x,disabled:g,className:"w-full bg-red-600 text-white py-2 rounded-lg hover:bg-red-700 transition-colors disabled:opacity-50",children:g?"Processing...":"Request Withdrawal"}),a.jsx("p",{className:"text-xs text-red-600",children:"Requires admin approval"})]})]})]}),f&&a.jsx("div",{className:"text-red-600 text-sm text-center bg-red-50 p-3 rounded-lg",children:f})]}),o==="history"&&a.jsx("div",{className:"space-y-4",children:s.length===0?a.jsx("p",{className:"text-gray-500 text-center",children:"No transactions yet"}):s.map(v=>a.jsxs("div",{className:"flex justify-between items-center p-3 bg-gray-50 rounded-lg",children:[a.jsxs("div",{children:[a.jsx("p",{className:"font-medium text-gray-900",children:v.description}),a.jsx("p",{className:"text-sm text-gray-600",children:F(v.timestamp,"MMM dd, yyyy HH:mm")})]}),a.jsxs("div",{className:"text-right",children:[a.jsxs("p",{className:`font-semibold ${v.amount>0?"text-green-600":"text-red-600"}`,children:[v.amount>0?"+":"","",Math.abs(v.amount)]}),a.jsx("p",{className:`text-xs ${v.status==="completed"?"text-green-600":v.status==="pending"?"text-yellow-600":"text-red-600"}`,children:v.status})]})]},v.id))})]})]})})},vi=()=>{const{user:r,logout:e}=ne(),{sessions:t,results:s,bets:n}=ie(),[i,o]=_.useState(null),[l,c]=_.useState(!1),[d,u]=_.useState(new Date);_.useEffect(()=>{const g=setInterval(()=>{u(new Date)},1e3);return()=>clearInterval(g)},[]);const h=(g,p)=>{const w=F(new Date,"yyyy-MM-dd"),x=new Date(`${w}T${p}:00`),v=new Date(`${w}T${g}:00`);if(Ue(d,v))return"Session Ended";if(Ue(d,x))return"Betting Closed";const y=x.getTime()-d.getTime(),S=Math.floor(y/6e4),$=Math.floor(y%6e4/1e3);return`${S}:${$.toString().padStart(2,"0")}`},f=g=>{const p=F(new Date,"yyyy-MM-dd"),w=new Date(`${p}T${g}:00`);return Ts(d,w)},m=g=>n.filter(p=>p.sessionId===g&&p.userId===(r==null?void 0:r.id));return a.jsxs("div",{className:"min-h-screen bg-gray-50",children:[a.jsx("header",{className:"bg-white shadow-sm border-b",children:a.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:a.jsxs("div",{className:"flex justify-between items-center h-16",children:[a.jsxs("div",{children:[a.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"LuckyPick"}),a.jsxs("p",{className:"text-sm text-gray-600",children:["Welcome, ",(r==null?void 0:r.fullName)||(r==null?void 0:r.email)]})]}),a.jsxs("div",{className:"flex items-center space-x-4",children:[a.jsxs("button",{onClick:()=>c(!0),className:"flex items-center space-x-2 bg-green-100 text-green-800 px-4 py-2 rounded-lg hover:bg-green-200 transition-colors",children:[a.jsx(Cs,{className:"w-4 h-4"}),a.jsxs("span",{children:["",r==null?void 0:r.walletBalance]})]}),a.jsxs("button",{onClick:e,className:"flex items-center space-x-2 text-gray-600 hover:text-gray-800 transition-colors",children:[a.jsx(Jt,{className:"w-4 h-4"}),a.jsx("span",{children:"Logout"})]})]})]})})}),a.jsx("main",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:a.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[a.jsxs("div",{className:"lg:col-span-2",children:[a.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-6",children:"Active Sessions"}),a.jsx("div",{className:"space-y-4",children:t.filter(g=>g.isActive).map(g=>{const p=h(g.time,g.betsCloseAt),w=f(g.betsCloseAt),x=m(g.id),v=x.reduce((y,S)=>y+S.amount,0);return a.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6",children:[a.jsxs("div",{className:"flex justify-between items-start mb-4",children:[a.jsxs("div",{children:[a.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:g.name||`Session ${g.time}`}),a.jsxs("p",{className:"text-gray-600",children:["Time: ",g.time]}),a.jsxs("p",{className:"text-sm text-gray-500",children:["Betting closes at ",g.betsCloseAt]})]}),a.jsxs("div",{className:"text-right",children:[a.jsxs("div",{className:"flex items-center text-blue-600 mb-2",children:[a.jsx(mt,{className:"w-4 h-4 mr-1"}),a.jsx("span",{className:"font-mono",children:p})]}),a.jsxs("p",{className:"text-sm text-gray-500",children:["Pool: ",g.totalPool]})]})]}),x.length>0&&a.jsxs("div",{className:"mb-4 p-3 bg-blue-50 rounded-lg",children:[a.jsxs("p",{className:"text-sm text-blue-800",children:["Your bets: ",x.map(y=>`${y.number} (${y.amount})`).join(", ")]}),a.jsxs("p",{className:"text-sm text-blue-600",children:["Total: ",v]})]}),a.jsx("button",{onClick:()=>o(g.id),disabled:!w,className:`w-full py-2 px-4 rounded-lg font-medium transition-colors ${w?"bg-blue-600 text-white hover:bg-blue-700":"bg-gray-300 text-gray-500 cursor-not-allowed"}`,children:w?"Place Bet":"Betting Closed"})]},g.id)})})]}),a.jsxs("div",{children:[a.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-6",children:"Previous Results"}),a.jsx("div",{className:"space-y-4",children:s.slice(-5).reverse().map(g=>{const p=t.find(v=>v.id===g.sessionId),x=n.filter(v=>v.sessionId===g.sessionId&&v.userId===(r==null?void 0:r.id)&&v.number===g.winningNumber).length>0;return a.jsxs("div",{className:"bg-white rounded-lg shadow-md p-4",children:[a.jsxs("div",{className:"flex justify-between items-start mb-2",children:[a.jsxs("div",{children:[a.jsx("p",{className:"font-medium text-gray-900",children:(p==null?void 0:p.name)||`Session ${p==null?void 0:p.time}`}),a.jsx("p",{className:"text-sm text-gray-600",children:F(g.timestamp,"MMM dd, HH:mm")})]}),a.jsx("div",{className:"text-right",children:a.jsxs("div",{className:"flex items-center text-yellow-600",children:[a.jsx(gt,{className:"w-4 h-4 mr-1"}),a.jsx("span",{className:"font-bold text-lg",children:g.winningNumber})]})})]}),a.jsxs("div",{className:"text-sm text-gray-600",children:[a.jsxs("p",{children:["Pool: ",g.totalPool]}),a.jsxs("p",{children:["Winners: ",g.winnerCount]}),x&&a.jsxs("p",{className:"text-green-600 font-medium",children:["You won: ",g.winnerPayout]})]})]},g.id)})})]})]})}),i&&a.jsx(yi,{sessionId:i,onClose:()=>o(null)}),l&&a.jsx(wi,{onClose:()=>c(!1)})]})},bi=()=>{const{sessions:r,bets:e,createSession:t,processJackpot:s}=ie(),[n,i]=_.useState(!1),[o,l]=_.useState(""),[c,d]=_.useState(""),[u,h]=_.useState(new Date);_.useEffect(()=>{const p=setInterval(()=>{h(new Date),r.forEach(w=>{if(w.isActive){const x=F(new Date,"yyyy-MM-dd"),v=new Date(`${x}T${w.time}:00`);Ue(u,v)&&s(w.id)}})},1e3);return()=>clearInterval(p)},[r,s,u]);const f=()=>{o&&(t(o,c||void 0),l(""),d(""),i(!1))},m=p=>e.filter(w=>w.sessionId===p),g=p=>{const w=m(p),x={};for(let v=0;v<=9;v++)x[v]=0;return w.forEach(v=>{x[v.number]+=v.amount}),x};return a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{className:"flex justify-between items-center",children:[a.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Session Management"}),a.jsxs("button",{onClick:()=>i(!0),className:"flex items-center space-x-2 bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors",children:[a.jsx(Ht,{className:"w-4 h-4"}),a.jsx("span",{children:"Create Session"})]})]}),a.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:r.map(p=>{const w=m(p.id),x=g(p.id),v=new Set(w.map(y=>y.userId)).size;return a.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6",children:[a.jsxs("div",{className:"flex justify-between items-start mb-4",children:[a.jsxs("div",{children:[a.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:p.name||`Session ${p.time}`}),a.jsxs("p",{className:"text-gray-600",children:["Time: ",p.time]}),a.jsxs("p",{className:"text-sm text-gray-500",children:["Created by: ",p.createdBy]})]}),a.jsx("div",{className:"text-right",children:a.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${p.isActive?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"}`,children:p.isActive?"Active":"Completed"})})]}),a.jsxs("div",{className:"grid grid-cols-3 gap-4 mb-4",children:[a.jsxs("div",{className:"text-center",children:[a.jsx("div",{className:"flex items-center justify-center text-blue-600 mb-1",children:a.jsx(ke,{className:"w-4 h-4 mr-1"})}),a.jsx("p",{className:"text-sm text-gray-600",children:"Total Pool"}),a.jsxs("p",{className:"font-semibold",children:["",p.totalPool]})]}),a.jsxs("div",{className:"text-center",children:[a.jsx("div",{className:"flex items-center justify-center text-green-600 mb-1",children:a.jsx(nt,{className:"w-4 h-4 mr-1"})}),a.jsx("p",{className:"text-sm text-gray-600",children:"Bettors"}),a.jsx("p",{className:"font-semibold",children:v})]}),a.jsxs("div",{className:"text-center",children:[a.jsx("div",{className:"flex items-center justify-center text-purple-600 mb-1",children:a.jsx(gt,{className:"w-4 h-4 mr-1"})}),a.jsx("p",{className:"text-sm text-gray-600",children:"Total Bets"}),a.jsx("p",{className:"font-semibold",children:w.length})]})]}),a.jsxs("div",{className:"border-t pt-4",children:[a.jsx("h4",{className:"text-sm font-medium text-gray-700 mb-2",children:"Bets by Number"}),a.jsx("div",{className:"grid grid-cols-5 gap-2",children:Object.entries(x).map(([y,S])=>a.jsxs("div",{className:"text-center p-2 bg-gray-50 rounded",children:[a.jsx("div",{className:"font-semibold text-gray-900",children:y}),a.jsxs("div",{className:"text-xs text-gray-600",children:["",S]})]},y))})]})]},p.id)})}),n&&a.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:a.jsx("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-md",children:a.jsxs("div",{className:"p-6",children:[a.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Create New Session"}),a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Session Time *"}),a.jsx("input",{type:"time",value:o,onChange:p=>l(p.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Session Name (Optional)"}),a.jsx("input",{type:"text",value:c,onChange:p=>d(p.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"e.g., Evening Special"})]})]}),a.jsxs("div",{className:"flex space-x-3 mt-6",children:[a.jsx("button",{onClick:()=>i(!1),className:"flex-1 py-2 px-4 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 transition-colors",children:"Cancel"}),a.jsx("button",{onClick:f,className:"flex-1 py-2 px-4 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:"Create Session"})]})]})})})]})},xi=()=>{const{withdrawals:r,processWithdrawal:e}=ie(),t=r.filter(o=>o.status==="pending"),s=r.filter(o=>o.status!=="pending"),n=o=>{e(o,"approved")},i=o=>{e(o,"rejected")};return a.jsxs("div",{className:"space-y-6",children:[a.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Withdrawal Management"}),a.jsxs("div",{className:"bg-white rounded-lg shadow-md",children:[a.jsx("div",{className:"px-6 py-4 border-b border-gray-200",children:a.jsxs("h3",{className:"text-lg font-semibold text-gray-900 flex items-center",children:[a.jsx(mt,{className:"w-5 h-5 mr-2 text-yellow-600"}),"Pending Withdrawals (",t.length,")"]})}),t.length===0?a.jsx("div",{className:"p-6 text-center text-gray-500",children:"No pending withdrawal requests"}):a.jsx("div",{className:"overflow-x-auto",children:a.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[a.jsx("thead",{className:"bg-gray-50",children:a.jsxs("tr",{children:[a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"User ID"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Amount"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Requested At"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),a.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:t.map(o=>a.jsxs("tr",{children:[a.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:o.userId}),a.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:["",o.amount]}),a.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:F(o.requestedAt,"MMM dd, yyyy HH:mm")}),a.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium space-x-2",children:[a.jsxs("button",{onClick:()=>n(o.id),className:"inline-flex items-center px-3 py-1 border border-transparent text-sm leading-4 font-medium rounded-md text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500",children:[a.jsx(Is,{className:"w-4 h-4 mr-1"}),"Approve"]}),a.jsxs("button",{onClick:()=>i(o.id),className:"inline-flex items-center px-3 py-1 border border-transparent text-sm leading-4 font-medium rounded-md text-white bg-red-600 hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500",children:[a.jsx(Be,{className:"w-4 h-4 mr-1"}),"Reject"]})]})]},o.id))})]})})]}),a.jsxs("div",{className:"bg-white rounded-lg shadow-md",children:[a.jsx("div",{className:"px-6 py-4 border-b border-gray-200",children:a.jsxs("h3",{className:"text-lg font-semibold text-gray-900",children:["Processed Withdrawals (",s.length,")"]})}),s.length===0?a.jsx("div",{className:"p-6 text-center text-gray-500",children:"No processed withdrawals yet"}):a.jsx("div",{className:"overflow-x-auto",children:a.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[a.jsx("thead",{className:"bg-gray-50",children:a.jsxs("tr",{children:[a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"User ID"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Amount"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Requested At"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Processed At"})]})}),a.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:s.slice().reverse().map(o=>a.jsxs("tr",{children:[a.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:o.userId}),a.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:["",o.amount]}),a.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:a.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${o.status==="approved"?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:o.status})}),a.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:F(o.requestedAt,"MMM dd, yyyy HH:mm")}),a.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:o.processedAt&&F(o.processedAt,"MMM dd, yyyy HH:mm")})]},o.id))})]})})]})]})},_i=()=>{const{bets:r,transactions:e}=ie(),[t,s]=_.useState(""),n=[{id:"user1",email:"test@gmail.com",phone:"+91 9876543210",walletBalance:1e3,isAdmin:!1,createdAt:new Date("2024-01-15")}],i=c=>r.filter(d=>d.userId===c),o=c=>e.filter(d=>d.userId===c),l=n.filter(c=>{var d;return c.email.toLowerCase().includes(t.toLowerCase())||((d=c.phone)==null?void 0:d.includes(t))});return a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{className:"flex justify-between items-center",children:[a.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"User Management"}),a.jsxs("div",{className:"relative",children:[a.jsx(Rs,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"}),a.jsx("input",{type:"text",value:t,onChange:c=>s(c.target.value),className:"pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Search users..."})]})]}),a.jsx("div",{className:"bg-white rounded-lg shadow-md overflow-hidden",children:a.jsx("div",{className:"overflow-x-auto",children:a.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[a.jsx("thead",{className:"bg-gray-50",children:a.jsxs("tr",{children:[a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"User"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Contact"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Wallet Balance"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Total Bets"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Transactions"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),a.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:l.map(c=>{const d=i(c.id),u=o(c.id),h=d.reduce((f,m)=>f+m.amount,0);return a.jsxs("tr",{children:[a.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:a.jsxs("div",{children:[a.jsx("div",{className:"text-sm font-medium text-gray-900",children:c.email}),a.jsxs("div",{className:"text-sm text-gray-500",children:["ID: ",c.id]})]})}),a.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:c.phone||"N/A"}),a.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:a.jsxs("div",{className:"flex items-center text-sm font-medium text-green-600",children:[a.jsx(ke,{className:"w-4 h-4 mr-1"}),"",c.walletBalance]})}),a.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:a.jsxs("div",{children:[a.jsxs("div",{children:[d.length," bets"]}),a.jsxs("div",{className:"text-xs text-gray-500",children:["",h," total"]})]})}),a.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:u.length}),a.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium space-x-2",children:[a.jsxs("button",{className:"text-blue-600 hover:text-blue-900 inline-flex items-center",children:[a.jsx(rt,{className:"w-4 h-4 mr-1"}),"View"]}),a.jsxs("button",{className:"text-indigo-600 hover:text-indigo-900 inline-flex items-center",children:[a.jsx(Us,{className:"w-4 h-4 mr-1"}),"Edit"]})]})]},c.id)})})]})})}),l.length===0&&a.jsx("div",{className:"text-center py-8 text-gray-500",children:"No users found matching your search."})]})},ji=()=>{const{logout:r}=ne(),{sessions:e,bets:t,results:s,withdrawals:n}=ie(),[i,o]=_.useState("overview"),l=e.reduce((f,m)=>f+m.totalPool,0),c=t.length,d=n.filter(f=>f.status==="pending").length,u=s.reduce((f,m)=>f+m.adminFee,0),h=[{id:"overview",label:"Overview",icon:Ls},{id:"sessions",label:"Sessions",icon:Ds},{id:"withdrawals",label:"Withdrawals",icon:ke},{id:"users",label:"Users",icon:nt}];return a.jsxs("div",{className:"min-h-screen bg-gray-50",children:[a.jsx("header",{className:"bg-white shadow-sm border-b",children:a.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:a.jsxs("div",{className:"flex justify-between items-center h-16",children:[a.jsxs("div",{children:[a.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Admin Panel"}),a.jsx("p",{className:"text-sm text-gray-600",children:"LuckyPick Lottery Management"})]}),a.jsxs("button",{onClick:r,className:"flex items-center space-x-2 text-gray-600 hover:text-gray-800 transition-colors",children:[a.jsx(Jt,{className:"w-4 h-4"}),a.jsx("span",{children:"Logout"})]})]})})}),a.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:a.jsxs("div",{className:"flex space-x-8",children:[a.jsx("div",{className:"w-64 bg-white rounded-lg shadow-md p-4",children:a.jsx("nav",{className:"space-y-2",children:h.map(f=>{const m=f.icon;return a.jsxs("button",{onClick:()=>o(f.id),className:`w-full flex items-center space-x-3 px-3 py-2 rounded-lg text-left transition-colors ${i===f.id?"bg-blue-100 text-blue-700":"text-gray-600 hover:bg-gray-100"}`,children:[a.jsx(m,{className:"w-5 h-5"}),a.jsx("span",{children:f.label})]},f.id)})})}),a.jsxs("div",{className:"flex-1",children:[i==="overview"&&a.jsxs("div",{className:"space-y-6",children:[a.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Dashboard Overview"}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[a.jsx("div",{className:"bg-white rounded-lg shadow-md p-6",children:a.jsxs("div",{className:"flex items-center",children:[a.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:a.jsx(ke,{className:"w-6 h-6 text-blue-600"})}),a.jsxs("div",{className:"ml-4",children:[a.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Total Pool"}),a.jsxs("p",{className:"text-2xl font-bold text-gray-900",children:["",l]})]})]})}),a.jsx("div",{className:"bg-white rounded-lg shadow-md p-6",children:a.jsxs("div",{className:"flex items-center",children:[a.jsx("div",{className:"p-2 bg-green-100 rounded-lg",children:a.jsx(gt,{className:"w-6 h-6 text-green-600"})}),a.jsxs("div",{className:"ml-4",children:[a.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Admin Earnings"}),a.jsxs("p",{className:"text-2xl font-bold text-gray-900",children:["",u]})]})]})}),a.jsx("div",{className:"bg-white rounded-lg shadow-md p-6",children:a.jsxs("div",{className:"flex items-center",children:[a.jsx("div",{className:"p-2 bg-purple-100 rounded-lg",children:a.jsx(mt,{className:"w-6 h-6 text-purple-600"})}),a.jsxs("div",{className:"ml-4",children:[a.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Total Bets"}),a.jsx("p",{className:"text-2xl font-bold text-gray-900",children:c})]})]})}),a.jsx("div",{className:"bg-white rounded-lg shadow-md p-6",children:a.jsxs("div",{className:"flex items-center",children:[a.jsx("div",{className:"p-2 bg-yellow-100 rounded-lg",children:a.jsx(nt,{className:"w-6 h-6 text-yellow-600"})}),a.jsxs("div",{className:"ml-4",children:[a.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Pending Withdrawals"}),a.jsx("p",{className:"text-2xl font-bold text-gray-900",children:d})]})]})})]}),a.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6",children:[a.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Recent Results"}),a.jsx("div",{className:"overflow-x-auto",children:a.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[a.jsx("thead",{className:"bg-gray-50",children:a.jsxs("tr",{children:[a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Session"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Winning Number"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Total Pool"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Admin Fee"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Winners"})]})}),a.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:s.slice(-5).reverse().map(f=>{const m=e.find(g=>g.id===f.sessionId);return a.jsxs("tr",{children:[a.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:(m==null?void 0:m.name)||(m==null?void 0:m.time)}),a.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:a.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800",children:f.winningNumber})}),a.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:["",f.totalPool]}),a.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-green-600",children:["",f.adminFee]}),a.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:f.winnerCount})]},f.id)})})]})})]})]}),i==="sessions"&&a.jsx(bi,{}),i==="withdrawals"&&a.jsx(xi,{}),i==="users"&&a.jsx(_i,{})]})]})})]})},ki=()=>{const[r,e]=_.useState(null),[t,s]=_.useState(!1),[n,i]=_.useState(!1);return _.useEffect(()=>{const l=window.matchMedia("(display-mode: standalone)").matches,c=window.navigator.standalone===!0;i(l||c);const d=h=>{h.preventDefault(),e(h),s(!0)},u=()=>{i(!0),s(!1),e(null)};return window.addEventListener("beforeinstallprompt",d),window.addEventListener("appinstalled",u),()=>{window.removeEventListener("beforeinstallprompt",d),window.removeEventListener("appinstalled",u)}},[]),{isInstallable:t,isInstalled:n,installApp:async()=>{if(!r)return;r.prompt();const{outcome:l}=await r.userChoice;l==="accepted"&&(e(null),s(!1))}}},Si=()=>{const{isInstallable:r,installApp:e}=ki(),[t,s]=st.useState(!1);return st.useEffect(()=>{if(r){const n=setTimeout(()=>{s(!0)},3e3);return()=>clearTimeout(n)}},[r]),!r||!t?null:a.jsx("div",{className:"fixed bottom-4 left-4 right-4 bg-blue-600 text-white p-4 rounded-lg shadow-lg z-50 md:left-auto md:right-4 md:max-w-sm",children:a.jsxs("div",{className:"flex items-start space-x-3",children:[a.jsx("div",{className:"flex-shrink-0",children:a.jsx(Bs,{className:"w-6 h-6"})}),a.jsxs("div",{className:"flex-1",children:[a.jsx("h3",{className:"font-semibold text-sm",children:"Install LuckyPick"}),a.jsx("p",{className:"text-xs text-blue-100 mt-1",children:"Add to your home screen for quick access and offline use"}),a.jsxs("div",{className:"flex space-x-2 mt-3",children:[a.jsx("button",{onClick:e,className:"bg-white text-blue-600 px-3 py-1 rounded text-xs font-medium hover:bg-blue-50 transition-colors",children:"Install"}),a.jsx("button",{onClick:()=>s(!1),className:"text-blue-100 px-3 py-1 rounded text-xs hover:text-white transition-colors",children:"Later"})]})]}),a.jsx("button",{onClick:()=>s(!1),className:"flex-shrink-0 text-blue-200 hover:text-white transition-colors",children:a.jsx(Be,{className:"w-4 h-4"})})]})})},Ni=()=>{const{isOnline:r,wasOffline:e}=Vt();return r&&!e?null:a.jsx("div",{className:`fixed top-0 left-0 right-0 z-50 p-2 text-center text-sm font-medium transition-colors ${r?"bg-green-600 text-white":"bg-red-600 text-white"}`,children:a.jsx("div",{className:"flex items-center justify-center space-x-2",children:r?a.jsxs(a.Fragment,{children:[a.jsx(qs,{className:"w-4 h-4"}),a.jsx("span",{children:"Back online - syncing data..."})]}):a.jsxs(a.Fragment,{children:[a.jsx(Ms,{className:"w-4 h-4"}),a.jsx("span",{children:"You're offline - some features may be limited"})]})})})},Ei=()=>{const{user:r,loading:e}=ne();return e?a.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 flex items-center justify-center",children:a.jsxs("div",{className:"text-center",children:[a.jsx(zt,{className:"w-8 h-8 animate-spin text-blue-600 mx-auto mb-4"}),a.jsx("p",{className:"text-gray-600",children:"Loading LuckyPick..."})]})}):r?r.isAdmin?a.jsx(ji,{}):a.jsx(vi,{}):a.jsx(pi,{})};function Ti(){return a.jsx(Ns,{children:a.jsx(mi,{children:a.jsxs(gi,{children:[a.jsx(Ni,{}),a.jsx(Ei,{}),a.jsx(Si,{})]})})})}it.createRoot(document.getElementById("root")).render(a.jsx(st.StrictMode,{children:a.jsx(Ti,{})}));
