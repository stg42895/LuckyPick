var vs=Object.defineProperty;var bs=(n,e,t)=>e in n?vs(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var Ee=(n,e,t)=>bs(n,typeof e!="symbol"?e+"":e,t);import{r as j,a as _s,g as js,c as q,b as st}from"./vendor-C1JoJ-56.js";import{B as Ns}from"./router-Cxn95ysK.js";import{f as D,i as be,a as ks,b as Ss}from"./utils-CsonoGMZ.js";import{M as Ke,P as Ve,L as vt,E as bt,a as _t,U as qt,A as Ts,X as Le,b as Es,D as z,c as Re,d as Ie,H as jt,C as Ps,W as As,e as Ft,f as _e,T as de,g as je,h as $s,i as Nt,j as rt,S as Os,Z as Ge,k as Cs,l as Is,m as Rs}from"./icons-B-vbaiFp.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const a of i)if(a.type==="childList")for(const o of a.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&s(o)}).observe(document,{childList:!0,subtree:!0});function t(i){const a={};return i.integrity&&(a.integrity=i.integrity),i.referrerPolicy&&(a.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?a.credentials="include":i.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function s(i){if(i.ep)return;i.ep=!0;const a=t(i);fetch(i.href,a)}})();var Jt={exports:{}},Be={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Ds=j,Us=Symbol.for("react.element"),Ls=Symbol.for("react.fragment"),Bs=Object.prototype.hasOwnProperty,Ms=Ds.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,Ws={key:!0,ref:!0,__self:!0,__source:!0};function Ht(n,e,t){var s,i={},a=null,o=null;t!==void 0&&(a=""+t),e.key!==void 0&&(a=""+e.key),e.ref!==void 0&&(o=e.ref);for(s in e)Bs.call(e,s)&&!Ws.hasOwnProperty(s)&&(i[s]=e[s]);if(n&&n.defaultProps)for(s in e=n.defaultProps,e)i[s]===void 0&&(i[s]=e[s]);return{$$typeof:Us,type:n,key:a,ref:o,props:i,_owner:Ms.current}}Be.Fragment=Ls;Be.jsx=Ht;Be.jsxs=Ht;Jt.exports=Be;var r=Jt.exports,nt={},kt=_s;nt.createRoot=kt.createRoot,nt.hydrateRoot=kt.hydrateRoot;class qs{constructor(){Ee(this,"dbName","LuckyPickDB");Ee(this,"version",1);Ee(this,"db",null)}async init(){return new Promise((e,t)=>{const s=indexedDB.open(this.dbName,this.version);s.onerror=()=>t(s.error),s.onsuccess=()=>{this.db=s.result,e()},s.onupgradeneeded=i=>{const a=i.target.result;a.objectStoreNames.contains("sessions")||a.createObjectStore("sessions",{keyPath:"id"}),a.objectStoreNames.contains("bets")||a.createObjectStore("bets",{keyPath:"id"}),a.objectStoreNames.contains("results")||a.createObjectStore("results",{keyPath:"id"}),a.objectStoreNames.contains("transactions")||a.createObjectStore("transactions",{keyPath:"id"}),a.objectStoreNames.contains("user")||a.createObjectStore("user",{keyPath:"id"}),a.objectStoreNames.contains("offlineActions")||a.createObjectStore("offlineActions",{keyPath:"id",autoIncrement:!0})}})}async saveData(e,t){return this.db||await this.init(),new Promise((s,i)=>{const l=this.db.transaction([e],"readwrite").objectStore(e).put(t);l.onerror=()=>i(l.error),l.onsuccess=()=>s()})}async getData(e,t){return this.db||await this.init(),new Promise((s,i)=>{const o=this.db.transaction([e],"readonly").objectStore(e),l=t?o.get(t):o.getAll();l.onerror=()=>i(l.error),l.onsuccess=()=>s(l.result)})}async saveOfflineAction(e){const t={...e,timestamp:new Date().toISOString(),synced:!1};await this.saveData("offlineActions",t)}async getOfflineActions(){return(await this.getData("offlineActions")).filter(t=>!t.synced)}async markActionSynced(e){return this.db||await this.init(),new Promise((t,s)=>{const a=this.db.transaction(["offlineActions"],"readwrite").objectStore("offlineActions"),o=a.get(e);o.onsuccess=()=>{const l=o.result;if(l){l.synced=!0;const c=a.put(l);c.onsuccess=()=>t(),c.onerror=()=>s(c.error)}else t()},o.onerror=()=>s(o.error)})}}const C=new qs,ft=()=>{const[n,e]=j.useState(navigator.onLine),[t,s]=j.useState(!1);return j.useEffect(()=>{const i=()=>{e(!0),t&&("serviceWorker"in navigator&&"sync"in window.ServiceWorkerRegistration.prototype&&navigator.serviceWorker.ready.then(o=>o.sync.register("background-sync")),s(!1))},a=()=>{e(!1),s(!0)};return window.addEventListener("online",i),window.addEventListener("offline",a),()=>{window.removeEventListener("online",i),window.removeEventListener("offline",a)}},[t]),{isOnline:n,wasOffline:t}},Fs="modulepreload",Js=function(n){return"/"+n},St={},ke=function(e,t,s){let i=Promise.resolve();if(t&&t.length>0){document.getElementsByTagName("link");const o=document.querySelector("meta[property=csp-nonce]"),l=(o==null?void 0:o.nonce)||(o==null?void 0:o.getAttribute("nonce"));i=Promise.allSettled(t.map(c=>{if(c=Js(c),c in St)return;St[c]=!0;const u=c.endsWith(".css"),d=u?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${c}"]${d}`))return;const h=document.createElement("link");if(h.rel=u?"stylesheet":Fs,u||(h.as="script"),h.crossOrigin="",h.href=c,l&&h.setAttribute("nonce",l),document.head.appendChild(h),u)return new Promise((f,g)=>{h.addEventListener("load",f),h.addEventListener("error",()=>g(new Error(`Unable to preload CSS for ${c}`)))})}))}function a(o){const l=new Event("vite:preloadError",{cancelable:!0});if(l.payload=o,window.dispatchEvent(l),!l.defaultPrevented)throw o}return i.then(o=>{for(const l of o||[])l.status==="rejected"&&a(l.reason);return e().catch(a)})},Hs=n=>{let e;return n?e=n:typeof fetch>"u"?e=(...t)=>ke(async()=>{const{default:s}=await Promise.resolve().then(()=>he);return{default:s}},void 0).then(({default:s})=>s(...t)):e=fetch,(...t)=>e(...t)};class mt extends Error{constructor(e,t="FunctionsError",s){super(e),this.name=t,this.context=s}}class zs extends mt{constructor(e){super("Failed to send a request to the Edge Function","FunctionsFetchError",e)}}class Ks extends mt{constructor(e){super("Relay Error invoking the Edge Function","FunctionsRelayError",e)}}class Vs extends mt{constructor(e){super("Edge Function returned a non-2xx status code","FunctionsHttpError",e)}}var it;(function(n){n.Any="any",n.ApNortheast1="ap-northeast-1",n.ApNortheast2="ap-northeast-2",n.ApSouth1="ap-south-1",n.ApSoutheast1="ap-southeast-1",n.ApSoutheast2="ap-southeast-2",n.CaCentral1="ca-central-1",n.EuCentral1="eu-central-1",n.EuWest1="eu-west-1",n.EuWest2="eu-west-2",n.EuWest3="eu-west-3",n.SaEast1="sa-east-1",n.UsEast1="us-east-1",n.UsWest1="us-west-1",n.UsWest2="us-west-2"})(it||(it={}));var Gs=function(n,e,t,s){function i(a){return a instanceof t?a:new t(function(o){o(a)})}return new(t||(t=Promise))(function(a,o){function l(d){try{u(s.next(d))}catch(h){o(h)}}function c(d){try{u(s.throw(d))}catch(h){o(h)}}function u(d){d.done?a(d.value):i(d.value).then(l,c)}u((s=s.apply(n,e||[])).next())})};class Zs{constructor(e,{headers:t={},customFetch:s,region:i=it.Any}={}){this.url=e,this.headers=t,this.region=i,this.fetch=Hs(s)}setAuth(e){this.headers.Authorization=`Bearer ${e}`}invoke(e,t={}){var s;return Gs(this,void 0,void 0,function*(){try{const{headers:i,method:a,body:o}=t;let l={},{region:c}=t;c||(c=this.region),c&&c!=="any"&&(l["x-region"]=c);let u;o&&(i&&!Object.prototype.hasOwnProperty.call(i,"Content-Type")||!i)&&(typeof Blob<"u"&&o instanceof Blob||o instanceof ArrayBuffer?(l["Content-Type"]="application/octet-stream",u=o):typeof o=="string"?(l["Content-Type"]="text/plain",u=o):typeof FormData<"u"&&o instanceof FormData?u=o:(l["Content-Type"]="application/json",u=JSON.stringify(o)));const d=yield this.fetch(`${this.url}/${e}`,{method:a||"POST",headers:Object.assign(Object.assign(Object.assign({},l),this.headers),i),body:u}).catch(y=>{throw new zs(y)}),h=d.headers.get("x-relay-error");if(h&&h==="true")throw new Ks(d);if(!d.ok)throw new Vs(d);let f=((s=d.headers.get("Content-Type"))!==null&&s!==void 0?s:"text/plain").split(";")[0].trim(),g;return f==="application/json"?g=yield d.json():f==="application/octet-stream"?g=yield d.blob():f==="text/event-stream"?g=d:f==="multipart/form-data"?g=yield d.formData():g=yield d.text(),{data:g,error:null}}catch(i){return{data:null,error:i}}})}}var W={},gt={},Me={},Se={},We={},qe={},Qs=function(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("unable to locate global object")},ue=Qs();const Ys=ue.fetch,zt=ue.fetch.bind(ue),Kt=ue.Headers,Xs=ue.Request,er=ue.Response,he=Object.freeze(Object.defineProperty({__proto__:null,Headers:Kt,Request:Xs,Response:er,default:zt,fetch:Ys},Symbol.toStringTag,{value:"Module"})),tr=js(he);var Fe={};Object.defineProperty(Fe,"__esModule",{value:!0});let sr=class extends Error{constructor(e){super(e.message),this.name="PostgrestError",this.details=e.details,this.hint=e.hint,this.code=e.code}};Fe.default=sr;var Vt=q&&q.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(qe,"__esModule",{value:!0});const rr=Vt(tr),nr=Vt(Fe);let ir=class{constructor(e){this.shouldThrowOnError=!1,this.method=e.method,this.url=e.url,this.headers=e.headers,this.schema=e.schema,this.body=e.body,this.shouldThrowOnError=e.shouldThrowOnError,this.signal=e.signal,this.isMaybeSingle=e.isMaybeSingle,e.fetch?this.fetch=e.fetch:typeof fetch>"u"?this.fetch=rr.default:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(e,t){return this.headers=Object.assign({},this.headers),this.headers[e]=t,this}then(e,t){this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers["Accept-Profile"]=this.schema:this.headers["Content-Profile"]=this.schema),this.method!=="GET"&&this.method!=="HEAD"&&(this.headers["Content-Type"]="application/json");const s=this.fetch;let i=s(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async a=>{var o,l,c;let u=null,d=null,h=null,f=a.status,g=a.statusText;if(a.ok){if(this.method!=="HEAD"){const k=await a.text();k===""||(this.headers.Accept==="text/csv"||this.headers.Accept&&this.headers.Accept.includes("application/vnd.pgrst.plan+text")?d=k:d=JSON.parse(k))}const N=(o=this.headers.Prefer)===null||o===void 0?void 0:o.match(/count=(exact|planned|estimated)/),b=(l=a.headers.get("content-range"))===null||l===void 0?void 0:l.split("/");N&&b&&b.length>1&&(h=parseInt(b[1])),this.isMaybeSingle&&this.method==="GET"&&Array.isArray(d)&&(d.length>1?(u={code:"PGRST116",details:`Results contain ${d.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},d=null,h=null,f=406,g="Not Acceptable"):d.length===1?d=d[0]:d=null)}else{const N=await a.text();try{u=JSON.parse(N),Array.isArray(u)&&a.status===404&&(d=[],u=null,f=200,g="OK")}catch{a.status===404&&N===""?(f=204,g="No Content"):u={message:N}}if(u&&this.isMaybeSingle&&(!((c=u==null?void 0:u.details)===null||c===void 0)&&c.includes("0 rows"))&&(u=null,f=200,g="OK"),u&&this.shouldThrowOnError)throw new nr.default(u)}return{error:u,data:d,count:h,status:f,statusText:g}});return this.shouldThrowOnError||(i=i.catch(a=>{var o,l,c;return{error:{message:`${(o=a==null?void 0:a.name)!==null&&o!==void 0?o:"FetchError"}: ${a==null?void 0:a.message}`,details:`${(l=a==null?void 0:a.stack)!==null&&l!==void 0?l:""}`,hint:"",code:`${(c=a==null?void 0:a.code)!==null&&c!==void 0?c:""}`},data:null,count:null,status:0,statusText:""}})),i.then(e,t)}returns(){return this}overrideTypes(){return this}};qe.default=ir;var ar=q&&q.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(We,"__esModule",{value:!0});const or=ar(qe);let lr=class extends or.default{select(e){let t=!1;const s=(e??"*").split("").map(i=>/\s/.test(i)&&!t?"":(i==='"'&&(t=!t),i)).join("");return this.url.searchParams.set("select",s),this.headers.Prefer&&(this.headers.Prefer+=","),this.headers.Prefer+="return=representation",this}order(e,{ascending:t=!0,nullsFirst:s,foreignTable:i,referencedTable:a=i}={}){const o=a?`${a}.order`:"order",l=this.url.searchParams.get(o);return this.url.searchParams.set(o,`${l?`${l},`:""}${e}.${t?"asc":"desc"}${s===void 0?"":s?".nullsfirst":".nullslast"}`),this}limit(e,{foreignTable:t,referencedTable:s=t}={}){const i=typeof s>"u"?"limit":`${s}.limit`;return this.url.searchParams.set(i,`${e}`),this}range(e,t,{foreignTable:s,referencedTable:i=s}={}){const a=typeof i>"u"?"offset":`${i}.offset`,o=typeof i>"u"?"limit":`${i}.limit`;return this.url.searchParams.set(a,`${e}`),this.url.searchParams.set(o,`${t-e+1}`),this}abortSignal(e){return this.signal=e,this}single(){return this.headers.Accept="application/vnd.pgrst.object+json",this}maybeSingle(){return this.method==="GET"?this.headers.Accept="application/json":this.headers.Accept="application/vnd.pgrst.object+json",this.isMaybeSingle=!0,this}csv(){return this.headers.Accept="text/csv",this}geojson(){return this.headers.Accept="application/geo+json",this}explain({analyze:e=!1,verbose:t=!1,settings:s=!1,buffers:i=!1,wal:a=!1,format:o="text"}={}){var l;const c=[e?"analyze":null,t?"verbose":null,s?"settings":null,i?"buffers":null,a?"wal":null].filter(Boolean).join("|"),u=(l=this.headers.Accept)!==null&&l!==void 0?l:"application/json";return this.headers.Accept=`application/vnd.pgrst.plan+${o}; for="${u}"; options=${c};`,o==="json"?this:this}rollback(){var e;return((e=this.headers.Prefer)!==null&&e!==void 0?e:"").trim().length>0?this.headers.Prefer+=",tx=rollback":this.headers.Prefer="tx=rollback",this}returns(){return this}};We.default=lr;var cr=q&&q.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(Se,"__esModule",{value:!0});const dr=cr(We);let ur=class extends dr.default{eq(e,t){return this.url.searchParams.append(e,`eq.${t}`),this}neq(e,t){return this.url.searchParams.append(e,`neq.${t}`),this}gt(e,t){return this.url.searchParams.append(e,`gt.${t}`),this}gte(e,t){return this.url.searchParams.append(e,`gte.${t}`),this}lt(e,t){return this.url.searchParams.append(e,`lt.${t}`),this}lte(e,t){return this.url.searchParams.append(e,`lte.${t}`),this}like(e,t){return this.url.searchParams.append(e,`like.${t}`),this}likeAllOf(e,t){return this.url.searchParams.append(e,`like(all).{${t.join(",")}}`),this}likeAnyOf(e,t){return this.url.searchParams.append(e,`like(any).{${t.join(",")}}`),this}ilike(e,t){return this.url.searchParams.append(e,`ilike.${t}`),this}ilikeAllOf(e,t){return this.url.searchParams.append(e,`ilike(all).{${t.join(",")}}`),this}ilikeAnyOf(e,t){return this.url.searchParams.append(e,`ilike(any).{${t.join(",")}}`),this}is(e,t){return this.url.searchParams.append(e,`is.${t}`),this}in(e,t){const s=Array.from(new Set(t)).map(i=>typeof i=="string"&&new RegExp("[,()]").test(i)?`"${i}"`:`${i}`).join(",");return this.url.searchParams.append(e,`in.(${s})`),this}contains(e,t){return typeof t=="string"?this.url.searchParams.append(e,`cs.${t}`):Array.isArray(t)?this.url.searchParams.append(e,`cs.{${t.join(",")}}`):this.url.searchParams.append(e,`cs.${JSON.stringify(t)}`),this}containedBy(e,t){return typeof t=="string"?this.url.searchParams.append(e,`cd.${t}`):Array.isArray(t)?this.url.searchParams.append(e,`cd.{${t.join(",")}}`):this.url.searchParams.append(e,`cd.${JSON.stringify(t)}`),this}rangeGt(e,t){return this.url.searchParams.append(e,`sr.${t}`),this}rangeGte(e,t){return this.url.searchParams.append(e,`nxl.${t}`),this}rangeLt(e,t){return this.url.searchParams.append(e,`sl.${t}`),this}rangeLte(e,t){return this.url.searchParams.append(e,`nxr.${t}`),this}rangeAdjacent(e,t){return this.url.searchParams.append(e,`adj.${t}`),this}overlaps(e,t){return typeof t=="string"?this.url.searchParams.append(e,`ov.${t}`):this.url.searchParams.append(e,`ov.{${t.join(",")}}`),this}textSearch(e,t,{config:s,type:i}={}){let a="";i==="plain"?a="pl":i==="phrase"?a="ph":i==="websearch"&&(a="w");const o=s===void 0?"":`(${s})`;return this.url.searchParams.append(e,`${a}fts${o}.${t}`),this}match(e){return Object.entries(e).forEach(([t,s])=>{this.url.searchParams.append(t,`eq.${s}`)}),this}not(e,t,s){return this.url.searchParams.append(e,`not.${t}.${s}`),this}or(e,{foreignTable:t,referencedTable:s=t}={}){const i=s?`${s}.or`:"or";return this.url.searchParams.append(i,`(${e})`),this}filter(e,t,s){return this.url.searchParams.append(e,`${t}.${s}`),this}};Se.default=ur;var hr=q&&q.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(Me,"__esModule",{value:!0});const ge=hr(Se);let fr=class{constructor(e,{headers:t={},schema:s,fetch:i}){this.url=e,this.headers=t,this.schema=s,this.fetch=i}select(e,{head:t=!1,count:s}={}){const i=t?"HEAD":"GET";let a=!1;const o=(e??"*").split("").map(l=>/\s/.test(l)&&!a?"":(l==='"'&&(a=!a),l)).join("");return this.url.searchParams.set("select",o),s&&(this.headers.Prefer=`count=${s}`),new ge.default({method:i,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}insert(e,{count:t,defaultToNull:s=!0}={}){const i="POST",a=[];if(this.headers.Prefer&&a.push(this.headers.Prefer),t&&a.push(`count=${t}`),s||a.push("missing=default"),this.headers.Prefer=a.join(","),Array.isArray(e)){const o=e.reduce((l,c)=>l.concat(Object.keys(c)),[]);if(o.length>0){const l=[...new Set(o)].map(c=>`"${c}"`);this.url.searchParams.set("columns",l.join(","))}}return new ge.default({method:i,url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:this.fetch,allowEmpty:!1})}upsert(e,{onConflict:t,ignoreDuplicates:s=!1,count:i,defaultToNull:a=!0}={}){const o="POST",l=[`resolution=${s?"ignore":"merge"}-duplicates`];if(t!==void 0&&this.url.searchParams.set("on_conflict",t),this.headers.Prefer&&l.push(this.headers.Prefer),i&&l.push(`count=${i}`),a||l.push("missing=default"),this.headers.Prefer=l.join(","),Array.isArray(e)){const c=e.reduce((u,d)=>u.concat(Object.keys(d)),[]);if(c.length>0){const u=[...new Set(c)].map(d=>`"${d}"`);this.url.searchParams.set("columns",u.join(","))}}return new ge.default({method:o,url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:this.fetch,allowEmpty:!1})}update(e,{count:t}={}){const s="PATCH",i=[];return this.headers.Prefer&&i.push(this.headers.Prefer),t&&i.push(`count=${t}`),this.headers.Prefer=i.join(","),new ge.default({method:s,url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:this.fetch,allowEmpty:!1})}delete({count:e}={}){const t="DELETE",s=[];return e&&s.push(`count=${e}`),this.headers.Prefer&&s.unshift(this.headers.Prefer),this.headers.Prefer=s.join(","),new ge.default({method:t,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}};Me.default=fr;var Je={},He={};Object.defineProperty(He,"__esModule",{value:!0});He.version=void 0;He.version="0.0.0-automated";Object.defineProperty(Je,"__esModule",{value:!0});Je.DEFAULT_HEADERS=void 0;const mr=He;Je.DEFAULT_HEADERS={"X-Client-Info":`postgrest-js/${mr.version}`};var Gt=q&&q.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(gt,"__esModule",{value:!0});const gr=Gt(Me),pr=Gt(Se),xr=Je;let yr=class Zt{constructor(e,{headers:t={},schema:s,fetch:i}={}){this.url=e,this.headers=Object.assign(Object.assign({},xr.DEFAULT_HEADERS),t),this.schemaName=s,this.fetch=i}from(e){const t=new URL(`${this.url}/${e}`);return new gr.default(t,{headers:Object.assign({},this.headers),schema:this.schemaName,fetch:this.fetch})}schema(e){return new Zt(this.url,{headers:this.headers,schema:e,fetch:this.fetch})}rpc(e,t={},{head:s=!1,get:i=!1,count:a}={}){let o;const l=new URL(`${this.url}/rpc/${e}`);let c;s||i?(o=s?"HEAD":"GET",Object.entries(t).filter(([d,h])=>h!==void 0).map(([d,h])=>[d,Array.isArray(h)?`{${h.join(",")}}`:`${h}`]).forEach(([d,h])=>{l.searchParams.append(d,h)})):(o="POST",c=t);const u=Object.assign({},this.headers);return a&&(u.Prefer=`count=${a}`),new pr.default({method:o,url:l,headers:u,schema:this.schemaName,body:c,fetch:this.fetch,allowEmpty:!1})}};gt.default=yr;var fe=q&&q.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(W,"__esModule",{value:!0});W.PostgrestError=W.PostgrestBuilder=W.PostgrestTransformBuilder=W.PostgrestFilterBuilder=W.PostgrestQueryBuilder=W.PostgrestClient=void 0;const Qt=fe(gt);W.PostgrestClient=Qt.default;const Yt=fe(Me);W.PostgrestQueryBuilder=Yt.default;const Xt=fe(Se);W.PostgrestFilterBuilder=Xt.default;const es=fe(We);W.PostgrestTransformBuilder=es.default;const ts=fe(qe);W.PostgrestBuilder=ts.default;const ss=fe(Fe);W.PostgrestError=ss.default;var wr=W.default={PostgrestClient:Qt.default,PostgrestQueryBuilder:Yt.default,PostgrestFilterBuilder:Xt.default,PostgrestTransformBuilder:es.default,PostgrestBuilder:ts.default,PostgrestError:ss.default};const{PostgrestClient:vr,PostgrestQueryBuilder:Bi,PostgrestFilterBuilder:Mi,PostgrestTransformBuilder:Wi,PostgrestBuilder:qi,PostgrestError:Fi}=wr;function br(){if(typeof WebSocket<"u")return WebSocket;if(typeof global.WebSocket<"u")return global.WebSocket;if(typeof window.WebSocket<"u")return window.WebSocket;if(typeof self.WebSocket<"u")return self.WebSocket;throw new Error("`WebSocket` is not supported in this environment")}const _r=br(),jr="2.11.15",Nr=`realtime-js/${jr}`,kr="1.0.0",rs=1e4,Sr=1e3;var xe;(function(n){n[n.connecting=0]="connecting",n[n.open=1]="open",n[n.closing=2]="closing",n[n.closed=3]="closed"})(xe||(xe={}));var U;(function(n){n.closed="closed",n.errored="errored",n.joined="joined",n.joining="joining",n.leaving="leaving"})(U||(U={}));var J;(function(n){n.close="phx_close",n.error="phx_error",n.join="phx_join",n.reply="phx_reply",n.leave="phx_leave",n.access_token="access_token"})(J||(J={}));var at;(function(n){n.websocket="websocket"})(at||(at={}));var re;(function(n){n.Connecting="connecting",n.Open="open",n.Closing="closing",n.Closed="closed"})(re||(re={}));class Tr{constructor(){this.HEADER_LENGTH=1}decode(e,t){return e.constructor===ArrayBuffer?t(this._binaryDecode(e)):t(typeof e=="string"?JSON.parse(e):{})}_binaryDecode(e){const t=new DataView(e),s=new TextDecoder;return this._decodeBroadcast(e,t,s)}_decodeBroadcast(e,t,s){const i=t.getUint8(1),a=t.getUint8(2);let o=this.HEADER_LENGTH+2;const l=s.decode(e.slice(o,o+i));o=o+i;const c=s.decode(e.slice(o,o+a));o=o+a;const u=JSON.parse(s.decode(e.slice(o,e.byteLength)));return{ref:null,topic:l,event:c,payload:u}}}class ns{constructor(e,t){this.callback=e,this.timerCalc=t,this.timer=void 0,this.tries=0,this.callback=e,this.timerCalc=t}reset(){this.tries=0,clearTimeout(this.timer)}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}var $;(function(n){n.abstime="abstime",n.bool="bool",n.date="date",n.daterange="daterange",n.float4="float4",n.float8="float8",n.int2="int2",n.int4="int4",n.int4range="int4range",n.int8="int8",n.int8range="int8range",n.json="json",n.jsonb="jsonb",n.money="money",n.numeric="numeric",n.oid="oid",n.reltime="reltime",n.text="text",n.time="time",n.timestamp="timestamp",n.timestamptz="timestamptz",n.timetz="timetz",n.tsrange="tsrange",n.tstzrange="tstzrange"})($||($={}));const Tt=(n,e,t={})=>{var s;const i=(s=t.skipTypes)!==null&&s!==void 0?s:[];return Object.keys(e).reduce((a,o)=>(a[o]=Er(o,n,e,i),a),{})},Er=(n,e,t,s)=>{const i=e.find(l=>l.name===n),a=i==null?void 0:i.type,o=t[n];return a&&!s.includes(a)?is(a,o):ot(o)},is=(n,e)=>{if(n.charAt(0)==="_"){const t=n.slice(1,n.length);return Or(e,t)}switch(n){case $.bool:return Pr(e);case $.float4:case $.float8:case $.int2:case $.int4:case $.int8:case $.numeric:case $.oid:return Ar(e);case $.json:case $.jsonb:return $r(e);case $.timestamp:return Cr(e);case $.abstime:case $.date:case $.daterange:case $.int4range:case $.int8range:case $.money:case $.reltime:case $.text:case $.time:case $.timestamptz:case $.timetz:case $.tsrange:case $.tstzrange:return ot(e);default:return ot(e)}},ot=n=>n,Pr=n=>{switch(n){case"t":return!0;case"f":return!1;default:return n}},Ar=n=>{if(typeof n=="string"){const e=parseFloat(n);if(!Number.isNaN(e))return e}return n},$r=n=>{if(typeof n=="string")try{return JSON.parse(n)}catch(e){return console.log(`JSON parse error: ${e}`),n}return n},Or=(n,e)=>{if(typeof n!="string")return n;const t=n.length-1,s=n[t];if(n[0]==="{"&&s==="}"){let a;const o=n.slice(1,t);try{a=JSON.parse("["+o+"]")}catch{a=o?o.split(","):[]}return a.map(l=>is(e,l))}return n},Cr=n=>typeof n=="string"?n.replace(" ","T"):n,as=n=>{let e=n;return e=e.replace(/^ws/i,"http"),e=e.replace(/(\/socket\/websocket|\/socket|\/websocket)\/?$/i,""),e.replace(/\/+$/,"")};class Ze{constructor(e,t,s={},i=rs){this.channel=e,this.event=t,this.payload=s,this.timeout=i,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(e){this.timeout=e,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(e){this.payload=Object.assign(Object.assign({},this.payload),e)}receive(e,t){var s;return this._hasReceived(e)&&t((s=this.receivedResp)===null||s===void 0?void 0:s.response),this.recHooks.push({status:e,callback:t}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const e=t=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=t,this._matchReceive(t)};this.channel._on(this.refEvent,{},e),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(e,t){this.refEvent&&this.channel._trigger(this.refEvent,{status:e,response:t})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:e,response:t}){this.recHooks.filter(s=>s.status===e).forEach(s=>s.callback(t))}_hasReceived(e){return this.receivedResp&&this.receivedResp.status===e}}var Et;(function(n){n.SYNC="sync",n.JOIN="join",n.LEAVE="leave"})(Et||(Et={}));class ye{constructor(e,t){this.channel=e,this.state={},this.pendingDiffs=[],this.joinRef=null,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const s=(t==null?void 0:t.events)||{state:"presence_state",diff:"presence_diff"};this.channel._on(s.state,{},i=>{const{onJoin:a,onLeave:o,onSync:l}=this.caller;this.joinRef=this.channel._joinRef(),this.state=ye.syncState(this.state,i,a,o),this.pendingDiffs.forEach(c=>{this.state=ye.syncDiff(this.state,c,a,o)}),this.pendingDiffs=[],l()}),this.channel._on(s.diff,{},i=>{const{onJoin:a,onLeave:o,onSync:l}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(i):(this.state=ye.syncDiff(this.state,i,a,o),l())}),this.onJoin((i,a,o)=>{this.channel._trigger("presence",{event:"join",key:i,currentPresences:a,newPresences:o})}),this.onLeave((i,a,o)=>{this.channel._trigger("presence",{event:"leave",key:i,currentPresences:a,leftPresences:o})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(e,t,s,i){const a=this.cloneDeep(e),o=this.transformState(t),l={},c={};return this.map(a,(u,d)=>{o[u]||(c[u]=d)}),this.map(o,(u,d)=>{const h=a[u];if(h){const f=d.map(b=>b.presence_ref),g=h.map(b=>b.presence_ref),y=d.filter(b=>g.indexOf(b.presence_ref)<0),N=h.filter(b=>f.indexOf(b.presence_ref)<0);y.length>0&&(l[u]=y),N.length>0&&(c[u]=N)}else l[u]=d}),this.syncDiff(a,{joins:l,leaves:c},s,i)}static syncDiff(e,t,s,i){const{joins:a,leaves:o}={joins:this.transformState(t.joins),leaves:this.transformState(t.leaves)};return s||(s=()=>{}),i||(i=()=>{}),this.map(a,(l,c)=>{var u;const d=(u=e[l])!==null&&u!==void 0?u:[];if(e[l]=this.cloneDeep(c),d.length>0){const h=e[l].map(g=>g.presence_ref),f=d.filter(g=>h.indexOf(g.presence_ref)<0);e[l].unshift(...f)}s(l,d,c)}),this.map(o,(l,c)=>{let u=e[l];if(!u)return;const d=c.map(h=>h.presence_ref);u=u.filter(h=>d.indexOf(h.presence_ref)<0),e[l]=u,i(l,u,c),u.length===0&&delete e[l]}),e}static map(e,t){return Object.getOwnPropertyNames(e).map(s=>t(s,e[s]))}static transformState(e){return e=this.cloneDeep(e),Object.getOwnPropertyNames(e).reduce((t,s)=>{const i=e[s];return"metas"in i?t[s]=i.metas.map(a=>(a.presence_ref=a.phx_ref,delete a.phx_ref,delete a.phx_ref_prev,a)):t[s]=i,t},{})}static cloneDeep(e){return JSON.parse(JSON.stringify(e))}onJoin(e){this.caller.onJoin=e}onLeave(e){this.caller.onLeave=e}onSync(e){this.caller.onSync=e}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var Pt;(function(n){n.ALL="*",n.INSERT="INSERT",n.UPDATE="UPDATE",n.DELETE="DELETE"})(Pt||(Pt={}));var At;(function(n){n.BROADCAST="broadcast",n.PRESENCE="presence",n.POSTGRES_CHANGES="postgres_changes",n.SYSTEM="system"})(At||(At={}));var V;(function(n){n.SUBSCRIBED="SUBSCRIBED",n.TIMED_OUT="TIMED_OUT",n.CLOSED="CLOSED",n.CHANNEL_ERROR="CHANNEL_ERROR"})(V||(V={}));class pt{constructor(e,t={config:{}},s){this.topic=e,this.params=t,this.socket=s,this.bindings={},this.state=U.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=e.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:""},private:!1},t.config),this.timeout=this.socket.timeout,this.joinPush=new Ze(this,J.join,this.params,this.timeout),this.rejoinTimer=new ns(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=U.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(i=>i.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=U.closed,this.socket._remove(this)}),this._onError(i=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,i),this.state=U.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=U.errored,this.rejoinTimer.scheduleTimeout())}),this._on(J.reply,{},(i,a)=>{this._trigger(this._replyEventName(a),i)}),this.presence=new ye(this),this.broadcastEndpointURL=as(this.socket.endPoint)+"/api/broadcast",this.private=this.params.config.private||!1}subscribe(e,t=this.timeout){var s,i;if(this.socket.isConnected()||this.socket.connect(),this.state==U.closed){const{config:{broadcast:a,presence:o,private:l}}=this.params;this._onError(d=>e==null?void 0:e(V.CHANNEL_ERROR,d)),this._onClose(()=>e==null?void 0:e(V.CLOSED));const c={},u={broadcast:a,presence:o,postgres_changes:(i=(s=this.bindings.postgres_changes)===null||s===void 0?void 0:s.map(d=>d.filter))!==null&&i!==void 0?i:[],private:l};this.socket.accessTokenValue&&(c.access_token=this.socket.accessTokenValue),this.updateJoinPayload(Object.assign({config:u},c)),this.joinedOnce=!0,this._rejoin(t),this.joinPush.receive("ok",async({postgres_changes:d})=>{var h;if(this.socket.setAuth(),d===void 0){e==null||e(V.SUBSCRIBED);return}else{const f=this.bindings.postgres_changes,g=(h=f==null?void 0:f.length)!==null&&h!==void 0?h:0,y=[];for(let N=0;N<g;N++){const b=f[N],{filter:{event:k,schema:v,table:x,filter:w}}=b,p=d&&d[N];if(p&&p.event===k&&p.schema===v&&p.table===x&&p.filter===w)y.push(Object.assign(Object.assign({},b),{id:p.id}));else{this.unsubscribe(),this.state=U.errored,e==null||e(V.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=y,e&&e(V.SUBSCRIBED);return}}).receive("error",d=>{this.state=U.errored,e==null||e(V.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(d).join(", ")||"error")))}).receive("timeout",()=>{e==null||e(V.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(e,t={}){return await this.send({type:"presence",event:"track",payload:e},t.timeout||this.timeout)}async untrack(e={}){return await this.send({type:"presence",event:"untrack"},e)}on(e,t,s){return this._on(e,t,s)}async send(e,t={}){var s,i;if(!this._canPush()&&e.type==="broadcast"){const{event:a,payload:o}=e,c={method:"POST",headers:{Authorization:this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"",apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:a,payload:o,private:this.private}]})};try{const u=await this._fetchWithTimeout(this.broadcastEndpointURL,c,(s=t.timeout)!==null&&s!==void 0?s:this.timeout);return await((i=u.body)===null||i===void 0?void 0:i.cancel()),u.ok?"ok":"error"}catch(u){return u.name==="AbortError"?"timed out":"error"}}else return new Promise(a=>{var o,l,c;const u=this._push(e.type,e,t.timeout||this.timeout);e.type==="broadcast"&&!(!((c=(l=(o=this.params)===null||o===void 0?void 0:o.config)===null||l===void 0?void 0:l.broadcast)===null||c===void 0)&&c.ack)&&a("ok"),u.receive("ok",()=>a("ok")),u.receive("error",()=>a("error")),u.receive("timeout",()=>a("timed out"))})}updateJoinPayload(e){this.joinPush.updatePayload(e)}unsubscribe(e=this.timeout){this.state=U.leaving;const t=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(J.close,"leave",this._joinRef())};this.joinPush.destroy();let s=null;return new Promise(i=>{s=new Ze(this,J.leave,{},e),s.receive("ok",()=>{t(),i("ok")}).receive("timeout",()=>{t(),i("timed out")}).receive("error",()=>{i("error")}),s.send(),this._canPush()||s.trigger("ok",{})}).finally(()=>{s==null||s.destroy()})}teardown(){this.pushBuffer.forEach(e=>e.destroy()),this.rejoinTimer&&clearTimeout(this.rejoinTimer.timer),this.joinPush.destroy()}async _fetchWithTimeout(e,t,s){const i=new AbortController,a=setTimeout(()=>i.abort(),s),o=await this.socket.fetch(e,Object.assign(Object.assign({},t),{signal:i.signal}));return clearTimeout(a),o}_push(e,t,s=this.timeout){if(!this.joinedOnce)throw`tried to push '${e}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let i=new Ze(this,e,t,s);return this._canPush()?i.send():(i.startTimeout(),this.pushBuffer.push(i)),i}_onMessage(e,t,s){return t}_isMember(e){return this.topic===e}_joinRef(){return this.joinPush.ref}_trigger(e,t,s){var i,a;const o=e.toLocaleLowerCase(),{close:l,error:c,leave:u,join:d}=J;if(s&&[l,c,u,d].indexOf(o)>=0&&s!==this._joinRef())return;let f=this._onMessage(o,t,s);if(t&&!f)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(o)?(i=this.bindings.postgres_changes)===null||i===void 0||i.filter(g=>{var y,N,b;return((y=g.filter)===null||y===void 0?void 0:y.event)==="*"||((b=(N=g.filter)===null||N===void 0?void 0:N.event)===null||b===void 0?void 0:b.toLocaleLowerCase())===o}).map(g=>g.callback(f,s)):(a=this.bindings[o])===null||a===void 0||a.filter(g=>{var y,N,b,k,v,x;if(["broadcast","presence","postgres_changes"].includes(o))if("id"in g){const w=g.id,p=(y=g.filter)===null||y===void 0?void 0:y.event;return w&&((N=t.ids)===null||N===void 0?void 0:N.includes(w))&&(p==="*"||(p==null?void 0:p.toLocaleLowerCase())===((b=t.data)===null||b===void 0?void 0:b.type.toLocaleLowerCase()))}else{const w=(v=(k=g==null?void 0:g.filter)===null||k===void 0?void 0:k.event)===null||v===void 0?void 0:v.toLocaleLowerCase();return w==="*"||w===((x=t==null?void 0:t.event)===null||x===void 0?void 0:x.toLocaleLowerCase())}else return g.type.toLocaleLowerCase()===o}).map(g=>{if(typeof f=="object"&&"ids"in f){const y=f.data,{schema:N,table:b,commit_timestamp:k,type:v,errors:x}=y;f=Object.assign(Object.assign({},{schema:N,table:b,commit_timestamp:k,eventType:v,new:{},old:{},errors:x}),this._getPayloadRecords(y))}g.callback(f,s)})}_isClosed(){return this.state===U.closed}_isJoined(){return this.state===U.joined}_isJoining(){return this.state===U.joining}_isLeaving(){return this.state===U.leaving}_replyEventName(e){return`chan_reply_${e}`}_on(e,t,s){const i=e.toLocaleLowerCase(),a={type:i,filter:t,callback:s};return this.bindings[i]?this.bindings[i].push(a):this.bindings[i]=[a],this}_off(e,t){const s=e.toLocaleLowerCase();return this.bindings[s]=this.bindings[s].filter(i=>{var a;return!(((a=i.type)===null||a===void 0?void 0:a.toLocaleLowerCase())===s&&pt.isEqual(i.filter,t))}),this}static isEqual(e,t){if(Object.keys(e).length!==Object.keys(t).length)return!1;for(const s in e)if(e[s]!==t[s])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(e){this._on(J.close,{},e)}_onError(e){this._on(J.error,{},t=>e(t))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(e=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=U.joining,this.joinPush.resend(e))}_getPayloadRecords(e){const t={new:{},old:{}};return(e.type==="INSERT"||e.type==="UPDATE")&&(t.new=Tt(e.columns,e.record)),(e.type==="UPDATE"||e.type==="DELETE")&&(t.old=Tt(e.columns,e.old_record)),t}}const $t=()=>{},Ir=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`;class Rr{constructor(e,t){var s;this.accessTokenValue=null,this.apiKey=null,this.channels=new Array,this.endPoint="",this.httpEndpoint="",this.headers={},this.params={},this.timeout=rs,this.heartbeatIntervalMs=25e3,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=$t,this.ref=0,this.logger=$t,this.conn=null,this.sendBuffer=[],this.serializer=new Tr,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._resolveFetch=a=>{let o;return a?o=a:typeof fetch>"u"?o=(...l)=>ke(async()=>{const{default:c}=await Promise.resolve().then(()=>he);return{default:c}},void 0).then(({default:c})=>c(...l)):o=fetch,(...l)=>o(...l)},this.endPoint=`${e}/${at.websocket}`,this.httpEndpoint=as(e),t!=null&&t.transport?this.transport=t.transport:this.transport=null,t!=null&&t.params&&(this.params=t.params),t!=null&&t.timeout&&(this.timeout=t.timeout),t!=null&&t.logger&&(this.logger=t.logger),(t!=null&&t.logLevel||t!=null&&t.log_level)&&(this.logLevel=t.logLevel||t.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),t!=null&&t.heartbeatIntervalMs&&(this.heartbeatIntervalMs=t.heartbeatIntervalMs);const i=(s=t==null?void 0:t.params)===null||s===void 0?void 0:s.apikey;if(i&&(this.accessTokenValue=i,this.apiKey=i),this.reconnectAfterMs=t!=null&&t.reconnectAfterMs?t.reconnectAfterMs:a=>[1e3,2e3,5e3,1e4][a-1]||1e4,this.encode=t!=null&&t.encode?t.encode:(a,o)=>o(JSON.stringify(a)),this.decode=t!=null&&t.decode?t.decode:this.serializer.decode.bind(this.serializer),this.reconnectTimer=new ns(async()=>{this.disconnect(),this.connect()},this.reconnectAfterMs),this.fetch=this._resolveFetch(t==null?void 0:t.fetch),t!=null&&t.worker){if(typeof window<"u"&&!window.Worker)throw new Error("Web Worker is not supported");this.worker=(t==null?void 0:t.worker)||!1,this.workerUrl=t==null?void 0:t.workerUrl}this.accessToken=(t==null?void 0:t.accessToken)||null}connect(){if(!this.conn){if(this.transport||(this.transport=_r),!this.transport)throw new Error("No transport provided");this.conn=new this.transport(this.endpointURL()),this.setupConnection()}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:kr}))}disconnect(e,t){this.conn&&(this.conn.onclose=function(){},e?this.conn.close(e,t??""):this.conn.close(),this.conn=null,this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.reset(),this.channels.forEach(s=>s.teardown()))}getChannels(){return this.channels}async removeChannel(e){const t=await e.unsubscribe();return this.channels.length===0&&this.disconnect(),t}async removeAllChannels(){const e=await Promise.all(this.channels.map(t=>t.unsubscribe()));return this.channels=[],this.disconnect(),e}log(e,t,s){this.logger(e,t,s)}connectionState(){switch(this.conn&&this.conn.readyState){case xe.connecting:return re.Connecting;case xe.open:return re.Open;case xe.closing:return re.Closing;default:return re.Closed}}isConnected(){return this.connectionState()===re.Open}channel(e,t={config:{}}){const s=`realtime:${e}`,i=this.getChannels().find(a=>a.topic===s);if(i)return i;{const a=new pt(`realtime:${e}`,t,this);return this.channels.push(a),a}}push(e){const{topic:t,event:s,payload:i,ref:a}=e,o=()=>{this.encode(e,l=>{var c;(c=this.conn)===null||c===void 0||c.send(l)})};this.log("push",`${t} ${s} (${a})`,i),this.isConnected()?o():this.sendBuffer.push(o)}async setAuth(e=null){let t=e||this.accessToken&&await this.accessToken()||this.accessTokenValue;this.accessTokenValue!=t&&(this.accessTokenValue=t,this.channels.forEach(s=>{const i={access_token:t,version:Nr};t&&s.updateJoinPayload(i),s.joinedOnce&&s._isJoined()&&s._push(J.access_token,{access_token:t})}))}async sendHeartbeat(){var e;if(!this.isConnected()){this.heartbeatCallback("disconnected");return}if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection"),this.heartbeatCallback("timeout"),(e=this.conn)===null||e===void 0||e.close(Sr,"hearbeat timeout");return}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef}),this.heartbeatCallback("sent"),await this.setAuth()}onHeartbeat(e){this.heartbeatCallback=e}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(e=>e()),this.sendBuffer=[])}_makeRef(){let e=this.ref+1;return e===this.ref?this.ref=0:this.ref=e,this.ref.toString()}_leaveOpenTopic(e){let t=this.channels.find(s=>s.topic===e&&(s._isJoined()||s._isJoining()));t&&(this.log("transport",`leaving duplicate topic "${e}"`),t.unsubscribe())}_remove(e){this.channels=this.channels.filter(t=>t.topic!==e.topic)}setupConnection(){this.conn&&(this.conn.binaryType="arraybuffer",this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=e=>this._onConnError(e),this.conn.onmessage=e=>this._onConnMessage(e),this.conn.onclose=e=>this._onConnClose(e))}_onConnMessage(e){this.decode(e.data,t=>{let{topic:s,event:i,payload:a,ref:o}=t;s==="phoenix"&&i==="phx_reply"&&this.heartbeatCallback(t.payload.status=="ok"?"ok":"error"),o&&o===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null),this.log("receive",`${a.status||""} ${s} ${i} ${o&&"("+o+")"||""}`,a),Array.from(this.channels).filter(l=>l._isMember(s)).forEach(l=>l._trigger(i,a,o)),this.stateChangeCallbacks.message.forEach(l=>l(t))})}_onConnOpen(){this.log("transport",`connected to ${this.endpointURL()}`),this.flushSendBuffer(),this.reconnectTimer.reset(),this.worker?this.workerRef||this._startWorkerHeartbeat():this._startHeartbeat(),this.stateChangeCallbacks.open.forEach(e=>e())}_startHeartbeat(){this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs)}_startWorkerHeartbeat(){this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const e=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(e),this.workerRef.onerror=t=>{this.log("worker","worker error",t.message),this.workerRef.terminate()},this.workerRef.onmessage=t=>{t.data.event==="keepAlive"&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}_onConnClose(e){this.log("transport","close",e),this._triggerChanError(),this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.scheduleTimeout(),this.stateChangeCallbacks.close.forEach(t=>t(e))}_onConnError(e){this.log("transport",`${e}`),this._triggerChanError(),this.stateChangeCallbacks.error.forEach(t=>t(e))}_triggerChanError(){this.channels.forEach(e=>e._trigger(J.error))}_appendParams(e,t){if(Object.keys(t).length===0)return e;const s=e.match(/\?/)?"&":"?",i=new URLSearchParams(t);return`${e}${s}${i}`}_workerObjectUrl(e){let t;if(e)t=e;else{const s=new Blob([Ir],{type:"application/javascript"});t=URL.createObjectURL(s)}return t}}class xt extends Error{constructor(e){super(e),this.__isStorageError=!0,this.name="StorageError"}}function R(n){return typeof n=="object"&&n!==null&&"__isStorageError"in n}class Dr extends xt{constructor(e,t){super(e),this.name="StorageApiError",this.status=t}toJSON(){return{name:this.name,message:this.message,status:this.status}}}class lt extends xt{constructor(e,t){super(e),this.name="StorageUnknownError",this.originalError=t}}var Ur=function(n,e,t,s){function i(a){return a instanceof t?a:new t(function(o){o(a)})}return new(t||(t=Promise))(function(a,o){function l(d){try{u(s.next(d))}catch(h){o(h)}}function c(d){try{u(s.throw(d))}catch(h){o(h)}}function u(d){d.done?a(d.value):i(d.value).then(l,c)}u((s=s.apply(n,e||[])).next())})};const os=n=>{let e;return n?e=n:typeof fetch>"u"?e=(...t)=>ke(async()=>{const{default:s}=await Promise.resolve().then(()=>he);return{default:s}},void 0).then(({default:s})=>s(...t)):e=fetch,(...t)=>e(...t)},Lr=()=>Ur(void 0,void 0,void 0,function*(){return typeof Response>"u"?(yield ke(()=>Promise.resolve().then(()=>he),void 0)).Response:Response}),ct=n=>{if(Array.isArray(n))return n.map(t=>ct(t));if(typeof n=="function"||n!==Object(n))return n;const e={};return Object.entries(n).forEach(([t,s])=>{const i=t.replace(/([-_][a-z])/gi,a=>a.toUpperCase().replace(/[-_]/g,""));e[i]=ct(s)}),e};var ne=function(n,e,t,s){function i(a){return a instanceof t?a:new t(function(o){o(a)})}return new(t||(t=Promise))(function(a,o){function l(d){try{u(s.next(d))}catch(h){o(h)}}function c(d){try{u(s.throw(d))}catch(h){o(h)}}function u(d){d.done?a(d.value):i(d.value).then(l,c)}u((s=s.apply(n,e||[])).next())})};const Qe=n=>n.msg||n.message||n.error_description||n.error||JSON.stringify(n),Br=(n,e,t)=>ne(void 0,void 0,void 0,function*(){const s=yield Lr();n instanceof s&&!(t!=null&&t.noResolveJson)?n.json().then(i=>{e(new Dr(Qe(i),n.status||500))}).catch(i=>{e(new lt(Qe(i),i))}):e(new lt(Qe(n),n))}),Mr=(n,e,t,s)=>{const i={method:n,headers:(e==null?void 0:e.headers)||{}};return n==="GET"?i:(i.headers=Object.assign({"Content-Type":"application/json"},e==null?void 0:e.headers),s&&(i.body=JSON.stringify(s)),Object.assign(Object.assign({},i),t))};function Te(n,e,t,s,i,a){return ne(this,void 0,void 0,function*(){return new Promise((o,l)=>{n(t,Mr(e,s,i,a)).then(c=>{if(!c.ok)throw c;return s!=null&&s.noResolveJson?c:c.json()}).then(c=>o(c)).catch(c=>Br(c,l,s))})})}function De(n,e,t,s){return ne(this,void 0,void 0,function*(){return Te(n,"GET",e,t,s)})}function Z(n,e,t,s,i){return ne(this,void 0,void 0,function*(){return Te(n,"POST",e,s,i,t)})}function Wr(n,e,t,s,i){return ne(this,void 0,void 0,function*(){return Te(n,"PUT",e,s,i,t)})}function qr(n,e,t,s){return ne(this,void 0,void 0,function*(){return Te(n,"HEAD",e,Object.assign(Object.assign({},t),{noResolveJson:!0}),s)})}function ls(n,e,t,s,i){return ne(this,void 0,void 0,function*(){return Te(n,"DELETE",e,s,i,t)})}var M=function(n,e,t,s){function i(a){return a instanceof t?a:new t(function(o){o(a)})}return new(t||(t=Promise))(function(a,o){function l(d){try{u(s.next(d))}catch(h){o(h)}}function c(d){try{u(s.throw(d))}catch(h){o(h)}}function u(d){d.done?a(d.value):i(d.value).then(l,c)}u((s=s.apply(n,e||[])).next())})};const Fr={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},Ot={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class Jr{constructor(e,t={},s,i){this.url=e,this.headers=t,this.bucketId=s,this.fetch=os(i)}uploadOrUpdate(e,t,s,i){return M(this,void 0,void 0,function*(){try{let a;const o=Object.assign(Object.assign({},Ot),i);let l=Object.assign(Object.assign({},this.headers),e==="POST"&&{"x-upsert":String(o.upsert)});const c=o.metadata;typeof Blob<"u"&&s instanceof Blob?(a=new FormData,a.append("cacheControl",o.cacheControl),c&&a.append("metadata",this.encodeMetadata(c)),a.append("",s)):typeof FormData<"u"&&s instanceof FormData?(a=s,a.append("cacheControl",o.cacheControl),c&&a.append("metadata",this.encodeMetadata(c))):(a=s,l["cache-control"]=`max-age=${o.cacheControl}`,l["content-type"]=o.contentType,c&&(l["x-metadata"]=this.toBase64(this.encodeMetadata(c)))),i!=null&&i.headers&&(l=Object.assign(Object.assign({},l),i.headers));const u=this._removeEmptyFolders(t),d=this._getFinalPath(u),h=yield this.fetch(`${this.url}/object/${d}`,Object.assign({method:e,body:a,headers:l},o!=null&&o.duplex?{duplex:o.duplex}:{})),f=yield h.json();return h.ok?{data:{path:u,id:f.Id,fullPath:f.Key},error:null}:{data:null,error:f}}catch(a){if(R(a))return{data:null,error:a};throw a}})}upload(e,t,s){return M(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",e,t,s)})}uploadToSignedUrl(e,t,s,i){return M(this,void 0,void 0,function*(){const a=this._removeEmptyFolders(e),o=this._getFinalPath(a),l=new URL(this.url+`/object/upload/sign/${o}`);l.searchParams.set("token",t);try{let c;const u=Object.assign({upsert:Ot.upsert},i),d=Object.assign(Object.assign({},this.headers),{"x-upsert":String(u.upsert)});typeof Blob<"u"&&s instanceof Blob?(c=new FormData,c.append("cacheControl",u.cacheControl),c.append("",s)):typeof FormData<"u"&&s instanceof FormData?(c=s,c.append("cacheControl",u.cacheControl)):(c=s,d["cache-control"]=`max-age=${u.cacheControl}`,d["content-type"]=u.contentType);const h=yield this.fetch(l.toString(),{method:"PUT",body:c,headers:d}),f=yield h.json();return h.ok?{data:{path:a,fullPath:f.Key},error:null}:{data:null,error:f}}catch(c){if(R(c))return{data:null,error:c};throw c}})}createSignedUploadUrl(e,t){return M(this,void 0,void 0,function*(){try{let s=this._getFinalPath(e);const i=Object.assign({},this.headers);t!=null&&t.upsert&&(i["x-upsert"]="true");const a=yield Z(this.fetch,`${this.url}/object/upload/sign/${s}`,{},{headers:i}),o=new URL(this.url+a.url),l=o.searchParams.get("token");if(!l)throw new xt("No token returned by API");return{data:{signedUrl:o.toString(),path:e,token:l},error:null}}catch(s){if(R(s))return{data:null,error:s};throw s}})}update(e,t,s){return M(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",e,t,s)})}move(e,t,s){return M(this,void 0,void 0,function*(){try{return{data:yield Z(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:s==null?void 0:s.destinationBucket},{headers:this.headers}),error:null}}catch(i){if(R(i))return{data:null,error:i};throw i}})}copy(e,t,s){return M(this,void 0,void 0,function*(){try{return{data:{path:(yield Z(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:s==null?void 0:s.destinationBucket},{headers:this.headers})).Key},error:null}}catch(i){if(R(i))return{data:null,error:i};throw i}})}createSignedUrl(e,t,s){return M(this,void 0,void 0,function*(){try{let i=this._getFinalPath(e),a=yield Z(this.fetch,`${this.url}/object/sign/${i}`,Object.assign({expiresIn:t},s!=null&&s.transform?{transform:s.transform}:{}),{headers:this.headers});const o=s!=null&&s.download?`&download=${s.download===!0?"":s.download}`:"";return a={signedUrl:encodeURI(`${this.url}${a.signedURL}${o}`)},{data:a,error:null}}catch(i){if(R(i))return{data:null,error:i};throw i}})}createSignedUrls(e,t,s){return M(this,void 0,void 0,function*(){try{const i=yield Z(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:t,paths:e},{headers:this.headers}),a=s!=null&&s.download?`&download=${s.download===!0?"":s.download}`:"";return{data:i.map(o=>Object.assign(Object.assign({},o),{signedUrl:o.signedURL?encodeURI(`${this.url}${o.signedURL}${a}`):null})),error:null}}catch(i){if(R(i))return{data:null,error:i};throw i}})}download(e,t){return M(this,void 0,void 0,function*(){const i=typeof(t==null?void 0:t.transform)<"u"?"render/image/authenticated":"object",a=this.transformOptsToQueryString((t==null?void 0:t.transform)||{}),o=a?`?${a}`:"";try{const l=this._getFinalPath(e);return{data:yield(yield De(this.fetch,`${this.url}/${i}/${l}${o}`,{headers:this.headers,noResolveJson:!0})).blob(),error:null}}catch(l){if(R(l))return{data:null,error:l};throw l}})}info(e){return M(this,void 0,void 0,function*(){const t=this._getFinalPath(e);try{const s=yield De(this.fetch,`${this.url}/object/info/${t}`,{headers:this.headers});return{data:ct(s),error:null}}catch(s){if(R(s))return{data:null,error:s};throw s}})}exists(e){return M(this,void 0,void 0,function*(){const t=this._getFinalPath(e);try{return yield qr(this.fetch,`${this.url}/object/${t}`,{headers:this.headers}),{data:!0,error:null}}catch(s){if(R(s)&&s instanceof lt){const i=s.originalError;if([400,404].includes(i==null?void 0:i.status))return{data:!1,error:s}}throw s}})}getPublicUrl(e,t){const s=this._getFinalPath(e),i=[],a=t!=null&&t.download?`download=${t.download===!0?"":t.download}`:"";a!==""&&i.push(a);const l=typeof(t==null?void 0:t.transform)<"u"?"render/image":"object",c=this.transformOptsToQueryString((t==null?void 0:t.transform)||{});c!==""&&i.push(c);let u=i.join("&");return u!==""&&(u=`?${u}`),{data:{publicUrl:encodeURI(`${this.url}/${l}/public/${s}${u}`)}}}remove(e){return M(this,void 0,void 0,function*(){try{return{data:yield ls(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:e},{headers:this.headers}),error:null}}catch(t){if(R(t))return{data:null,error:t};throw t}})}list(e,t,s){return M(this,void 0,void 0,function*(){try{const i=Object.assign(Object.assign(Object.assign({},Fr),t),{prefix:e||""});return{data:yield Z(this.fetch,`${this.url}/object/list/${this.bucketId}`,i,{headers:this.headers},s),error:null}}catch(i){if(R(i))return{data:null,error:i};throw i}})}encodeMetadata(e){return JSON.stringify(e)}toBase64(e){return typeof Buffer<"u"?Buffer.from(e).toString("base64"):btoa(e)}_getFinalPath(e){return`${this.bucketId}/${e}`}_removeEmptyFolders(e){return e.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(e){const t=[];return e.width&&t.push(`width=${e.width}`),e.height&&t.push(`height=${e.height}`),e.resize&&t.push(`resize=${e.resize}`),e.format&&t.push(`format=${e.format}`),e.quality&&t.push(`quality=${e.quality}`),t.join("&")}}const Hr="2.7.1",zr={"X-Client-Info":`storage-js/${Hr}`};var ie=function(n,e,t,s){function i(a){return a instanceof t?a:new t(function(o){o(a)})}return new(t||(t=Promise))(function(a,o){function l(d){try{u(s.next(d))}catch(h){o(h)}}function c(d){try{u(s.throw(d))}catch(h){o(h)}}function u(d){d.done?a(d.value):i(d.value).then(l,c)}u((s=s.apply(n,e||[])).next())})};class Kr{constructor(e,t={},s){this.url=e,this.headers=Object.assign(Object.assign({},zr),t),this.fetch=os(s)}listBuckets(){return ie(this,void 0,void 0,function*(){try{return{data:yield De(this.fetch,`${this.url}/bucket`,{headers:this.headers}),error:null}}catch(e){if(R(e))return{data:null,error:e};throw e}})}getBucket(e){return ie(this,void 0,void 0,function*(){try{return{data:yield De(this.fetch,`${this.url}/bucket/${e}`,{headers:this.headers}),error:null}}catch(t){if(R(t))return{data:null,error:t};throw t}})}createBucket(e,t={public:!1}){return ie(this,void 0,void 0,function*(){try{return{data:yield Z(this.fetch,`${this.url}/bucket`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(s){if(R(s))return{data:null,error:s};throw s}})}updateBucket(e,t){return ie(this,void 0,void 0,function*(){try{return{data:yield Wr(this.fetch,`${this.url}/bucket/${e}`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(s){if(R(s))return{data:null,error:s};throw s}})}emptyBucket(e){return ie(this,void 0,void 0,function*(){try{return{data:yield Z(this.fetch,`${this.url}/bucket/${e}/empty`,{},{headers:this.headers}),error:null}}catch(t){if(R(t))return{data:null,error:t};throw t}})}deleteBucket(e){return ie(this,void 0,void 0,function*(){try{return{data:yield ls(this.fetch,`${this.url}/bucket/${e}`,{},{headers:this.headers}),error:null}}catch(t){if(R(t))return{data:null,error:t};throw t}})}}class Vr extends Kr{constructor(e,t={},s){super(e,t,s)}from(e){return new Jr(this.url,this.headers,e,this.fetch)}}const Gr="2.50.2";let pe="";typeof Deno<"u"?pe="deno":typeof document<"u"?pe="web":typeof navigator<"u"&&navigator.product==="ReactNative"?pe="react-native":pe="node";const Zr={"X-Client-Info":`supabase-js-${pe}/${Gr}`},Qr={headers:Zr},Yr={schema:"public"},Xr={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},en={};var tn=function(n,e,t,s){function i(a){return a instanceof t?a:new t(function(o){o(a)})}return new(t||(t=Promise))(function(a,o){function l(d){try{u(s.next(d))}catch(h){o(h)}}function c(d){try{u(s.throw(d))}catch(h){o(h)}}function u(d){d.done?a(d.value):i(d.value).then(l,c)}u((s=s.apply(n,e||[])).next())})};const sn=n=>{let e;return n?e=n:typeof fetch>"u"?e=zt:e=fetch,(...t)=>e(...t)},rn=()=>typeof Headers>"u"?Kt:Headers,nn=(n,e,t)=>{const s=sn(t),i=rn();return(a,o)=>tn(void 0,void 0,void 0,function*(){var l;const c=(l=yield e())!==null&&l!==void 0?l:n;let u=new i(o==null?void 0:o.headers);return u.has("apikey")||u.set("apikey",n),u.has("Authorization")||u.set("Authorization",`Bearer ${c}`),s(a,Object.assign(Object.assign({},o),{headers:u}))})};var an=function(n,e,t,s){function i(a){return a instanceof t?a:new t(function(o){o(a)})}return new(t||(t=Promise))(function(a,o){function l(d){try{u(s.next(d))}catch(h){o(h)}}function c(d){try{u(s.throw(d))}catch(h){o(h)}}function u(d){d.done?a(d.value):i(d.value).then(l,c)}u((s=s.apply(n,e||[])).next())})};function on(n){return n.endsWith("/")?n:n+"/"}function ln(n,e){var t,s;const{db:i,auth:a,realtime:o,global:l}=n,{db:c,auth:u,realtime:d,global:h}=e,f={db:Object.assign(Object.assign({},c),i),auth:Object.assign(Object.assign({},u),a),realtime:Object.assign(Object.assign({},d),o),global:Object.assign(Object.assign(Object.assign({},h),l),{headers:Object.assign(Object.assign({},(t=h==null?void 0:h.headers)!==null&&t!==void 0?t:{}),(s=l==null?void 0:l.headers)!==null&&s!==void 0?s:{})}),accessToken:()=>an(this,void 0,void 0,function*(){return""})};return n.accessToken?f.accessToken=n.accessToken:delete f.accessToken,f}const cs="2.70.0",ce=30*1e3,dt=3,Ye=dt*ce,cn="http://localhost:9999",dn="supabase.auth.token",un={"X-Client-Info":`gotrue-js/${cs}`},ut="X-Supabase-Api-Version",ds={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}},hn=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i,fn=6e5;class yt extends Error{constructor(e,t,s){super(e),this.__isAuthError=!0,this.name="AuthError",this.status=t,this.code=s}}function T(n){return typeof n=="object"&&n!==null&&"__isAuthError"in n}class mn extends yt{constructor(e,t,s){super(e,t,s),this.name="AuthApiError",this.status=t,this.code=s}}function gn(n){return T(n)&&n.name==="AuthApiError"}class us extends yt{constructor(e,t){super(e),this.name="AuthUnknownError",this.originalError=t}}class Y extends yt{constructor(e,t,s,i){super(e,s,i),this.name=t,this.status=s}}class G extends Y{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}function pn(n){return T(n)&&n.name==="AuthSessionMissingError"}class Pe extends Y{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class Ae extends Y{constructor(e){super(e,"AuthInvalidCredentialsError",400,void 0)}}class $e extends Y{constructor(e,t=null){super(e,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}function xn(n){return T(n)&&n.name==="AuthImplicitGrantRedirectError"}class Ct extends Y{constructor(e,t=null){super(e,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class ht extends Y{constructor(e,t){super(e,"AuthRetryableFetchError",t,void 0)}}function Xe(n){return T(n)&&n.name==="AuthRetryableFetchError"}class It extends Y{constructor(e,t,s){super(e,"AuthWeakPasswordError",t,"weak_password"),this.reasons=s}}class we extends Y{constructor(e){super(e,"AuthInvalidJwtError",400,"invalid_jwt")}}const Ue="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),Rt=` 	
\r=`.split(""),yn=(()=>{const n=new Array(128);for(let e=0;e<n.length;e+=1)n[e]=-1;for(let e=0;e<Rt.length;e+=1)n[Rt[e].charCodeAt(0)]=-2;for(let e=0;e<Ue.length;e+=1)n[Ue[e].charCodeAt(0)]=e;return n})();function Dt(n,e,t){if(n!==null)for(e.queue=e.queue<<8|n,e.queuedBits+=8;e.queuedBits>=6;){const s=e.queue>>e.queuedBits-6&63;t(Ue[s]),e.queuedBits-=6}else if(e.queuedBits>0)for(e.queue=e.queue<<6-e.queuedBits,e.queuedBits=6;e.queuedBits>=6;){const s=e.queue>>e.queuedBits-6&63;t(Ue[s]),e.queuedBits-=6}}function hs(n,e,t){const s=yn[n];if(s>-1)for(e.queue=e.queue<<6|s,e.queuedBits+=6;e.queuedBits>=8;)t(e.queue>>e.queuedBits-8&255),e.queuedBits-=8;else{if(s===-2)return;throw new Error(`Invalid Base64-URL character "${String.fromCharCode(n)}"`)}}function Ut(n){const e=[],t=o=>{e.push(String.fromCodePoint(o))},s={utf8seq:0,codepoint:0},i={queue:0,queuedBits:0},a=o=>{bn(o,s,t)};for(let o=0;o<n.length;o+=1)hs(n.charCodeAt(o),i,a);return e.join("")}function wn(n,e){if(n<=127){e(n);return}else if(n<=2047){e(192|n>>6),e(128|n&63);return}else if(n<=65535){e(224|n>>12),e(128|n>>6&63),e(128|n&63);return}else if(n<=1114111){e(240|n>>18),e(128|n>>12&63),e(128|n>>6&63),e(128|n&63);return}throw new Error(`Unrecognized Unicode codepoint: ${n.toString(16)}`)}function vn(n,e){for(let t=0;t<n.length;t+=1){let s=n.charCodeAt(t);if(s>55295&&s<=56319){const i=(s-55296)*1024&65535;s=(n.charCodeAt(t+1)-56320&65535|i)+65536,t+=1}wn(s,e)}}function bn(n,e,t){if(e.utf8seq===0){if(n<=127){t(n);return}for(let s=1;s<6;s+=1)if(!(n>>7-s&1)){e.utf8seq=s;break}if(e.utf8seq===2)e.codepoint=n&31;else if(e.utf8seq===3)e.codepoint=n&15;else if(e.utf8seq===4)e.codepoint=n&7;else throw new Error("Invalid UTF-8 sequence");e.utf8seq-=1}else if(e.utf8seq>0){if(n<=127)throw new Error("Invalid UTF-8 sequence");e.codepoint=e.codepoint<<6|n&63,e.utf8seq-=1,e.utf8seq===0&&t(e.codepoint)}}function _n(n){const e=[],t={queue:0,queuedBits:0},s=i=>{e.push(i)};for(let i=0;i<n.length;i+=1)hs(n.charCodeAt(i),t,s);return new Uint8Array(e)}function jn(n){const e=[];return vn(n,t=>e.push(t)),new Uint8Array(e)}function Nn(n){const e=[],t={queue:0,queuedBits:0},s=i=>{e.push(i)};return n.forEach(i=>Dt(i,t,s)),Dt(null,t,s),e.join("")}function kn(n){return Math.round(Date.now()/1e3)+n}function Sn(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(n){const e=Math.random()*16|0;return(n=="x"?e:e&3|8).toString(16)})}const F=()=>typeof window<"u"&&typeof document<"u",te={tested:!1,writable:!1},ve=()=>{if(!F())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(te.tested)return te.writable;const n=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(n,n),globalThis.localStorage.removeItem(n),te.tested=!0,te.writable=!0}catch{te.tested=!0,te.writable=!1}return te.writable};function Tn(n){const e={},t=new URL(n);if(t.hash&&t.hash[0]==="#")try{new URLSearchParams(t.hash.substring(1)).forEach((i,a)=>{e[a]=i})}catch{}return t.searchParams.forEach((s,i)=>{e[i]=s}),e}const fs=n=>{let e;return n?e=n:typeof fetch>"u"?e=(...t)=>ke(async()=>{const{default:s}=await Promise.resolve().then(()=>he);return{default:s}},void 0).then(({default:s})=>s(...t)):e=fetch,(...t)=>e(...t)},En=n=>typeof n=="object"&&n!==null&&"status"in n&&"ok"in n&&"json"in n&&typeof n.json=="function",ms=async(n,e,t)=>{await n.setItem(e,JSON.stringify(t))},Oe=async(n,e)=>{const t=await n.getItem(e);if(!t)return null;try{return JSON.parse(t)}catch{return t}},Ce=async(n,e)=>{await n.removeItem(e)};class ze{constructor(){this.promise=new ze.promiseConstructor((e,t)=>{this.resolve=e,this.reject=t})}}ze.promiseConstructor=Promise;function et(n){const e=n.split(".");if(e.length!==3)throw new we("Invalid JWT structure");for(let s=0;s<e.length;s++)if(!hn.test(e[s]))throw new we("JWT not in base64url format");return{header:JSON.parse(Ut(e[0])),payload:JSON.parse(Ut(e[1])),signature:_n(e[2]),raw:{header:e[0],payload:e[1]}}}async function Pn(n){return await new Promise(e=>{setTimeout(()=>e(null),n)})}function An(n,e){return new Promise((s,i)=>{(async()=>{for(let a=0;a<1/0;a++)try{const o=await n(a);if(!e(a,null,o)){s(o);return}}catch(o){if(!e(a,o)){i(o);return}}})()})}function $n(n){return("0"+n.toString(16)).substr(-2)}function On(){const e=new Uint32Array(56);if(typeof crypto>"u"){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",s=t.length;let i="";for(let a=0;a<56;a++)i+=t.charAt(Math.floor(Math.random()*s));return i}return crypto.getRandomValues(e),Array.from(e,$n).join("")}async function Cn(n){const t=new TextEncoder().encode(n),s=await crypto.subtle.digest("SHA-256",t),i=new Uint8Array(s);return Array.from(i).map(a=>String.fromCharCode(a)).join("")}async function In(n){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),n;const t=await Cn(n);return btoa(t).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function ae(n,e,t=!1){const s=On();let i=s;t&&(i+="/PASSWORD_RECOVERY"),await ms(n,`${e}-code-verifier`,i);const a=await In(s);return[a,s===a?"plain":"s256"]}const Rn=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function Dn(n){const e=n.headers.get(ut);if(!e||!e.match(Rn))return null;try{return new Date(`${e}T00:00:00.0Z`)}catch{return null}}function Un(n){if(!n)throw new Error("Missing exp claim");const e=Math.floor(Date.now()/1e3);if(n<=e)throw new Error("JWT has expired")}function Ln(n){switch(n){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}const Bn=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/;function oe(n){if(!Bn.test(n))throw new Error("@supabase/auth-js: Expected parameter to be UUID but is not")}var Mn=function(n,e){var t={};for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&e.indexOf(s)<0&&(t[s]=n[s]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,s=Object.getOwnPropertySymbols(n);i<s.length;i++)e.indexOf(s[i])<0&&Object.prototype.propertyIsEnumerable.call(n,s[i])&&(t[s[i]]=n[s[i]]);return t};const se=n=>n.msg||n.message||n.error_description||n.error||JSON.stringify(n),Wn=[502,503,504];async function Lt(n){var e;if(!En(n))throw new ht(se(n),0);if(Wn.includes(n.status))throw new ht(se(n),n.status);let t;try{t=await n.json()}catch(a){throw new us(se(a),a)}let s;const i=Dn(n);if(i&&i.getTime()>=ds["2024-01-01"].timestamp&&typeof t=="object"&&t&&typeof t.code=="string"?s=t.code:typeof t=="object"&&t&&typeof t.error_code=="string"&&(s=t.error_code),s){if(s==="weak_password")throw new It(se(t),n.status,((e=t.weak_password)===null||e===void 0?void 0:e.reasons)||[]);if(s==="session_not_found")throw new G}else if(typeof t=="object"&&t&&typeof t.weak_password=="object"&&t.weak_password&&Array.isArray(t.weak_password.reasons)&&t.weak_password.reasons.length&&t.weak_password.reasons.reduce((a,o)=>a&&typeof o=="string",!0))throw new It(se(t),n.status,t.weak_password.reasons);throw new mn(se(t),n.status||500,s)}const qn=(n,e,t,s)=>{const i={method:n,headers:(e==null?void 0:e.headers)||{}};return n==="GET"?i:(i.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},e==null?void 0:e.headers),i.body=JSON.stringify(s),Object.assign(Object.assign({},i),t))};async function P(n,e,t,s){var i;const a=Object.assign({},s==null?void 0:s.headers);a[ut]||(a[ut]=ds["2024-01-01"].name),s!=null&&s.jwt&&(a.Authorization=`Bearer ${s.jwt}`);const o=(i=s==null?void 0:s.query)!==null&&i!==void 0?i:{};s!=null&&s.redirectTo&&(o.redirect_to=s.redirectTo);const l=Object.keys(o).length?"?"+new URLSearchParams(o).toString():"",c=await Fn(n,e,t+l,{headers:a,noResolveJson:s==null?void 0:s.noResolveJson},{},s==null?void 0:s.body);return s!=null&&s.xform?s==null?void 0:s.xform(c):{data:Object.assign({},c),error:null}}async function Fn(n,e,t,s,i,a){const o=qn(e,s,i,a);let l;try{l=await n(t,Object.assign({},o))}catch(c){throw console.error(c),new ht(se(c),0)}if(l.ok||await Lt(l),s!=null&&s.noResolveJson)return l;try{return await l.json()}catch(c){await Lt(c)}}function K(n){var e;let t=null;Kn(n)&&(t=Object.assign({},n),n.expires_at||(t.expires_at=kn(n.expires_in)));const s=(e=n.user)!==null&&e!==void 0?e:n;return{data:{session:t,user:s},error:null}}function Bt(n){const e=K(n);return!e.error&&n.weak_password&&typeof n.weak_password=="object"&&Array.isArray(n.weak_password.reasons)&&n.weak_password.reasons.length&&n.weak_password.message&&typeof n.weak_password.message=="string"&&n.weak_password.reasons.reduce((t,s)=>t&&typeof s=="string",!0)&&(e.data.weak_password=n.weak_password),e}function Q(n){var e;return{data:{user:(e=n.user)!==null&&e!==void 0?e:n},error:null}}function Jn(n){return{data:n,error:null}}function Hn(n){const{action_link:e,email_otp:t,hashed_token:s,redirect_to:i,verification_type:a}=n,o=Mn(n,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),l={action_link:e,email_otp:t,hashed_token:s,redirect_to:i,verification_type:a},c=Object.assign({},o);return{data:{properties:l,user:c},error:null}}function zn(n){return n}function Kn(n){return n.access_token&&n.refresh_token&&n.expires_in}const tt=["global","local","others"];var Vn=function(n,e){var t={};for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&e.indexOf(s)<0&&(t[s]=n[s]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,s=Object.getOwnPropertySymbols(n);i<s.length;i++)e.indexOf(s[i])<0&&Object.prototype.propertyIsEnumerable.call(n,s[i])&&(t[s[i]]=n[s[i]]);return t};class Gn{constructor({url:e="",headers:t={},fetch:s}){this.url=e,this.headers=t,this.fetch=fs(s),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)}}async signOut(e,t=tt[0]){if(tt.indexOf(t)<0)throw new Error(`@supabase/auth-js: Parameter scope must be one of ${tt.join(", ")}`);try{return await P(this.fetch,"POST",`${this.url}/logout?scope=${t}`,{headers:this.headers,jwt:e,noResolveJson:!0}),{data:null,error:null}}catch(s){if(T(s))return{data:null,error:s};throw s}}async inviteUserByEmail(e,t={}){try{return await P(this.fetch,"POST",`${this.url}/invite`,{body:{email:e,data:t.data},headers:this.headers,redirectTo:t.redirectTo,xform:Q})}catch(s){if(T(s))return{data:{user:null},error:s};throw s}}async generateLink(e){try{const{options:t}=e,s=Vn(e,["options"]),i=Object.assign(Object.assign({},s),t);return"newEmail"in s&&(i.new_email=s==null?void 0:s.newEmail,delete i.newEmail),await P(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:i,headers:this.headers,xform:Hn,redirectTo:t==null?void 0:t.redirectTo})}catch(t){if(T(t))return{data:{properties:null,user:null},error:t};throw t}}async createUser(e){try{return await P(this.fetch,"POST",`${this.url}/admin/users`,{body:e,headers:this.headers,xform:Q})}catch(t){if(T(t))return{data:{user:null},error:t};throw t}}async listUsers(e){var t,s,i,a,o,l,c;try{const u={nextPage:null,lastPage:0,total:0},d=await P(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(s=(t=e==null?void 0:e.page)===null||t===void 0?void 0:t.toString())!==null&&s!==void 0?s:"",per_page:(a=(i=e==null?void 0:e.perPage)===null||i===void 0?void 0:i.toString())!==null&&a!==void 0?a:""},xform:zn});if(d.error)throw d.error;const h=await d.json(),f=(o=d.headers.get("x-total-count"))!==null&&o!==void 0?o:0,g=(c=(l=d.headers.get("link"))===null||l===void 0?void 0:l.split(","))!==null&&c!==void 0?c:[];return g.length>0&&(g.forEach(y=>{const N=parseInt(y.split(";")[0].split("=")[1].substring(0,1)),b=JSON.parse(y.split(";")[1].split("=")[1]);u[`${b}Page`]=N}),u.total=parseInt(f)),{data:Object.assign(Object.assign({},h),u),error:null}}catch(u){if(T(u))return{data:{users:[]},error:u};throw u}}async getUserById(e){oe(e);try{return await P(this.fetch,"GET",`${this.url}/admin/users/${e}`,{headers:this.headers,xform:Q})}catch(t){if(T(t))return{data:{user:null},error:t};throw t}}async updateUserById(e,t){oe(e);try{return await P(this.fetch,"PUT",`${this.url}/admin/users/${e}`,{body:t,headers:this.headers,xform:Q})}catch(s){if(T(s))return{data:{user:null},error:s};throw s}}async deleteUser(e,t=!1){oe(e);try{return await P(this.fetch,"DELETE",`${this.url}/admin/users/${e}`,{headers:this.headers,body:{should_soft_delete:t},xform:Q})}catch(s){if(T(s))return{data:{user:null},error:s};throw s}}async _listFactors(e){oe(e.userId);try{const{data:t,error:s}=await P(this.fetch,"GET",`${this.url}/admin/users/${e.userId}/factors`,{headers:this.headers,xform:i=>({data:{factors:i},error:null})});return{data:t,error:s}}catch(t){if(T(t))return{data:null,error:t};throw t}}async _deleteFactor(e){oe(e.userId),oe(e.id);try{return{data:await P(this.fetch,"DELETE",`${this.url}/admin/users/${e.userId}/factors/${e.id}`,{headers:this.headers}),error:null}}catch(t){if(T(t))return{data:null,error:t};throw t}}}const Zn={getItem:n=>ve()?globalThis.localStorage.getItem(n):null,setItem:(n,e)=>{ve()&&globalThis.localStorage.setItem(n,e)},removeItem:n=>{ve()&&globalThis.localStorage.removeItem(n)}};function Mt(n={}){return{getItem:e=>n[e]||null,setItem:(e,t)=>{n[e]=t},removeItem:e=>{delete n[e]}}}function Qn(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}const le={debug:!!(globalThis&&ve()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class gs extends Error{constructor(e){super(e),this.isAcquireTimeout=!0}}class Yn extends gs{}async function Xn(n,e,t){le.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",n,e);const s=new globalThis.AbortController;return e>0&&setTimeout(()=>{s.abort(),le.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",n)},e),await Promise.resolve().then(()=>globalThis.navigator.locks.request(n,e===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:s.signal},async i=>{if(i){le.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",n,i.name);try{return await t()}finally{le.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",n,i.name)}}else{if(e===0)throw le.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",n),new Yn(`Acquiring an exclusive Navigator LockManager lock "${n}" immediately failed`);if(le.debug)try{const a=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(a,null,"  "))}catch(a){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",a)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await t()}}))}Qn();const ei={url:cn,storageKey:dn,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:un,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1};async function Wt(n,e,t){return await t()}class Ne{constructor(e){var t,s;this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log,this.instanceID=Ne.nextInstanceID,Ne.nextInstanceID+=1,this.instanceID>0&&F()&&console.warn("Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.");const i=Object.assign(Object.assign({},ei),e);if(this.logDebugMessages=!!i.debug,typeof i.debug=="function"&&(this.logger=i.debug),this.persistSession=i.persistSession,this.storageKey=i.storageKey,this.autoRefreshToken=i.autoRefreshToken,this.admin=new Gn({url:i.url,headers:i.headers,fetch:i.fetch}),this.url=i.url,this.headers=i.headers,this.fetch=fs(i.fetch),this.lock=i.lock||Wt,this.detectSessionInUrl=i.detectSessionInUrl,this.flowType=i.flowType,this.hasCustomAuthorizationHeader=i.hasCustomAuthorizationHeader,i.lock?this.lock=i.lock:F()&&(!((t=globalThis==null?void 0:globalThis.navigator)===null||t===void 0)&&t.locks)?this.lock=Xn:this.lock=Wt,this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER,this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this)},this.persistSession?i.storage?this.storage=i.storage:ve()?this.storage=Zn:(this.memoryStorage={},this.storage=Mt(this.memoryStorage)):(this.memoryStorage={},this.storage=Mt(this.memoryStorage)),F()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(a){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",a)}(s=this.broadcastChannel)===null||s===void 0||s.addEventListener("message",async a=>{this._debug("received broadcast notification from other tab or client",a),await this._notifyAllSubscribers(a.data.event,a.data.session,!1)})}this.initialize()}_debug(...e){return this.logDebugMessages&&this.logger(`GoTrueClient@${this.instanceID} (${cs}) ${new Date().toISOString()}`,...e),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(-1,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){var e;try{const t=Tn(window.location.href);let s="none";if(this._isImplicitGrantCallback(t)?s="implicit":await this._isPKCECallback(t)&&(s="pkce"),F()&&this.detectSessionInUrl&&s!=="none"){const{data:i,error:a}=await this._getSessionFromURL(t,s);if(a){if(this._debug("#_initialize()","error detecting session from URL",a),xn(a)){const c=(e=a.details)===null||e===void 0?void 0:e.code;if(c==="identity_already_exists"||c==="identity_not_found"||c==="single_identity_not_deletable")return{error:a}}return await this._removeSession(),{error:a}}const{session:o,redirectType:l}=i;return this._debug("#_initialize()","detected session in URL",o,"redirect type",l),await this._saveSession(o),setTimeout(async()=>{l==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",o):await this._notifyAllSubscribers("SIGNED_IN",o)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(t){return T(t)?{error:t}:{error:new us("Unexpected error during initialization",t)}}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(e){var t,s,i;try{const a=await P(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(s=(t=e==null?void 0:e.options)===null||t===void 0?void 0:t.data)!==null&&s!==void 0?s:{},gotrue_meta_security:{captcha_token:(i=e==null?void 0:e.options)===null||i===void 0?void 0:i.captchaToken}},xform:K}),{data:o,error:l}=a;if(l||!o)return{data:{user:null,session:null},error:l};const c=o.session,u=o.user;return o.session&&(await this._saveSession(o.session),await this._notifyAllSubscribers("SIGNED_IN",c)),{data:{user:u,session:c},error:null}}catch(a){if(T(a))return{data:{user:null,session:null},error:a};throw a}}async signUp(e){var t,s,i;try{let a;if("email"in e){const{email:d,password:h,options:f}=e;let g=null,y=null;this.flowType==="pkce"&&([g,y]=await ae(this.storage,this.storageKey)),a=await P(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:f==null?void 0:f.emailRedirectTo,body:{email:d,password:h,data:(t=f==null?void 0:f.data)!==null&&t!==void 0?t:{},gotrue_meta_security:{captcha_token:f==null?void 0:f.captchaToken},code_challenge:g,code_challenge_method:y},xform:K})}else if("phone"in e){const{phone:d,password:h,options:f}=e;a=await P(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:d,password:h,data:(s=f==null?void 0:f.data)!==null&&s!==void 0?s:{},channel:(i=f==null?void 0:f.channel)!==null&&i!==void 0?i:"sms",gotrue_meta_security:{captcha_token:f==null?void 0:f.captchaToken}},xform:K})}else throw new Ae("You must provide either an email or phone number and a password");const{data:o,error:l}=a;if(l||!o)return{data:{user:null,session:null},error:l};const c=o.session,u=o.user;return o.session&&(await this._saveSession(o.session),await this._notifyAllSubscribers("SIGNED_IN",c)),{data:{user:u,session:c},error:null}}catch(a){if(T(a))return{data:{user:null,session:null},error:a};throw a}}async signInWithPassword(e){try{let t;if("email"in e){const{email:a,password:o,options:l}=e;t=await P(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:a,password:o,gotrue_meta_security:{captcha_token:l==null?void 0:l.captchaToken}},xform:Bt})}else if("phone"in e){const{phone:a,password:o,options:l}=e;t=await P(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:a,password:o,gotrue_meta_security:{captcha_token:l==null?void 0:l.captchaToken}},xform:Bt})}else throw new Ae("You must provide either an email or phone number and a password");const{data:s,error:i}=t;return i?{data:{user:null,session:null},error:i}:!s||!s.session||!s.user?{data:{user:null,session:null},error:new Pe}:(s.session&&(await this._saveSession(s.session),await this._notifyAllSubscribers("SIGNED_IN",s.session)),{data:Object.assign({user:s.user,session:s.session},s.weak_password?{weakPassword:s.weak_password}:null),error:i})}catch(t){if(T(t))return{data:{user:null,session:null},error:t};throw t}}async signInWithOAuth(e){var t,s,i,a;return await this._handleProviderSignIn(e.provider,{redirectTo:(t=e.options)===null||t===void 0?void 0:t.redirectTo,scopes:(s=e.options)===null||s===void 0?void 0:s.scopes,queryParams:(i=e.options)===null||i===void 0?void 0:i.queryParams,skipBrowserRedirect:(a=e.options)===null||a===void 0?void 0:a.skipBrowserRedirect})}async exchangeCodeForSession(e){return await this.initializePromise,this._acquireLock(-1,async()=>this._exchangeCodeForSession(e))}async signInWithWeb3(e){const{chain:t}=e;if(t==="solana")return await this.signInWithSolana(e);throw new Error(`@supabase/auth-js: Unsupported chain "${t}"`)}async signInWithSolana(e){var t,s,i,a,o,l,c,u,d,h,f,g;let y,N;if("message"in e)y=e.message,N=e.signature;else{const{chain:b,wallet:k,statement:v,options:x}=e;let w;if(F())if(typeof k=="object")w=k;else{const m=window;if("solana"in m&&typeof m.solana=="object"&&("signIn"in m.solana&&typeof m.solana.signIn=="function"||"signMessage"in m.solana&&typeof m.solana.signMessage=="function"))w=m.solana;else throw new Error("@supabase/auth-js: No compatible Solana wallet interface on the window object (window.solana) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'solana', wallet: resolvedUserWallet }) instead.")}else{if(typeof k!="object"||!(x!=null&&x.url))throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");w=k}const p=new URL((t=x==null?void 0:x.url)!==null&&t!==void 0?t:window.location.href);if("signIn"in w&&w.signIn){const m=await w.signIn(Object.assign(Object.assign(Object.assign({issuedAt:new Date().toISOString()},x==null?void 0:x.signInWithSolana),{version:"1",domain:p.host,uri:p.href}),v?{statement:v}:null));let _;if(Array.isArray(m)&&m[0]&&typeof m[0]=="object")_=m[0];else if(m&&typeof m=="object"&&"signedMessage"in m&&"signature"in m)_=m;else throw new Error("@supabase/auth-js: Wallet method signIn() returned unrecognized value");if("signedMessage"in _&&"signature"in _&&(typeof _.signedMessage=="string"||_.signedMessage instanceof Uint8Array)&&_.signature instanceof Uint8Array)y=typeof _.signedMessage=="string"?_.signedMessage:new TextDecoder().decode(_.signedMessage),N=_.signature;else throw new Error("@supabase/auth-js: Wallet method signIn() API returned object without signedMessage and signature fields")}else{if(!("signMessage"in w)||typeof w.signMessage!="function"||!("publicKey"in w)||typeof w!="object"||!w.publicKey||!("toBase58"in w.publicKey)||typeof w.publicKey.toBase58!="function")throw new Error("@supabase/auth-js: Wallet does not have a compatible signMessage() and publicKey.toBase58() API");y=[`${p.host} wants you to sign in with your Solana account:`,w.publicKey.toBase58(),...v?["",v,""]:[""],"Version: 1",`URI: ${p.href}`,`Issued At: ${(i=(s=x==null?void 0:x.signInWithSolana)===null||s===void 0?void 0:s.issuedAt)!==null&&i!==void 0?i:new Date().toISOString()}`,...!((a=x==null?void 0:x.signInWithSolana)===null||a===void 0)&&a.notBefore?[`Not Before: ${x.signInWithSolana.notBefore}`]:[],...!((o=x==null?void 0:x.signInWithSolana)===null||o===void 0)&&o.expirationTime?[`Expiration Time: ${x.signInWithSolana.expirationTime}`]:[],...!((l=x==null?void 0:x.signInWithSolana)===null||l===void 0)&&l.chainId?[`Chain ID: ${x.signInWithSolana.chainId}`]:[],...!((c=x==null?void 0:x.signInWithSolana)===null||c===void 0)&&c.nonce?[`Nonce: ${x.signInWithSolana.nonce}`]:[],...!((u=x==null?void 0:x.signInWithSolana)===null||u===void 0)&&u.requestId?[`Request ID: ${x.signInWithSolana.requestId}`]:[],...!((h=(d=x==null?void 0:x.signInWithSolana)===null||d===void 0?void 0:d.resources)===null||h===void 0)&&h.length?["Resources",...x.signInWithSolana.resources.map(_=>`- ${_}`)]:[]].join(`
`);const m=await w.signMessage(new TextEncoder().encode(y),"utf8");if(!m||!(m instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet signMessage() API returned an recognized value");N=m}}try{const{data:b,error:k}=await P(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"solana",message:y,signature:Nn(N)},!((f=e.options)===null||f===void 0)&&f.captchaToken?{gotrue_meta_security:{captcha_token:(g=e.options)===null||g===void 0?void 0:g.captchaToken}}:null),xform:K});if(k)throw k;return!b||!b.session||!b.user?{data:{user:null,session:null},error:new Pe}:(b.session&&(await this._saveSession(b.session),await this._notifyAllSubscribers("SIGNED_IN",b.session)),{data:Object.assign({},b),error:k})}catch(b){if(T(b))return{data:{user:null,session:null},error:b};throw b}}async _exchangeCodeForSession(e){const t=await Oe(this.storage,`${this.storageKey}-code-verifier`),[s,i]=(t??"").split("/");try{const{data:a,error:o}=await P(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:e,code_verifier:s},xform:K});if(await Ce(this.storage,`${this.storageKey}-code-verifier`),o)throw o;return!a||!a.session||!a.user?{data:{user:null,session:null,redirectType:null},error:new Pe}:(a.session&&(await this._saveSession(a.session),await this._notifyAllSubscribers("SIGNED_IN",a.session)),{data:Object.assign(Object.assign({},a),{redirectType:i??null}),error:o})}catch(a){if(T(a))return{data:{user:null,session:null,redirectType:null},error:a};throw a}}async signInWithIdToken(e){try{const{options:t,provider:s,token:i,access_token:a,nonce:o}=e,l=await P(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:s,id_token:i,access_token:a,nonce:o,gotrue_meta_security:{captcha_token:t==null?void 0:t.captchaToken}},xform:K}),{data:c,error:u}=l;return u?{data:{user:null,session:null},error:u}:!c||!c.session||!c.user?{data:{user:null,session:null},error:new Pe}:(c.session&&(await this._saveSession(c.session),await this._notifyAllSubscribers("SIGNED_IN",c.session)),{data:c,error:u})}catch(t){if(T(t))return{data:{user:null,session:null},error:t};throw t}}async signInWithOtp(e){var t,s,i,a,o;try{if("email"in e){const{email:l,options:c}=e;let u=null,d=null;this.flowType==="pkce"&&([u,d]=await ae(this.storage,this.storageKey));const{error:h}=await P(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:l,data:(t=c==null?void 0:c.data)!==null&&t!==void 0?t:{},create_user:(s=c==null?void 0:c.shouldCreateUser)!==null&&s!==void 0?s:!0,gotrue_meta_security:{captcha_token:c==null?void 0:c.captchaToken},code_challenge:u,code_challenge_method:d},redirectTo:c==null?void 0:c.emailRedirectTo});return{data:{user:null,session:null},error:h}}if("phone"in e){const{phone:l,options:c}=e,{data:u,error:d}=await P(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:l,data:(i=c==null?void 0:c.data)!==null&&i!==void 0?i:{},create_user:(a=c==null?void 0:c.shouldCreateUser)!==null&&a!==void 0?a:!0,gotrue_meta_security:{captcha_token:c==null?void 0:c.captchaToken},channel:(o=c==null?void 0:c.channel)!==null&&o!==void 0?o:"sms"}});return{data:{user:null,session:null,messageId:u==null?void 0:u.message_id},error:d}}throw new Ae("You must provide either an email or phone number.")}catch(l){if(T(l))return{data:{user:null,session:null},error:l};throw l}}async verifyOtp(e){var t,s;try{let i,a;"options"in e&&(i=(t=e.options)===null||t===void 0?void 0:t.redirectTo,a=(s=e.options)===null||s===void 0?void 0:s.captchaToken);const{data:o,error:l}=await P(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},e),{gotrue_meta_security:{captcha_token:a}}),redirectTo:i,xform:K});if(l)throw l;if(!o)throw new Error("An error occurred on token verification.");const c=o.session,u=o.user;return c!=null&&c.access_token&&(await this._saveSession(c),await this._notifyAllSubscribers(e.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",c)),{data:{user:u,session:c},error:null}}catch(i){if(T(i))return{data:{user:null,session:null},error:i};throw i}}async signInWithSSO(e){var t,s,i;try{let a=null,o=null;return this.flowType==="pkce"&&([a,o]=await ae(this.storage,this.storageKey)),await P(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in e?{provider_id:e.providerId}:null),"domain"in e?{domain:e.domain}:null),{redirect_to:(s=(t=e.options)===null||t===void 0?void 0:t.redirectTo)!==null&&s!==void 0?s:void 0}),!((i=e==null?void 0:e.options)===null||i===void 0)&&i.captchaToken?{gotrue_meta_security:{captcha_token:e.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:a,code_challenge_method:o}),headers:this.headers,xform:Jn})}catch(a){if(T(a))return{data:null,error:a};throw a}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async e=>{const{data:{session:t},error:s}=e;if(s)throw s;if(!t)throw new G;const{error:i}=await P(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:t.access_token});return{data:{user:null,session:null},error:i}})}catch(e){if(T(e))return{data:{user:null,session:null},error:e};throw e}}async resend(e){try{const t=`${this.url}/resend`;if("email"in e){const{email:s,type:i,options:a}=e,{error:o}=await P(this.fetch,"POST",t,{headers:this.headers,body:{email:s,type:i,gotrue_meta_security:{captcha_token:a==null?void 0:a.captchaToken}},redirectTo:a==null?void 0:a.emailRedirectTo});return{data:{user:null,session:null},error:o}}else if("phone"in e){const{phone:s,type:i,options:a}=e,{data:o,error:l}=await P(this.fetch,"POST",t,{headers:this.headers,body:{phone:s,type:i,gotrue_meta_security:{captcha_token:a==null?void 0:a.captchaToken}}});return{data:{user:null,session:null,messageId:o==null?void 0:o.message_id},error:l}}throw new Ae("You must provide either an email or phone number and a type")}catch(t){if(T(t))return{data:{user:null,session:null},error:t};throw t}}async getSession(){return await this.initializePromise,await this._acquireLock(-1,async()=>this._useSession(async t=>t))}async _acquireLock(e,t){this._debug("#_acquireLock","begin",e);try{if(this.lockAcquired){const s=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),i=(async()=>(await s,await t()))();return this.pendingInLock.push((async()=>{try{await i}catch{}})()),i}return await this.lock(`lock:${this.storageKey}`,e,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const s=t();for(this.pendingInLock.push((async()=>{try{await s}catch{}})()),await s;this.pendingInLock.length;){const i=[...this.pendingInLock];await Promise.all(i),this.pendingInLock.splice(0,i.length)}return await s}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(e){this._debug("#_useSession","begin");try{const t=await this.__loadSession();return await e(t)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let e=null;const t=await Oe(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",t),t!==null&&(this._isValidSession(t)?e=t:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!e)return{data:{session:null},error:null};const s=e.expires_at?e.expires_at*1e3-Date.now()<Ye:!1;if(this._debug("#__loadSession()",`session has${s?"":" not"} expired`,"expires_at",e.expires_at),!s){if(this.storage.isServer){let o=this.suppressGetSessionWarning;e=new Proxy(e,{get:(c,u,d)=>(!o&&u==="user"&&(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),o=!0,this.suppressGetSessionWarning=!0),Reflect.get(c,u,d))})}return{data:{session:e},error:null}}const{session:i,error:a}=await this._callRefreshToken(e.refresh_token);return a?{data:{session:null},error:a}:{data:{session:i},error:null}}finally{this._debug("#__loadSession()","end")}}async getUser(e){return e?await this._getUser(e):(await this.initializePromise,await this._acquireLock(-1,async()=>await this._getUser()))}async _getUser(e){try{return e?await P(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:e,xform:Q}):await this._useSession(async t=>{var s,i,a;const{data:o,error:l}=t;if(l)throw l;return!(!((s=o.session)===null||s===void 0)&&s.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new G}:await P(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(a=(i=o.session)===null||i===void 0?void 0:i.access_token)!==null&&a!==void 0?a:void 0,xform:Q})})}catch(t){if(T(t))return pn(t)&&(await this._removeSession(),await Ce(this.storage,`${this.storageKey}-code-verifier`)),{data:{user:null},error:t};throw t}}async updateUser(e,t={}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._updateUser(e,t))}async _updateUser(e,t={}){try{return await this._useSession(async s=>{const{data:i,error:a}=s;if(a)throw a;if(!i.session)throw new G;const o=i.session;let l=null,c=null;this.flowType==="pkce"&&e.email!=null&&([l,c]=await ae(this.storage,this.storageKey));const{data:u,error:d}=await P(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:t==null?void 0:t.emailRedirectTo,body:Object.assign(Object.assign({},e),{code_challenge:l,code_challenge_method:c}),jwt:o.access_token,xform:Q});if(d)throw d;return o.user=u.user,await this._saveSession(o),await this._notifyAllSubscribers("USER_UPDATED",o),{data:{user:o.user},error:null}})}catch(s){if(T(s))return{data:{user:null},error:s};throw s}}async setSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._setSession(e))}async _setSession(e){try{if(!e.access_token||!e.refresh_token)throw new G;const t=Date.now()/1e3;let s=t,i=!0,a=null;const{payload:o}=et(e.access_token);if(o.exp&&(s=o.exp,i=s<=t),i){const{session:l,error:c}=await this._callRefreshToken(e.refresh_token);if(c)return{data:{user:null,session:null},error:c};if(!l)return{data:{user:null,session:null},error:null};a=l}else{const{data:l,error:c}=await this._getUser(e.access_token);if(c)throw c;a={access_token:e.access_token,refresh_token:e.refresh_token,user:l.user,token_type:"bearer",expires_in:s-t,expires_at:s},await this._saveSession(a),await this._notifyAllSubscribers("SIGNED_IN",a)}return{data:{user:a.user,session:a},error:null}}catch(t){if(T(t))return{data:{session:null,user:null},error:t};throw t}}async refreshSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._refreshSession(e))}async _refreshSession(e){try{return await this._useSession(async t=>{var s;if(!e){const{data:o,error:l}=t;if(l)throw l;e=(s=o.session)!==null&&s!==void 0?s:void 0}if(!(e!=null&&e.refresh_token))throw new G;const{session:i,error:a}=await this._callRefreshToken(e.refresh_token);return a?{data:{user:null,session:null},error:a}:i?{data:{user:i.user,session:i},error:null}:{data:{user:null,session:null},error:null}})}catch(t){if(T(t))return{data:{user:null,session:null},error:t};throw t}}async _getSessionFromURL(e,t){try{if(!F())throw new $e("No browser detected.");if(e.error||e.error_description||e.error_code)throw new $e(e.error_description||"Error in URL with unspecified error_description",{error:e.error||"unspecified_error",code:e.error_code||"unspecified_code"});switch(t){case"implicit":if(this.flowType==="pkce")throw new Ct("Not a valid PKCE flow url.");break;case"pkce":if(this.flowType==="implicit")throw new $e("Not a valid implicit grant flow url.");break;default:}if(t==="pkce"){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!e.code)throw new Ct("No code detected.");const{data:v,error:x}=await this._exchangeCodeForSession(e.code);if(x)throw x;const w=new URL(window.location.href);return w.searchParams.delete("code"),window.history.replaceState(window.history.state,"",w.toString()),{data:{session:v.session,redirectType:null},error:null}}const{provider_token:s,provider_refresh_token:i,access_token:a,refresh_token:o,expires_in:l,expires_at:c,token_type:u}=e;if(!a||!l||!o||!u)throw new $e("No session defined in URL");const d=Math.round(Date.now()/1e3),h=parseInt(l);let f=d+h;c&&(f=parseInt(c));const g=f-d;g*1e3<=ce&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${g}s, should have been closer to ${h}s`);const y=f-h;d-y>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",y,f,d):d-y<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",y,f,d);const{data:N,error:b}=await this._getUser(a);if(b)throw b;const k={provider_token:s,provider_refresh_token:i,access_token:a,expires_in:h,expires_at:f,refresh_token:o,token_type:u,user:N.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),{data:{session:k,redirectType:e.type},error:null}}catch(s){if(T(s))return{data:{session:null,redirectType:null},error:s};throw s}}_isImplicitGrantCallback(e){return!!(e.access_token||e.error_description)}async _isPKCECallback(e){const t=await Oe(this.storage,`${this.storageKey}-code-verifier`);return!!(e.code&&t)}async signOut(e={scope:"global"}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._signOut(e))}async _signOut({scope:e}={scope:"global"}){return await this._useSession(async t=>{var s;const{data:i,error:a}=t;if(a)return{error:a};const o=(s=i.session)===null||s===void 0?void 0:s.access_token;if(o){const{error:l}=await this.admin.signOut(o,e);if(l&&!(gn(l)&&(l.status===404||l.status===401||l.status===403)))return{error:l}}return e!=="others"&&(await this._removeSession(),await Ce(this.storage,`${this.storageKey}-code-verifier`)),{error:null}})}onAuthStateChange(e){const t=Sn(),s={id:t,callback:e,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",t),this.stateChangeEmitters.delete(t)}};return this._debug("#onAuthStateChange()","registered callback with id",t),this.stateChangeEmitters.set(t,s),(async()=>(await this.initializePromise,await this._acquireLock(-1,async()=>{this._emitInitialSession(t)})))(),{data:{subscription:s}}}async _emitInitialSession(e){return await this._useSession(async t=>{var s,i;try{const{data:{session:a},error:o}=t;if(o)throw o;await((s=this.stateChangeEmitters.get(e))===null||s===void 0?void 0:s.callback("INITIAL_SESSION",a)),this._debug("INITIAL_SESSION","callback id",e,"session",a)}catch(a){await((i=this.stateChangeEmitters.get(e))===null||i===void 0?void 0:i.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",e,"error",a),console.error(a)}})}async resetPasswordForEmail(e,t={}){let s=null,i=null;this.flowType==="pkce"&&([s,i]=await ae(this.storage,this.storageKey,!0));try{return await P(this.fetch,"POST",`${this.url}/recover`,{body:{email:e,code_challenge:s,code_challenge_method:i,gotrue_meta_security:{captcha_token:t.captchaToken}},headers:this.headers,redirectTo:t.redirectTo})}catch(a){if(T(a))return{data:null,error:a};throw a}}async getUserIdentities(){var e;try{const{data:t,error:s}=await this.getUser();if(s)throw s;return{data:{identities:(e=t.user.identities)!==null&&e!==void 0?e:[]},error:null}}catch(t){if(T(t))return{data:null,error:t};throw t}}async linkIdentity(e){var t;try{const{data:s,error:i}=await this._useSession(async a=>{var o,l,c,u,d;const{data:h,error:f}=a;if(f)throw f;const g=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,e.provider,{redirectTo:(o=e.options)===null||o===void 0?void 0:o.redirectTo,scopes:(l=e.options)===null||l===void 0?void 0:l.scopes,queryParams:(c=e.options)===null||c===void 0?void 0:c.queryParams,skipBrowserRedirect:!0});return await P(this.fetch,"GET",g,{headers:this.headers,jwt:(d=(u=h.session)===null||u===void 0?void 0:u.access_token)!==null&&d!==void 0?d:void 0})});if(i)throw i;return F()&&!(!((t=e.options)===null||t===void 0)&&t.skipBrowserRedirect)&&window.location.assign(s==null?void 0:s.url),{data:{provider:e.provider,url:s==null?void 0:s.url},error:null}}catch(s){if(T(s))return{data:{provider:e.provider,url:null},error:s};throw s}}async unlinkIdentity(e){try{return await this._useSession(async t=>{var s,i;const{data:a,error:o}=t;if(o)throw o;return await P(this.fetch,"DELETE",`${this.url}/user/identities/${e.identity_id}`,{headers:this.headers,jwt:(i=(s=a.session)===null||s===void 0?void 0:s.access_token)!==null&&i!==void 0?i:void 0})})}catch(t){if(T(t))return{data:null,error:t};throw t}}async _refreshAccessToken(e){const t=`#_refreshAccessToken(${e.substring(0,5)}...)`;this._debug(t,"begin");try{const s=Date.now();return await An(async i=>(i>0&&await Pn(200*Math.pow(2,i-1)),this._debug(t,"refreshing attempt",i),await P(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:e},headers:this.headers,xform:K})),(i,a)=>{const o=200*Math.pow(2,i);return a&&Xe(a)&&Date.now()+o-s<ce})}catch(s){if(this._debug(t,"error",s),T(s))return{data:{session:null,user:null},error:s};throw s}finally{this._debug(t,"end")}}_isValidSession(e){return typeof e=="object"&&e!==null&&"access_token"in e&&"refresh_token"in e&&"expires_at"in e}async _handleProviderSignIn(e,t){const s=await this._getUrlForProvider(`${this.url}/authorize`,e,{redirectTo:t.redirectTo,scopes:t.scopes,queryParams:t.queryParams});return this._debug("#_handleProviderSignIn()","provider",e,"options",t,"url",s),F()&&!t.skipBrowserRedirect&&window.location.assign(s),{data:{provider:e,url:s},error:null}}async _recoverAndRefresh(){var e;const t="#_recoverAndRefresh()";this._debug(t,"begin");try{const s=await Oe(this.storage,this.storageKey);if(this._debug(t,"session from storage",s),!this._isValidSession(s)){this._debug(t,"session is not valid"),s!==null&&await this._removeSession();return}const i=((e=s.expires_at)!==null&&e!==void 0?e:1/0)*1e3-Date.now()<Ye;if(this._debug(t,`session has${i?"":" not"} expired with margin of ${Ye}s`),i){if(this.autoRefreshToken&&s.refresh_token){const{error:a}=await this._callRefreshToken(s.refresh_token);a&&(console.error(a),Xe(a)||(this._debug(t,"refresh failed with a non-retryable error, removing the session",a),await this._removeSession()))}}else await this._notifyAllSubscribers("SIGNED_IN",s)}catch(s){this._debug(t,"error",s),console.error(s);return}finally{this._debug(t,"end")}}async _callRefreshToken(e){var t,s;if(!e)throw new G;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const i=`#_callRefreshToken(${e.substring(0,5)}...)`;this._debug(i,"begin");try{this.refreshingDeferred=new ze;const{data:a,error:o}=await this._refreshAccessToken(e);if(o)throw o;if(!a.session)throw new G;await this._saveSession(a.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",a.session);const l={session:a.session,error:null};return this.refreshingDeferred.resolve(l),l}catch(a){if(this._debug(i,"error",a),T(a)){const o={session:null,error:a};return Xe(a)||await this._removeSession(),(t=this.refreshingDeferred)===null||t===void 0||t.resolve(o),o}throw(s=this.refreshingDeferred)===null||s===void 0||s.reject(a),a}finally{this.refreshingDeferred=null,this._debug(i,"end")}}async _notifyAllSubscribers(e,t,s=!0){const i=`#_notifyAllSubscribers(${e})`;this._debug(i,"begin",t,`broadcast = ${s}`);try{this.broadcastChannel&&s&&this.broadcastChannel.postMessage({event:e,session:t});const a=[],o=Array.from(this.stateChangeEmitters.values()).map(async l=>{try{await l.callback(e,t)}catch(c){a.push(c)}});if(await Promise.all(o),a.length>0){for(let l=0;l<a.length;l+=1)console.error(a[l]);throw a[0]}}finally{this._debug(i,"end")}}async _saveSession(e){this._debug("#_saveSession()",e),this.suppressGetSessionWarning=!0,await ms(this.storage,this.storageKey,e)}async _removeSession(){this._debug("#_removeSession()"),await Ce(this.storage,this.storageKey),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const e=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{e&&F()&&(window!=null&&window.removeEventListener)&&window.removeEventListener("visibilitychange",e)}catch(t){console.error("removing visibilitychange callback failed",t)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const e=setInterval(()=>this._autoRefreshTokenTick(),ce);this.autoRefreshTicker=e,e&&typeof e=="object"&&typeof e.unref=="function"?e.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(e),setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const e=this.autoRefreshTicker;this.autoRefreshTicker=null,e&&clearInterval(e)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const e=Date.now();try{return await this._useSession(async t=>{const{data:{session:s}}=t;if(!s||!s.refresh_token||!s.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const i=Math.floor((s.expires_at*1e3-e)/ce);this._debug("#_autoRefreshTokenTick()",`access token expires in ${i} ticks, a tick lasts ${ce}ms, refresh threshold is ${dt} ticks`),i<=dt&&await this._callRefreshToken(s.refresh_token)})}catch(t){console.error("Auto refresh tick failed with error. This is likely a transient error.",t)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(e){if(e.isAcquireTimeout||e instanceof gs)this._debug("auto refresh token tick lock not available");else throw e}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!F()||!(window!=null&&window.addEventListener))return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),window==null||window.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(e){console.error("_handleVisibilityChange",e)}}async _onVisibilityChanged(e){const t=`#_onVisibilityChanged(${e})`;this._debug(t,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),e||(await this.initializePromise,await this._acquireLock(-1,async()=>{if(document.visibilityState!=="visible"){this._debug(t,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(e,t,s){const i=[`provider=${encodeURIComponent(t)}`];if(s!=null&&s.redirectTo&&i.push(`redirect_to=${encodeURIComponent(s.redirectTo)}`),s!=null&&s.scopes&&i.push(`scopes=${encodeURIComponent(s.scopes)}`),this.flowType==="pkce"){const[a,o]=await ae(this.storage,this.storageKey),l=new URLSearchParams({code_challenge:`${encodeURIComponent(a)}`,code_challenge_method:`${encodeURIComponent(o)}`});i.push(l.toString())}if(s!=null&&s.queryParams){const a=new URLSearchParams(s.queryParams);i.push(a.toString())}return s!=null&&s.skipBrowserRedirect&&i.push(`skip_http_redirect=${s.skipBrowserRedirect}`),`${e}?${i.join("&")}`}async _unenroll(e){try{return await this._useSession(async t=>{var s;const{data:i,error:a}=t;return a?{data:null,error:a}:await P(this.fetch,"DELETE",`${this.url}/factors/${e.factorId}`,{headers:this.headers,jwt:(s=i==null?void 0:i.session)===null||s===void 0?void 0:s.access_token})})}catch(t){if(T(t))return{data:null,error:t};throw t}}async _enroll(e){try{return await this._useSession(async t=>{var s,i;const{data:a,error:o}=t;if(o)return{data:null,error:o};const l=Object.assign({friendly_name:e.friendlyName,factor_type:e.factorType},e.factorType==="phone"?{phone:e.phone}:{issuer:e.issuer}),{data:c,error:u}=await P(this.fetch,"POST",`${this.url}/factors`,{body:l,headers:this.headers,jwt:(s=a==null?void 0:a.session)===null||s===void 0?void 0:s.access_token});return u?{data:null,error:u}:(e.factorType==="totp"&&(!((i=c==null?void 0:c.totp)===null||i===void 0)&&i.qr_code)&&(c.totp.qr_code=`data:image/svg+xml;utf-8,${c.totp.qr_code}`),{data:c,error:null})})}catch(t){if(T(t))return{data:null,error:t};throw t}}async _verify(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var s;const{data:i,error:a}=t;if(a)return{data:null,error:a};const{data:o,error:l}=await P(this.fetch,"POST",`${this.url}/factors/${e.factorId}/verify`,{body:{code:e.code,challenge_id:e.challengeId},headers:this.headers,jwt:(s=i==null?void 0:i.session)===null||s===void 0?void 0:s.access_token});return l?{data:null,error:l}:(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+o.expires_in},o)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",o),{data:o,error:l})})}catch(t){if(T(t))return{data:null,error:t};throw t}})}async _challenge(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var s;const{data:i,error:a}=t;return a?{data:null,error:a}:await P(this.fetch,"POST",`${this.url}/factors/${e.factorId}/challenge`,{body:{channel:e.channel},headers:this.headers,jwt:(s=i==null?void 0:i.session)===null||s===void 0?void 0:s.access_token})})}catch(t){if(T(t))return{data:null,error:t};throw t}})}async _challengeAndVerify(e){const{data:t,error:s}=await this._challenge({factorId:e.factorId});return s?{data:null,error:s}:await this._verify({factorId:e.factorId,challengeId:t.id,code:e.code})}async _listFactors(){const{data:{user:e},error:t}=await this.getUser();if(t)return{data:null,error:t};const s=(e==null?void 0:e.factors)||[],i=s.filter(o=>o.factor_type==="totp"&&o.status==="verified"),a=s.filter(o=>o.factor_type==="phone"&&o.status==="verified");return{data:{all:s,totp:i,phone:a},error:null}}async _getAuthenticatorAssuranceLevel(){return this._acquireLock(-1,async()=>await this._useSession(async e=>{var t,s;const{data:{session:i},error:a}=e;if(a)return{data:null,error:a};if(!i)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:o}=et(i.access_token);let l=null;o.aal&&(l=o.aal);let c=l;((s=(t=i.user.factors)===null||t===void 0?void 0:t.filter(h=>h.status==="verified"))!==null&&s!==void 0?s:[]).length>0&&(c="aal2");const d=o.amr||[];return{data:{currentLevel:l,nextLevel:c,currentAuthenticationMethods:d},error:null}}))}async fetchJwk(e,t={keys:[]}){let s=t.keys.find(o=>o.kid===e);if(s||(s=this.jwks.keys.find(o=>o.kid===e),s&&this.jwks_cached_at+fn>Date.now()))return s;const{data:i,error:a}=await P(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(a)throw a;if(!i.keys||i.keys.length===0)throw new we("JWKS is empty");if(this.jwks=i,this.jwks_cached_at=Date.now(),s=i.keys.find(o=>o.kid===e),!s)throw new we("No matching signing key found in JWKS");return s}async getClaims(e,t={keys:[]}){try{let s=e;if(!s){const{data:g,error:y}=await this.getSession();if(y||!g.session)return{data:null,error:y};s=g.session.access_token}const{header:i,payload:a,signature:o,raw:{header:l,payload:c}}=et(s);if(Un(a.exp),!i.kid||i.alg==="HS256"||!("crypto"in globalThis&&"subtle"in globalThis.crypto)){const{error:g}=await this.getUser(s);if(g)throw g;return{data:{claims:a,header:i,signature:o},error:null}}const u=Ln(i.alg),d=await this.fetchJwk(i.kid,t),h=await crypto.subtle.importKey("jwk",d,u,!0,["verify"]);if(!await crypto.subtle.verify(u,h,o,jn(`${l}.${c}`)))throw new we("Invalid JWT signature");return{data:{claims:a,header:i,signature:o},error:null}}catch(s){if(T(s))return{data:null,error:s};throw s}}}Ne.nextInstanceID=0;const ti=Ne;class si extends ti{constructor(e){super(e)}}var ri=function(n,e,t,s){function i(a){return a instanceof t?a:new t(function(o){o(a)})}return new(t||(t=Promise))(function(a,o){function l(d){try{u(s.next(d))}catch(h){o(h)}}function c(d){try{u(s.throw(d))}catch(h){o(h)}}function u(d){d.done?a(d.value):i(d.value).then(l,c)}u((s=s.apply(n,e||[])).next())})};class ni{constructor(e,t,s){var i,a,o;if(this.supabaseUrl=e,this.supabaseKey=t,!e)throw new Error("supabaseUrl is required.");if(!t)throw new Error("supabaseKey is required.");const l=on(e),c=new URL(l);this.realtimeUrl=new URL("realtime/v1",c),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",c),this.storageUrl=new URL("storage/v1",c),this.functionsUrl=new URL("functions/v1",c);const u=`sb-${c.hostname.split(".")[0]}-auth-token`,d={db:Yr,realtime:en,auth:Object.assign(Object.assign({},Xr),{storageKey:u}),global:Qr},h=ln(s??{},d);this.storageKey=(i=h.auth.storageKey)!==null&&i!==void 0?i:"",this.headers=(a=h.global.headers)!==null&&a!==void 0?a:{},h.accessToken?(this.accessToken=h.accessToken,this.auth=new Proxy({},{get:(f,g)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(g)} is not possible`)}})):this.auth=this._initSupabaseAuthClient((o=h.auth)!==null&&o!==void 0?o:{},this.headers,h.global.fetch),this.fetch=nn(t,this._getAccessToken.bind(this),h.global.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers,accessToken:this._getAccessToken.bind(this)},h.realtime)),this.rest=new vr(new URL("rest/v1",c).href,{headers:this.headers,schema:h.db.schema,fetch:this.fetch}),h.accessToken||this._listenForAuthEvents()}get functions(){return new Zs(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}get storage(){return new Vr(this.storageUrl.href,this.headers,this.fetch)}from(e){return this.rest.from(e)}schema(e){return this.rest.schema(e)}rpc(e,t={},s={}){return this.rest.rpc(e,t,s)}channel(e,t={config:{}}){return this.realtime.channel(e,t)}getChannels(){return this.realtime.getChannels()}removeChannel(e){return this.realtime.removeChannel(e)}removeAllChannels(){return this.realtime.removeAllChannels()}_getAccessToken(){var e,t;return ri(this,void 0,void 0,function*(){if(this.accessToken)return yield this.accessToken();const{data:s}=yield this.auth.getSession();return(t=(e=s.session)===null||e===void 0?void 0:e.access_token)!==null&&t!==void 0?t:null})}_initSupabaseAuthClient({autoRefreshToken:e,persistSession:t,detectSessionInUrl:s,storage:i,storageKey:a,flowType:o,lock:l,debug:c},u,d){const h={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new si({url:this.authUrl.href,headers:Object.assign(Object.assign({},h),u),storageKey:a,autoRefreshToken:e,persistSession:t,detectSessionInUrl:s,storage:i,flowType:o,lock:l,debug:c,fetch:d,hasCustomAuthorizationHeader:"Authorization"in this.headers})}_initRealtimeClient(e){return new Rr(this.realtimeUrl.href,Object.assign(Object.assign({},e),{params:Object.assign({apikey:this.supabaseKey},e==null?void 0:e.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((t,s)=>{this._handleTokenChanged(t,"CLIENT",s==null?void 0:s.access_token)})}_handleTokenChanged(e,t,s){(e==="TOKEN_REFRESHED"||e==="SIGNED_IN")&&this.changedAccessToken!==s?this.changedAccessToken=s:e==="SIGNED_OUT"&&(this.realtime.setAuth(),t=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}}const ii=(n,e,t)=>new ni(n,e,t),ai="https://your-project.supabase.co",oi="your-anon-key",H=ii(ai,oi);class li{static async sendOTP(e){try{const{data:t,error:s}=await H.rpc("can_resend_otp",{user_email:e});if(s)throw s;if(!t)return{success:!1,message:"Please wait before requesting another OTP. You can resend after 1 minute."};const{data:i,error:a}=await H.rpc("create_email_verification",{user_email:e});if(a)throw a;if(i&&i.length>0){const{otp_code:o,expires_at:l}=i[0];return console.log(`OTP for ${e}: ${o}`),console.log(`Expires at: ${l}`),await this.simulateEmailSending(e,o),{success:!0,message:"OTP sent successfully to your email address.",data:{expires_at:l,otp_code:void 0}}}return{success:!1,message:"Failed to generate OTP. Please try again."}}catch(t){return console.error("Error sending OTP:",t),{success:!1,message:"Failed to send OTP. Please try again later."}}}static async verifyOTP(e,t){try{const{data:s,error:i}=await H.rpc("verify_otp",{user_email:e,provided_otp:t});if(i)throw i;return s===!0?{success:!0,message:"Email verified successfully!"}:{success:!1,message:"Invalid or expired OTP code. Please try again."}}catch(s){return console.error("Error verifying OTP:",s),{success:!1,message:"Verification failed. Please try again."}}}static async isEmailVerified(e){try{const{data:t,error:s}=await H.rpc("is_email_verified",{user_email:e});return s?(console.error("Error checking email verification:",s),!1):t===!0}catch(t){return console.error("Error checking email verification:",t),!1}}static async simulateEmailSending(e,t){console.log(`
      📧 Email Simulation
      To: ${e}
      Subject: LuckyPick - Email Verification Code
      
      Your verification code is: ${t}
      
      This code will expire in 10 minutes.
      
      If you didn't request this code, please ignore this email.
    `),await new Promise(s=>setTimeout(s,1e3))}static async cleanupExpiredOTPs(){try{const{error:e}=await H.rpc("cleanup_expired_otps");e&&console.error("Error cleaning up expired OTPs:",e)}catch(e){console.error("Error cleaning up expired OTPs:",e)}}}const ps=j.createContext(void 0),me=()=>{const n=j.useContext(ps);if(!n)throw new Error("useAuth must be used within an AuthProvider");return n},ci=({children:n})=>{const[e,t]=j.useState(null),[s,i]=j.useState(!0),{isOnline:a}=ft();j.useEffect(()=>{const d=async()=>{i(!0);try{const f=localStorage.getItem("user");if(f){const g=JSON.parse(f);t(g),await C.saveData("user",g)}else if(!a){const g=await C.getData("user","user1");g&&t(g)}}catch(f){console.error("Failed to load user data:",f)}finally{i(!1)}},{data:{subscription:h}}=H.auth.onAuthStateChange(async(f,g)=>{if(g!=null&&g.user){console.log("User signed in:",g.user);try{const{data:y,error:N}=await H.from("users").select("*").eq("email",g.user.email).single();if(y&&!N){const b={id:y.id,email:y.email,fullName:y.full_name,phone:y.phone,isAdmin:y.is_admin,walletBalance:Number(y.wallet_balance),createdAt:new Date(y.created_at)};t(b),localStorage.setItem("user",JSON.stringify(b)),await C.saveData("user",b)}}catch(y){console.error("Error loading user data:",y)}}else console.log("User signed out"),t(null),localStorage.removeItem("user");i(!1)});return d(),()=>{h.unsubscribe()}},[a]);const o=async(d,h)=>{try{if(d==="test@gmail.com"&&h==="12345677"){const y={id:"user1",email:d,fullName:"Demo User",isAdmin:!1,walletBalance:1e3,createdAt:new Date};return t(y),localStorage.setItem("user",JSON.stringify(y)),await C.saveData("user",y),!0}else if(d==="Admin@admin.com"&&h==="9794478972"){const y={id:"admin1",email:d,fullName:"System Admin",isAdmin:!0,walletBalance:0,createdAt:new Date};return t(y),localStorage.setItem("user",JSON.stringify(y)),await C.saveData("user",y),!0}const{data:f,error:g}=await H.auth.signInWithPassword({email:d,password:h});return g?(console.error("Login error:",g),!1):!!f.user}catch(f){return console.error("Login failed:",f),!1}},l=async d=>{try{if(!await li.isEmailVerified(d.email))throw new Error("Email must be verified before creating account");const{data:f,error:g}=await H.from("users").insert({email:d.email,full_name:d.fullName,phone:d.phone,email_verified:!0,email_verified_at:new Date().toISOString()}).select().single();if(g)return console.error("User creation error:",g),!1;if(f){try{await H.auth.signUp({email:d.email,password:d.password,options:{data:{full_name:d.fullName,phone:d.phone}}})}catch(N){console.warn("Auth user creation failed, but database user created:",N)}const y={id:f.id,email:f.email,fullName:f.full_name,phone:f.phone,isAdmin:f.is_admin,walletBalance:Number(f.wallet_balance),createdAt:new Date(f.created_at)};return t(y),localStorage.setItem("user",JSON.stringify(y)),await C.saveData("user",y),!0}return!1}catch(h){return console.error("Signup failed:",h),!1}},c=async()=>{try{await H.auth.signOut()}catch(d){console.error("Logout error:",d)}t(null),localStorage.removeItem("user")},u=d=>{if(e){const h={...e,walletBalance:e.walletBalance+d};t(h),localStorage.setItem("user",JSON.stringify(h)),C.saveData("user",h),a||C.saveOfflineAction({type:"updateWallet",data:{userId:e.id,amount:d}})}};return r.jsx(ps.Provider,{value:{user:e,loading:s,login:o,signup:l,logout:c,updateWallet:u},children:n})},xs=j.createContext(void 0),X=()=>{const n=j.useContext(xs);if(!n)throw new Error("useApp must be used within an AppProvider");return n},di=({children:n})=>{const[e,t]=j.useState([]),[s,i]=j.useState([]),[a,o]=j.useState([]),[l,c]=j.useState([]),[u,d]=j.useState([]),{isOnline:h}=ft();j.useEffect(()=>{(async()=>{try{if(await C.init(),!h){const x=await C.getData("sessions"),w=await C.getData("bets"),p=await C.getData("results"),m=await C.getData("transactions");x!=null&&x.length&&t(x),w!=null&&w.length&&i(w),p!=null&&p.length&&o(p),m!=null&&m.length&&c(m)}}catch(x){console.error("Failed to initialize offline storage:",x)}})()},[h]),j.useEffect(()=>{const v=()=>{const p=D(new Date,"yyyy-MM-dd");if(e.filter(_=>_.date===p).length===0){console.log("Creating today's sessions for",p);const _=[{id:`session-1430-${p}`,name:"Afternoon Draw",time:"14:30",date:p,isActive:!0,betsCloseAt:"14:25",totalPool:0,createdBy:"system"},{id:`session-1900-${p}`,name:"Evening Draw",time:"19:00",date:p,isActive:!0,betsCloseAt:"18:55",totalPool:0,createdBy:"system"}];t(E=>E.filter(S=>S.date===p).length===0?[...E,..._]:E),_.forEach(E=>{C.saveData("sessions",E)})}},x=D(new Date,"yyyy-MM-dd"),w=e.filter(p=>p.date===x);(e.length===0||w.length===0)&&v()},[e.length]),j.useEffect(()=>{const v=()=>{const w=new Date,p=D(w,"yyyy-MM-dd");e.forEach(m=>{if(m.isActive&&m.date===p){const _=new Date(`${p}T${m.time}:00`);be(w,_)&&(console.log(`Auto-processing jackpot for session ${m.id} at ${m.time}`),y(m.id))}})},x=setInterval(v,3e4);return v(),()=>clearInterval(x)},[e]),j.useEffect(()=>{e.forEach(v=>{C.saveData("sessions",v)})},[e]),j.useEffect(()=>{s.forEach(v=>{C.saveData("bets",v)})},[s]),j.useEffect(()=>{a.forEach(v=>{C.saveData("results",v)})},[a]),j.useEffect(()=>{l.forEach(v=>{C.saveData("transactions",v)})},[l]);const f=(v,x)=>{const w=D(new Date,"yyyy-MM-dd"),p=D(ks(new Date(`${w}T${v}:00`),-5),"HH:mm"),m={id:`session-${Date.now()}`,name:x,time:v,date:w,isActive:!0,betsCloseAt:p,totalPool:0,createdBy:"admin"};t(_=>[..._,m]),h||C.saveOfflineAction({type:"createSession",data:m})},g=(v,x,w,p)=>{const m=e.find(I=>I.id===v);if(!m)return!1;const _=new Date,E=D(_,"yyyy-MM-dd"),O=new Date(`${E}T${m.betsCloseAt}:00`);if(be(_,O))return!1;const S={id:`bet-${Date.now()}`,userId:p,sessionId:v,number:x,amount:w,timestamp:_};return i(I=>[...I,S]),t(I=>I.map(L=>L.id===v?{...L,totalPool:L.totalPool+w}:L)),h||C.saveOfflineAction({type:"placeBet",data:S}),!0},y=v=>{const x=s.filter(A=>A.sessionId===v),w=e.find(A=>A.id===v);if(!w)return;if(x.length===0){t(A=>A.map(B=>B.id===v?{...B,isActive:!1}:B));return}const p={};for(let A=0;A<=9;A++)p[A]=0;x.forEach(A=>{p[A.number]+=A.amount});let m=0,_=p[0];for(let A=1;A<=9;A++)p[A]<_&&(m=A,_=p[A]);const E=w.totalPool,O=_===0&&E>0;let S,I,L;if(O)S=E,I=0,L=0;else{S=0;const A=x.filter(B=>B.number===m);L=A.length,I=0,L>0&&(A.forEach(B=>{const wt=B.amount*9,ys={id:`win-${Date.now()}-${B.userId}-${Math.random()}`,userId:B.userId,type:"win",amount:wt,status:"completed",timestamp:new Date,description:`Jackpot win: ₹${B.amount} × 9 = ₹${wt} for number ${m} in session ${w.time}`};c(ws=>[...ws,ys])}),I=A[0].amount*9)}const ee={id:`result-${Date.now()}`,sessionId:v,winningNumber:m,totalPool:E,adminFee:S,winnerCount:L,winnerPayout:O?0:I,timestamp:new Date,isZeroBetWin:O};o(A=>[...A,ee]),t(A=>A.map(B=>B.id===v?{...B,isActive:!1}:B)),console.log(`Jackpot processed for session ${v}:`,{winningNumber:m,totalPool:E,adminFee:S,winnerCount:L,winnerPayout:O?0:"9x bet amount per winner",isZeroBetWin:O}),h||C.saveOfflineAction({type:"processJackpot",data:{sessionId:v,result:ee}})},N=v=>{const x={...v,id:`txn-${Date.now()}`};c(w=>[...w,x]),h||C.saveOfflineAction({type:"addTransaction",data:x})},b=(v,x)=>{const w={id:`withdrawal-${Date.now()}`,userId:v,amount:x,status:"pending",requestedAt:new Date};d(p=>[...p,w]),h||C.saveOfflineAction({type:"requestWithdrawal",data:w})},k=(v,x)=>{d(w=>w.map(p=>p.id===v?{...p,status:x,processedAt:new Date,processedBy:"admin"}:p)),h||C.saveOfflineAction({type:"processWithdrawal",data:{id:v,status:x}})};return r.jsx(xs.Provider,{value:{sessions:e,bets:s,results:a,transactions:l,withdrawals:u,createSession:f,placeBet:g,processJackpot:y,addTransaction:N,requestWithdrawal:b,processWithdrawal:k},children:n})},ui=()=>{const[n,e]=j.useState("login"),[t,s]=j.useState("email"),[i,a]=j.useState(""),[o,l]=j.useState(""),[c,u]=j.useState(""),[d,h]=j.useState(""),[f,g]=j.useState(""),[y,N]=j.useState(!1),[b,k]=j.useState(""),[v,x]=j.useState(!1),{login:w}=me(),p=async S=>{S.preventDefault(),k(""),x(!0);try{await w(i,c)||k("Invalid credentials")}catch{k("Login failed")}finally{x(!1)}},m=async S=>{S.preventDefault(),k(""),x(!0);try{if(!i||!d||!c){k("Please fill in all required fields"),x(!1);return}if(c.length<6){k("Password must be at least 6 characters long"),x(!1);return}console.log("Sending OTP to:",i),e("verify"),k("")}catch{k("Signup failed")}finally{x(!1)}},_=async S=>{S.preventDefault(),k(""),x(!0);try{if(f.length!==6){k("Please enter a valid 6-digit OTP"),x(!1);return}f==="123456"||f.length===6?await w(i,c)?console.log("Account created and verified for:",i):k("Account creation failed"):k("Invalid OTP. Please try again.")}catch{k("Verification failed")}finally{x(!1)}},E=()=>{k(""),console.log("Resending OTP to:",i),k("OTP resent successfully!"),setTimeout(()=>k(""),3e3)},O=()=>{e("login"),a(""),l(""),u(""),h(""),g(""),k("")};return r.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 flex items-center justify-center p-4",children:r.jsxs("div",{className:"bg-white rounded-2xl shadow-xl w-full max-w-md p-8",children:[r.jsxs("div",{className:"text-center mb-8",children:[r.jsx("h1",{className:"text-3xl font-bold text-gray-800 mb-2",children:"LuckyPick"}),r.jsx("p",{className:"text-gray-600",children:"Daily Number Lottery"})]}),n!=="verify"&&r.jsxs("div",{className:"flex mb-6 bg-gray-100 rounded-lg p-1",children:[r.jsx("button",{type:"button",onClick:()=>e("login"),className:`flex-1 py-2 px-4 rounded-md text-sm font-medium transition-colors ${n==="login"?"bg-white text-blue-600 shadow-sm":"text-gray-600 hover:text-gray-800"}`,children:"Login"}),r.jsx("button",{type:"button",onClick:()=>e("signup"),className:`flex-1 py-2 px-4 rounded-md text-sm font-medium transition-colors ${n==="signup"?"bg-white text-blue-600 shadow-sm":"text-gray-600 hover:text-gray-800"}`,children:"Sign Up"})]}),n==="login"&&r.jsxs(r.Fragment,{children:[r.jsxs("div",{className:"flex mb-6 bg-gray-100 rounded-lg p-1",children:[r.jsxs("button",{type:"button",onClick:()=>s("email"),className:`flex-1 py-2 px-4 rounded-md text-sm font-medium transition-colors ${t==="email"?"bg-white text-blue-600 shadow-sm":"text-gray-600 hover:text-gray-800"}`,children:[r.jsx(Ke,{className:"w-4 h-4 inline mr-2"}),"Email"]}),r.jsxs("button",{type:"button",onClick:()=>s("phone"),className:`flex-1 py-2 px-4 rounded-md text-sm font-medium transition-colors ${t==="phone"?"bg-white text-blue-600 shadow-sm":"text-gray-600 hover:text-gray-800"}`,children:[r.jsx(Ve,{className:"w-4 h-4 inline mr-2"}),"Phone"]})]}),r.jsxs("form",{onSubmit:p,className:"space-y-4",children:[t==="email"?r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Email Address"}),r.jsxs("div",{className:"relative",children:[r.jsx(Ke,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"}),r.jsx("input",{type:"email",value:i,onChange:S=>a(S.target.value),className:"w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Enter your email",required:!0})]})]}):r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Phone Number"}),r.jsxs("div",{className:"relative",children:[r.jsx(Ve,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"}),r.jsx("input",{type:"tel",value:o,onChange:S=>l(S.target.value),className:"w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Enter your phone number",required:!0})]})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Password"}),r.jsxs("div",{className:"relative",children:[r.jsx(vt,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"}),r.jsx("input",{type:y?"text":"password",value:c,onChange:S=>u(S.target.value),className:"w-full pl-10 pr-12 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Enter your password",required:!0}),r.jsx("button",{type:"button",onClick:()=>N(!y),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600",children:y?r.jsx(bt,{className:"w-5 h-5"}):r.jsx(_t,{className:"w-5 h-5"})})]})]}),b&&r.jsx("div",{className:"text-red-600 text-sm text-center",children:b}),r.jsx("button",{type:"submit",disabled:v,className:"w-full bg-blue-600 text-white py-3 rounded-lg font-medium hover:bg-blue-700 focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:v?"Signing In...":"Sign In"})]})]}),n==="signup"&&r.jsxs("form",{onSubmit:m,className:"space-y-4",children:[r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Full Name *"}),r.jsxs("div",{className:"relative",children:[r.jsx(qt,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"}),r.jsx("input",{type:"text",value:d,onChange:S=>h(S.target.value),className:"w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Enter your full name",required:!0})]})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Email Address *"}),r.jsxs("div",{className:"relative",children:[r.jsx(Ke,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"}),r.jsx("input",{type:"email",value:i,onChange:S=>a(S.target.value),className:"w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Enter your email",required:!0})]})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Phone Number (Optional)"}),r.jsxs("div",{className:"relative",children:[r.jsx(Ve,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"}),r.jsx("input",{type:"tel",value:o,onChange:S=>l(S.target.value),className:"w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Enter your phone number"})]})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Password *"}),r.jsxs("div",{className:"relative",children:[r.jsx(vt,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"}),r.jsx("input",{type:y?"text":"password",value:c,onChange:S=>u(S.target.value),className:"w-full pl-10 pr-12 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Create a password (min 6 characters)",required:!0,minLength:6}),r.jsx("button",{type:"button",onClick:()=>N(!y),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600",children:y?r.jsx(bt,{className:"w-5 h-5"}):r.jsx(_t,{className:"w-5 h-5"})})]}),r.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Password must be at least 6 characters long"})]}),b&&r.jsx("div",{className:"text-red-600 text-sm text-center",children:b}),r.jsx("button",{type:"submit",disabled:v,className:"w-full bg-green-600 text-white py-3 rounded-lg font-medium hover:bg-green-700 focus:ring-2 focus:ring-green-500 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:v?"Creating Account...":"Create Account"})]}),n==="verify"&&r.jsxs("div",{className:"space-y-6",children:[r.jsxs("div",{className:"text-center",children:[r.jsxs("button",{onClick:O,className:"inline-flex items-center text-blue-600 hover:text-blue-800 mb-4",children:[r.jsx(Ts,{className:"w-4 h-4 mr-1"}),"Back to signup"]}),r.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Verify Your Email"}),r.jsx("p",{className:"text-gray-600 text-sm",children:"We've sent a 6-digit verification code to"}),r.jsx("p",{className:"text-blue-600 font-medium",children:i})]}),r.jsxs("form",{onSubmit:_,className:"space-y-4",children:[r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Verification Code"}),r.jsx("input",{type:"text",value:f,onChange:S=>g(S.target.value.replace(/\D/g,"").slice(0,6)),className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-center text-lg font-mono tracking-widest",placeholder:"000000",maxLength:6,required:!0}),r.jsx("p",{className:"text-xs text-gray-500 mt-1 text-center",children:"Enter the 6-digit code sent to your email"})]}),b&&r.jsx("div",{className:`text-sm text-center ${b.includes("resent")?"text-green-600":"text-red-600"}`,children:b}),r.jsx("button",{type:"submit",disabled:v||f.length!==6,className:"w-full bg-blue-600 text-white py-3 rounded-lg font-medium hover:bg-blue-700 focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:v?"Verifying...":"Verify & Create Account"}),r.jsx("div",{className:"text-center",children:r.jsxs("p",{className:"text-sm text-gray-600",children:["Didn't receive the code?"," ",r.jsx("button",{type:"button",onClick:E,className:"text-blue-600 hover:text-blue-800 font-medium",children:"Resend OTP"})]})})]})]}),n==="login"&&r.jsxs("div",{className:"mt-8 p-4 bg-gray-50 rounded-lg",children:[r.jsx("h3",{className:"font-medium text-gray-800 mb-2",children:"Demo Accounts:"}),r.jsxs("div",{className:"text-sm text-gray-600 space-y-1",children:[r.jsxs("div",{children:[r.jsx("strong",{children:"User:"})," test@gmail.com / 12345677"]}),r.jsxs("div",{children:[r.jsx("strong",{children:"Admin:"})," Admin@admin.com / 9794478972"]})]})]}),n==="signup"&&r.jsxs("div",{className:"mt-6 p-4 bg-blue-50 rounded-lg",children:[r.jsx("h3",{className:"font-medium text-blue-800 mb-2",children:"Getting Started:"}),r.jsxs("div",{className:"text-sm text-blue-700 space-y-1",children:[r.jsx("p",{children:"• Create your account with email verification"}),r.jsx("p",{children:"• Start with ₹100 welcome bonus"}),r.jsx("p",{children:"• Play in daily lottery draws at 2:30 PM & 7:00 PM"}),r.jsx("p",{children:"• Win 9x your bet amount!"})]})]}),n==="verify"&&r.jsxs("div",{className:"mt-6 p-4 bg-yellow-50 rounded-lg",children:[r.jsx("h3",{className:"font-medium text-yellow-800 mb-2",children:"Demo Mode:"}),r.jsxs("div",{className:"text-sm text-yellow-700",children:[r.jsx("p",{children:"For demo purposes, use any 6-digit code (e.g., 123456)"}),r.jsx("p",{children:"In production, a real OTP would be sent to your email."})]})]})]})})},hi=({sessionId:n,onClose:e})=>{const{sessions:t,placeBet:s,bets:i}=X(),{user:a,updateWallet:o}=me(),[l,c]=j.useState(null),[u,d]=j.useState(10),[h,f]=j.useState(!1),[g,y]=j.useState(""),N=t.find(w=>w.id===n),b=i.filter(w=>w.sessionId===n&&w.userId===(a==null?void 0:a.id));if(!N||!a)return null;const k=async()=>{if(l===null){y("Please select a number");return}if(u<10){y("Minimum bet amount is ₹10");return}if(u>a.walletBalance){y("Insufficient wallet balance");return}f(!0),y("");try{s(n,l,u,a.id)?(o(-u),c(null),d(10),setTimeout(()=>{e()},1e3)):y("Failed to place bet. Betting may be closed.")}catch{y("Failed to place bet. Please try again.")}finally{f(!1)}},v=w=>{const p=u+w;p>=10&&p<=a.walletBalance&&d(p)},x=[10,25,50,100,250,500];return r.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:r.jsxs("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-md",children:[r.jsxs("div",{className:"flex justify-between items-center p-6 border-b",children:[r.jsxs("h3",{className:"text-lg font-semibold text-gray-900",children:["Place Bet - ",N.name||`Session ${N.time}`]}),r.jsx("button",{onClick:e,className:"text-gray-400 hover:text-gray-600 transition-colors",children:r.jsx(Le,{className:"w-5 h-5"})})]}),r.jsxs("div",{className:"p-6 space-y-6",children:[b.length>0&&r.jsxs("div",{className:"bg-blue-50 rounded-lg p-4",children:[r.jsx("h4",{className:"text-sm font-medium text-blue-800 mb-2",children:"Your Current Bets:"}),r.jsx("div",{className:"flex flex-wrap gap-2",children:b.map(w=>r.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-800",children:[w.number,": ₹",w.amount]},w.id))}),r.jsxs("p",{className:"text-xs text-blue-600 mt-2",children:["Total: ₹",b.reduce((w,p)=>w+p.amount,0)]})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"Select Number (0-9)"}),r.jsx("div",{className:"grid grid-cols-5 gap-2",children:[0,1,2,3,4,5,6,7,8,9].map(w=>r.jsx("button",{onClick:()=>c(w),className:`h-12 rounded-lg font-semibold transition-colors ${l===w?"bg-blue-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:w},w))})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"Bet Amount"}),r.jsx("div",{className:"grid grid-cols-3 gap-2 mb-3",children:x.map(w=>r.jsxs("button",{onClick:()=>d(w),disabled:w>a.walletBalance,className:`py-2 px-3 rounded-lg text-sm font-medium transition-colors ${u===w?"bg-blue-600 text-white":w>a.walletBalance?"bg-gray-100 text-gray-400 cursor-not-allowed":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:["₹",w]},w))}),r.jsxs("div",{className:"flex items-center space-x-2",children:[r.jsx("button",{onClick:()=>v(-10),disabled:u<=10,className:"p-2 rounded-lg bg-gray-100 text-gray-600 hover:bg-gray-200 disabled:opacity-50 disabled:cursor-not-allowed",children:r.jsx(Es,{className:"w-4 h-4"})}),r.jsxs("div",{className:"flex-1 relative",children:[r.jsx(z,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),r.jsx("input",{type:"number",value:u,onChange:w=>{const p=parseInt(w.target.value)||0;p>=10&&p<=a.walletBalance&&d(p)},min:"10",max:a.walletBalance,className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),r.jsx("button",{onClick:()=>v(10),disabled:u+10>a.walletBalance,className:"p-2 rounded-lg bg-gray-100 text-gray-600 hover:bg-gray-200 disabled:opacity-50 disabled:cursor-not-allowed",children:r.jsx(Re,{className:"w-4 h-4"})})]}),r.jsxs("div",{className:"flex justify-between text-xs text-gray-500 mt-1",children:[r.jsx("span",{children:"Min: ₹10"}),r.jsxs("span",{children:["Wallet: ₹",a.walletBalance]})]})]}),l!==null&&u>=10&&r.jsxs("div",{className:"bg-green-50 rounded-lg p-4",children:[r.jsx("h4",{className:"text-sm font-medium text-green-800 mb-1",children:"Potential Winnings:"}),r.jsxs("p",{className:"text-lg font-bold text-green-600",children:["₹",u*9]}),r.jsx("p",{className:"text-xs text-green-600",children:"9x your bet amount if you win!"})]}),g&&r.jsx("div",{className:"text-red-600 text-sm text-center bg-red-50 p-3 rounded-lg",children:g})]}),r.jsxs("div",{className:"flex space-x-3 p-6 border-t",children:[r.jsx("button",{onClick:e,className:"flex-1 py-2 px-4 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 transition-colors",children:"Cancel"}),r.jsx("button",{onClick:k,disabled:h||l===null||u<10||u>a.walletBalance,className:"flex-1 py-2 px-4 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:h?"Placing Bet...":`Place Bet ₹${u}`})]})]})})},fi=({onClose:n})=>{const{user:e,updateWallet:t}=me(),{transactions:s,addTransaction:i,requestWithdrawal:a}=X(),[o,l]=j.useState("overview"),[c,u]=j.useState(100),[d,h]=j.useState(100),[f,g]=j.useState(!1),[y,N]=j.useState(""),[b,k]=j.useState("");if(!e)return null;const v=s.filter(m=>m.userId===e.id).slice(0,10),x=async()=>{if(c<10){N("Minimum deposit amount is ₹10");return}g(!0),N(""),k("");try{await new Promise(m=>setTimeout(m,2e3)),t(c),i({userId:e.id,type:"deposit",amount:c,status:"completed",timestamp:new Date,description:"Wallet deposit via demo payment"}),k(`₹${c} deposited successfully!`),u(100),setTimeout(()=>{k(""),l("overview")},2e3)}catch{N("Deposit failed. Please try again.")}finally{g(!1)}},w=async()=>{if(d<50){N("Minimum withdrawal amount is ₹50");return}if(d>e.walletBalance){N("Insufficient wallet balance");return}g(!0),N(""),k("");try{a(e.id,d),t(-d),i({userId:e.id,type:"withdrawal",amount:d,status:"pending",timestamp:new Date,description:"Withdrawal request - pending admin approval"}),k(`Withdrawal request of ₹${d} submitted!`),h(100),setTimeout(()=>{k(""),l("overview")},2e3)}catch{N("Withdrawal request failed. Please try again.")}finally{g(!1)}},p=[100,250,500,1e3,2500,5e3];return r.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:r.jsxs("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-2xl max-h-[90vh] overflow-y-auto",children:[r.jsxs("div",{className:"flex justify-between items-center p-6 border-b",children:[r.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"My Wallet"}),r.jsx("button",{onClick:n,className:"text-gray-400 hover:text-gray-600 transition-colors",children:r.jsx(Le,{className:"w-5 h-5"})})]}),r.jsx("div",{className:"p-6 bg-gradient-to-r from-blue-50 to-indigo-100",children:r.jsxs("div",{className:"text-center",children:[r.jsx("p",{className:"text-sm text-gray-600 mb-2",children:"Current Balance"}),r.jsxs("p",{className:"text-3xl font-bold text-gray-900",children:["₹",e.walletBalance]})]})}),r.jsx("div",{className:"border-b",children:r.jsx("nav",{className:"flex space-x-8 px-6",children:[{id:"overview",label:"Overview",icon:z},{id:"deposit",label:"Deposit",icon:Re},{id:"withdraw",label:"Withdraw",icon:Ie},{id:"history",label:"History",icon:jt}].map(m=>{const _=m.icon;return r.jsxs("button",{onClick:()=>l(m.id),className:`flex items-center space-x-2 py-4 border-b-2 font-medium text-sm transition-colors ${o===m.id?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700"}`,children:[r.jsx(_,{className:"w-4 h-4"}),r.jsx("span",{children:m.label})]},m.id)})})}),r.jsxs("div",{className:"p-6",children:[o==="overview"&&r.jsxs("div",{className:"space-y-6",children:[r.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[r.jsxs("button",{onClick:()=>l("deposit"),className:"flex items-center justify-center space-x-2 bg-green-600 text-white py-3 px-4 rounded-lg hover:bg-green-700 transition-colors",children:[r.jsx(Re,{className:"w-4 h-4"}),r.jsx("span",{children:"Add Money"})]}),r.jsxs("button",{onClick:()=>l("withdraw"),className:"flex items-center justify-center space-x-2 bg-blue-600 text-white py-3 px-4 rounded-lg hover:bg-blue-700 transition-colors",children:[r.jsx(Ie,{className:"w-4 h-4"}),r.jsx("span",{children:"Withdraw"})]})]}),r.jsxs("div",{children:[r.jsx("h4",{className:"text-sm font-medium text-gray-700 mb-3",children:"Recent Transactions"}),r.jsx("div",{className:"space-y-2",children:v.slice(0,5).map(m=>r.jsxs("div",{className:"flex justify-between items-center py-2 px-3 bg-gray-50 rounded-lg",children:[r.jsxs("div",{children:[r.jsx("p",{className:"text-sm font-medium text-gray-900",children:m.type.charAt(0).toUpperCase()+m.type.slice(1)}),r.jsx("p",{className:"text-xs text-gray-500",children:D(m.timestamp,"MMM dd, HH:mm")})]}),r.jsxs("div",{className:"text-right",children:[r.jsxs("p",{className:`text-sm font-medium ${m.type==="deposit"||m.type==="win"?"text-green-600":"text-red-600"}`,children:[m.type==="deposit"||m.type==="win"?"+":"-","₹",m.amount]}),r.jsx("p",{className:`text-xs ${m.status==="completed"?"text-green-500":m.status==="pending"?"text-yellow-500":"text-red-500"}`,children:m.status})]})]},m.id))})]})]}),o==="deposit"&&r.jsxs("div",{className:"space-y-6",children:[r.jsxs("div",{children:[r.jsx("h4",{className:"text-sm font-medium text-gray-700 mb-3",children:"Quick Amounts"}),r.jsx("div",{className:"grid grid-cols-3 gap-2",children:p.map(m=>r.jsxs("button",{onClick:()=>u(m),className:`py-2 px-3 rounded-lg text-sm font-medium transition-colors ${c===m?"bg-green-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:["₹",m]},m))})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Custom Amount"}),r.jsxs("div",{className:"relative",children:[r.jsx(z,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),r.jsx("input",{type:"number",value:c,onChange:m=>u(parseInt(m.target.value)||0),min:"10",className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent",placeholder:"Enter amount"})]}),r.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Minimum deposit: ₹10"})]}),y&&r.jsx("div",{className:"text-red-600 text-sm bg-red-50 p-3 rounded-lg",children:y}),b&&r.jsx("div",{className:"text-green-600 text-sm bg-green-50 p-3 rounded-lg",children:b}),r.jsxs("button",{onClick:x,disabled:f||c<10,className:"w-full flex items-center justify-center space-x-2 bg-green-600 text-white py-3 px-4 rounded-lg hover:bg-green-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:[r.jsx(Ps,{className:"w-4 h-4"}),r.jsx("span",{children:f?"Processing...":`Deposit ₹${c}`})]})]}),o==="withdraw"&&r.jsxs("div",{className:"space-y-6",children:[r.jsxs("div",{children:[r.jsx("h4",{className:"text-sm font-medium text-gray-700 mb-3",children:"Quick Amounts"}),r.jsx("div",{className:"grid grid-cols-3 gap-2",children:p.filter(m=>m<=e.walletBalance).map(m=>r.jsxs("button",{onClick:()=>h(m),className:`py-2 px-3 rounded-lg text-sm font-medium transition-colors ${d===m?"bg-blue-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:["₹",m]},m))})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Withdrawal Amount"}),r.jsxs("div",{className:"relative",children:[r.jsx(z,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),r.jsx("input",{type:"number",value:d,onChange:m=>h(parseInt(m.target.value)||0),min:"50",max:e.walletBalance,className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Enter amount"})]}),r.jsxs("div",{className:"flex justify-between text-xs text-gray-500 mt-1",children:[r.jsx("span",{children:"Minimum: ₹50"}),r.jsxs("span",{children:["Available: ₹",e.walletBalance]})]})]}),r.jsx("div",{className:"bg-yellow-50 p-4 rounded-lg",children:r.jsxs("p",{className:"text-sm text-yellow-800",children:[r.jsx("strong",{children:"Note:"})," Withdrawal requests are processed by admin within 24 hours."]})}),y&&r.jsx("div",{className:"text-red-600 text-sm bg-red-50 p-3 rounded-lg",children:y}),b&&r.jsx("div",{className:"text-green-600 text-sm bg-green-50 p-3 rounded-lg",children:b}),r.jsxs("button",{onClick:w,disabled:f||d<50||d>e.walletBalance,className:"w-full flex items-center justify-center space-x-2 bg-blue-600 text-white py-3 px-4 rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:[r.jsx(Ie,{className:"w-4 h-4"}),r.jsx("span",{children:f?"Processing...":`Withdraw ₹${d}`})]})]}),o==="history"&&r.jsxs("div",{className:"space-y-4",children:[r.jsx("h4",{className:"text-sm font-medium text-gray-700",children:"Transaction History"}),r.jsx("div",{className:"space-y-2",children:v.map(m=>r.jsxs("div",{className:"flex justify-between items-start py-3 px-4 bg-gray-50 rounded-lg",children:[r.jsxs("div",{className:"flex-1",children:[r.jsx("p",{className:"text-sm font-medium text-gray-900",children:m.type.charAt(0).toUpperCase()+m.type.slice(1)}),r.jsx("p",{className:"text-xs text-gray-500 mt-1",children:m.description}),r.jsx("p",{className:"text-xs text-gray-400",children:D(m.timestamp,"MMM dd, yyyy HH:mm")})]}),r.jsxs("div",{className:"text-right",children:[r.jsxs("p",{className:`text-sm font-medium ${m.type==="deposit"||m.type==="win"?"text-green-600":"text-red-600"}`,children:[m.type==="deposit"||m.type==="win"?"+":"-","₹",m.amount]}),r.jsx("p",{className:`text-xs ${m.status==="completed"?"text-green-500":m.status==="pending"?"text-yellow-500":"text-red-500"}`,children:m.status})]})]},m.id))}),v.length===0&&r.jsxs("div",{className:"text-center py-8",children:[r.jsx(jt,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),r.jsx("p",{className:"text-gray-500",children:"No transactions yet"})]})]})]})]})})},mi=()=>{const{user:n,logout:e,updateWallet:t}=me(),{sessions:s,results:i,bets:a,transactions:o,addTransaction:l}=X(),[c,u]=j.useState(null),[d,h]=j.useState(!1),[f,g]=j.useState(new Date),[y,N]=j.useState(new Set);j.useEffect(()=>{const p=setInterval(()=>{g(new Date)},1e3);return()=>clearInterval(p)},[]),j.useEffect(()=>{if(!n)return;o.filter(m=>m.userId===n.id&&m.type==="win"&&m.status==="completed"&&!y.has(m.id)).forEach(m=>{o.find(E=>E.userId===n.id&&E.type==="deposit"&&E.description.includes(`Win credit: ${m.id}`))||(t(m.amount),l({userId:n.id,type:"deposit",amount:m.amount,status:"completed",timestamp:new Date,description:`Win credit: ${m.id} - Jackpot winnings (9x payout)`}),N(E=>new Set([...E,m.id])))})},[o,n,t,l,y]);const b=(p,m)=>{const _=D(new Date,"yyyy-MM-dd"),E=new Date(`${_}T${m}:00`),O=new Date(`${_}T${p}:00`);if(be(f,O))return"Session Ended";if(be(f,E))return"Betting Closed";const S=E.getTime()-f.getTime(),I=Math.floor(S/6e4),L=Math.floor(S%6e4/1e3);return`${I}:${L.toString().padStart(2,"0")}`},k=p=>{const m=D(new Date,"yyyy-MM-dd"),_=new Date(`${m}T${p}:00`);return Ss(f,_)},v=p=>a.filter(m=>m.sessionId===p&&m.userId===(n==null?void 0:n.id)),x=p=>i.find(m=>m.sessionId===p),w=p=>{const m=x(p);if(!m)return null;const _=a.filter(E=>E.sessionId===p&&E.userId===(n==null?void 0:n.id)&&E.number===m.winningNumber);return _.length>0?{won:!0,amount:_.reduce((O,S)=>O+S.amount*9,0),winningNumber:m.winningNumber}:{won:!1,winningNumber:m.winningNumber}};return r.jsxs("div",{className:"min-h-screen bg-gray-50",children:[r.jsx("header",{className:"bg-white shadow-sm border-b",children:r.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:r.jsxs("div",{className:"flex justify-between items-center h-16",children:[r.jsxs("div",{children:[r.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"LuckyPick"}),r.jsxs("p",{className:"text-sm text-gray-600",children:["Welcome, ",(n==null?void 0:n.fullName)||(n==null?void 0:n.email)]})]}),r.jsxs("div",{className:"flex items-center space-x-4",children:[r.jsxs("button",{onClick:()=>h(!0),className:"flex items-center space-x-2 bg-green-100 text-green-800 px-4 py-2 rounded-lg hover:bg-green-200 transition-colors",children:[r.jsx(As,{className:"w-4 h-4"}),r.jsxs("span",{children:["₹",n==null?void 0:n.walletBalance]})]}),r.jsxs("button",{onClick:e,className:"flex items-center space-x-2 text-gray-600 hover:text-gray-800 transition-colors",children:[r.jsx(Ft,{className:"w-4 h-4"}),r.jsx("span",{children:"Logout"})]})]})]})})}),r.jsx("main",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:r.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[r.jsxs("div",{className:"lg:col-span-2",children:[r.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-6",children:"Active Sessions"}),r.jsx("div",{className:"space-y-4",children:s.filter(p=>p.isActive).map(p=>{var I,L;const m=b(p.time,p.betsCloseAt),_=k(p.betsCloseAt),E=v(p.id),O=E.reduce((ee,A)=>ee+A.amount,0),S=x(p.id);return r.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6",children:[r.jsxs("div",{className:"flex justify-between items-start mb-4",children:[r.jsxs("div",{children:[r.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:p.name||`Session ${p.time}`}),r.jsxs("p",{className:"text-gray-600",children:["Time: ",p.time]}),r.jsxs("p",{className:"text-sm text-gray-500",children:["Betting closes at ",p.betsCloseAt]})]}),r.jsxs("div",{className:"text-right",children:[r.jsxs("div",{className:"flex items-center text-blue-600 mb-2",children:[r.jsx(_e,{className:"w-4 h-4 mr-1"}),r.jsx("span",{className:"font-mono",children:m})]}),r.jsxs("p",{className:"text-sm text-gray-500",children:["Pool: ₹",p.totalPool]})]})]}),E.length>0&&r.jsxs("div",{className:"mb-4 p-3 bg-blue-50 rounded-lg",children:[r.jsxs("p",{className:"text-sm text-blue-800",children:["Your bets: ",E.map(ee=>`${ee.number} (₹${ee.amount})`).join(", ")]}),r.jsxs("p",{className:"text-sm text-blue-600",children:["Total: ₹",O]}),r.jsxs("p",{className:"text-xs text-blue-500",children:["Potential win: ₹",O*9," (9x payout)"]})]}),S&&r.jsx("div",{className:"mb-4 p-3 bg-yellow-50 rounded-lg border border-yellow-200",children:r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{className:"flex items-center",children:[r.jsx(de,{className:"w-4 h-4 text-yellow-600 mr-2"}),r.jsxs("span",{className:"text-sm font-medium text-yellow-800",children:["Result: Number ",S.winningNumber," Won!"]})]}),((I=w(p.id))==null?void 0:I.won)&&r.jsx("div",{className:"flex items-center text-green-600",children:r.jsxs("span",{className:"text-sm font-medium",children:["You won ₹",(L=w(p.id))==null?void 0:L.amount,"!"]})})]})}),r.jsx("button",{onClick:()=>u(p.id),disabled:!_||!!S,className:`w-full py-2 px-4 rounded-lg font-medium transition-colors ${_&&!S?"bg-blue-600 text-white hover:bg-blue-700":"bg-gray-300 text-gray-500 cursor-not-allowed"}`,children:S?"Session Completed":_?"Place Bet":"Betting Closed"})]},p.id)})})]}),r.jsxs("div",{children:[r.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-6",children:"Previous Results"}),r.jsx("div",{className:"space-y-4",children:i.slice(-5).reverse().map(p=>{const m=s.find(_=>_.id===p.sessionId);return r.jsx("div",{className:"bg-white rounded-lg shadow-md p-4",children:r.jsxs("div",{className:"flex justify-between items-start mb-2",children:[r.jsxs("div",{children:[r.jsx("p",{className:"font-medium text-gray-900",children:(m==null?void 0:m.name)||`Session ${m==null?void 0:m.time}`}),r.jsx("p",{className:"text-sm text-gray-600",children:D(p.timestamp,"MMM dd, HH:mm")})]}),r.jsx("div",{className:"text-right",children:r.jsxs("div",{className:"flex items-center text-yellow-600",children:[r.jsx(de,{className:"w-4 h-4 mr-1"}),r.jsx("span",{className:"font-bold text-lg",children:p.winningNumber})]})})]})},p.id)})})]})]})}),c&&r.jsx(hi,{sessionId:c,onClose:()=>u(null)}),d&&r.jsx(fi,{onClose:()=>h(!1)})]})};function gi(n,e){const t=e.filter(f=>f.sessionId===n.id),s={};for(let f=0;f<=9;f++)s[f]=0;t.forEach(f=>{s[f.number]+=f.amount});let i=0,a=s[0];for(let f=1;f<=9;f++)s[f]<a&&(i=f,a=s[f]);const o=n.totalPool,l=a===0&&o>0;let c,u,d,h;if(l)c=o,u=0,d=0,h="Zero bet win - 100% to admin";else{c=0;const f=t.filter(g=>g.number===i);d=f.length,u=d>0?f[0].amount*9:0,h="9x multiplier - each winner gets 9 times their bet amount"}return{winningNumber:i,totalPool:o,adminFee:c,winnerCount:d,winnerPayout:u,isZeroBetWin:l,numberTotals:s,payoutRule:h}}function pi(n,e){if(!n.isActive)return!1;const t=new Date(`${n.date}T${n.time}:00`);return e>=t}function xi(n,e){return n.filter(t=>pi(t,e))}function yi(n,e){return`Jackpot Result for ${e}:
    Winning Number: ${n.winningNumber}
    Total Pool: ₹${n.totalPool}
    Admin Fee: ₹${n.adminFee}
    Winner Count: ${n.winnerCount}
    Payout Rule: ${n.payoutRule}
    Winner Payout: ${n.isZeroBetWin?"₹0":"₹"+n.winnerPayout+" per winner (9x bet amount)"}
    Zero Bet Win: ${n.isZeroBetWin}
    Number Distribution: ${JSON.stringify(n.numberTotals)}`}const wi=()=>{const{sessions:n,bets:e,processJackpot:t}=X(),s=j.useRef(new Set);j.useEffect(()=>{const i=()=>{xi(n,new Date).forEach(c=>{if(!s.current.has(c.id)){if(console.log(`Auto-processing jackpot for session ${c.id} at ${c.time}`),e.filter(d=>d.sessionId===c.id).length>0){const d=gi(c,e);console.log(yi(d,c.id))}t(c.id),s.current.add(c.id)}})},a=setInterval(i,3e4);return i(),()=>clearInterval(a)},[n,e,t]),j.useEffect(()=>{const i=new Set(n.map(o=>o.id));Array.from(s.current).forEach(o=>{i.has(o)||s.current.delete(o)})},[n])},vi=()=>{const{sessions:n,bets:e,createSession:t,results:s}=X(),[i,a]=j.useState(!1),[o,l]=j.useState(""),[c,u]=j.useState(""),[d,h]=j.useState(new Date);j.useEffect(()=>{const v=setInterval(()=>{h(new Date)},1e3);return()=>clearInterval(v)},[]);const f=()=>{o&&(t(o,c||void 0),l(""),u(""),a(!1))},g=v=>e.filter(x=>x.sessionId===v),y=v=>{const x=g(v),w={};for(let p=0;p<=9;p++)w[p]=0;return x.forEach(p=>{w[p.number]+=p.amount}),w},N=v=>s.find(x=>x.sessionId===v),b=v=>{const x=D(new Date,"yyyy-MM-dd"),w=new Date(`${x}T${v.time}:00`);return N(v.id)?{status:"completed",color:"bg-green-100 text-green-800",text:"Completed"}:v.isActive?be(d,w)?{status:"processing",color:"bg-yellow-100 text-yellow-800",text:"Processing..."}:{status:"active",color:"bg-green-100 text-green-800",text:"Active"}:{status:"processed",color:"bg-blue-100 text-blue-800",text:"Processed"}},k=v=>{const x=D(new Date,"yyyy-MM-dd"),p=new Date(`${x}T${v}:00`).getTime()-d.getTime();if(p<=0)return"Session Time Reached";const m=Math.floor(p/(1e3*60*60)),_=Math.floor(p%(1e3*60*60)/(1e3*60)),E=Math.floor(p%(1e3*60)/1e3);return m>0?`${m}h ${_}m ${E}s`:_>0?`${_}m ${E}s`:`${E}s`};return r.jsxs("div",{className:"space-y-6",children:[r.jsxs("div",{className:"flex justify-between items-center",children:[r.jsxs("div",{children:[r.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Session Management"}),r.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Jackpots are automatically processed at session end time"})]}),r.jsxs("button",{onClick:()=>a(!0),className:"flex items-center space-x-2 bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors",children:[r.jsx(Re,{className:"w-4 h-4"}),r.jsx("span",{children:"Create Session"})]})]}),r.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:n.map(v=>{const x=g(v.id),w=y(v.id),p=new Set(x.map(O=>O.userId)).size,m=b(v),_=N(v.id),E=k(v.time);return r.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6",children:[r.jsxs("div",{className:"flex justify-between items-start mb-4",children:[r.jsxs("div",{children:[r.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:v.name||`Session ${v.time}`}),r.jsxs("p",{className:"text-gray-600",children:["Time: ",v.time]}),r.jsxs("p",{className:"text-sm text-gray-500",children:["Created by: ",v.createdBy]}),v.isActive&&r.jsxs("p",{className:"text-sm text-blue-600 font-medium",children:[r.jsx(_e,{className:"w-3 h-3 inline mr-1"}),E]})]}),r.jsxs("div",{className:"text-right",children:[r.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${m.color}`,children:m.text}),_&&r.jsxs("div",{className:"mt-2 text-right",children:[r.jsxs("div",{className:"flex items-center text-yellow-600 text-sm",children:[r.jsx(de,{className:"w-4 h-4 mr-1"}),r.jsxs("span",{className:"font-bold",children:["Winner: ",_.winningNumber]})]}),r.jsxs("p",{className:"text-xs text-gray-500",children:[_.winnerCount," winners",!_.isZeroBetWin&&r.jsx("span",{children:", 9x payout each"})]})]})]})]}),r.jsxs("div",{className:"grid grid-cols-3 gap-4 mb-4",children:[r.jsxs("div",{className:"text-center",children:[r.jsx("div",{className:"flex items-center justify-center text-blue-600 mb-1",children:r.jsx(z,{className:"w-4 h-4 mr-1"})}),r.jsx("p",{className:"text-sm text-gray-600",children:"Total Pool"}),r.jsxs("p",{className:"font-semibold",children:["₹",v.totalPool]})]}),r.jsxs("div",{className:"text-center",children:[r.jsx("div",{className:"flex items-center justify-center text-green-600 mb-1",children:r.jsx(je,{className:"w-4 h-4 mr-1"})}),r.jsx("p",{className:"text-sm text-gray-600",children:"Bettors"}),r.jsx("p",{className:"font-semibold",children:p})]}),r.jsxs("div",{className:"text-center",children:[r.jsx("div",{className:"flex items-center justify-center text-purple-600 mb-1",children:r.jsx(de,{className:"w-4 h-4 mr-1"})}),r.jsx("p",{className:"text-sm text-gray-600",children:"Total Bets"}),r.jsx("p",{className:"font-semibold",children:x.length})]})]}),r.jsxs("div",{className:"border-t pt-4",children:[r.jsx("h4",{className:"text-sm font-medium text-gray-700 mb-2",children:"Bets by Number"}),r.jsx("div",{className:"grid grid-cols-5 gap-2",children:Object.entries(w).map(([O,S])=>r.jsxs("div",{className:`text-center p-2 rounded ${_&&_.winningNumber===parseInt(O)?"bg-yellow-100 border-2 border-yellow-400":"bg-gray-50"}`,children:[r.jsxs("div",{className:"font-semibold text-gray-900 flex items-center justify-center",children:[O,_&&_.winningNumber===parseInt(O)&&r.jsx($s,{className:"w-3 h-3 ml-1 text-yellow-600"})]}),r.jsxs("div",{className:"text-xs text-gray-600",children:["₹",S]})]},O))})]}),_&&r.jsxs("div",{className:"border-t pt-4 mt-4",children:[r.jsx("h4",{className:"text-sm font-medium text-gray-700 mb-2",children:"Result Summary"}),r.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[r.jsxs("div",{children:[r.jsx("p",{className:"text-gray-600",children:"Payout Rule:"}),r.jsx("p",{className:"font-semibold text-blue-600",children:_.isZeroBetWin?"Zero bet win":"9x multiplier"})]}),r.jsxs("div",{children:[r.jsx("p",{className:"text-gray-600",children:"Admin Earnings:"}),r.jsxs("p",{className:"font-semibold text-green-600",children:["₹",_.adminFee]})]}),_.isZeroBetWin&&r.jsx("div",{className:"col-span-2",children:r.jsx("p",{className:"text-xs text-orange-600 font-medium",children:"Zero Bet Win: No one bet on winning number"})})]})]})]},v.id)})}),i&&r.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:r.jsx("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-md",children:r.jsxs("div",{className:"p-6",children:[r.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Create New Session"}),r.jsxs("div",{className:"space-y-4",children:[r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Session Time *"}),r.jsx("input",{type:"time",value:o,onChange:v=>l(v.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Session Name (Optional)"}),r.jsx("input",{type:"text",value:c,onChange:v=>u(v.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"e.g., Evening Special"})]})]}),r.jsxs("div",{className:"flex space-x-3 mt-6",children:[r.jsx("button",{onClick:()=>a(!1),className:"flex-1 py-2 px-4 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 transition-colors",children:"Cancel"}),r.jsx("button",{onClick:f,className:"flex-1 py-2 px-4 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:"Create Session"})]})]})})})]})},bi=()=>{const{withdrawals:n,processWithdrawal:e}=X(),t=(o,l)=>{e(o,l)},s=n.filter(o=>o.status==="pending"),i=n.filter(o=>o.status!=="pending"),a=o=>{switch(o){case"pending":return"bg-yellow-100 text-yellow-800";case"approved":return"bg-green-100 text-green-800";case"rejected":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}};return r.jsxs("div",{className:"space-y-6",children:[r.jsxs("div",{className:"flex justify-between items-center",children:[r.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Withdrawal Management"}),r.jsxs("div",{className:"flex items-center space-x-4 text-sm text-gray-600",children:[r.jsxs("div",{className:"flex items-center",children:[r.jsx(_e,{className:"w-4 h-4 mr-1 text-yellow-600"}),r.jsxs("span",{children:[s.length," Pending"]})]}),r.jsxs("div",{className:"flex items-center",children:[r.jsx(Nt,{className:"w-4 h-4 mr-1 text-green-600"}),r.jsxs("span",{children:[i.filter(o=>o.status==="approved").length," Approved"]})]})]})]}),s.length>0&&r.jsxs("div",{className:"bg-white rounded-lg shadow-md",children:[r.jsx("div",{className:"px-6 py-4 border-b border-gray-200",children:r.jsxs("h3",{className:"text-lg font-semibold text-gray-900 flex items-center",children:[r.jsx(_e,{className:"w-5 h-5 mr-2 text-yellow-600"}),"Pending Withdrawals (",s.length,")"]})}),r.jsx("div",{className:"divide-y divide-gray-200",children:s.map(o=>r.jsx("div",{className:"p-6",children:r.jsxs("div",{className:"flex justify-between items-start",children:[r.jsxs("div",{className:"flex-1",children:[r.jsxs("div",{className:"flex items-center space-x-4 mb-3",children:[r.jsxs("div",{className:"flex items-center text-gray-600",children:[r.jsx(qt,{className:"w-4 h-4 mr-1"}),r.jsxs("span",{className:"text-sm",children:["User ID: ",o.userId]})]}),r.jsxs("div",{className:"flex items-center text-gray-600",children:[r.jsx(rt,{className:"w-4 h-4 mr-1"}),r.jsx("span",{className:"text-sm",children:D(o.requestedAt,"MMM dd, yyyy HH:mm")})]})]}),r.jsxs("div",{className:"flex items-center space-x-4",children:[r.jsxs("div",{className:"flex items-center text-green-600",children:[r.jsx(z,{className:"w-5 h-5 mr-1"}),r.jsxs("span",{className:"text-xl font-bold",children:["₹",o.amount]})]}),r.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${a(o.status)}`,children:o.status.charAt(0).toUpperCase()+o.status.slice(1)})]})]}),r.jsxs("div",{className:"flex space-x-2",children:[r.jsxs("button",{onClick:()=>t(o.id,"approved"),className:"flex items-center space-x-1 bg-green-600 text-white px-3 py-2 rounded-lg hover:bg-green-700 transition-colors",children:[r.jsx(Nt,{className:"w-4 h-4"}),r.jsx("span",{children:"Approve"})]}),r.jsxs("button",{onClick:()=>t(o.id,"rejected"),className:"flex items-center space-x-1 bg-red-600 text-white px-3 py-2 rounded-lg hover:bg-red-700 transition-colors",children:[r.jsx(Le,{className:"w-4 h-4"}),r.jsx("span",{children:"Reject"})]})]})]})},o.id))})]}),r.jsxs("div",{className:"bg-white rounded-lg shadow-md",children:[r.jsx("div",{className:"px-6 py-4 border-b border-gray-200",children:r.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Recent Processed Withdrawals"})}),r.jsx("div",{className:"overflow-x-auto",children:r.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[r.jsx("thead",{className:"bg-gray-50",children:r.jsxs("tr",{children:[r.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"User"}),r.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Amount"}),r.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),r.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Requested"}),r.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Processed"}),r.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Processed By"})]})}),r.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:i.slice(0,10).map(o=>r.jsxs("tr",{children:[r.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:o.userId}),r.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:["₹",o.amount]}),r.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:r.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${a(o.status)}`,children:o.status.charAt(0).toUpperCase()+o.status.slice(1)})}),r.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:D(o.requestedAt,"MMM dd, yyyy HH:mm")}),r.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:o.processedAt?D(o.processedAt,"MMM dd, yyyy HH:mm"):"-"}),r.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:o.processedBy||"-"})]},o.id))})]})})]}),s.length===0&&i.length===0&&r.jsxs("div",{className:"bg-white rounded-lg shadow-md p-8 text-center",children:[r.jsx(z,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),r.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No Withdrawals"}),r.jsx("p",{className:"text-gray-600",children:"No withdrawal requests have been made yet."})]})]})},_i=()=>{const{bets:n,transactions:e}=X(),[t,s]=j.useState(""),i=[{id:"user1",email:"test@gmail.com",fullName:"Demo User",isAdmin:!1,walletBalance:1e3,createdAt:new Date("2024-01-15")},{id:"admin1",email:"Admin@admin.com",fullName:"System Admin",isAdmin:!0,walletBalance:0,createdAt:new Date("2024-01-01")}],a=i.filter(l=>l.fullName.toLowerCase().includes(t.toLowerCase())||l.email.toLowerCase().includes(t.toLowerCase())),o=l=>{const c=n.filter(f=>f.userId===l),u=e.filter(f=>f.userId===l),d=c.reduce((f,g)=>f+g.amount,0),h=u.filter(f=>f.type==="win").reduce((f,g)=>f+g.amount,0);return{totalBets:c.length,totalBetAmount:d,totalWinnings:h,totalTransactions:u.length}};return r.jsxs("div",{className:"space-y-6",children:[r.jsxs("div",{className:"flex justify-between items-center",children:[r.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"User Management"}),r.jsx("div",{className:"flex items-center space-x-4",children:r.jsxs("div",{className:"relative",children:[r.jsx(Os,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),r.jsx("input",{type:"text",placeholder:"Search users...",value:t,onChange:l=>s(l.target.value),className:"pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]})})]}),r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[r.jsx("div",{className:"bg-white rounded-lg shadow-md p-6",children:r.jsxs("div",{className:"flex items-center",children:[r.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:r.jsx(je,{className:"w-6 h-6 text-blue-600"})}),r.jsxs("div",{className:"ml-4",children:[r.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Total Users"}),r.jsx("p",{className:"text-2xl font-bold text-gray-900",children:i.length})]})]})}),r.jsx("div",{className:"bg-white rounded-lg shadow-md p-6",children:r.jsxs("div",{className:"flex items-center",children:[r.jsx("div",{className:"p-2 bg-green-100 rounded-lg",children:r.jsx(z,{className:"w-6 h-6 text-green-600"})}),r.jsxs("div",{className:"ml-4",children:[r.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Total Wallet Balance"}),r.jsxs("p",{className:"text-2xl font-bold text-gray-900",children:["₹",i.reduce((l,c)=>l+c.walletBalance,0)]})]})]})}),r.jsx("div",{className:"bg-white rounded-lg shadow-md p-6",children:r.jsxs("div",{className:"flex items-center",children:[r.jsx("div",{className:"p-2 bg-purple-100 rounded-lg",children:r.jsx(de,{className:"w-6 h-6 text-purple-600"})}),r.jsxs("div",{className:"ml-4",children:[r.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Active Bettors"}),r.jsx("p",{className:"text-2xl font-bold text-gray-900",children:new Set(n.map(l=>l.userId)).size})]})]})})]}),r.jsxs("div",{className:"bg-white rounded-lg shadow-md",children:[r.jsx("div",{className:"px-6 py-4 border-b border-gray-200",children:r.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"All Users"})}),r.jsx("div",{className:"overflow-x-auto",children:r.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[r.jsx("thead",{className:"bg-gray-50",children:r.jsxs("tr",{children:[r.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"User"}),r.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Role"}),r.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Wallet Balance"}),r.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Total Bets"}),r.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Bet Amount"}),r.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Winnings"}),r.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Joined"})]})}),r.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:a.map(l=>{const c=o(l.id);return r.jsxs("tr",{className:"hover:bg-gray-50",children:[r.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:r.jsxs("div",{children:[r.jsx("div",{className:"text-sm font-medium text-gray-900",children:l.fullName}),r.jsx("div",{className:"text-sm text-gray-500",children:l.email})]})}),r.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:r.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${l.isAdmin?"bg-purple-100 text-purple-800":"bg-blue-100 text-blue-800"}`,children:l.isAdmin?"Admin":"User"})}),r.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:["₹",l.walletBalance]}),r.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:c.totalBets}),r.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:["₹",c.totalBetAmount]}),r.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:["₹",c.totalWinnings]}),r.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:D(l.createdAt,"MMM dd, yyyy")})]},l.id)})})]})})]}),a.length===0&&r.jsxs("div",{className:"bg-white rounded-lg shadow-md p-8 text-center",children:[r.jsx(je,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),r.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No Users Found"}),r.jsx("p",{className:"text-gray-600",children:t?"No users match your search criteria.":"No users have registered yet."})]})]})},ji=()=>{const{logout:n}=me(),{sessions:e,bets:t,results:s,withdrawals:i}=X(),[a,o]=j.useState("overview");wi();const l=e.reduce((g,y)=>g+y.totalPool,0),c=t.length,u=i.filter(g=>g.status==="pending").length,d=s.reduce((g,y)=>g+(y.isZeroBetWin?y.adminFee:0),0),h=e.filter(g=>g.isActive).length,f=[{id:"overview",label:"Overview",icon:Cs},{id:"sessions",label:"Sessions",icon:rt},{id:"withdrawals",label:"Withdrawals",icon:z},{id:"users",label:"Users",icon:je}];return r.jsxs("div",{className:"min-h-screen bg-gray-50",children:[r.jsx("header",{className:"bg-white shadow-sm border-b",children:r.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:r.jsxs("div",{className:"flex justify-between items-center h-16",children:[r.jsxs("div",{children:[r.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Admin Panel"}),r.jsxs("div",{className:"flex items-center space-x-4",children:[r.jsx("p",{className:"text-sm text-gray-600",children:"LuckyPick Lottery Management"}),r.jsxs("div",{className:"flex items-center text-green-600 text-xs",children:[r.jsx(Ge,{className:"w-3 h-3 mr-1"}),r.jsx("span",{children:"Auto Jackpot Active"})]})]})]}),r.jsxs("button",{onClick:n,className:"flex items-center space-x-2 text-gray-600 hover:text-gray-800 transition-colors",children:[r.jsx(Ft,{className:"w-4 h-4"}),r.jsx("span",{children:"Logout"})]})]})})}),r.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:r.jsxs("div",{className:"flex space-x-8",children:[r.jsx("div",{className:"w-64 bg-white rounded-lg shadow-md p-4",children:r.jsx("nav",{className:"space-y-2",children:f.map(g=>{const y=g.icon;return r.jsxs("button",{onClick:()=>o(g.id),className:`w-full flex items-center space-x-3 px-3 py-2 rounded-lg text-left transition-colors ${a===g.id?"bg-blue-100 text-blue-700":"text-gray-600 hover:bg-gray-100"}`,children:[r.jsx(y,{className:"w-5 h-5"}),r.jsx("span",{children:g.label})]},g.id)})})}),r.jsxs("div",{className:"flex-1",children:[a==="overview"&&r.jsxs("div",{className:"space-y-6",children:[r.jsxs("div",{className:"flex justify-between items-center",children:[r.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Dashboard Overview"}),r.jsxs("div",{className:"flex items-center text-sm text-green-600 bg-green-50 px-3 py-1 rounded-full",children:[r.jsx(Ge,{className:"w-4 h-4 mr-1"}),r.jsx("span",{children:"Auto Processing Enabled"})]})]}),r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-6",children:[r.jsx("div",{className:"bg-white rounded-lg shadow-md p-6",children:r.jsxs("div",{className:"flex items-center",children:[r.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:r.jsx(z,{className:"w-6 h-6 text-blue-600"})}),r.jsxs("div",{className:"ml-4",children:[r.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Total Pool"}),r.jsxs("p",{className:"text-2xl font-bold text-gray-900",children:["₹",l]})]})]})}),r.jsx("div",{className:"bg-white rounded-lg shadow-md p-6",children:r.jsxs("div",{className:"flex items-center",children:[r.jsx("div",{className:"p-2 bg-green-100 rounded-lg",children:r.jsx(de,{className:"w-6 h-6 text-green-600"})}),r.jsxs("div",{className:"ml-4",children:[r.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Admin Earnings"}),r.jsxs("p",{className:"text-2xl font-bold text-gray-900",children:["₹",d]}),r.jsx("p",{className:"text-xs text-gray-500",children:"Zero bet wins only"})]})]})}),r.jsx("div",{className:"bg-white rounded-lg shadow-md p-6",children:r.jsxs("div",{className:"flex items-center",children:[r.jsx("div",{className:"p-2 bg-purple-100 rounded-lg",children:r.jsx(_e,{className:"w-6 h-6 text-purple-600"})}),r.jsxs("div",{className:"ml-4",children:[r.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Total Bets"}),r.jsx("p",{className:"text-2xl font-bold text-gray-900",children:c})]})]})}),r.jsx("div",{className:"bg-white rounded-lg shadow-md p-6",children:r.jsxs("div",{className:"flex items-center",children:[r.jsx("div",{className:"p-2 bg-yellow-100 rounded-lg",children:r.jsx(je,{className:"w-6 h-6 text-yellow-600"})}),r.jsxs("div",{className:"ml-4",children:[r.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Pending Withdrawals"}),r.jsx("p",{className:"text-2xl font-bold text-gray-900",children:u})]})]})}),r.jsx("div",{className:"bg-white rounded-lg shadow-md p-6",children:r.jsxs("div",{className:"flex items-center",children:[r.jsx("div",{className:"p-2 bg-indigo-100 rounded-lg",children:r.jsx(rt,{className:"w-6 h-6 text-indigo-600"})}),r.jsxs("div",{className:"ml-4",children:[r.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Active Sessions"}),r.jsx("p",{className:"text-2xl font-bold text-gray-900",children:h})]})]})})]}),r.jsx("div",{className:"bg-gradient-to-r from-green-50 to-blue-50 rounded-lg p-6 border border-green-200",children:r.jsxs("div",{className:"flex items-start space-x-4",children:[r.jsx("div",{className:"p-2 bg-green-100 rounded-lg",children:r.jsx(Ge,{className:"w-6 h-6 text-green-600"})}),r.jsxs("div",{children:[r.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Auto Jackpot System - 9x Payout Rule"}),r.jsx("p",{className:"text-gray-700 mb-3",children:"Jackpots are automatically calculated and published when sessions reach their end time. Winners receive 9 times their bet amount with no admin commission."}),r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 text-sm",children:[r.jsxs("div",{className:"bg-white p-3 rounded-lg",children:[r.jsx("p",{className:"font-medium text-gray-900",children:"Winning Logic"}),r.jsx("p",{className:"text-gray-600",children:"Number with lowest total bets wins"})]}),r.jsxs("div",{className:"bg-white p-3 rounded-lg",children:[r.jsx("p",{className:"font-medium text-gray-900",children:"Payout Rule"}),r.jsx("p",{className:"text-gray-600",children:"Each winner gets 9x their bet amount"})]}),r.jsxs("div",{className:"bg-white p-3 rounded-lg",children:[r.jsx("p",{className:"font-medium text-gray-900",children:"Zero Bet Rule"}),r.jsx("p",{className:"text-gray-600",children:"100% to admin if no bets on winner"})]})]})]})]})}),r.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6",children:[r.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Recent Auto-Processed Results"}),r.jsx("div",{className:"overflow-x-auto",children:r.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[r.jsx("thead",{className:"bg-gray-50",children:r.jsxs("tr",{children:[r.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Session"}),r.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Winning Number"}),r.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Total Pool"}),r.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Payout Rule"}),r.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Winners"}),r.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Processed At"})]})}),r.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:s.slice(-5).reverse().map(g=>{const y=e.find(N=>N.id===g.sessionId);return r.jsxs("tr",{children:[r.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:(y==null?void 0:y.name)||(y==null?void 0:y.time)}),r.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:r.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800",children:g.winningNumber})}),r.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:["₹",g.totalPool]}),r.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-blue-600",children:g.isZeroBetWin?"Zero bet win":"9x multiplier"}),r.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:[g.winnerCount,g.isZeroBetWin&&r.jsx("span",{className:"ml-1 text-xs text-orange-600",children:"(Zero bet)"})]}),r.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:new Date(g.timestamp).toLocaleString()})]},g.id)})})]})})]})]}),a==="sessions"&&r.jsx(vi,{}),a==="withdrawals"&&r.jsx(bi,{}),a==="users"&&r.jsx(_i,{})]})]})})]})},Ni=()=>{const[n,e]=j.useState(null),[t,s]=j.useState(!1),[i,a]=j.useState(!1);return j.useEffect(()=>{const l=window.matchMedia("(display-mode: standalone)").matches,c=window.navigator.standalone===!0;a(l||c);const u=h=>{h.preventDefault(),e(h),s(!0)},d=()=>{a(!0),s(!1),e(null)};return window.addEventListener("beforeinstallprompt",u),window.addEventListener("appinstalled",d),()=>{window.removeEventListener("beforeinstallprompt",u),window.removeEventListener("appinstalled",d)}},[]),{isInstallable:t,isInstalled:i,installApp:async()=>{if(!n)return;n.prompt();const{outcome:l}=await n.userChoice;l==="accepted"&&(e(null),s(!1))}}},ki=()=>{const{isInstallable:n,installApp:e}=Ni(),[t,s]=st.useState(!1);return st.useEffect(()=>{if(n){const i=setTimeout(()=>{s(!0)},3e3);return()=>clearTimeout(i)}},[n]),!n||!t?null:r.jsx("div",{className:"fixed bottom-4 left-4 right-4 bg-blue-600 text-white p-4 rounded-lg shadow-lg z-50 md:left-auto md:right-4 md:max-w-sm",children:r.jsxs("div",{className:"flex items-start space-x-3",children:[r.jsx("div",{className:"flex-shrink-0",children:r.jsx(Ie,{className:"w-6 h-6"})}),r.jsxs("div",{className:"flex-1",children:[r.jsx("h3",{className:"font-semibold text-sm",children:"Install LuckyPick"}),r.jsx("p",{className:"text-xs text-blue-100 mt-1",children:"Add to your home screen for quick access and offline use"}),r.jsxs("div",{className:"flex space-x-2 mt-3",children:[r.jsx("button",{onClick:e,className:"bg-white text-blue-600 px-3 py-1 rounded text-xs font-medium hover:bg-blue-50 transition-colors",children:"Install"}),r.jsx("button",{onClick:()=>s(!1),className:"text-blue-100 px-3 py-1 rounded text-xs hover:text-white transition-colors",children:"Later"})]})]}),r.jsx("button",{onClick:()=>s(!1),className:"flex-shrink-0 text-blue-200 hover:text-white transition-colors",children:r.jsx(Le,{className:"w-4 h-4"})})]})})},Si=()=>{const{isOnline:n,wasOffline:e}=ft();return n&&!e?null:r.jsx("div",{className:`fixed top-0 left-0 right-0 z-50 p-2 text-center text-sm font-medium transition-colors ${n?"bg-green-600 text-white":"bg-red-600 text-white"}`,children:r.jsx("div",{className:"flex items-center justify-center space-x-2",children:n?r.jsxs(r.Fragment,{children:[r.jsx(Is,{className:"w-4 h-4"}),r.jsx("span",{children:"Back online - syncing data..."})]}):r.jsxs(r.Fragment,{children:[r.jsx(Rs,{className:"w-4 h-4"}),r.jsx("span",{children:"You're offline - some features may be limited"})]})})})},Ti=()=>{const{user:n}=me();return n?n.isAdmin?r.jsx(ji,{}):r.jsx(mi,{}):r.jsx(ui,{})};function Ei(){return r.jsx(Ns,{children:r.jsx(ci,{children:r.jsxs(di,{children:[r.jsx(Si,{}),r.jsx(Ti,{}),r.jsx(ki,{})]})})})}nt.createRoot(document.getElementById("root")).render(r.jsx(st.StrictMode,{children:r.jsx(Ei,{})}));
